<!DOCTYPE html>
<html>
	<head>
		<title>CSV ë°ì´í„°ë¥¼ HTML í‘œë¡œ ë¶ˆëŸ¬ì˜¤ê¸°</title>
		<style>
			th {
				cursor: pointer;
				text-align: center;
			}
	
			th.sorted-asc::after {
				content: "â–²";
			}
	
			th.sorted-desc::after {
				content: "â–¼";
			}
	
			th, td {
				font-family: Malgun Gothic;
				border: 1px solid #909090;
				min-width: 42px;
			}
	
			table, iframe, .nav-container {
				width: 98%;
				margin: 0 auto; /* ê°€ìš´ë° ì •ë ¬ */
				border-collapse: collapse;
				margin-bottom: 25px; /* ì¡°ê¸ˆ ë„ìš°ê¸° */
				border: 1px solid #909090;
				background-color: #2f2f2f;
			}

			#floatingContainer{
				top: 0;
				height: 30px;
				position: fixed;
				bottom: 10px;
				right: 10px;
				font-size: 20px;
				border: none;
				border-radius: 5px;
				z-index: 999; /* ë‹¤ë¥¸ ìš”ì†Œ ìœ„ë¡œ í‘œì‹œí•˜ê¸° ìœ„í•´ ë†’ì€ ê°’ ì„¤ì • */
				background: none;
			}

			select {
				background-color: #2f2f2f;
				color: #dddddd;
			}
			
			#floatingToggleButton {
				display: inline;
				cursor: pointer;
				background: none;
			}

			body {
				font-size: 14px;
				background-color: #1f1f1f;
				color: #dddddd;
			}
		</style>

	</head>
	
<body data-server-no-reload>
	<div class="nav-container">
		<div class="nav-content">
			<span>íƒœê·¸ã€€</span>
			<select id="includeTagDropdown1">
				<option value="">í¬í•¨</option>
			</select><select id="includeTagDropdown2">
				<option value="">í¬í•¨</option>
			</select><select id="excludeTagDropdown1">
				<option value="">ë¯¸í¬í•¨</option>
			</select><select id="excludeTagDropdown2">
				<option value="">ë¯¸í¬í•¨</option>
			</select>
		</div>
		<div class="nav-content">
			<span>í‹°ì–´ã€€</span>
			<select id="tierAboveDropdown">
				<option value="">ì´ìƒ</option>
			</select><select id="tierBelowDropdown">
				<option value="">ì´í•˜</option>
			</select><label for="hideForeignLanguage">ã€€ì™¸êµ­ì–´</label>
			<input type="checkbox" id="hideForeignLanguage">
			<label for="hideSolved">í•´ê²°</label>
			<input type="checkbox" id="hideSolved">
		</div>
		<div class="nav-content">
			<span>ê°±ì‹ ã€€</span>
			<select id="refreshDropdown">
				<option value="ì„ íƒ">ì„ íƒ</option>
				<option value="ì¡°ê±´ëŒ€ë¡œ">ì¡°ê±´ëŒ€ë¡œ</option>
				<option value="ëœë¤ë””íœìŠ¤">ëœë¤ë””íœìŠ¤</option>
				<option value="ì´ˆê¸°í™”">ì´ˆê¸°í™”</option>
			</select>
		</div>
	</div>
	<div id="floatingContainer">
		<div id="floatingToggleButton" onclick="toggleNav()">ğŸ´</div>
		<div id="floatingToggleButton" onclick="toggleTable()">ğŸ“‹</div>
		<div id="floatingToggleButton" onclick="toggleProblem()">âœ</div>
	</div>
	<table id="csvTable">
		<thead>
		</thead>
		<tbody>
		</tbody>
	</table>
	<iframe id="csvIframe" style="display: none;" src="./BOJ/ë°±ì¤€ë¦¬ìŠ¤íŠ¸.html"></iframe>
	<iframe src="about:blank" id="iframeProblem"></iframe>
	<script>
		function toggleNav() {
			const navContainer = document.querySelector('.nav-container');
			navContainer.style.display = navContainer.style.display=='none' ? 'block' : 'none';
		}
		function toggleTable() {
			const csvTable= document.querySelector('#csvTable');
			csvTable.style.display = csvTable.style.display=='none' ? 'table' : 'none';
		}
		const iframe = document.getElementById("csvIframe");
		iframe.addEventListener("load", once);
		function once() {
			iframe.removeEventListener("load", once);
			const csvData = iframe.contentDocument.body.textContent;
			const table = document.getElementById("csvTable");
			const includeTagDropdown1 = document.getElementById("includeTagDropdown1");
			const includeTagDropdown2 = document.getElementById("includeTagDropdown2");
			const excludeTagDropdown1 = document.getElementById("excludeTagDropdown1");
			const excludeTagDropdown2 = document.getElementById("excludeTagDropdown2");
			const tierAboveDropdown = document.getElementById("tierAboveDropdown");
			const tierBelowDropdown = document.getElementById("tierBelowDropdown");
			const refreshDropdown = document.getElementById("refreshDropdown");
			const hideForeignLanguageCheckbox = document.getElementById("hideForeignLanguage");
			const hideSolvedCheckbox = document.getElementById("hideSolved");
			
			const tiers='ë¸Œì‹¤ê³¨í”Œë‹¤ë£¨';
			const tiersColor=["saddlebrown","white","gold","lime","blue","red"];
			// í‹°ì–´ ì´ìƒ ë° ì´í•˜ ë“œë¡­ë‹¤ìš´ì— 1ë¶€í„° 30ê¹Œì§€ì˜ ìì—°ìˆ˜ë¥¼ ë°˜ë³µë¬¸ìœ¼ë¡œ ì¶”ê°€
			for (let i = 1; i <= 30; i++) {
				const option = document.createElement("option");
				option.value = i.toString();
				option.textContent = tiers[Math.floor((i-1)/5)]+(5-(i-1)%5+"");
				tierAboveDropdown.appendChild(option);
				tierBelowDropdown.appendChild(option.cloneNode(true));
			}

			// ë“œë¡­ë‹¤ìš´ ì˜µì…˜ ì±„ìš°ê¸°
			const uniqueTags = [...new Set(csvData.split("\n").map(row => row.split(",")[2].split('/')).flat())]
			uniqueTags.forEach(tag => {
				if (tag == 'íƒœê·¸')
					return;
				const option = document.createElement("option");
				option.value = tag;
				option.textContent = tag;
				includeTagDropdown1.appendChild(option);
				includeTagDropdown2.appendChild(option.cloneNode(true));
				excludeTagDropdown1.appendChild(option.cloneNode(true));
				excludeTagDropdown2.appendChild(option.cloneNode(true));
			});

			// ë¨¸ë¦¬ê¸€ í–‰ ìƒì„±
			const headerRow = document.createElement("tr");
			const headers = csvData.split("\n")[0].split(",");
			headers.forEach(headerText => {
				const th = document.createElement("th");
				th.textContent = headerText;
				th.addEventListener("click", () => sortTable(headers.indexOf(headerText)));
				if (headerText == 'ì™¸êµ­ì–´' || headerText == 'í•´ê²°')
					th.style.display="none";
				headerRow.appendChild(th);
			});
			table.querySelector("thead").appendChild(headerRow);
			
			// ë‚˜ë¨¸ì§€ ì¤„ì„ í…Œì´ë¸” ë³¸ë¬¸ì— ì¶”ê°€
			csvData.split("\n").slice(1).forEach(row => {
				const rowData = row.split(",");
				if (rowData.length > 1) {
					const newRow = document.createElement("tr");
					for (let j = 0; j < rowData.length; j++) {
						const cellValue = rowData[j];
						const cell = createCell(cellValue, j, newRow);
						newRow.appendChild(cell);
					}
					table.querySelector("tbody").appendChild(newRow);
				}
			});

			function createCell(value, columnIndex, tr) {
				const td = document.createElement("td");
				td.textContent = value
				if (columnIndex === 0){
					td.addEventListener("click",()=>{
						console.log(value);
						changeIframeSource(value);
					});
				}

				if (columnIndex === 3){
					td.style.color = tiersColor[Math.floor((value-1)/5)];
				}

				if (columnIndex === 4){
					td.textContent = Math.round(value/100)/10 + 'k';
				}
				if (columnIndex === 6){
					if (td.textContent == 1){
						tr.style.color='gray';
					}
					td.style.display="none";
				}
				if (columnIndex === 7){
					if (td.textContent == 1){
						tr.style.color="#4c7d4c";
					}
					td.style.display="none";
				}
				if (columnIndex != 1 && columnIndex != 2){
					td.style.textAlign = "center";
				}
				return td;
			};

			let sortingColumn = -1;
			let ascending = true;
			
			function sortTable(columnIndex) {
				const tbody = table.querySelector("tbody");
				const rows = Array.from(tbody.rows);

				if (sortingColumn === columnIndex) {
					ascending = !ascending;
				} else {
					ascending = true;
					sortingColumn = columnIndex;
				}

				// ë¨¸ë¦¬ê¸€ ì…€ì— ì •ë ¬ ì•„ì´ì½˜ì„ ì¶”ê°€
				const th = table.querySelector("thead").querySelectorAll("th");
				th.forEach((header, index) => {
					header.classList.remove("sorted-asc", "sorted-desc");
					if (index === columnIndex)
						header.classList.add(ascending ? "sorted-asc" : "sorted-desc");
				});

				rows.sort((a, b) => {
					var cellA = a.cells[columnIndex].textContent.trim();
					var cellB = b.cells[columnIndex].textContent.trim();
					
					if (ascending)
						return cellA.localeCompare(cellB, undefined, { numeric: true, sensitivity: 'base' });
					else
						return cellB.localeCompare(cellA, undefined, { numeric: true, sensitivity: 'base' });
				});
				// í–‰ì„ ì •ë ¬ëœ ìˆœì„œë¡œ ë‹¤ì‹œ ì‚½ì…
				for (const row of rows) {
					tbody.appendChild(row);
				}
			}

			// ë“œë¡­ë‹¤ìš´ ë³€ê²½ ì‹œ í•„í„°ë§ ì ìš©
			includeTagDropdown1.addEventListener("change", () => filterTable());
			includeTagDropdown2.addEventListener("change", () => filterTable());
			excludeTagDropdown1.addEventListener("change", () => filterTable());
			excludeTagDropdown2.addEventListener("change", () => filterTable());
			tierAboveDropdown.addEventListener("change", () => filterTable());
			tierBelowDropdown.addEventListener("change", () => filterTable());
			refreshDropdown.addEventListener("change", () => {
				refreshTable();
				refreshDropdown.selectedIndex = 0; // ê¸°ë³¸ ì˜µì…˜ìœ¼ë¡œ ë¦¬ì…‹
			});
			hideForeignLanguageCheckbox.addEventListener("change", () => filterTable());
			hideSolvedCheckbox.addEventListener("change", () => filterTable());
			
			function filterTable() {
				const selectedIncludeTag1 = includeTagDropdown1.value;
				const selectedIncludeTag2 = includeTagDropdown2.value;
				const selectedExcludeTag1 = excludeTagDropdown1.value;
				const selectedExcludeTag2 = excludeTagDropdown2.value;
				const selectedTierAbove = tierAboveDropdown.value;
				const selectedTierBelow = tierBelowDropdown.value;
				const hideForeignLanguage = hideForeignLanguageCheckbox.checked;
				const hideSolved = hideSolvedCheckbox.checked;
				
				const tbody = table.querySelector("tbody");
				const rows = Array.from(tbody.rows);

				rows.forEach(row => {
					const rowData = row.cells[2].textContent;
					const tierData = parseInt(row.cells[3].textContent);
					const hasForeignLanguage = row.cells[6].textContent === "1";
					const isSolved = row.cells[7].textContent === "1";
					const tags = rowData.split('/');
					const includeTag1Match = !selectedIncludeTag1 || tags.includes(selectedIncludeTag1);
					const includeTag2Match = !selectedIncludeTag2 || tags.includes(selectedIncludeTag2);
					const excludeTag1Match = !selectedExcludeTag1 || !tags.includes(selectedExcludeTag1);
					const excludeTag2Match = !selectedExcludeTag2 || !tags.includes(selectedExcludeTag2);
					const tierMatch = (!selectedTierAbove || tierData >= parseInt(selectedTierAbove)) && (!selectedTierBelow || tierData <= parseInt(selectedTierBelow));

					const showRow = includeTag1Match && includeTag2Match &&
					excludeTag1Match && excludeTag2Match &&
					tierMatch &&
					(hideForeignLanguage || !hasForeignLanguage) && (hideSolved || !isSolved);

					row.style.display = showRow ? "table-row" : "none";
				});
			}

			function refreshTable() {
				// ìƒˆë¡œ ê³ ì¹¨ ë“œë¡­ë‹¤ìš´ì—ì„œ ì„ íƒëœ ì˜µì…˜ì„ í™•ì¸
				const refreshOption = refreshDropdown.value;

				if (refreshOption === "ì¡°ê±´ëŒ€ë¡œ") {
					// ì¡°ê±´ì— ë”°ë¼ í•„í„°ë§
					filterTable();
				} else if (refreshOption === "ëœë¤ë””íœìŠ¤") {
					// ëœë¤ í•„í„°ë§ ì˜ˆì œ: í•„í„°ëœ ë°ì´í„° ì¤‘ì—ì„œ ëœë¤ìœ¼ë¡œ 3ê°œ í‘œì‹œ
					filterTable();
					const filteredRows = Array.from(table.querySelector("tbody").rows).filter(row => row.style.display === "table-row");
					const randomIndices = generateRandomIndices(filteredRows.length, 3);
					filteredRows.forEach((row, index) => {
						row.style.display = randomIndices.includes(index) ? "table-row" : "none";
					});
				} else if (refreshOption === "ì´ˆê¸°í™”") {
					// ëª¨ë“  í–‰ì„ ì´ˆê¸°í™”
					Array.from(table.querySelector("tbody").rows).forEach(row => {
						row.style.display = "table-row";
					});

					// ëª¨ë“  ë“œë¡­ë‹¤ìš´ì„ ë¦¬ì…‹
					includeTagDropdown1.selectedIndex = 0;
					includeTagDropdown2.selectedIndex = 0;
					excludeTagDropdown1.selectedIndex = 0;
					excludeTagDropdown2.selectedIndex = 0;
					tierAboveDropdown.selectedIndex = 0;
					tierBelowDropdown.selectedIndex = 0;
					refreshDropdown.selectedIndex = 0;

					// ëª¨ë“  ì²´í¬ë°•ìŠ¤ë¥¼ ë¦¬ì…‹
					hideForeignLanguageCheckbox.checked = false;
					hideSolvedCheckbox.checked = false;

					filterTable();
				}
			}

			function generateRandomIndices(maxValue, count) {
				const randomIndices = [];
				while (randomIndices.length < count) {
					const randomIndex = Math.floor(Math.random() * maxValue);
					if (!randomIndices.includes(randomIndex)) {
						randomIndices.push(randomIndex);
					}
				}
				return randomIndices;
			}

			filterTable();
		};
		var iframeMinimized = false;
		var html = document.querySelector("html");
		var body = document.querySelector("body");

		function toggleProblem() {
			var iframe = document.getElementById("iframeProblem");
			iframeMinimized = !iframeMinimized;

			if (iframeMinimized)
				iframe.style.display = "none";
			else
				iframe.style.display = "block";
		}

		function changeIframeSource(number) {
			var iframe = document.getElementById("iframeProblem");

			if (iframeMinimized) {
				toggleProblem();
			}
			iframe.src = "./BOJ/output/" + number + ".html";
			applyStylesToIframe();
		}
		
		function applyStylesToIframe() {
			var iframe = document.getElementById("iframeProblem");
			var innerDocument = iframe.contentDocument || iframe.contentWindow.document;
			innerDocument.body.style.backgroundColor = "#222222";
			innerDocument.body.style.margin = "0 auto";

			[...innerDocument.querySelectorAll("td, th")]
				.forEach(x=>x.style=`color:#E0E0E0; border-color:#909090;
				font-family:Malgun Gothic; font-size:14px;
				background-color:#2d2d2d`);
			
			[...innerDocument.querySelectorAll(".mjx-copytext")]
				.forEach(x=>x.style.fontSize = "0"); //ìˆ˜ì‹ í‘œí˜„ì‹œ ì¢…ì¢… ë‚˜íƒ€ë‚˜ëŠ” ì°Œêº¼ê¸° ì œê±°

			[...innerDocument.querySelectorAll("math")]
				.forEach(x=>x.style.color = "yellow"); //ìˆ˜ì‹ íƒœê·¸ ê°•ì¡°

			[...innerDocument.querySelectorAll("a")]
				.forEach(x=>x.style.color = "aqua"); //ë§í¬ ê°€ë…ì„±, íŒŒë‘ ëŒ€ì‹ 

			[...innerDocument.querySelectorAll("img")]
			.forEach(x=>x.style = "max-width:100%");

			iframe.style.height = '0';
			iframe.style.height = innerDocument.body.scrollHeight*1.02+"px";
			iframe.style.border = "0";

		}

		window.addEventListener("DOMContentLoaded", function() {
			var iframe = document.getElementById("iframeProblem");
			iframe.onload = applyStylesToIframe;
			toggleProblem();
		});

		window.addEventListener("resize", applyStylesToIframe);
	</script>
</body>
</html>
