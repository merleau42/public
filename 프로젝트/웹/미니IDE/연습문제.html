<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<style>
		* {
			margin: 0;
			padding: 0;
		}
		body {
			display: flex;
			flex-direction: column;
			justify-content: center;
			align-items: center;
		}
		.카드 {
			display: flex;
			flex-direction: column;
			width: 80vw;
			max-width: 700px;
			height: 40vh;
			gap: 10px;
			text-align: center;
			margin-top: 15px;
		}
		.번호 {
			height: 10%;
		}
		.섹션 {
			display: grid;
			grid-template-columns: 2fr 1fr;
			justify-items: center;
		}
		.섹션1, .섹션2 {
			width: 95%;
		}
		.섹션1 {
			display: flex;
			flex-direction: column;
			gap: 5px;
		}
		textarea, input[type="text"] {
			padding: 3px;
			font-size: 14px;
			font-family:'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif;
		}
		.코드 {
			height: 20vh;
		}
		.입력라인 {
			display: flex;
			justify-content: center;
			align-items: center;
			gap: 5px;
		}
		.입력 {
			width: 75%;
			height: 2vh;
			min-height: 25px;
		}
		.실행 {
			width: 25%;
			height: 3vh;
			min-height: 25px;
		}
		.출력 {
			height: 10vh;
		}
		.문제 {
			height: 100%;
			width: 100%;
			font-size: 20px;
			font-family: 'Gothic';
		}
		.구분 {
			margin: auto;
			margin-top: 15px;
			width: 85%;
			border-bottom: 1px solid #bbb;
		}
		.상단바 {
			display: flex;
			justify-content: center;
			align-items: center;
			width: 100%;
			height: 4vh;
			background: #ccc;
			gap: 5px;
		}
		.저장하기, .불러오기, .기본문제 {
			font-size: 19px;
			cursor: pointer;
		}
	</style>
	<script>
		let Q = (x,y=document) => y.querySelector(x);
		let Elem = (config) => {
			const {tag='div', text='', class:className='', ...attrs} = config;
			el = document.createElement(tag);
			el.innerText = text;
			el.className = className;
			Object.keys(attrs).forEach(attr => el.setAttribute(attr, attrs[attr]));
			return el;
		}
		let input;
		let activated_index;

		document.addEventListener('DOMContentLoaded', main);

		let quest = [{번호:'', 코드:'📂버튼을 눌러서 연습문제를 불러와주세요', 입력:'입력값은 스페이스바로 구분해주세요'}];

		function main() {
			Q('body').appendChild( navi() );
			refresh();
		}

		function refresh() {
			if (Q('#list')) Q('body').removeChild(Q('#list'));
			Q('body').appendChild( Elem({id:'list'}) );
			quest.forEach(info => Q('#list').appendChild(problem(info)));
		}

		function problem(info) {
			console.log(info);
			카드 = Elem({class:'카드'});
				번호 = Elem({tag:'h3', class:'번호', text:`연습문제 ${info?.번호}`});
				섹션 = Elem({class:'섹션'});
					섹션1 = Elem({class:'섹션1 코딩파트'});
						코드 = Elem({tag:'textarea', class:'코드', placeholder:'코드', text:info?.코드, index:info?.번호});
						입력라인 = Elem({class: '입력라인'});
							입력 = Elem({tag:'input', type:'text', class:'입력', placeholder:'입력값', value:info?.입력??'', index:info?.번호});
							실행 = Elem({tag:'input', type:'button', class:'실행', value:'실행', index:info?.번호});
						출력 = Elem({tag:'textarea', class:'출력', placeholder:'출력', index:info?.번호});
					섹션2 = Elem({class:'섹션2'});
						문제 = Elem({tag:'textarea', class:'문제', placeholder:'문제', text:info?.문제, index:info?.번호});
				구분 = Elem({class:'구분'});


			실행.addEventListener('click', e => {
				const index = e.target.getAttribute('index');
				const code = Q(`.코드[index="${index}"]`).value;
				activated_index = index;

				Q(`.출력[index="${index}"]`).value = '';
				input = Q(`.입력[index="${index}"]`).value.split(' ');

				eval(code);
			});

			[코드, 입력, 문제].forEach(el => el.addEventListener('change', e => {
				const index = e.target.getAttribute('index');
				state = quest.filter(x => x.번호 == index)[0];
				state.코드 = Q(`.코드[index="${index}"]`).value;
				state.입력 = Q(`.입력[index="${index}"]`).value;
				state.문제 = Q(`.문제[index="${index}"]`).value;
			}));

			[입력, 실행].forEach(el => 입력라인.appendChild(el));
			[코드, 입력라인, 출력].forEach(el => 섹션1.appendChild(el));
			[문제].forEach(el => 섹션2.appendChild(el));
			[섹션1, 섹션2].forEach(el => 섹션.appendChild(el));
			[번호, 섹션, 구분].forEach(el => 카드.appendChild(el));

			return 카드;
		}

		function navi() {
			상단바 = Elem({tag: 'nav', class: '상단바'});
				저장하기 = Elem({class: '저장하기', text: '💾'});
				불러오기 = Elem({class: '불러오기', text: '📂'});
				기본문제 = Elem({class: '기본문제', text: '📄'});
				
			저장하기.addEventListener('click', ()=>{
				const blob = new Blob([JSON.stringify(quest, null, 2)], { type: 'application/json' });
				const url = URL.createObjectURL(blob);

				Elem({tag: 'a', href: url, download: 'exercise.json'}).click();
				URL.revokeObjectURL(url);
			});

			불러오기.addEventListener('click', () => {
				const load = Elem({ tag: 'input', type: 'file', accept: 'application/json' });

				load.addEventListener('change', () => {
					const reader = new FileReader();
					reader.onload = () => {
						quest = JSON.parse(reader.result);
						refresh();
					}
					reader.readAsText(load.files[0]);
				});

				load.click();
			});

			기본문제.addEventListener('click', () => {
				fetch('문제.json')
				.then(res => res.json() )
				.then(res => quest = res )
				.then(_ => refresh());
			});

			[저장하기, 불러오기, 기본문제].forEach(el => 상단바.appendChild(el));
			return 상단바;
		}

		function log(msg) {
			Q(`.출력[index="${activated_index}"]`).value += `${msg}\n`;
		}
	</script>
</head>
<body>
</body>
</html>
