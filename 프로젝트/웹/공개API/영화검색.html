<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8" name="viewport" content="width=device-width, initial-scale=1.0">
	<title>영화 목록</title>
	<style>
		#레이아웃 > * {
			border: 1px black solid;
			border-radius: 20px;
		}
		#레이아웃 {
			width: 45vw;
			min-width: 600px;
			display: flex;
			flex-direction: column;
		}
		body {
			padding: 35px;
			display: flex;
			align-items: center;
			justify-content: center;
		}
		header, footer {
			height: 10vh;
			display: flex;
			align-items: center;
			justify-content: center;
			flex-direction: column;
		}
		.필터창 {
			display: flex;
			flex-direction: row;
			gap: 15px;
		}
		.필터 {
			display: flex;
			flex-direction: row;
			align-items: baseline;
			gap: 5px;
		}

		main {
			height: 70vh;
			min-height: 600px;
			display: flex;
			flex-direction: column;
			align-items: center;
		}
		.목록 {
			width: 100%;
			height: 95%;
			display: flex;
			flex-direction: column;
			gap: 9px;
			justify-content: center;
			align-items: center;
		}
			.레코드 { width: 80%; height: 22%; display: flex; }
				.섹션1 { width: 25%; height: 100%; text-align: center; }
					.포스터 { height: 100%; }
				.섹션2 { width: 65%; font-size: 14px; }
					.정보 { display: flex; flex-direction: column; gap: 5px; white-space: nowrap; }
						.제목 { font-weight: bold; }
		.페이지 {
			height: 5%;
			position: relative;
			display: flex;
			flex-direction: row;
			gap: 15px;
			justify-content: center;
		}
			.페이지 > div {
				text-align: center;
				width: 25px;
				height: 25px;
				border: 1px solid blue;
				border-radius: 5px;
				background-color: aliceblue;
				cursor: pointer;
			}
			.페이지 > div:hover { background-color: lightblue; }
			.번호.current { background-color: aqua; }
	</style>
	<script>
		let Q = (x,y=document) => y.querySelector(x);
		let QQ = (x,y=document) => [...y.querySelectorAll(x)];
		let Elem = (config) => {
			const {tag='div', text='', class:className='', ...attrs} = config;
			const el = document.createElement(tag);
			el.innerText = text;
			el.className = className;
			Object.keys(attrs).forEach(attr => el.setAttribute(attr, attrs[attr]));
			return el;
		}
		
		let state = { 영화목록: [], 페이지: 1,
					  옵션: {장르:'all', 화질:'all', 평점:'0', 연도:'all', 국가:'all'} };


		document.addEventListener('DOMContentLoaded', main);

		function main() {
			Q('body').append(c_layout());
			list_record( state.페이지 );
		}

		async function list_record(page) {
			await yts20( Math.floor( (page-1)/5 ) + 1);

			QQ('.레코드').forEach(el => el.remove());
			Q('.번호.current')?.classList.remove('current');

			Q('.목록').append( c_record(state.영화목록[ ((page-1)%5 + 1) * 4 - 4]) );
			Q('.목록').append( c_record(state.영화목록[ ((page-1)%5 + 1) * 4 - 3]) );
			Q('.목록').append( c_record(state.영화목록[ ((page-1)%5 + 1) * 4 - 2]) );
			Q('.목록').append( c_record(state.영화목록[ ((page-1)%5 + 1) * 4 - 1]) );

			Q('.번호[index="1"]').innerText = ( Math.floor((page-1)/5) + 1) * 5 - 4;
			Q('.번호[index="2"]').innerText = ( Math.floor((page-1)/5) + 1) * 5 - 3;
			Q('.번호[index="3"]').innerText = ( Math.floor((page-1)/5) + 1) * 5 - 2;
			Q('.번호[index="4"]').innerText = ( Math.floor((page-1)/5) + 1) * 5 - 1;
			Q('.번호[index="5"]').innerText = ( Math.floor((page-1)/5) + 1) * 5;

			QQ('.번호').filter(el => el.innerText == page)[0].classList.add('current');
		}

		function c_layout() {
			const 컨테이너 = Elem({id: '레이아웃'});
				헤더 = Elem({tag: 'header'});
					필터창 = Elem({class:'필터창'});
						필터1 = c_filter({__이름:'장르:', __종류:'장르', ALL:'all',
							액션:'action', 드라마:'drama', 모험:'adventure',
							애니:'animation', 전기:'biography', 코미디:'comedy', 공포:'horror'});
						필터2 = c_filter({__이름:'화질:', __종류:'화질', ALL:'all',
							'2160p':'2160p', '1080p':'1080p', '720p':'720p', '480p':'480p', '3D':'3d'});
						필터3 = c_filter({__이름:'평점:', __종류:'평점', ALL:'0',
							'9+':'9', '8+':'8', '7+':'7', '6+':'6'});
				메인 = Elem({tag: 'main'});
					목록 = Elem({class: '목록'});
						// [컴포넌트: 레코드] * N
					페이지 = c_page(); // [컴포넌트: 페이지]
				푸터 = Elem({tag: 'footer'});
					로고 = Elem({tag: 'img', src: 'YTS.svg'});
					저작권 = Elem({tag: 'span', class:'저작권', text:'yts.mx/api'});

			컨테이너.append(헤더, 메인, 푸터);
				헤더.append(필터창);
					필터창.append(필터1, 필터2, 필터3);
				메인.append(목록, 페이지);
				푸터.append(로고, 저작권);

			return 컨테이너;
		}

		function c_record(info){
			const 컨테이너 = Elem({class: '레코드'});
				섹션1 = Elem({class: '섹션1'});
					링크 = Elem({tag: 'a', href: info.url});
						포스터 = Elem({tag: 'img', class:'포스터', src: info.image});
				섹션2 = Elem({class: '섹션2'});
					정보 = Elem({class: '정보'});
						제목 = Elem({class: '제목', text: info.title});
						연도 = Elem({class: '연도', text: `연도: ${info.year}`});
						평점 = Elem({class: '평점', text: `평점: ${'★'.repeat(info.rating)} (${info.rating}/10)`});
						장르 = Elem({class: '장르', text: `장르: ${info.genres.join(', ')}`});
						분량 = Elem({class: '분량', text: `분량: ${info.runtime}분`});
						기타 = Elem({class: '기타', text: `API: ${info.API}`});
			
			컨테이너.append(섹션1, 섹션2);
				섹션1.append(링크);
					링크.append(포스터);
				섹션2.append(정보);
					정보.append(제목, 연도, 평점, 장르, 분량, 기타);

			return 컨테이너;
		}

		function c_page() {
			const 컨테이너 = Elem({class: '페이지'});
				맨앞 = Elem({class: '맨앞', text: '<<'});
				이전 = Elem({class: '이전', text: '<'});
				번호1 = Elem({class: '번호', text: '1', index: 1});
				번호2 = Elem({class: '번호', text: '2', index: 2});
				번호3 = Elem({class: '번호', text: '3', index: 3});
				번호4 = Elem({class: '번호', text: '4', index: 4});
				번호5 = Elem({class: '번호', text: '5', index: 5});
				다음 = Elem({class: '다음', text: '>'});
				맨뒤 = Elem({class: '맨뒤', text: '>>'});

			컨테이너.append(맨앞, 이전, 번호1, 번호2, 번호3, 번호4, 번호5, 다음, 맨뒤);

			맨앞.addEventListener('click', _ => list_record( state.페이지=1 ) );
			이전.addEventListener('click', _ => list_record( --state.페이지 ) );
			다음.addEventListener('click', _ => list_record( ++state.페이지 ) );
			맨뒤.addEventListener('click', _ => list_record( state.페이지=100 ) );
			[번호1, 번호2, 번호3, 번호4, 번호5].forEach(el => el.addEventListener('click',_ => {
				list_record( state.페이지 = Number(el.innerText) );
			}))

			return 컨테이너;
		}

		function c_filter(opt){
			const 컨테이너 = Elem({class:'필터'});

			const 필터명 = Elem({class:'필터명', tag:'h4', text:opt.__이름??'필터:'});
			const 리스트 = Elem({class:'리스트', tag:'select', type:opt.__type});
			
			const 항목 = Object.keys(opt).filter(key=>!key.startsWith('__')).map(key=> Elem({tag:'option', class:'항목', text:key, value:opt[key]}) );
			리스트.append(...항목);
			
			리스트.addEventListener('change', _ => {
				state.옵션[opt.__종류] = 리스트.value;
				list_record(state.페이지);
			});
	
			컨테이너.append(필터명, 리스트);
			return 컨테이너;
		}

		function yts20(num){
			const {장르, 화질, 평점, 연도, 국가} = state.옵션;
			const query = `page=${num}&genre=${장르}&quality=${화질}&minimum_rating=${평점}`;
			return fetch(`https://yts.mx/api/v2/list_movies.json?${query}`)
				.then(res => res.json())
				.then(obj => obj.data.movies.map((mv, i) => ({
					url: mv.url,
					title: mv.title,
					year: mv.year,
					rating: mv.rating,
					genres: mv.genres,
					runtime: mv.runtime,
					image: mv.large_cover_image,
					API: `(${num}, ${i})`
				})))
				.then(movies => state.영화목록 = movies )
		}

	</script>
</head>
<body>
</body>
</html>
