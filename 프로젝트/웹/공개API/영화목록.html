<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8" name="viewport" content="width=device-width, initial-scale=1.0">
	<title>영화 목록</title>
	<style>
		#레이아웃 > * {
			border: 1px black solid;
			border-radius: 20px;
		}
		#레이아웃 {
			width: 45vw;
			min-width: 600px;
			display: flex;
			flex-direction: column;
		}
		body {
			padding: 35px;
			display: flex;
			align-items: center;
			justify-content: center;
		}
		header, footer {
			height: 10vh;
			display: flex;
			align-items: center;
			justify-content: center;
		}
		main {
			height: 70vh;
			min-height: 600px;
			display: flex;
			flex-direction: column;
			align-items: center;
		}
		.목록 {
			width: 100%;
			height: 95%;
			display: flex;
			flex-direction: column;
			gap: 9px;
			justify-content: center;
			align-items: center;
		}
			.레코드 { width: 80%; height: 22%; display: flex; }
				.섹션1 { width: 25%; height: 100%; text-align: center; }
					.포스터 { height: 100%; }
				.섹션2 { width: 65%; font-size: 14px; }
					.정보 { display: flex; flex-direction: column; gap: 5px; white-space: nowrap; }
						.제목 { font-weight: bold; }
		.페이지 {
			height: 5%;
			position: relative;
			display: flex;
			flex-direction: row;
			gap: 15px;
			justify-content: center;
		}
			.페이지 > div {
				text-align: center;
				width: 25px;
				height: 25px;
				border: 1px solid blue;
				border-radius: 5px;
				background-color: aliceblue;
				cursor: pointer;
			}
			.페이지 > div:hover { background-color: lightblue; }
			.번호.current { background-color: aqua; }
	</style>
	<script>
		let state = { 영화목록:[], 페이지:1 };
		let Q = (x,y=document) => y.querySelector(x);
		let QQ = (x,y=document) => [...y.querySelectorAll(x)];
		let Elem = (config) => {
			const {tag='div', text='', class:className='', ...attrs} = config;
			el = document.createElement(tag);
			el.innerText = text;
			el.className = className;
			Object.keys(attrs).forEach(attr => el.setAttribute(attr, attrs[attr]));
			return el;
		}

		document.addEventListener('DOMContentLoaded', main);

		function main() {
			Q('body').append(c_layout());
			list_record( state.페이지 );
		}

		async function list_record(page) {
			await yts20( Math.floor( (page-1)/5 ) + 1 );

			QQ('.레코드').forEach(el => el.remove());
			Q('.번호.current')?.classList.remove('current');

			Q('.목록').append( c_record(state.영화목록[ ((page-1)%5 + 1) * 4 - 4]) );
			Q('.목록').append( c_record(state.영화목록[ ((page-1)%5 + 1) * 4 - 3]) );
			Q('.목록').append( c_record(state.영화목록[ ((page-1)%5 + 1) * 4 - 2]) );
			Q('.목록').append( c_record(state.영화목록[ ((page-1)%5 + 1) * 4 - 1]) );

			Q('.번호[index="1"]').innerText = ( Math.floor((page-1)/5) + 1) * 5 - 4;
			Q('.번호[index="2"]').innerText = ( Math.floor((page-1)/5) + 1) * 5 - 3;
			Q('.번호[index="3"]').innerText = ( Math.floor((page-1)/5) + 1) * 5 - 2;
			Q('.번호[index="4"]').innerText = ( Math.floor((page-1)/5) + 1) * 5 - 1;
			Q('.번호[index="5"]').innerText = ( Math.floor((page-1)/5) + 1) * 5;

			QQ('.번호').filter(el => el.innerText == page)[0].classList.add('current');
		}

		function c_layout() {
			컨테이너 = Elem({id: '레이아웃'});
				헤더 = Elem({tag: 'header'});
					로고 = Elem({tag: 'img', src: 'YTS.svg'});
				메인 = Elem({tag: 'main'});
					목록 = Elem({class: '목록'});
						// [컴포넌트: 레코드]
					페이지 = Elem({class: '페이지'});
						맨앞 = Elem({class: '맨앞', text: '<<'});
						이전 = Elem({class: '이전', text: '<'});
						번호1 = Elem({class: '번호', text: '1', index: 1});
						번호2 = Elem({class: '번호', text: '2', index: 2});
						번호3 = Elem({class: '번호', text: '3', index: 3});
						번호4 = Elem({class: '번호', text: '4', index: 4});
						번호5 = Elem({class: '번호', text: '5', index: 5});
						다음 = Elem({class: '다음', text: '>'});
						맨뒤 = Elem({class: '맨뒤', text: '>>'});
				푸터 = Elem({tag: 'footer'});
					저작권 = Elem({tag: 'span', class:'저작권', text:'yts.mx/api'});

			컨테이너.append(헤더, 메인, 푸터);
				헤더.append(로고);
				메인.append(목록, 페이지);
					페이지.append(맨앞, 이전, 번호1, 번호2, 번호3, 번호4, 번호5, 다음, 맨뒤);
				푸터.append(저작권);

			맨앞.addEventListener('click', _ => list_record( state.페이지=1 ) );
			다음.addEventListener('click', _ => list_record( ++state.페이지 ) );
			이전.addEventListener('click', _ => list_record( --state.페이지 ) );
			맨뒤.addEventListener('click', _ => list_record( state.페이지=100 ) );
			[번호1, 번호2, 번호3, 번호4, 번호5].forEach(el => el.addEventListener('click',_ => {
				list_record( state.페이지 = Number(el.innerText) );
			}))

			return 컨테이너;
		}

		function c_record(info){
			컨테이너 = Elem({class: '레코드'});
				섹션1 = Elem({class: '섹션1'});
					링크 = Elem({tag: 'a', href: info.url});
						포스터 = Elem({tag: 'img', class:'포스터', src: info.image});
				섹션2 = Elem({class: '섹션2'});
					정보 = Elem({class: '정보'});
						제목 = Elem({class: '제목', text: info.title});
						연도 = Elem({class: '연도', text: `연도: ${info.year}`});
						평점 = Elem({class: '평점', text: `평점: ${'★'.repeat(info.rating)} (${info.rating}/10)`});
						장르 = Elem({class: '장르', text: `장르: ${info.genres.join(', ')}`});
						분량 = Elem({class: '분량', text: `분량: ${info.runtime}분`});
						기타 = Elem({class: '기타', text: `API: ${info.API}`});
			
			컨테이너.append(섹션1, 섹션2);
				섹션1.append(링크);
					링크.append(포스터);
				섹션2.append(정보);
					정보.append(제목, 연도, 평점, 장르, 분량, 기타);

			return 컨테이너;
		}

		function yts20(num){
			return fetch(`https://yts.mx/api/v2/list_movies.json?page=${num}`)
				.then(res => res.json())
				.then(obj => obj.data.movies.map((mv, i) => ({
					url: mv.url,
					title: mv.title,
					year: mv.year,
					rating: mv.rating,
					genres: mv.genres,
					runtime: mv.runtime,
					image: mv.large_cover_image,
					API: `(${num}, ${i})`
				})))
				.then(movies => state.영화목록 = movies )
		}

	</script>
</head>
<body>
</body>
</html>