"use strict";(self.webpackChunkluna=self.webpackChunkluna||[]).push([[4],{38:(e,r,t)=>{t.r(r),t.d(r,{ByteStreamReader:()=>a});class a{constructor(e,r){this.data=e,this._le=r,this.offset=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength)}readUint8(){return this.view.getUint8(this.offset++)}readUint16(){const e=this.view.getUint16(this.offset,this._le);return this.offset+=2,e}readUint32(){const e=this.view.getUint32(this.offset,this._le);return this.offset+=4,e}}},37:(e,r,t)=>{t.r(r),t.d(r,{decodeTga:()=>o});var a=t(9),i=t(38),n=t(39),d=t(40);async function o(e,r={}){var t,o;const h={reader:new i.ByteStreamReader(e,!0),hasAlpha:!1,ambiguousAlpha:!1,options:r,warnings:[]},U=function(e){const r=e.reader.readUint8(),t=e.reader.readUint8();let i;0===t||1===t?i=t:((0,a.handleWarning)(e,new a.DecodeWarning("Color map type unrecognized",e.reader.offset-1)),i=2);const n=e.reader.readUint8();if(!(0,d.isValidImageType)(n))throw new a.DecodeError(e,`Invalid image type "${n}"`,e.reader.offset-1);1===i&&1!==n&&9!==n&&(0,a.handleWarning)(e,new a.DecodeWarning(`Image type "${n}" cannot have a color map`,e.reader.offset-2));const o=e.reader.readUint16(),s=e.reader.readUint16(),f=e.reader.readUint8();if(1===i&&(o>=s&&(0,a.handleWarning)(e,new a.DecodeWarning(`Color map origin "${o}" is greater than color map length "${s}"`,e.reader.offset-5)),!(0,d.isValidColorMapDepth)(f)))throw new a.DecodeError(e,`Unsupported color map bit depth "${f}"`,e.reader.offset-1);const h=e.reader.readUint16(),c=e.reader.readUint16(),l=e.reader.readUint16(),g=e.reader.readUint16(),u=e.reader.readUint8();if(!(0,d.isValidBitDepth)(u,n))throw new a.DecodeError(e,`Unsupported TGA bit depth "${u}" with image type ${n}`,16);const p=e.reader.readUint8(),U=(15&p)>>0,w=(48&p)>>4;return 1===w&&(0,a.handleWarning)(e,new a.DecodeWarning("This image is encoded using a bottom right screen origin, many image editors won't read this correctly",e.reader.offset-1)),3===w&&(0,a.handleWarning)(e,new a.DecodeWarning("This image is encoded using a top right screen origin, many image editors won't read this correctly",e.reader.offset-1)),{idLength:r,colorMap:0!==i?{type:i,depth:f,length:s,origin:o}:void 0,imageType:n,origin:{x:h,y:c},width:l,height:g,bitDepth:u,imageDescriptor:p,attributeBitsPerPixel:U,screenOrigin:w}}(h),w={...h,header:U};w.identificationField=(0,n.readText)(w,void 0,w.header.idLength);const v=w.reader.offset;return w.footer=function(e){if(e.reader.offset=e.reader.view.byteLength-26+8,"TRUEVISION-XFILE."!==(0,n.readText)(e,void 0,17)||0!==e.reader.readUint8())return{extensionAreaOffset:0,developerDirectoryOffset:0};e.reader.offset=e.reader.view.byteLength-26;let r=e.reader.readUint32();r>=e.reader.view.byteLength&&((0,a.handleWarning)(e,new a.DecodeWarning(`Extension area offset "${r}" is invalid`,e.reader.offset-4)),r=0);let t=e.reader.readUint32();return t>=e.reader.view.byteLength&&((0,a.handleWarning)(e,new a.DecodeWarning(`Developer directory offset "${t}" is invalid`,e.reader.offset-4)),t=0),{extensionAreaOffset:r,developerDirectoryOffset:t}}(w),w.extensionArea=function(e){var r;if(void 0===(null===(r=e.footer)||void 0===r?void 0:r.extensionAreaOffset)||0===e.footer.extensionAreaOffset)return;e.reader.offset=e.footer.extensionAreaOffset;const t=e.reader.readUint16();495!==t&&(0,a.handleWarning)(e,new a.DecodeWarning("TGA file is a version other than v2",e.reader.offset-2));const i=(0,n.readText)(e,void 0,41).trim()||void 0,d=(0,n.readText)(e,void 0,324).trim()||void 0,o=function(e){const r=e.reader.readUint16(),t=e.reader.readUint16(),a=e.reader.readUint16(),i=e.reader.readUint16(),n=e.reader.readUint16(),d=e.reader.readUint16();if(0!==r||0!==t||0!==a||0!==i||0!==n||0!==d)return new Date(a,r,t,i,n,d)}(e),s=(0,n.readText)(e,void 0,41).trim()||void 0,f=function(e){const r=e.reader.readUint16(),t=e.reader.readUint16(),a=e.reader.readUint16();if(0!==r||0!==t||0!==a)return{hours:r,minutes:t,seconds:a}}(e),h=(0,n.readText)(e,void 0,41).trim()||void 0,c=e.reader.readUint8()/100,l=(0,n.readText)(e,void 0,2);let g;g=0!==c||" "!==l&&0!==l.length?`${c}${l}`:void 0;const u=e.reader.readUint8(),p=e.reader.readUint8(),U=e.reader.readUint8(),w=e.reader.readUint8();let v;v=0===u&&0===p&&0===U&&0===w?void 0:new Uint8Array([p,U,w,u]);const m=e.reader.readUint16(),b=e.reader.readUint16();let y;y=0===b?void 0:m/b;const D=e.reader.readUint16(),A=e.reader.readUint16();let x;x=0===A?void 0:D/A;return{extensionSize:t,authorName:i,authorComments:d,dateTimestamp:o,jobName:s,jobTime:f,softwareId:h,softwareVersion:g,keyColor:v,aspectRatio:y,gamma:x,colorCorrectionOffset:e.reader.readUint32(),postageStampOffset:e.reader.readUint32(),scanLineOffset:e.reader.readUint32(),attributesType:e.reader.readUint8()}}(w),w.developerDirectory=function(e){var r;if(void 0===(null===(r=e.footer)||void 0===r?void 0:r.developerDirectoryOffset)||0===e.footer.developerDirectoryOffset)return[];e.reader.offset=e.footer.developerDirectoryOffset;const t=e.reader.readUint16(),a=[];for(let r=0;r<t;r++){const r=e.reader.readUint16(),t=e.reader.readUint32(),i=e.reader.readUint32();a.push({tag:r,offset:t,length:i})}return a}(w),w.reader.offset=v,1===(null===(t=w.header.colorMap)||void 0===t?void 0:t.type)&&(w.colorMap=function(e,r){const t=e.reader.offset,a=Math.ceil(r.depth/8);let i;switch(e.reader.offset+=r.length*a,r.depth){case 15:i=c;break;case 16:i=e.hasAlpha?l:c;break;case 24:i=g;break;case 32:i=u}return(r,n,d,o)=>{const s=d.getUint8(o);return i(r,n,e.reader.view,t+s*a),1}}(w,w.header.colorMap)),w.hasAlpha=w.colorMap&&32===(null===(o=w.header.colorMap)||void 0===o?void 0:o.depth)||(w.header.attributeBitsPerPixel>0||32===w.header.bitDepth)&&(void 0===w.extensionArea||w.extensionArea.attributesType>2),w.ambiguousAlpha=w.hasAlpha&&0===w.header.attributeBitsPerPixel,w.image=function(e,r){const t={width:e.header.width,height:e.header.height,data:new Uint8Array(e.header.width*e.header.height*4)};let i;if(e.colorMap)i=e.colorMap;else switch(e.header.bitDepth){case 8:i=s;break;case 15:i=c;break;case 16:i=11===e.header.imageType||3===e.header.imageType?f:e.hasAlpha?l:c;break;case 24:i=g;break;case 32:i=e.hasAlpha?u:p}let n=e.reader.view;if(8&e.header.imageType){const t=function(e){const r=Math.ceil(e.header.bitDepth/8),t=new Uint8Array(e.header.width*e.header.height*r);let a=0,i=0,n=0,d=0,o=0;for(;n<t.length;)if(a=e.reader.readUint8(),i=1+(127&a),128&a){for(d=0;d<r;d++)for(a=e.reader.readUint8(),o=0;o<i;o++)t[n+o*r+d]=a;n+=i*r}else{i*=r;for(let r=0;r<i;r++)t[n++]=e.reader.readUint8()}return t}(e);n=new DataView(t.buffer,t.byteOffset,t.length),r=0}switch(e.header.screenOrigin){case 0:{let a=0;for(let d=t.height-1;d>=0;d--){a=e.header.width*d*4;for(let e=0;e<t.width;e++)r+=i(t.data,a,n,r),a+=4}break}case 1:{let a=0;for(let d=t.height-1;d>=0;d--){a=4*(e.header.width*d+(e.header.width-1));for(let e=0;e<t.width;e++)r+=i(t.data,a,n,r),a-=4}break}case 2:{let e=0;for(let a=0;a<t.height;a++)for(let a=0;a<t.width;a++)r+=i(t.data,e,n,r),e+=4;break}case 3:{let a=0;for(let d=0;d<t.height;d++){a=4*(e.header.width*d+(e.header.width-1));for(let e=0;e<t.width;e++)r+=i(t.data,a,n,r),a-=4}break}}if(e.ambiguousAlpha&&!e.options.strictMode&&e.options.detectAmbiguousAlphaChannel){let r=!1;for(let e=3;e<t.width*t.height*4;e+=4)t.data[e]>0&&(r=!0);if(!r){(0,a.handleWarning)(e,new a.DecodeWarning("Image has ambiguous alpha and is fully transparent, alpha has been disabled",-1));for(let e=3;e<t.width*t.height*4;e+=4)t.data[e]=255}}return t}(w,w.reader.offset),{image:w.image,details:{header:w.header,imageId:w.identificationField,footer:w.footer,extensionArea:w.extensionArea,developerDirectory:w.developerDirectory},warnings:w.warnings}}function s(e,r,t,a){return e[r]=t.getUint8(a),e[r+1]=e[r],e[r+2]=e[r],e[r+3]=255,1}function f(e,r,t,a){return e[r]=t.getUint8(a),e[r+1]=e[r],e[r+2]=e[r],e[r+3]=t.getUint8(a+1),2}let h=0;function c(e,r,t,a){return h=t.getUint16(a,!0),e[r]=h>>10&31,e[r+1]=h>>5&31,e[r+2]=31&h,e[r]=e[r]<<3|e[r]>>2,e[r+1]=e[r+1]<<3|e[r+1]>>2,e[r+2]=e[r+2]<<3|e[r+2]>>2,e[r+3]=255,2}function l(e,r,t,a){return h=t.getUint16(a,!0),e[r]=h>>10&31,e[r+1]=h>>5&31,e[r+2]=31&h,e[r]=e[r]<<3|e[r]>>2,e[r+1]=e[r+1]<<3|e[r+1]>>2,e[r+2]=e[r+2]<<3|e[r+2]>>2,e[r+3]=32768&h?0:255,2}function g(e,r,t,a){return e[r]=t.getUint8(a+2),e[r+1]=t.getUint8(a+1),e[r+2]=t.getUint8(a),e[r+3]=255,3}function u(e,r,t,a){return e[r]=t.getUint8(a+2),e[r+1]=t.getUint8(a+1),e[r+2]=t.getUint8(a),e[r+3]=t.getUint8(a+3),4}function p(e,r,t,a){return e[r]=t.getUint8(a+2),e[r+1]=t.getUint8(a+1),e[r+2]=t.getUint8(a),e[r+3]=255,4}},39:(e,r,t)=>{t.r(r),t.d(r,{readText:()=>i});var a=t(9);function i(e,r,t,i){const n=[];let d=0,o=0;const s=e.reader.offset;for(;o<t;o++){try{d=e.reader.view.getUint8(e.reader.offset)}catch(r){throw r instanceof Error&&"Offset is outside the bounds of the DataView"===r.message&&(0,a.handleWarning)(e,new a.DecodeWarning("EOF while reading text",e.reader.offset)),r}if(!i&&0===d)break;e.reader.offset++,n.push(d)}return e.reader.offset=s+t,r?r.decode(new Uint8Array(n)):String.fromCharCode(...n)}},40:(e,r,t)=>{function a(e){return 1===e||2===e||3===e||9===e||10===e||11===e}function i(e){return 15===e||16===e||24===e||32===e}function n(e,r){return 1===r||9===r?8===e:3===r||11===r?8===e||16===e:15===e||16===e||24===e||32===e}t.r(r),t.d(r,{isValidImageType:()=>a,isValidColorMapDepth:()=>i,isValidBitDepth:()=>n})}}]);