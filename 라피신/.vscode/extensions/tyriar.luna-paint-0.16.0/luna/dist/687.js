"use strict";const a18_0x5f25=["setTopLeft","1039dPecTA","_updateQuality","_finishSelection","ArrowRight","_cursorCurrent","onUpdate","state","expand-canvas-to-selection","_expandCanvasToSelectionAction","normal","2FGiKgb","Quality","moveStep","fire","selectAll","altKey","clientWidth","keyDown","createDomRenderProgram","_getQualityValue","dispose","bottomright","MoveImageRangeRenderer","getPointerState","319027JnLvGt","1GvlaKs","_onUpdate","Nearest Neighbor","onBeforeRunLayerTask","range","get","offsetY","devicePixelRatio","offsetX","1360214IinLTb","_elementContainer","movePixels","ArrowUp","onLayerChange","difference","softLight","createCompositeEntry","commit","_onRequestRender","options","width","_value","Finish Selection","currentState","setRange","130838kxGkfJ","set","bottomleft","_clearMovingLayer","flipY","data","_refreshLayerSelectionRange","_imageService","new","Bilinear","render","_onStateChange","right","_allowNewState","add","zoom","pointerUp","top","1093vTRPRL","max","207719bqlJKV","event","triggerRequestRender","Expand Canvas to Selection","resource","bottom","none","_getRange","linearDodgeAdd","topleft","register","historyService","type","_renderer","_activeMovingLayer","quality","getCoordsFromEvent","left","_onHistoryUpdateValue","imageService","Set Quality Sampling","appendChild","_refreshActionEnabledState","nearestneighbor","850RitnYw","_isYFlipping","setValueFromHistoryChange","replace","screen","exclusion","setVisible","removeChild","_qualityOption","classList","pointerDown","move","102218WmEXBf","taskService","_getQualityString","selectionService","_cursorOrigin","moving","value","height","cutImage","_enabled","name","linearBurn","_directionalMoveElements","string-combo","_startMove","key","_movingLayerOrigin","onHistoryUnset","Blend Mode","_onOptionsChange","floor","min","allowUnchecking","topright","_sc","currentLayer","flipX","bilinear","darken","_activeLayer","_isXFlipping","_setupActiveTemporaryLayer","createElement","validate","onStateChange","shiftKey","enabled","number","push","taskWorkerService","order","onHistoryUpdateValue","_isFirstMove","_originalSelection","_directionalMoveZones","display","slice","onTemporaryLayerRegistered","multiply","viewportService","ArrowDown","_isVisible","Move Pixels","894JZzKzG","onRequestRender","div","metaKey","pointerDownMove","_container","round","temporaryLayer","webpackChunkluna","overlay","style"],a18_0x554a=function(t,i){return a18_0x5f25[t-=373]},a18_0x1a89d3=a18_0x554a;!function(t,i){const s=a18_0x554a;for(;;)try{if(732592==-parseInt(s(431))+-parseInt(s(484))*-parseInt(s(419))+parseInt(s(521))*-parseInt(s(395))+parseInt(s(393))*parseInt(s(496))-parseInt(s(530))-parseInt(s(375))+-parseInt(s(506))*-parseInt(s(520)))break;t.push(t.shift())}catch(i){t.push(t.shift())}}(a18_0x5f25),(self[a18_0x1a89d3(492)]=self.webpackChunkluna||[])[a18_0x1a89d3(469)]([[687,504],{6173:(t,i,s)=>{const e=a18_0x1a89d3;s.d(i,{f:()=>o});var h=s(1815),n=s(5120);class o extends n.JT{constructor(t,i,s){const e=a18_0x554a;super(),this.name=t,this[e(407)]=i,this[e(440)]=s,this[e(522)]=this[e(405)](new h.v),this[e(501)]=this[e(522)][e(396)]}get[e(467)](){return this[e(440)]}set[e(467)](t){const i=e;this._enabled!==t&&(this[i(440)]=t,this[i(522)].fire())}}},9904:(t,i,s)=>{const e=a18_0x1a89d3;s.d(i,{FV:()=>r,rP:()=>a,tv:()=>c,Jp:()=>l,X5:()=>g,qv:()=>p});var h=s(1815),n=s(5120),o=s(2939);class r extends n.JT{constructor(t,i,s,e=!0){const n=a18_0x554a;super(),this[n(441)]=t,this.hasImage=i,this._value=s,this[n(453)]=e,this[n(407)]="boolean",this[n(413)]=this[n(405)](new h.v),this[n(472)]=this[n(413)][n(396)],this[n(522)]=this[n(405)](new h.v),this[n(501)]=this._onUpdate.event}get[e(437)](){return this[e(542)]}set value(t){const i=e;this[i(542)]=t,this._onUpdate[i(509)](t)}setValueFromHistoryChange(t){const i=e;this[i(542)]=t,this[i(413)][i(509)](t)}}class a extends n.JT{constructor(t,i,s){const n=e;super(),this.name=t,this[n(540)]=i,this[n(542)]=s,this[n(407)]="string",this[n(413)]=this.register(new h.v),this[n(472)]=this._onHistoryUpdateValue[n(396)],this._onUpdate=this[n(405)](new h.v),this[n(501)]=this[n(522)][n(396)]}get[e(437)](){return this._value}set[e(437)](t){const i=e;this[i(542)]=t,this[i(522)][i(509)](t)}[e(421)](t){const i=e;this[i(542)]=t,this[i(413)][i(509)](t)}}class c extends n.JT{constructor(t,i,s){const n=e;super(),this[n(441)]=t,this[n(540)]=i,this[n(542)]=s,this.type=n(444),this._onHistoryUpdateValue=this[n(405)](new h.v),this[n(472)]=this._onHistoryUpdateValue[n(396)],this[n(522)]=this[n(405)](new h.v),this[n(501)]=this._onUpdate[n(396)]}get[e(437)](){return this._value}set value(t){const i=e;this[i(542)]=t,this[i(522)][i(509)](t)}[e(421)](t){const i=e;this[i(542)]=t,this[i(413)][i(509)](t)}}class l extends a{constructor(){const t=e;super(t(449),[t(505),t(422),t(459),t(479),t(442),"lighten",t(423),"linearDodgeAdd",t(493),"softLight",t(535),"exclusion"],t(505))}}class g extends n.JT{constructor(t,i,s,n){const o=e;super(),this[o(441)]=t,this[o(542)]=i,this[o(452)]=s,this[o(394)]=n,this[o(407)]="number",this[o(413)]=this[o(405)](new h.v),this[o(472)]=this[o(413)][o(396)],this[o(522)]=this.register(new h.v),this[o(501)]=this[o(522)].event}get[e(437)](){const t=e;return(0,o.u)(this._value,this[t(394)],this.min)}set[e(437)](t){const i=e;this[i(542)]=t,this[i(522)][i(509)](t)}[e(421)](t){const i=e;this[i(542)]=t,this[i(413)][i(509)](t)}}class p extends g{constructor(t,i,s,h){const n=e;super(t,i,s,h),this[n(407)]=n(468)}get[e(437)](){const t=e;return(0,o.u)(this[t(542)],this[t(394)],this[t(452)])}set[e(437)](t){const i=e;this._value=Math[i(451)](t),this[i(522)][i(509)](t)}}},504:(t,i,s)=>{const e=a18_0x1a89d3;s.r(i),s.d(i,{MoveImageRangeRenderer:()=>o});var h=s(5120),n=s(1003);class o extends h.JT{constructor(t,i,s,e,h){const o=a18_0x554a;super(),this[o(489)]=t,this[o(402)]=i,this[o(388)]=s,this._viewportService=e,this[o(382)]=h,this[o(471)]=2,this[o(443)]=new Map,this[o(475)]=new Map,this._isVisible=!0,this._elementContainer=document[o(463)](o(486));const r=[o(404),o(454),"bottomleft",o(517),o(392),o(400),o(412),"right"];for(const t of r){const i=document[o(463)](o(486));i[o(428)][o(389)]("move-handle",t),this[o(531)][o(416)](i),this[o(443)][o(376)](t,i),this[o(475)].set(t,(0,n.Pq)())}this[o(489)][o(416)](this[o(531)]),this[o(405)]({dispose:()=>{const t=o;this[t(489)][t(426)](this[t(531)])}})}[e(425)](t){const i=e;t!==this[i(482)]&&(this[i(531)][i(494)][i(476)]=t?"":i(401),this[i(482)]=t)}[e(374)](t){}[e(385)](){const t=e,i=this[t(402)]();if(!i)return;const s=this[t(382)][t(456)];if(!s)return;const h=this._viewportService,n=Math.round(this[t(489)][t(512)]/2)-s.width/2*h[t(390)],o=Math[t(490)](this[t(489)].clientHeight/2)-s[t(438)]/2*h[t(390)],r=n+(h.x+i[t(412)])*h[t(390)],a=o+(h.y+i[t(392)])*h[t(390)],c=n+(h.x+i[t(387)])*h[t(390)],l=o+(h.y+i.bottom)*h[t(390)],g=Math[t(490)]((r+c)/2),p=Math[t(490)]((a+l)/2),u=10*window[t(528)],v={left:Math[t(452)](r+u,Math[t(394)](r,g-u)),top:Math[t(452)](a+u,Math[t(394)](a,p-u)),right:Math[t(394)](c-u,Math[t(452)](c,g+u)),bottom:Math.max(l-u,Math[t(452)](l,p+u))},d={left:r-u,top:a-u,right:c+u,bottom:l+u},_=this[t(475)].get(t(404));_[t(412)]=d[t(412)],_[t(387)]=v[t(412)],_.top=d[t(392)],_[t(400)]=v[t(392)];const m=this[t(443)].get("topleft");m[t(494)][t(412)]=r+"px",m[t(494)][t(392)]=a+"px";const y=this[t(475)][t(526)]("topright");y.left=v.right,y[t(387)]=d.right,y[t(392)]=d[t(392)],y[t(400)]=v.top;const f=this[t(443)].get(t(454));f.style[t(412)]=c+"px",f[t(494)][t(392)]=a+"px";const w=this[t(475)].get(t(377));w.left=d[t(412)],w[t(387)]=v[t(412)],w[t(392)]=v[t(400)],w.bottom=d.bottom;const M=this._directionalMoveElements[t(526)](t(377));M[t(494)].left=r+"px",M[t(494)][t(392)]=l+"px";const x=this[t(475)][t(526)](t(517));x.left=v.right,x[t(387)]=d[t(387)],x[t(392)]=v[t(400)],x[t(400)]=d[t(400)];const b=this._directionalMoveElements[t(526)](t(517));b[t(494)].left=c+"px",b[t(494)][t(392)]=l+"px";const S=this[t(475)][t(526)](t(392));S.left=v.left,S[t(387)]=v[t(387)],S.top=d[t(392)],S[t(400)]=v.top;const L=this._directionalMoveElements.get(t(392));L[t(494)][t(412)]=g+"px",L[t(494)].top=a+"px";const R=this[t(475)][t(526)](t(400));R[t(412)]=v[t(412)],R[t(387)]=v.right,R.top=v[t(400)],R[t(400)]=d[t(400)];const k=this[t(443)][t(526)]("bottom");k[t(494)][t(412)]=g+"px",k[t(494)][t(392)]=l+"px";const C=this[t(475)].get("left");C[t(412)]=d.left,C[t(387)]=v[t(412)],C[t(392)]=v[t(392)],C[t(400)]=v[t(400)];const A=this[t(443)][t(526)](t(412));A[t(494)].left=r+"px",A[t(494)][t(392)]=p+"px";const F=this[t(475)].get("right");F[t(412)]=v[t(387)],F[t(387)]=d[t(387)],F[t(392)]=v[t(392)],F.bottom=v.bottom;const I=this._directionalMoveElements[t(526)](t(387));I[t(494)][t(412)]=c+"px",I[t(494)][t(392)]=p+"px"}[e(519)](t){const i=e;if(!this[i(402)]())return this[i(388)]?i(383):"move";for(const[s,e]of this[i(475)])if((0,n.RB)(e,t[i(529)],t[i(527)]))return s;const s=this._directionalMoveZones[i(526)](i(404)),h=this[i(475)][i(526)](i(517)),o={left:s[i(412)],top:s[i(392)],right:h[i(387)],bottom:h[i(400)]};return(0,n.RB)(o,t[i(529)],t[i(527)])?i(430):this._allowNewState?"new":i(430)}}},687:(t,i,s)=>{const e=a18_0x1a89d3;s.r(i),s.d(i,{default:()=>u});var h=s(1815),n=s(5120),o=s(7896),r=s(1003),a=s(270),c=s(6173),l=s(9904),g=s(504);class p extends n.JT{constructor(t){const i=a18_0x554a;super(),this[i(455)]=t,this.id=i(532),this[i(502)]=i(430),this[i(473)]=!0,this._expandCanvasToSelectionAction=new c.f(i(398),i(503),!1),this.actions=[this[i(504)]],this[i(427)]=new l.rP(i(507),["Bilinear",i(523)],i(384)),this[i(540)]=[this[i(427)]],this[i(539)]=this[i(405)](new h.v),this[i(485)]=this[i(539)][i(396)],this[i(386)]=this[i(405)](new h.v),this[i(465)]=this[i(386)][i(396)],this[i(405)](this._qualityOption[i(501)]((()=>this[i(497)]()))),this[i(405)](this[i(455)].imageService[i(534)]((()=>this[i(498)]()))),this.register(this._sc[i(432)][i(524)]((async t=>{t.finishSelection&&await this._finishSelection()}))),this[i(405)](this[i(455)][i(434)][i(501)]((()=>{const t=i;this[t(381)](),this[t(417)](),this[t(539)][t(509)]()}))),this[i(405)](this[i(455)][i(414)][i(478)]((t=>this[i(462)](t)))),this[i(455)][i(414)][i(456)]?.[i(491)]&&this[i(462)](this[i(455)].imageService[i(456)][i(491)]),this[i(417)]()}[e(462)](t){const i=e;"moving"===t[i(407)]&&(this[i(409)]=t,this[i(405)](this._activeMovingLayer.onHistoryAction((()=>this[i(450)]()))),this[i(405)](this[i(409)][i(448)]((()=>this[i(378)]()))),this[i(408)]?.[i(425)](!0),this[i(381)](),this[i(417)](),this[i(539)][i(509)]())}[e(381)](){const t=e;if(!this[t(409)])return;const i=this._sc[t(434)][t(525)];i&&this._activeMovingLayer.moveToRange(i)}[e(417)](){const t=e,i=this[t(455)][t(434)][t(525)],s=!(!i||(0,r.ur)((0,r.DI)(this[t(455)][t(414)].width,this[t(455)].imageService.height),i));this[t(504)].enabled=s}[e(450)](){const t=e;this[t(409)]&&this[t(427)].setValueFromHistoryChange(this[t(433)](this._activeMovingLayer[t(373)][t(410)]))}[e(516)](){const t=e;this[t(498)](),super[t(516)]()}async[e(429)](t){const i=e;if(this[i(460)]=this._sc.imageService.currentLayer,!this._activeLayer)return;const s=this[i(455)].selectionService.range||this[i(455)][i(414)][i(510)]();this._isFirstMove=!this[i(409)],this[i(435)]=this[i(455)][i(480)][i(411)](t),this[i(500)]=this._cursorOrigin[i(477)](),this[i(447)]=[s.left,s[i(392)]],await this._startMove(this[i(460)],s),this._isXFlipping=!1,this[i(420)]=!1,this[i(474)]=this[i(455)][i(434)][i(525)],this[i(502)]!==i(383)&&this[i(474)]&&((this[i(502)]===i(392)||this[i(502)]===i(404)||this.state===i(454))&&(this[i(435)][1]=this[i(474)].top),(this.state===i(400)||this[i(502)]===i(377)||"bottomright"===this[i(502)])&&(this._cursorOrigin[1]=this[i(474)].bottom-1),(this.state===i(412)||this.state===i(404)||this[i(502)]===i(377))&&(this[i(435)][0]=this[i(474)][i(412)]),(this[i(502)]===i(387)||"topright"===this[i(502)]||this[i(502)]===i(517))&&(this._cursorOrigin[0]=this[i(474)][i(387)]-1))}async[e(391)](t){const i=e;if(!this[i(460)])return;if(!this[i(409)])return;const s=this[i(409)],h=this._isFirstMove?"Move Selected Pixels":i(483);this[i(455)][i(406)].createCompositeEntrySync(h,(()=>{const t=i;s[t(508)](),this[t(455)][t(434)].commit(h)})),this[i(473)]=!1,this.pointerMove(t,!1)}pointerMove(t,i){const s=e;if(this[s(408)]&&!i){const i=this._renderer[s(519)](t);this[s(502)]!==i&&(this[s(502)]=i,this._onStateChange[s(509)]())}}[e(488)](t){const i=e;if(!this[i(409)]||!this[i(435)]||!this[i(447)])return;if(this[i(500)]=this[i(455)][i(480)].getCoordsFromEvent(t),this[i(502)]===i(430)){const t=this._movingLayerOrigin[0]+this[i(500)][0]-this[i(435)][0],s=this[i(447)][1]+this[i(500)][1]-this._cursorOrigin[1];return void this[i(455)][i(434)][i(495)](t,s)}if(!this[i(474)])return;const s=this[i(500)][0]-this._cursorOrigin[0],h=this[i(500)][1]-this._cursorOrigin[1];let n;if(!t[i(466)]||"topleft"!==this[i(502)]&&this[i(502)]!==i(454)&&this.state!==i(377)&&"bottomright"!==this[i(502)])n=(0,r.BN)(this[i(474)]),(this.state===i(392)||this[i(502)]===i(404)||this[i(502)]===i(454))&&(n[i(392)]+=h,n[i(400)]<=n.top&&n[i(392)]++,t.altKey&&(n[i(400)]-=h)),(this[i(502)]===i(400)||this[i(502)]===i(377)||"bottomright"===this.state)&&(n[i(400)]+=h,n[i(400)]<=n.top&&n.bottom--,t[i(511)]&&(n[i(392)]-=h)),(this.state===i(412)||this[i(502)]===i(404)||this[i(502)]===i(377))&&(n[i(412)]+=s,n.right<=n[i(412)]&&n.left++,t[i(511)]&&(n[i(387)]-=s)),("right"===this[i(502)]||this[i(502)]===i(454)||"bottomright"===this[i(502)])&&(n[i(387)]+=s,n[i(387)]<=n[i(412)]&&n.right--,t.altKey&&(n.left-=s));else{const e=(0,r.n3)(this[i(474)]);let o;switch(n=(0,r.BN)(this._originalSelection),this[i(502)]){case i(404):o=(1/e*-s-h)/2,n[i(412)]-=Math.round(o*e),n[i(392)]-=Math[i(490)](o),t[i(511)]&&(n.right+=Math[i(490)](o*e),n.bottom+=Math.round(o));break;case i(454):o=(s*(1/e)-h)/2,n.right+=Math.round(o*e),n[i(392)]-=Math[i(490)](o),t.altKey&&(n.left-=Math[i(490)](o*e),n[i(400)]+=Math[i(490)](o));break;case"bottomleft":o=(1/e*-s+h)/2,n[i(412)]-=Math.round(o*e),n[i(400)]+=Math[i(490)](o),t.altKey&&(n[i(387)]+=Math[i(490)](o*e),n[i(392)]-=Math[i(490)](o));break;case"bottomright":o=(s*(1/e)+h)/2,n[i(387)]+=Math.round(o*e),n.bottom+=Math.round(o),t[i(511)]&&(n.left-=Math[i(490)](o*e),n[i(392)]-=Math[i(490)](o))}}const o=this._isXFlipping;this[i(461)]=n[i(387)]<n[i(412)],this[i(461)]!==o&&(this[i(409)][i(373)][i(457)]=!this._activeMovingLayer.currentState[i(457)]);const a=this[i(420)];this._isYFlipping=n.bottom<n[i(392)],this._isYFlipping!==a&&(this._activeMovingLayer[i(373)][i(379)]=!this._activeMovingLayer[i(373)][i(379)]),this[i(455)][i(434)].range=(0,r.FJ)(n)}async[e(513)](t){const i=e;if(!this[i(460)]&&(this[i(460)]=this[i(455)][i(414)][i(456)]),!this[i(460)])return;if("ArrowUp"!==t[i(446)]&&t.key!==i(481)&&"ArrowLeft"!==t.key&&t.key!==i(499))return;const s=this[i(455)][i(434)][i(525)]||this[i(455)].imageService.selectAll();if(this[i(473)]=!this[i(409)],this._isFirstMove&&await this[i(445)](this[i(460)],s),!this._activeMovingLayer)throw new Error("No moving layer");const h=(o.V5?t[i(487)]:t.ctrlKey)?10:1;switch(t[i(446)]){case i(533):this[i(455)].selectionService[i(495)](s.left,s.top-h);break;case"ArrowDown":this._sc[i(434)][i(495)](s[i(412)],s[i(392)]+h);break;case"ArrowLeft":this[i(455)].selectionService[i(495)](s[i(412)]-h,s[i(392)]);break;case"ArrowRight":this[i(455)][i(434)][i(495)](s[i(412)]+h,s[i(392)])}this[i(409)].moveStep()}async[e(445)](t,i){const s=e;if((!this[s(409)]||this[s(409)]!==t[s(491)])&&t[s(491)]?.[s(407)]===s(436)&&(this[s(409)]=t[s(491)]),this[s(409)]&&this[s(409)]===t[s(491)])return;t[s(491)]&&await t[s(491)][s(538)](),(0,r.l$)(i,(0,r.DI)(t[s(541)],t[s(438)]));const h=(0,r.Oq)(i),n=(0,r.rY)(i);let o;const c=new Promise((t=>o=t)),l={resource:{width:h,height:n,data:new Uint8Array(new SharedArrayBuffer(h*n*4))},readyPromise:c,isReady:!1},g={image:l,range:i};this._activeMovingLayer=new a.m(t,g,this[s(515)](),this[s(455)][s(406)],this[s(455)][s(434)],this[s(455)][s(470)]),await t.registerTemporaryLayer(this._activeMovingLayer),await t.edit((async(t,e,h)=>{const n=s;return await this[n(455)][n(470)].runTask(n(439),{cutImage:{data:l[n(399)][n(380)],width:l.resource[n(541)],height:l[n(399)][n(438)]},cutRange:i,targetImage:{data:t,width:e,height:h}}),i})),o(l[s(399)]),l.isReady=!0,t.onUpdateEmitter[s(509)](i)}async _finishSelection(){const t=e,i=this[t(460)]||this._sc[t(414)][t(456)];if(!i)return;if(!this[t(409)]&&i.temporaryLayer?.[t(407)]===t(436)&&(this[t(409)]=i[t(491)]),!this[t(409)])return;const s=this[t(409)];await this[t(455)][t(406)][t(537)](t(543),(async()=>{const e=t;await s[e(538)](),this[e(455)][e(434)][e(464)](i.width,i.height),this[e(455)].selectionService[e(538)]("Finish Selection")})),this[t(378)]()}[e(378)](){const t=e;this[t(460)]=void 0,this[t(409)]=void 0,this[t(408)]?.[t(425)](!1),this._onRequestRender[t(509)]()}[e(497)](){const t=e,i=this[t(515)]();this[t(409)]&&this._activeMovingLayer[t(373)][t(410)]!==i&&(this[t(409)][t(373)][t(410)]=i,this[t(409)].optionStep(t(415)),this._activeMovingLayer[t(397)]())}[e(515)](){const t=e;switch(this._qualityOption[t(437)]){case t(384):return t(458);case t(523):return t(418)}}[e(433)](t){const i=e;switch(t){case i(458):return i(384);case i(418):return i(523)}}[e(514)](t){const i=e,s=new(g[i(518)])(t,(()=>this[i(455)][i(434)].range),!1,this[i(455)][i(480)],this[i(455)][i(414)]);return this._sc[i(434)][i(501)]((()=>s[i(425)](void 0!==this._sc[i(434)][i(525)]))),s[i(425)](void 0!==this[i(455)][i(434)].range),this._renderer=s,this[i(408)]}}const u=p}}]);