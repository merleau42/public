const a2_0x4d34=["Layers are not supported for this image type","bottomleft","Erase Selection","onChangedDimensions","Cannot restore state from previous version (","_animationFrame","_showColorDetails","report-issue","entries","close","_taskWorkerService","linearDodgeAdd","_stopAnimatingProgram","effectAllowed","There is no layer to merge down into","createHslColor","_elementResizeObserver","readonly","_entryFactories","image-new","Attempt to dispose a disposed entity","_extHostRequestHandlers","_blendShader","width","outlineSize","Deselect","getProgramParameter","right-items","blur","deltaX","putImage","_frameBuffer","parsedChunks","#181e29","isPointerDown","--luna-statusBar-icon-brightness","_toolDisposables","simple",'", ignoring',"title","_rehydrateExtHostMessage","verticalAlignment","layer","attribute vec4 a_position;uniform mat4 a;uniform vec2 b;void main(){gl_Position=a*(a_position*vec4(b,0.,1.));}","wheel","Move the active image down","_changeHexInput","fitToWindow","focusin","--vscode-foreground","className","eraser","getService","executeOnAllLayers","_isDisposed","_finishHistoryEntryCtor","registerHistoryEntryFactory","StateService","toggle","di$target","_createToggle","fallbackDimensions","Alpha (aka opacity)","_onMimeTypeChange","_textureAUniformLocation","_normalizeWheelDelta","_layoutDependentViews",".tga","image.deleteImage","body","hex","Finish Rectangle","number","createRgbaColor","linear-gradient(180deg, rgba(","_progressTimeout","_loadModule","_innerContainer","Value (aka brightness)","secondary","loadedImages","zoom","onPointerMove","createReadonlyHsvColor","createCompositeEntry","ms ","targetIndex","_viewportOrigin","draw","restoreImage","pointermove","_historyService","_loadedImages","replacedRange","clipboard","NOTEQUAL","setActiveImageById","layer.mergeLayerDown","Hue","_taskService","luna-image://",".tpic","Bottom","_createColorInfo",", try reopening the editor.","checkbox","_getUnusedLayerLabelId","clientWidth","reportIssue","_renderImages","Right","_activeTool","stencilFunc","tool.crop","_savedViewport","multiply","The color of all merged layers","animation","newFromClipboard","No undo entry","strictMode","_getImageCoordsFromEvent","updateTextureIfNeeded","Cannot serialize history","primary","ArrowDown","_currentCompositeEntry","Go to Layer Below","_attachedDisposables","_onShowViewportChange","onConfigChanged","Update Selection","active-colors","colorData","onDidAddBottomItem"," x ","selection.selectAll"," at position ","getRanges","_getIndexFromId","position","_onCommit","_workMatrices","list-","_updateProgress","resume","interactive","return this","luna-layer://","tool-container","_commandService","_viewportUpdate","onEntriesChange","Cannot finish temporary layer without at least 1 step","transform","onDimensionsChange","fillContiguous","DYNAMIC_DRAW","_onStartAnimating","_ctx","setColors","scaledWidth","bilinear","_listItemElements","devicePixelRatio","onShowColorDetailsChange","getRightItems","untilRelease","history.toggleHistoryWindow"," - ","#bottom","darken","Toggle the minimap","step","splice"," (Error)","validate","pointB","canRunCommand","pop","\", it's disabled","BLEND","_tileScaledDimensionsUniformLocation","linear-gradient(90deg, rgb(255,0,0) 0%, rgb(255,255,0) 16.67%, rgb(0,255,0) 33.33%, rgb(0,255,255) 50%, rgb(0,0,255) 66.67%, rgb(255,0,255) 83.33%, rgb(255,0,0) 100%)"," y=","snapToPixelGrid","_lunaService","exportImageClone","imageFileId","Window","Toggle Stretch","size","difference","_info","error","image/bmp","_textureBUniformLocation","Layer","triggerHistoryUnset","openFile","getParameter","dispatchEvent","Layer: ","onSoftDeletedChange","list","bindFramebuffer","join","developerDirectory","pointerUp","Open Image","Rotate 90Â° Clockwise","Zoom level is ","_option","renameLayer","swapImagePositions","history-list","#canvas","active","texParameteri","Go to Bottom Layer","readyPromise","_calculateScrollVelocity","_requestToolIfNeeded","activeImageSetIndex","bindRenderbuffer","Finish Active Action","scrollTop","onerror","Selection","adjustVector","_previewCache","Layer Name: ","writeText","metaKey","quickPick","activeTool","image.addNewImage","isStretchEnabled","onDidChangeViews","_onSliderChange","getPixel","_defaultValue","_resize",">Luna: ","Zoom In","padStart","Toggle Images Window","composite","Could not find layer ","_operationName","layer.moveLayerToBottom","_eventInViewport","Move Pixels","_alpha","onDidAddTopItem","serialize function does not exist on history entry","Hard edges","Menu","slider-input-","_viewElement","InstantiationService","KEEP","isArray","releasePointerCapture","_createWorker","Copied ","selection.erase","_startAnimatingProgram","_rectangleElement","canRead","goToLayerBelow","New","Image is readonly, edit is not supported","Composite entry error","boolean","_model","_range","Access to clipboard-read was denied","_backgroundColor","color-picker-target","_refreshTheme","undoBlendMode","setNextLayerId","bindVertexArray","keypress","_viewportService","_colorToHex",'State handler for id "',"set","_finish","inputBoxNumber","isVisible","Toggle more color details","flipX","addEventListener","--luna-editor-backgroundColor","timeout","display","onDidChangeVisibility","SharedArrayBuffer","some","start","layer/flipVertical","modal","background","layerReplace","_refreshToolState","_targetIndex","_name",";\n\nin vec2 v_position;\n\nout vec4 outColor;\n\nvoid main() {\n  if (mod(v_position.x / ","onStretchEnabledChange","help.reportIssue","getShaderParameter","_imageTextureRange","Rectangle","allSettled","TRIANGLES",",1)","image-list","HelpService","redoData","_onWheel","Must follow ","_onDidAddBottomItem","_toolRenderPrograms","forEach",", bottom: ","enable","fitLayerToWindow","Command Palette","_viewportElement","warn","palette","_program","layer-move-down","angle","layer/rotate180","Erase","openBlob","register","_zoomUniformLocation","Cannot add composite entry to composite entry","pointer-color","Enter",'Cannot find factory for history entry id "',"duplicateLayer","_imageSet"," failed","layer.goToLayerBelow","Save","destRange","Merge","undoRange","Merge Layer Down","_onmessage","LINK_STATUS","onImageDeleted","key","No history entry ID to restore","Could not restore workbench state (version ","tool.colorPicker","scrollHeight","Go to Image Above","Duplicate Layer","result","duplicate","types","images","_isPointerDown","layer/flipHorizontal"," (HSV)","492358lCWcra","Cannot run expand canvas to selection without a selection","_setSoftDeleted","NYI","text","__decorate","Options for task ","filterCommands","_vscodeApi","_onStateSync","_vertexArrayObject","onStopAnimating","_imageLayerIdCounter","padEnd","_rightElement","Line","_frameBufferTextures",'" failed: ',"transparent","image/jpeg","_colorLocation","TEXTURE_MIN_FILTER","_updateUniformValueMatrix","statusBarPointerColor","temporaryLayer","Empty","document","suffix","uniform2f","canUndo","_refreshActiveImage","push","deleteLayer","Invalid range - left: ","_configEquals","mousedown","startVector","addEntry","rightItems","fade","sort","updateWorkbenchState","deleteShader","Alt",'Response received without request "',"alt+pageup","showViewport","cmd-palette","linkProgram","4-bit","_getValue","deleteRenderbuffer","_channelToHex","_unloadImageSet","_flippedAxisUniformLocation","_headerContentElement","createReadonlyHslColor","button","anchor","decorate","u_color","channel","altKey","open","Toggle Shape Tool","onProgress","Move the active image up","topright","image/webp","_redoName","onLayerVisibilityChange","_undoData","activeLayer","useMovingLayer","_options","_statusBarService","render","Rename layer","image.moveImageDown","onDispose","_toolElements","requestLayerTaskOptions","useProgram","_layerCountUniformLocation","COLOR_BUFFER_BIT","moveImageUp","ctrl+shift+s","views","_paletteService","ContextMenuService","_dropTargetElement","file.open","TRIANGLE_FAN","Move Layer Up","contains","assign","edit",";\n\nout vec4 outColor;\n\nvoid main() {\n  outColor = ","acquireVsCodeApi","_rangeBuffer","_finishHistoryEntryOperationName","ctrl+d","Top right","_ignoreStateChangeEvents","Move Layer","_getNonSoftDeletedLayerCount","_targetElement","%) 100%)"," (Readonly)","_event","goToLayerAbove","layer/invertColors","_createBlendModeSelect","_activeRequests","onDidRemoveTopItem","history","color.toggleDetails","setBlendMode","tiles","pointerEvents","Space","bindTexture","_onShowColorDetailsChange","Fit to Window","bottomStatusBar","Command ","Loading chunk ","_temporaryLayerIdCounter","undoImage","getUniformLocation","_onDidRemoveTopItem",") in vec4 a_position;\n\nuniform mat4 ","isAutoSaveEnabled","mouseWheelBehavior"," has already been registered","cmdctrl+shift+p","head","operationName","#gui","selectionEnd","There is no layer below this layer","_setState","onStateChange","Move Image","scaledImage","pow","isItalic","Windows","identificationField","_entries","finishText","tool.eraser","undefined","_container","[createInstance] ","data-active-tool","_nullTexture","createEmptyRgbColor","Cut Image","Flip Vertical","_blendModeUniformLocation","Text","showView","_createLayer","_selectionAnimationFrame","vscode.toggleMenuBar","footer","defaultVisible","_services","_luna","editIndex","static","_initialIndex","50%","_progress","Move Layer to Top","visibleCheckbox","fillGlobal","_onImagesChange","_activeUntilReleaseTool","_supportsLayers","value","_input","input","addImage","Uint32Array","exclusion","Toggle the viewport display in the minimap","_onDidRemoveBottomItem","139VnGXLr","canRedo","Hex:","contentRange","996029wgzNuh","_layerTexturesUniformLocation","Hexadecimal representation of RGB","layer.flipVertical","toString","ArrowUp","_logProgress","attach","input-container","slider-with-input","_checkCanEdit","tool.rectangle","_lastAnimationFrame","_rightItemsElement","onPointerDownMove","viewService","_blendWithframeBufferUniformLocation","onDidStartDrag","_updateTextureIfNeeded","--luna-icon-list-active-brightness","unloadedImages","_onHistoryAction","requestAnimationFrame","nextSibling","_resetHexInput","undoName","_state","enter","_renderService","layerId","window.toggleTopStatusBarView","_onPointerUp","_handlePointerUp","tempLayerId","_contextKeyService","cmd-palette-list","getColorSetFromPointerEvent","WorkbenchConfigService","activeTexture","_onZoomChange","runCommand","pointA","getData","values","not supported","defaultPosition","#version 300 es\nprecision mediump float;\n\nuniform vec4 ","--vscode-breadcrumb-foreground","setProperty","_swapImagePositions","sourceColor","_stateHandlers","_width","deselect","_blendMode","framebufferTexture2D","moveLayerTo","preview","No current layer","min","ONE","ceil","_activeLayersModel","COLOR_ATTACHMENT0","_currentEntryPointer","_handleHistoryAction","Bottom Status Bar","adjustments.invert","_renderPrograms","pointerout","Layer Blend Mode: ","Hide","edit.undo","Toggle Pixel Grid","create","_onPointerDown","layer-list","The images window is not supported for this file type","vscode-menu","_config","moving","image.moveImageToTop","Enter the new name","executeOnSingleLayer","restoreState","blendMode","ctrl+j","_onDidChangeViews","_showViewport","cmd-palette-header","Toggle Move Tool","Could not set color to array of length smaller than 4","_selectionService","moveLayerUp","options","_configService","_updatePreviewIfNeeded","_lastCoord","redoHandler","Select where to anchor the existing image","image/x-ico","byteOffset","registerTemporaryLayer","selectionStart","_focusNonActiveImage","Selection top left position is x=","remove","Could not find current layer","_imageTexture","right","smoothing","linear-gradient(90deg, rgba(","backupClipboardData","_fillCommands","map","activeToolState","textureImage","layerRange","_redoBlendMode","getContext","redo","_layerBlendModesUniformLocation","image/x-tga","Unexpected image file ID for single image file","IpcService","shiftKey","Report an issue or give feedback","prepend","goToImageAbove","flipY","onTemporaryLayerUnregistered","runTask","isPixelGridEnabled","layer/rotate90CounterClockwise","STENCIL_BUFFER_BIT","encodePng","_pointerDownMoveListener","WinCE","offsetY","keys","factory","True color","max","_updateWindowViewPosition","item","ctrl+h","_updateRenderLayerTiles","_getLayerDragEventId","Toggle Top Status Bar View","round","in-viewport","Command","1377JvKOnu","currentTemporaryLayerId","clearEntries","invertColors","_sc","_undoDimensions","_mergeLayerDownButton","runAction","hand","softLight","onHistoryUnset","firstChild","_moveActiveImageToIndex","Cannot call exportBlob for ico files","defineProperty","setNextTemporaryLayerId","luna:textFocused","shape","view.focusCanvas","SRC_ALPHA","di$dependencies","u_matrix","dimensions","object","then","requestNewDimensions","luna:focused","ONE_MINUS_SRC_ALPHA","partiallyDecodedImage","_imageDimensionsUniformLocation","data-tool-state","_onConfigChanged","top","_sanitizeValue","Cannot redo readonly entry","Customize Pointer Color Status Bar Item","Module","Finish Line","toHsv","Cannot run crop to selection without a selection","percent","goToBottomLayer","generatePreview","Cannot undo readonly entry","_views","Could not find layer for history entry","view.fitToWindow","progress","text/plain","_onProgress","uniform4f","activeElement"," (RGB)","requestRender","__esModule","Delete image","getOwnPropertyDescriptor","_redoImage","Crop to Selection","buttons","toFixed","Rotate 180Â°","load",'History entry "',"_frameBufferTexture","initialIndex","minimap.toggleStretch","LINEAR","drawArrays","_contextKeys","_lastPointerEvent","createRgbColor","onPointerDown","side","query","pointerMove","drawShape","Failed to serialize history","_updateShiftUniform","vertexAttribPointer","onKeyDown","tabIndex","getType","dims","status-bar-item-"," < ","ChunkLoadError","toRgba","_matrixLocation","default","Validate Selection","select","[0-9a-fA-F]*","Gets the color of the nearest pixel.","@IServiceName-decorator can only be used to decorate a parameter","commandId","Enter the width of the image","_listElement","_removeItem","newLayer","The color of the pixel at the pointer (excluding active vectors or moving pixels)","getComputedStyle","left","setPosition","createCompositeEntrySync","onDidChangeDimensions","moveToRange","OffscreenCanvas","unregisterTemporaryLayer","Toggle Show Viewport","drawLine","ColorService","Shape","_parentLayer","mergeDown","tool.hand","_lastActiveTool","tool.handUntilRelease","webviewRequestId","bottom","Could not find layer to set","handleOptionUpdate","insertBefore","floor","_layersModel","_rangeNotYetRequested","clearColor","pixelCount",", top: ","utf-8","_activeTemporaryLayers","_isStencilUniformLocation","toUpperCase","createVertexArray","drawCircle",'Unrecognized file extension "',"color","onRedo","Unknown History Entry","fontSize","_imagesMap"," static arguments","complete","onCommit","moveImageToBottom","mergeLayerDown","Invalid data length: ","_restoreCompositeEntry","getLayerById","vscode.setContext","_isStretchEnabled","_imageListItems","currentState"," Copy","Toggle Color Details","finishRectangle","toggle-minimap","ctrl+g","Flatten Layers","a_texcoord","grabbed","onZoomChange","cmdctrl+x","onRequestTool","requestInput","-bit","runLayerTask","blendColorAtRange","Background","tools","setPointerCapture","onDblClick","onImagesChange","_progressLast","_animationRenderPrograms","_applyCommit","STENCIL_TEST","replacedImage","_tempLayerId","_refreshTitle","hue","_isScrollLocked","container","Command: Show All Commands",'Unknown command id for type "',"removeAttribute","VERTEX_SHADER","show","_windowPosition","_cachedMovingLayer","SharedArrayBuffer is not supported","abs","image.resizeCanvas","_activeUntilReleaseToolKey","activeImageFileId","strokeWidth","element","movePixels","_setActiveItem","minimap.toggleShowViewport","_inputElement","_undoImage","extensionArea","colors","_onToolChange","_layerOffsetUniformLocation","_onRequestRender","_reportProgress","terminate","ContextKeyService","includes","pointerDown","_isEditInProgress","append","_quickPickService","blend","_cached","deserialize","exports"," depends on UNKNOWN service ","miniCssF","log","pageX","_renderer","view-drop-target"," > ","cancelAnimationFrame",",1) 0%, rgba(","appendChild","Move Selected Pixels","bufferData","setTopLeft",";\n\nout vec2 v_position;\n\nvoid main() {\n  gl_Position = ","_undoName","dragend","dispose","Pencil","pending","viewport","_replacedImage","createFramebuffer","Select All","blendFuncSeparate","getCoordsFromEvent","png","keyDown","precision mediump float;varying vec2 v_texcoord;uniform int h;uniform int k;uniform vec2 d;uniform vec2 f;uniform vec2 g;uniform int m;uniform vec2 l;uniform int c[7];uniform sampler2D j[7];uniform sampler2D n;uniform vec2 o;vec3 A(vec4 B,vec4 C,vec3 D){float E=B.a*C.a;return(B.a-E)*B.rgb+(C.a-E)*C.rgb+E*D;}vec4 F(vec4 B,vec4 C,int G){if(C.a==0.){return B;}if(B.a==0.){return C;}if(G==28){return C;}vec3 H;if(G==1){H=C.rgb;}else if(G==3){H=vec3(min(B.r,C.r),min(B.g,C.g),min(B.b,C.b));}else if(G==4){H=B.rgb*C.rgb;}else if(G==6){H=max(B.rgb+C.rgb-1.,0.);}else if(G==8){H=vec3(max(B.r,C.r),max(B.g,C.g),max(B.b,C.b));}else if(G==9){H=vec3(1.-(1.-B.r)*(1.-C.r),1.-(1.-B.g)*(1.-C.g),1.-(1.-B.b)*(1.-C.b));}else if(G==11){H=min(B.rgb+C.rgb,vec3(1.));}else if(G==13){H=vec3(B.r<.5?(2.*B.r*C.r):(1.-2.*(1.-B.r)*(1.-C.r)),B.g<.5?(2.*B.g*C.g):(1.-2.*(1.-B.g)*(1.-C.g)),B.b<.5?(2.*B.b*C.b):(1.-2.*(1.-B.b)*(1.-C.b)));}else if(G==14){H=vec3(C.r<.5?(2.*B.r*C.r+B.r*B.r*(1.-2.*C.r)):(sqrt(B.r)*(2.*C.r-1.)+2.*B.r*(1.-C.r)),C.g<.5?(2.*B.g*C.g+B.g*B.g*(1.-2.*C.g)):(sqrt(B.g)*(2.*C.g-1.)+2.*B.g*(1.-C.g)),C.b<.5?(2.*B.b*C.b+B.b*B.b*(1.-2.*C.b)):(sqrt(B.b)*(2.*C.b-1.)+2.*B.b*(1.-C.b)));}else if(G==20){H=abs(B.rgb-C.rgb);}else if(G==21){H=B.rgb+C.rgb-2.*B.rgb*C.rgb;}float I=C.a+B.a*(1.-C.a);return vec4(A(B,C,H)/I,I);}void main(){vec4 B;if(g==f&&d==vec2(0.)){B=texture2D(j[0],v_texcoord);}else{if(v_texcoord.x>=(d.x)/g.x&&v_texcoord.y>=(d.y)/g.y&&v_texcoord.x<((d.x)+f.x)/g.x&&v_texcoord.y<((d.y)+f.y)/g.y){vec2 J=v_texcoord-vec2(d.x/g.x,d.y/g.y);vec2 K=J*vec2(g.x/f.x,g.y/f.y);if(o.x==1.){K.x=1.-K.x;}if(o.y==1.){K.y=1.-K.y;}B=texture2D(j[0],K);}else{if(k==1){discard;}else{B=vec4(0.,0.,0.,0.);}}}if(m==1){vec4 L=texture2D(n,gl_FragCoord.xy/l);B=F(L,B,c[0]);}for(int M=1;M<7;M++){if(M>=h){break;}if(g==f){vec4 C=texture2D(j[M],v_texcoord);B=F(B,C,c[M]);}else{if(v_texcoord.x>=(d.x)/g.x&&v_texcoord.y>=(d.y)/g.y&&v_texcoord.x<((d.x)+f.x)/g.x&&v_texcoord.y<((d.y)+f.y)/g.y){vec2 J=v_texcoord-vec2(d.x/g.x,d.y/g.y);vec2 K=J*vec2(g.x/f.x,g.y/f.y);vec4 C=texture2D(j[M],K);B=F(B,C,c[M]);}}}gl_FragColor=B;}","moveImageDown","view.actualSize","_forwardLayerEvents","onToolChange","_gl","texture","renderLayer","onPixelGridEnabledChange","imageSmoothingEnabled","uniform1f","_onDidStartDrag","_syncHiddenText","actions",".jpeg","permissions","deleteTexture","Save As","RGBA","_setHorizontalLine","focusout","_positionArray","uniform1i","secondaryColor","NEAREST","move","linearBurn","History entry type ","selected","state","_pointCache","_startHistoryEntryOperationName","_scrollInterval","toggleView","createDomRenderProgram","_onEntriesChange","_clearUntilReleaseTool","newImage","setImageSoftDeleted","onLayerChange","swap","pointer-coords","enabled","_leftItemsElement","canvas",".png","History","_imageFileService","zoomIn","bitness","overlay","layer/expandCanvasToSelection","image.rotate180","registerRequestHandler","_isPixelGridEnabled","layer/cropToSelection","%) 0%, hsl(","erase","24-bit","minimap-stretch","setMimeType","Rotate 90Â° Counter Clockwise","focus","showToast","denied","_renderLayers","enableVertexAttribArray","_outOfFrameScroll","ctrlKey","The primary color's hex value in the format rrggbb. When changing, rgb will be expanded to rrggbb.","ctrl+9","image.toggleImagesWindow","_imageIdCounter","setVisible","_startEdit","layer.goToLayerAbove","all","getFineCoordsFromEvent","TRIANGLE_STRIP","hidden","onStartAnimating","image.rotate90Clockwise","bmp","moveSelection","read",", right: ","ILunaService","Finish Text","layer/crop",'Duplicate webview request handler "',"mouseleft","_onHistoryUnset","_forwardEventToTool","u_pixelsize","eraseSelection","afterend","_activeAnimatingRenderPrograms","documentElement","_disposables","308935hCdsVd","isSelectionTool","aria-label","a_position","Active","disconnect","registerHistoryEntryHandler","_contentElement","ctrl+alt+pagedown","exportImage","Float32Array","onTemporaryLayerRegistered","commit","palette.togglePaletteWindow","setAttribute","dest","length","_getSliderBackground","_onChangedDimensions","image-move-up","_cloneState","nameSpan","Fit layer to window [","onLastListenerRemove","Cannot delete last layer","_onDidChangeVisibilityEmitter","hotExitMaxPixels","Minimap","No active image index","_onKeyUp","onStateSync","byteLength","inputBoxString","find","substring","Expand Canvas to Selection","_data","Failed to import image from clipboard","_checkLayerSupport","image/png","color.swapColors","createDocumentFragment","_value","middle","getAttribute","Top Status Bar","framebufferRenderbuffer","message","event","redoName","Open","startsWith","CommandService","_applyData","onShowViewportChange","_primaryColorDiv","importBlob","_contextMenuService","dataTransfer",", 1.) < 1. / ","toStringTag","_stepState","navigator.clipboard.write not supported","_imageService","bindBuffer",".ico","layer.goToTopLayer","tool.fill","interlaceMethod","_canvas","Move Layer Down","resize","offsetTop","Restore Image (Hot Exit)","Mac68K","dragstart","info","parentElement","_createButton","colorPicker","onUpdate","ctor","_createMinimapImageBounds","_positionsArray","parentNode","FLOAT","offset","Resize","textContent","Use % for percentage","deleteProgram","cmdctrl+c","Copy","linear-gradient(180deg, ","decodeTga","setTimeout","setActiveImageByIndex","moveLayerDown","_updateAttributeBuffers","disabled","from","observe","_createPaletteButton",'Task "',"dblclick","_finishEdit","previousSibling","_uniformValueZoom","finishLine","_getFrameBufferTexture","task","nonce","updateConfig","setTool","layer-duplicate","edit.redo"," 0%, rgba(","_onPointerMove","new","Trying to get visible viewport range before element is attached","createProgram","ctrl+shift+x","_activeItems","currentLayer","drawText","restore","missing","_isReadonly","radio","alt+pagedown","ctrl+shift+d","getPropertyValue","_matrixUniformLocation","zoomOut","crop","dragging","_secondaryColorDiv","270187SzZbqr","Cannot add readonly entry to composite entry","registerStateHandler","chunk-","_color","absolute","dataType","Palette","undo","image-move-down","change","querySelectorAll","Image exceeded maximum pixel count allowed (","mouseout","height","Could not find temp layer ","_getImageDragEventId","version"," * a_position;\n}","rectangle",".jpe","_listeners","exportBlobClone","onDidRemoveBottomItem","image.goToBottomImage","goToTopLayer","findIndex","image","image.resize","_onDblClick",".dib","_startTime","colors-toggle-details","contextmenu","leftItems","dblClick","_instantiationService","slider-tab","478490UKCNJz","name","createRenderProgram","Show All Commands","_queueProgress","string-combo","multiLayer",'No handler for webview request "',"_onStretchEnabledChange","image.customizePointerColorStatusBarItem","createReadonlyRgbColor","primaryColor","_goToRelativeLayer","Flip Horizontal","isInteger","_serializeCompositeEntry","MacPPC","uniformMatrix4fv","moveStep","_selection","TEXTURE_2D","_onPixelGridEnabledChange","_lastCommittedRange","setData","_stateService","_items","charset","Nearest neighbor","setPixel","Go to Top Layer","createImageBitmap","requestQuickPick","Duplicate image","Macintosh",";\n\nvoid main() {\n  gl_Position = ","_onAttach","_generatePreview","Select how the resize will be performed","destImage","indexOf","preventDefault","Could not load tool ","setLayerName","_refreshColorDetails","_viewportPosition","Duplicate the active layer","corrupt","triggerHistoryAction","clientHeight","_positionsNeedsUpdate","_workbenchConfigService","renderSelection","requiresTool","rgba(","_rectangleShader","Tools","mimeType","layer.deleteLayer","True color & alpha channel","_entryFocusedContextKey","layer-delete","Add Image","Image: ","_matrixNeedsUpdate","_getAnchorSide","_reportInterval","colorType","negateEnabled","Multiple ","match","_undoBlendMode","Move the active layer up",".view","_layerId","none","view","_minValue","vscode.executeCommand","onmessage","workbenchState","saveState","_needsAttributeUpdate","uniform1iv","Tool","postMessage","Close ","showColorDetails","_isSoftDeleted","_clipspaceToCanvasCoordsMatrix","clientY","_keyDown","decodePng","ctrl+r","rename","platform","layer.moveLayerUp","Undoing temporary layer step without initial step state event","_moveLayerDownButton","data","value must not be falsy","imageTextureRange","removeChild","layer/resize","MinimapService","_moveLayerUpButton","dragover","undoData","Paste","_imageCanvasRenderProgram","_onLayerChange",'Could not find non-existent command "',"_openImages","hasStateHandler","createEmptyHslColor","_forceSelectionAnimation","createRenderbuffer","hsl","ranges","Cannot merge the bottom layer down","onPointerCoordChange"," pixels tall","Width not selected","_onTemporaryLayerRegistered","onLayerChangeEmitter","createReadonlyRgbaColor","_layerListItems","luna-icon","+click]","bottomright","View","content","getTempLayer","TEXTURE_WRAP_S","_positionBuffer","_uniformValueBlendModes","dropEffect","onWheel","fire","Resize Canvas","minimap","Delete layer","Cannot set the active layer to undefined"," conflicts with ","resource","_frameBufferUniformLocation","_pointerDownY","dataLength","merge","tool.toggleMoveTool","catch","get","ctrl+alt+pageup","_activeLayersModelIndex","Anchor not selected","edit.copy","_checkSupportsMultipleImages","expand-canvas-to-selection","Fill","New Image","refreshTheme","stopPropagation","file.save","u_shift","_render","DEPTH_STENCIL_ATTACHMENT","_onStopAnimating","tool.moveSelection",")->(","webpackChunkluna","onVisibilityChange","onImageChange","_zoomLocation","showDecodeProblemStatusBarEntry","INPUT","visible","_updateItem","_addOption","hsv","applyCommit","img","stopImmediatePropagation","Top left","layer/rotate90Clockwise","finishTemporaryLayer","Move Layer to Bottom","image.expandCanvasToSelection"," chunks not allowed","pixel-grid","Help",".webp","hardwareConcurrency","[invokeFunction] unknown service '","drawImage","onHistoryAction","_fillRange","color-overlay","#version 300 es\nlayout(location=0)in vec4 A;out vec2 v_texcoord;void main(){gl_Position=A;v_texcoord=(A.xy+1.)/2.;}","__param","_channel","tool.toggleShapeTool","goToImageBelow","_layer",'" to set active',"ctrl+shift+r","_updateBottomLayer","string","Unrecognized array type",".jif","_cachedVectorLayer","defaultTool","workbench.action.quickOpen","layer.goToBottomLayer","moveLayerToTop","deleteImage","_restoreEntry","_onUndo","rgb","blendFunc","_ipcService","random","click","warnings","Cannot serialize history entry","onUpdateEmitter","importScripts","write","Delete the active image","code","cmdctrl+v","normal","Toggle Colors Window","Layers","_startHistoryEntryCtor","_addItem","compileShader","Use % for percentage, wxh for shorthand","clientX","_sliderGradientElement","ctrl+y","has","_updateAttributeBuffersForLayer","Selection size is ","WebGL2 is not supported",") {\n    outColor = vec4(0.2, 0.2, 0.2, .2);\n  }\n}","_colorDetailsDisposables",".bmp","_attach","delete","tool.selection","#version 300 es\nlayout (location = ","_onSoftDeletedChange","_renderProgramsWithOrder","layer.moveLayerDown","getBoundingClientRect","rgba","getElementsByTagName","checked","pointerDownMove","fireAndWait","Move Image to Bottom","image-delete","_hiddenText","repeat","_onDispose","sqrt","DeleteImage","toLowerCase","save","_onTemporaryLayerUnregistered","_maxValue","_zoom","Height not selected","buffer","Move Image to Top","space",'Unexpected option type "',"draggable"," Layer",'Cannot run command "',"script","_rebuildImageCache","_scrollVelocity","imageSet","_glSelection","_handleWheel","clearRect","_getActiveImage","hideView","replace","disposables","toBlob","fill","data-webpack","request","linear-gradient(to right, rgb(255,255,255) 0%, rgb(","onBeforeRunLayerTask","Move Image Up","_onRequestTool","layer/resizeCanvas","Go to Top Image","deltaY","layer.moveLayerToTop","line","cmd+shift+z","108987MoGggD","_action","setActiveLayer","_redoData","extName","_setValue","createTexture","_updateMatrixUniform","allLayers","1yNoPNe","Show","selection","isBold","src","layerIndexList","flattenLayers","isReadonly","setService","file.new","_viewsElement","view.zoomIn","createEmptyRgbaColor","_queueUpdate","_redoRange",".jpg","Duplicate layer","Invert","_onLayerVisibilityChange","_deleteLayerByIndex","color-box","prototype","_createWindowView","getAll","stepState","Go to Image Below","_getBeforeRunLayerTaskEvent","filter","dragleave","eraseRange","updateAnimation","FRAGMENT_SHADER","view.fitLayerToWindow","LINE_LOOP","ArrowRight","_blendModeOptions","_destRange","luna-icon-before","precision mediump float;uniform vec4 c;void main(){gl_FragColor=c;}","File","_shiftValue","label","_isRestoringState","WebGL context loss, please reload the tab","sourceImage","MAX_TEXTURE_IMAGE_UNITS","_onDimensionsChange","Toggle Menu Bar","ctrl+shift+n","subarray","layer.renameLayer","_updateLayer","goToBottomImage","tool","Colors","_pointerDownStartTime","Delete Image","getAttribLocation","_inputService","add","luna.executeCommand","_renderSelection","layer.addNewLayer","isReady","#top","location","Automatic publicPath is not supported in this browser","onAttach","initialState","1-bit","activeImage","_refresh","div","ArrowLeft","_onBeforeRunLayerTask","createInstance","_hexInputElement","_onVisibilityChange","Rotate 90Â° Counter-Clockwise","insertAdjacentElement","_isAnimating","protocol","call","_createListItemElement",";\n\nout vec4 outColor;\n\nvoid main() {\n  float c = floor(mod((float(gl_FragCoord.x) + float(gl_FragCoord.y) + ","TEXTURE0","indexList","_redoDimensions","activeEntry","_handlePointerMove","writeIco","function","getInfo","_handlePointerDownMove","no-text","exportBlob","_onPointerDownMove","apply","linear-gradient(rgba(0,0,0,0) 0%, rgb(0,0,0) 100%),","History entry factory ","Image","Bottom left","_viewService","selectAll","image.goToImageAbove","run","staticState","runSyncAction","createElement",'No state handler for id "',"_imageListElement","trim","_texcoordBuffer","ARRAY_BUFFER","disable","REPLACE","currentScript","onFirstListenerAdd","pencil","tagName","There must be at least one image",".js","ctrl+s","pointerId","_onRedo","undoHandler","_contributions","order","getTemporaryLayerById","drop-target","offsetHeight","Edit",".css","Saturation","_getRange","_finishCompositeEntry","openImage","layer.rotate180","arrayBuffer","_target","Quality not selected","_onKeyDown","ALWAYS","requestInputNumber","createItem","_isPaused","currentEntry","_layerListElement",'Job dimension not found for task "',"imageTexture","AddImage","goToTopImage","_sliderTabElement","_toolService","finishShape","webgl2","lighten","convertToBlob","toRgb","onDidEndDrag","extHostRequestId","keydown","Set Paste Image Selection","fontFamily","Adjustments","DEPTH_BUFFER_BIT","stencilOp","FRAMEBUFFER","STATIC_DRAW","No redo entry","pattern","_multiplyZoom","isSoftDeleted","Finish Selection","unregister",'Cannot find image "',"_getImageOrActiveIndex","_timeout","getCommand","minimap-viewport","_layoutAll","_windowResolvedPosition","_height","fitToCoords","_channelIndex","bind","texImage2D","currentValue","Uint8Array"," not yet supported","pageY","MODULE_NOT_FOUND","_messageHandler","_renderTileSet","ctrl+m","256 colors","_doExecuteOnLayer","_windowVisibleContextKey","isBottomLayer","_elementService","Must precede ","createShader","_itemDisposables","onRequestRender","Status bar item already added","_widgetContent","tool.movePixels","invokeFunction","onPointerUp","redoRange","setOption","serialize","offsetWidth","_sliderContainer","_isWindowAnchor","#version 300 es\nprecision mediump float;uniform int a;uniform sampler2D b;uniform sampler2D c;in vec2 v_texcoord;out vec4 A;vec3 B(vec4 C,vec4 D,vec3 E){float a=C.a*D.a;return(C.a-a)*C.rgb+(D.a-a)*D.rgb+a*E;}vec4 F(vec4 C,vec4 D,int G){if(D.a==0.){return C;}if(C.a==0.){return D;}if(G==28){return D;}vec3 H;if(G==1){H=D.rgb;}else if(G==3){H=vec3(min(C.r,D.r),min(C.g,D.g),min(C.b,D.b));}else if(G==4){H=C.rgb*D.rgb;}else if(G==6){H=max(C.rgb+D.rgb-1.,0.);}else if(G==8){H=vec3(max(C.r,D.r),max(C.g,D.g),max(C.b,D.b));}else if(G==9){H=vec3(1.-(1.-C.r)*(1.-D.r),1.-(1.-C.g)*(1.-D.g),1.-(1.-C.b)*(1.-D.b));}else if(G==11){H=min(C.rgb+D.rgb,vec3(1.));}else if(G==13){H=vec3(C.r<.5?(2.*C.r*D.r):(1.-2.*(1.-C.r)*(1.-D.r)),C.g<.5?(2.*C.g*D.g):(1.-2.*(1.-C.g)*(1.-D.g)),C.b<.5?(2.*C.b*D.b):(1.-2.*(1.-C.b)*(1.-D.b)));}else if(G==14){H=vec3(D.r<.5?(2.*C.r*D.r+C.r*C.r*(1.-2.*D.r)):(sqrt(C.r)*(2.*D.r-1.)+2.*C.r*(1.-D.r)),D.g<.5?(2.*C.g*D.g+C.g*C.g*(1.-2.*D.g)):(sqrt(C.g)*(2.*D.g-1.)+2.*C.g*(1.-D.g)),D.b<.5?(2.*C.b*D.b+C.b*C.b*(1.-2.*D.b)):(sqrt(C.b)*(2.*D.b-1.)+2.*C.b*(1.-D.b)));}else if(G==20){H=abs(C.rgb-D.rgb);}else if(G==21){H=C.rgb+D.rgb-2.*C.rgb*D.rgb;}float I=D.a+C.a*(1.-D.a);return vec4(B(C,D,H)/I,I);}void main(){vec4 J=texture(b,v_texcoord);vec4 K=texture(c,v_texcoord);A=F(J,K,a);}","mouseright","_getWithCache","_disposed"," to clipboard","type","minimap.toggleMinimapWindow","loaded","_shiftLocation","duplicateImage","section","_entryHandlers","_frameBufferRenderBuffer","encodeOptions","_validate","alignment","image.moveImageUp","resolve","createHsvColor","image-entry","DEPTH_STENCIL","onSliderChange","_pointerDownX","Cannot get coords without element","temporaryLayers","_getCanvasBounds","syncGlobalState","_pixelSizeLocation","offsetX","pointerup","_update","_onImageDeleted","pause","image.flattenLayers","saveAs","Crop","TEXTURE_MAG_FILTER","TEXTURE_WRAP_T","tool.shape","toast-message","global","config","selection.deselect","_updateViaSlider","Top","scaledHeight","separator","Redo","target","imageFile","getLayer",'" already exists',"Bottom right","redoBlendMode","luna:","header","triggerRequestRender","getEventPositionFromCoords","now","shaderSource","Report Issue...","screen","clipboard-read","_imageFileId","onload","createBuffer","_apply","moveImageTo","moveLayer","imageResize","putRange","removeEventListener","_colorService","left-items","image-dimensions","split","_onDidEndDrag"," ||\n      mod(v_position.y / ","Actual Size","Cannot finish composite entry without an entries array","style","Enter the height of the image","moveSelectedPixels","UNSIGNED_BYTE","_mimeType","file","singleLayer","layers","canSerialize","_canvasDimensionsUniformLocation","_replacedRange","span","Buffer","onChange","window","quality","Eraser","image.finishActiveAction","topStatusBar","setLayerVisibility","_updateUniformValueZoom","finishMovePixels","onHistoryUpdateValue","toggleAttribute","_onStateChange","distance","layer.duplicateLayer","Left","_onPointerCoordChange","view.togglePixelGrid","_isVisible","slider","onKeyUp","showError","_clickOrigin","Toggle Tools Window","_pointerCoord","createMessageHandler","Rename Layer","range","CLAMP_TO_EDGE","hasImage","Could not serialize layers","reduce","moveImageToTop","Green","for","selection.eraseKeepSelection","optionStep","classList","clear","getShaderInfoLog","image.flipVertical","_canvasSelection","visibleRange","Clipboard contains non-image data. Unable to access it.","Toggle pixel grid when zoomed in","option","drop","colorMask","_minimapService","eraseKeepSelection","pointerdown",") 100%)","previewCanvas","topleft","Blue","onUndo","onMimeTypeChange","serviceBrand","_onDidAddTopItem","end","layer-move-up","getAllCommands","index","_pointCount","MoveImage","update","disableWorkers","RENDERBUFFER","moveLayerToBottom","$debounce$","activeToolId","setActiveImage","_screenPixelToCanvasCoord","Toggle History Window","toHsl","slice","translate(-50%, -50%)","_onUpdate","bitDepth",'Could not find non-existent static view "',"querySelector","Toggle Layers Window","TEXTAREA","ctrl+a"],a2_0x43a7=function(t,e){return a2_0x4d34[t-=293]};(function(t,e){const i=a2_0x43a7;for(;;)try{if(253551===parseInt(i(1120))+parseInt(i(945))+-parseInt(i(1424))*parseInt(i(1433))+parseInt(i(444))*-parseInt(i(600))+parseInt(i(2195))+parseInt(i(1082))+-parseInt(i(448)))break;t.push(t.shift())}catch(e){t.push(t.shift())}})(a2_0x4d34),(()=>{var t={4738:t=>{const e=a2_0x43a7;t[e(818)]=e(1648)},7542:t=>{const e=a2_0x43a7;t.exports=e(1316)},3318:t=>{const e=a2_0x43a7;t.exports=e(846)},3716:t=>{t[a2_0x43a7(818)]="attribute vec4 a_position;attribute vec2 a_texcoord;uniform mat4 a;uniform vec2 b;varying vec2 v_texcoord;void main(){gl_Position=a*(a_position*vec4(b,0.,1.));v_texcoord=a_texcoord;}"},98:t=>{const e=a2_0x43a7;t[e(818)]=e(1471)},7034:t=>{const e=a2_0x43a7;t[e(818)]=e(1867)},6495:(t,e,i)=>{"use strict";const s=a2_0x43a7;i.d(e,{Z:()=>r,N:()=>a});var n=i(7166),o=i(4378);class r{constructor(t,e,i,s){this[a2_0x43a7(392)]=t,this._range=e,this._layer=i,this._f=s}async[s(1538)](){const t=s,e=(0,n.Qf)(this[t(1321)],this[t(2100)]);await this[t(1321)][t(351)]((async(e,i,s)=>{const n=t;return await this._f(e,i,s),this[n(2100)]}));const i=(0,n.Qf)(this[t(1321)],this[t(2100)]);return new o.$(this[t(392)],this[t(2100)],this[t(1321)][t(2012)],this[t(1321)].id,e,i)}}class a{constructor(t,e,i,n,o,r,a,h,c){const l=s;this[l(2073)]=t,this[l(1321)]=e,this._selection=i,this._x=n,this._y=o,this[l(1086)]=r,this._tolerance=a,this._blendMode=h,this[l(1834)]=c}async[s(1538)](){const t=s;let e;return await this[t(1321)].edit((async(i,s,n)=>{const o=t;return e=await this[o(1834)][o(579)](o(432),{targetImage:{data:i,width:s,height:n},color:this._color,selection:this[o(1139)],x:this._x,y:this._y,tolerance:this._tolerance,blendMode:this[o(502)]}),e[o(1767)]})),new o.$(this[t(2073)],e.range,this._layer[t(2012)],this[t(1321)].id,e.undoData,e[t(2144)])}}},4852:(t,e,i)=>{"use strict";const s=a2_0x43a7;i.d(e,{S:()=>n});class n{constructor(t,e,i,s,n,o){const r=a2_0x43a7;this[r(392)]=t,this[r(1172)]=e,this[r(1457)]=i,this[r(1711)]=s,this[r(1193)]=n,this[r(778)]=o,this.type=r(1734),this[r(727)]=0}async[s(1090)](t){const e=s,i=await t[e(1698)](this[e(1711)],this[e(1193)]);if(!i)throw new Error(e(2072)+this[e(1193)]);const n=await t.getTempLayer(this[e(1711)],this[e(1193)],this._tempLayerId);if(!n)throw new Error("Could not find temp layer "+this[e(1193)]);if(n[e(1457)][e(2003)](),0===n[e(1457)].length)throw new Error(e(1216));const o=n[e(1457)][n[e(1457)][e(961)]-1];return this[e(1714)](n,o),i}async[s(568)](t){const e=s,i=await t[e(1698)](this[e(1711)],this._layerId);if(!i)throw new Error(e(2072)+this[e(1193)]);const n=await t[e(1251)](this._imageFileId,this[e(1193)],this[e(778)]);if(!n)throw new Error(e(1097)+this[e(1193)]);return n[e(1457)][e(2226)](this[e(1457)]),this[e(1714)](n,this.stepState),i}[s(1714)](t,e){const i=s;Object[i(350)](t[i(752)],e),t[i(1704)](),t[i(1167)]()}[s(1644)](){const t=s;return{id:t(2053),requiresTool:this[t(1172)],operationName:this[t(392)],imageFileId:this[t(1711)],layerId:this._layerId,tempLayerId:this[t(778)],stepState:this[t(1457)]}}static create(t){return new n(t[s(392)],t.requiresTool,t.stepState,t.imageFileId,t.layerId,t.tempLayerId)}}},8286:(t,e,i)=>{"use strict";const s=a2_0x43a7;i.d(e,{Z:()=>n});class n{constructor(t,e,i,s){const n=a2_0x43a7;this[n(392)]=t,this[n(1711)]=e,this[n(1193)]=i,this._tempLayerId=s,this[n(1653)]=n(1734),this.requiresTool=n(1422),this.pixelCount=0}async[s(1090)](t){const e=s,i=await t[e(1698)](this._imageFileId,this._layerId);if(!i)throw new Error(e(2072)+this._layerId);const n=await t[e(1251)](this[e(1711)],this[e(1193)],this[e(778)]);if(!n)throw new Error(e(1097)+this._layerId);if(0===n[e(1457)][e(961)])throw new Error(e(1977));const o=n[e(1457)][n[e(1457)][e(961)]-1];return this._apply(n[e(752)],o),await i.registerTemporaryLayer(n,!1),n[e(1167)](),i}async redo(t){const e=s,i=await t[e(1698)](this._imageFileId,this[e(1193)]);if(!i)throw new Error(e(2072)+this._layerId);const n=await t.getTempLayer(this[e(1711)],this[e(1193)],this[e(778)]);if(!n)throw new Error("Could not find temp layer "+this[e(1193)]);return i[e(2219)]=void 0,n.triggerHistoryUnset(),i}[s(1714)](t,e){Object[s(350)](t,e)}[s(1644)](){const t=s;return{id:t(1053),operationName:this[t(392)],imageFileId:this._imageFileId,layerId:this[t(1193)],tempLayerId:this._tempLayerId}}static[s(522)](t){const e=s;return new n(t[e(392)],t[e(2012)],t[e(477)],t[e(481)])}}},6628:(t,e,i)=>{"use strict";const s=a2_0x43a7;i.d(e,{$:()=>r});var n=i(1003),o=i(7605);class r{constructor(t,e,i,s,o,r,a,h){const c=a2_0x43a7;this.operationName=t,this[c(1834)]=e,this._destRange=i,this._replacedRange=s,this._imageFileId=o,this[c(1193)]=r,this[c(778)]=a,this[c(839)]=h,this[c(1653)]=c(1734),this[c(1172)]=c(797),this[c(727)]=(0,n.U6)(this[c(1738)])}async[s(1090)](t){const e=s,i=await t[e(1698)](this[e(1711)],this[e(1193)]);if(!i)throw new Error("Could not find layer "+this[e(1193)]);const n=await t[e(1251)](this[e(1711)],this[e(1193)],this[e(778)]);if(!n)throw new Error("Could not find temp layer "+this[e(1193)]);if(0===n.stepState[e(961)])throw new Error(e(1977));const o=n[e(1457)][n.stepState[e(961)]-1];return n[e(752)][e(1676)]=o[e(1676)],n[e(752)][e(586)]=o[e(586)],n[e(752)][e(2117)]=o[e(2117)],n[e(752)].flipY=o[e(577)],await i[e(550)](n,!1),await i[e(351)]((async(t,i,s)=>{const n=e;return await this[n(1834)][n(579)](n(1854),{targetImage:{data:t,width:i,height:s},putImage:{data:this._replacedImage[n(1218)],width:this._replacedImage[n(1847)],height:this._replacedImage[n(1096)]},putRange:this[n(1738)],replacedImage:void 0,blend:n(1408)}),this[n(1469)]})),n.triggerHistoryAction(),i}async[s(568)](t){const e=s,i=await t.getLayer(this._imageFileId,this[e(1193)]);if(!i)throw new Error(e(2072)+this[e(1193)]);const n=await t[e(1251)](this[e(1711)],this[e(1193)],this[e(778)]);if(!n)throw new Error("Could not find temp layer "+this[e(1193)]);const o=n[e(1457)][n[e(1457)][e(961)]-1];n[e(752)][e(1676)]=this[e(1469)].left,n.currentState[e(586)]=this._destRange[e(632)],n[e(752)][e(2117)]=o.flipX,n[e(752)].flipY=o[e(577)],i[e(2219)]=void 0;const r=await n[e(1539)][e(1109)][e(2044)];let a;if(o[e(1985)]===r[e(1847)]&&o[e(1693)]===r[e(1096)])a=r;else{const t=await this[e(1834)][e(766)]("layer/resize",{width:o.scaledWidth,height:o[e(1693)],resampling:o.quality},r,void 0)[e(2188)];a=t[e(960)]}return await i.edit((async(t,i,s)=>{const o=e;return await this._taskWorkerService.runTask("putImage",{targetImage:{data:t,width:i,height:s},putImage:{data:a[o(1218)],width:a.width,height:a[o(1096)]},putRange:this[o(1469)],replacedImage:void 0,blend:o(1408),flipX:n[o(752)][o(2117)],flipY:n[o(752)][o(577)]}),this[o(1469)]})),n[e(2022)](),i}serialize(){const t=s;return{id:t(1749),operationName:this[t(392)],imageFileId:this[t(1711)],layerId:this._layerId,tempLayerId:this[t(778)],destRange:this[t(1469)],replacedRange:this[t(1738)],replacedImage:(0,o.t)(this[t(839)])}}static[s(522)](t,e){const i=s;return new r(e.operationName,t,e[i(2174)],e[i(1917)],e[i(2012)],e[i(477)],e[i(481)],(0,o.e)(e[i(777)]))}}},3817:(t,e,i)=>{"use strict";const s=a2_0x43a7;i.d(e,{O:()=>n});class n{constructor(t,e,i,s){const n=a2_0x43a7;this[n(392)]=t,this._imageFileId=e,this[n(1193)]=i,this._tempLayerId=s,this[n(1653)]="singleLayer",this.requiresTool=n(1101),this[n(727)]=0}async[s(1090)](t){const e=s,i=await t[e(1698)](this[e(1711)],this[e(1193)]);if(!i)throw new Error(e(2072)+this._layerId);const n=await t[e(1251)](this._imageFileId,this[e(1193)],this[e(778)]);if(!n)throw new Error(e(1097)+this._layerId);if(0===n.stepState[e(961)])throw new Error(e(1977));const o=n[e(1457)][n[e(1457)][e(961)]-1];return this._apply(n.currentState,o),await i[e(550)](n,!1),n[e(1167)](),i}async[s(568)](t){const e=s,i=await t.getLayer(this._imageFileId,this[e(1193)]);if(!i)throw new Error("Could not find layer "+this[e(1193)]);const n=await t.getTempLayer(this._imageFileId,this[e(1193)],this._tempLayerId);if(!n)throw new Error(e(1097)+this._layerId);return i[e(2219)]=void 0,n.triggerHistoryUnset(),i}[s(1714)](t,e){Object[s(350)](t,e)}[s(1644)](){const t=s;return{id:"finishRectangle",operationName:this.operationName,imageFileId:this[t(1711)],layerId:this[t(1193)],tempLayerId:this[t(778)]}}static[s(522)](t){const e=s;return new n(t[e(392)],t.imageFileId,t[e(477)],t[e(481)])}}},3089:(t,e,i)=>{"use strict";const s=a2_0x43a7;i.d(e,{o:()=>n});class n{constructor(t,e,i,s){const n=a2_0x43a7;this.operationName=t,this[n(1711)]=e,this[n(1193)]=i,this[n(778)]=s,this[n(1653)]=n(1734),this[n(1172)]=n(617),this.pixelCount=0}async[s(1090)](t){const e=s,i=await t.getLayer(this[e(1711)],this[e(1193)]);if(!i)throw new Error(e(2072)+this[e(1193)]);const n=await t[e(1251)](this[e(1711)],this[e(1193)],this[e(778)]);if(!n)throw new Error("Could not find temp layer "+this[e(1193)]);if(0===n[e(1457)][e(961)])throw new Error("Cannot finish temporary layer without at least 1 step");const o=n[e(1457)][n.stepState[e(961)]-1];return this[e(1714)](n[e(752)],o),await i[e(550)](n,!1),n[e(1167)](),i}async[s(568)](t){const e=s,i=await t[e(1698)](this[e(1711)],this[e(1193)]);if(!i)throw new Error(e(2072)+this[e(1193)]);const n=await t.getTempLayer(this[e(1711)],this._layerId,this[e(778)]);if(!n)throw new Error(e(1097)+this[e(1193)]);return i[e(2219)]=void 0,n[e(2022)](),i}[s(1714)](t,e){Object[s(350)](t,e)}[s(1644)](){const t=s;return{id:t(1587),operationName:this[t(392)],imageFileId:this[t(1711)],layerId:this._layerId,tempLayerId:this._tempLayerId}}static[s(522)](t){const e=s;return new n(t[e(392)],t[e(2012)],t[e(477)],t.tempLayerId)}}},707:(t,e,i)=>{"use strict";const s=a2_0x43a7;i.d(e,{o:()=>n});class n{constructor(t,e,i,s){const n=a2_0x43a7;this[n(392)]=t,this._imageFileId=e,this[n(1193)]=i,this[n(778)]=s,this[n(1653)]="singleLayer",this.requiresTool=n(2199),this[n(727)]=0}async[s(1090)](t){const e=s,i=await t[e(1698)](this[e(1711)],this[e(1193)]);if(!i)throw new Error(e(2072)+this[e(1193)]);const n=await t[e(1251)](this[e(1711)],this[e(1193)],this[e(778)]);if(!n)throw new Error(e(1097)+this[e(1193)]);if(0===n[e(1457)].length)throw new Error(e(1977));const o=n[e(1457)][n[e(1457)][e(961)]-1];return this[e(1714)](n[e(752)],o),await i[e(550)](n,!1),n[e(1167)](),i}async[s(568)](t){const e=s,i=await t[e(1698)](this[e(1711)],this[e(1193)]);if(!i)throw new Error(e(2072)+this[e(1193)]);const n=await t.getTempLayer(this[e(1711)],this[e(1193)],this[e(778)]);if(!n)throw new Error(e(1097)+this[e(1193)]);return i[e(2219)]=void 0,n.triggerHistoryUnset(),i}_apply(t,e){Object[s(350)](t,e)}[s(1644)](){const t=s;return{id:t(405),operationName:this[t(392)],imageFileId:this[t(1711)],layerId:this[t(1193)],tempLayerId:this._tempLayerId}}static[s(522)](t){const e=s;return new n(t[e(392)],t.imageFileId,t[e(477)],t[e(481)])}}},6785:(t,e,i)=>{"use strict";const s=a2_0x43a7;i.d(e,{x:()=>o});var n=i(7605);class o{constructor(t,e,i,s,n,o){const r=a2_0x43a7;this.operationName=t,this[r(1711)]=e,this._layerId=i,this[r(2100)]=s,this[r(326)]=n,this[r(1427)]=o,this[r(1653)]=r(1734),this.pixelCount=this._undoData[r(1519)][r(961)]}[s(1090)](t){const e=s;return this[e(998)](this[e(2100)],this._undoData,t)}[s(568)](t){const e=s;return this[e(998)](this[e(2100)],this[e(1427)],t)}[s(1644)](){const t=s;return{id:t(1438),operationName:this[t(392)],imageFileId:this[t(1711)],layerId:this[t(1193)],range:this[t(2100)],undoData:(0,n.t)(this._undoData),redoData:(0,n.t)(this._redoData)}}async[s(998)](t,e,i){const n=s,o=await i[n(1698)](this[n(1711)],this._layerId);if(!o)throw new Error(n(645));return await o[n(351)]((i=>{const s=n;let o=0;for(let t=0;t<e[s(1519)][s(961)];t++)o=e[s(1519)][t],i[o]=e[s(1957)][4*t],i[o+1]=e[s(1957)][4*t+1],i[o+2]=e[s(1957)][4*t+2],i[o+3]=e[s(1957)][4*t+3];return t})),o}static[s(522)](t){const e=s;return new o(t[e(392)],t[e(2012)],t.layerId,t[e(1767)],(0,n.e)(t[e(1226)]),(0,n.e)(t[e(2144)]))}}},4378:(t,e,i)=>{"use strict";const s=a2_0x43a7;i.d(e,{$:()=>o});var n=i(1003);class o{constructor(t,e,i,s,o,r){const a=a2_0x43a7;this[a(392)]=t,this[a(1767)]=e,this[a(1711)]=i,this[a(1193)]=s,this._undoData=o,this[a(1427)]=r,this.type="singleLayer",this[a(727)]=(0,n.U6)(this[a(1767)])}async[s(1090)](t){const e=s;return await this._apply(this[e(326)],t)}async[s(568)](t){const e=s;return await this._apply(this[e(1427)],t)}async _apply(t,e){const i=s,o=await e.getLayer(this[i(1711)],this[i(1193)]);if(!o)throw new Error("Could not find layer "+this[i(1193)]);const r=(0,n.rY)(this[i(1767)]),a=(0,n.Oq)(this[i(1767)]),h=4*a;let c=0,l=0,d=0;return await o[i(351)](((e,s)=>{const n=i;for(let i=0;i<r;i++)l=i+this[n(1767)].top,c=4*(l*s+this[n(1767)][n(702)]),d=i*a*4,e.set(t.subarray(d,d+h),c);return this[n(1767)]})),o}[s(1644)](){const t=s;return{id:t(565),operationName:this[t(392)],imageFileId:this[t(1711)],layerId:this[t(1193)],range:this.range,undoData:Array[t(1045)](this._undoData),redoData:Array.from(this._redoData)}}static[s(522)](t){const e=s;return new o(t[e(392)],t[e(1767)],t[e(2012)],t[e(477)],new Uint8Array(t.undoData),new Uint8Array(t[e(2144)]))}}},1375:(t,e,i)=>{"use strict";const s=a2_0x43a7;i.d(e,{C:()=>n});class n{constructor(t,e,i,s,n,o,r,a){const h=a2_0x43a7;this[h(392)]=t,this._taskWorkerService=e,this._stepState=i,this._imageFileId=s,this[h(1193)]=n,this[h(778)]=o,this[h(500)]=r,this._height=a,this[h(1653)]=h(1734),this.requiresTool="movePixels",this[h(727)]=this._width*this[h(1615)]}async undo(t){const e=a2_0x43a7,i=await t[e(1698)](this._imageFileId,this[e(1193)]);if(!i)throw new Error(e(2072)+this[e(1193)]);const s=await t.getTempLayer(this[e(1711)],this[e(1193)],this[e(778)]);if(!s)throw new Error(e(1097)+this._layerId);return s.stepState[e(2003)](),s.currentState.offsetX=s[e(1501)][e(1676)],s[e(752)][e(586)]=s[e(1501)][e(586)],s.currentState.flipX=s[e(1501)][e(2117)],s[e(752)][e(577)]=s[e(1501)][e(577)],i[e(2219)]=void 0,await i[e(351)]((async(t,i,n)=>{const o=e,r=await s[o(1539)][o(1109)].readyPromise,a=this[o(1567)](s);return await this[o(1834)][o(579)](o(1854),{targetImage:{data:t,width:i,height:n},putImage:{data:r[o(1218)],width:r[o(1847)],height:r.height},putRange:a,replacedImage:void 0,blend:o(1408)}),a})),s[e(2022)](),i}async[s(568)](t){const e=s,i=await t[e(1698)](this[e(1711)],this[e(1193)]);if(!i)throw new Error(e(2072)+this[e(1193)]);const n=await t[e(1251)](this[e(1711)],this[e(1193)],this[e(778)]);if(!n)throw new Error(e(1097)+this[e(1193)]);return n[e(1457)][e(2226)](this[e(1006)]),n[e(752)][e(1676)]=this._stepState.offsetX,n[e(752)][e(586)]=this[e(1006)][e(586)],n[e(752)][e(2117)]=this._stepState[e(2117)],n[e(752)][e(577)]=this[e(1006)].flipY,i.temporaryLayer=n,await i.edit((async(t,i,s)=>{const o=e,r=this[o(1567)](n);return await this._taskWorkerService[o(579)]("eraseRange",{targetImage:{data:t,width:i,height:s},range:r}),r})),n[e(1167)](),i}[s(1567)](t){const e=s;return{left:t[e(1501)][e(1676)],top:t.initialState[e(586)],right:t[e(1501)][e(1676)]+t[e(1539)][e(1109)].resource[e(1847)],bottom:t.initialState[e(586)]+t[e(1539)][e(1109)][e(1263)][e(1096)]}}[s(1644)](){const t=s;return{id:t(1730),operationName:this[t(392)],imageFileId:this[t(1711)],layerId:this[t(1193)],tempLayerId:this[t(778)],stepState:this[t(1006)],width:this[t(500)],height:this._height}}static create(t,e){const i=s;return new n(e[i(392)],t,e[i(1457)],e[i(2012)],e[i(477)],e[i(481)],e[i(1847)],e.height)}}},8549:(t,e,i)=>{"use strict";const s=a2_0x43a7;i.d(e,{i:()=>n});class n{constructor(t,e,i,s,n,o){const r=a2_0x43a7;this[r(392)]=t,this[r(1172)]=e,this._stepState=i,this[r(1711)]=s,this[r(1193)]=n,this[r(778)]=o,this[r(1653)]="singleLayer",this.pixelCount=0}async undo(t){const e=a2_0x43a7,i=await t[e(1698)](this[e(1711)],this[e(1193)]);if(!i)throw new Error("Could not find layer "+this[e(1193)]);const s=await t.getTempLayer(this[e(1711)],this[e(1193)],this[e(778)]);if(!s)throw new Error("Could not find temp layer "+this[e(1193)]);return s[e(1457)][e(2003)](),this[e(1714)](s,s[e(1501)]),i.temporaryLayer=void 0,s.triggerHistoryUnset(),i}async redo(t){const e=a2_0x43a7,i=await t[e(1698)](this[e(1711)],this[e(1193)]);if(!i)throw new Error(e(2072)+this[e(1193)]);const s=await t[e(1251)](this[e(1711)],this._layerId,this[e(778)]);if(!s)throw new Error(e(1097)+this._layerId);return s[e(1457)][e(2226)](this[e(1006)]),this[e(1714)](s,this[e(1006)]),await i[e(550)](s,!1),s.triggerHistoryAction(),i}_apply(t,e){const i=a2_0x43a7;Object[i(350)](t.currentState,e),t[i(1704)]()}[s(1644)](){const t=s;return{id:t(2231),requiresTool:this.requiresTool,operationName:this[t(392)],imageFileId:this[t(1711)],layerId:this[t(1193)],tempLayerId:this[t(778)],stepState:this._stepState}}static create(t){const e=s;return new n(t.operationName,t[e(1172)],t.stepState,t.imageFileId,t[e(477)],t.tempLayerId)}}},3491:(t,e,i)=>{"use strict";const s=a2_0x43a7;i.d(e,{M:()=>h,w:()=>c});var n=i(1815),o=i(5120),r=i(7605);let a=0;function h(t){a=Math[a2_0x43a7(590)](a,t)}class c extends o.JT{constructor(t,e){const i=a2_0x43a7;super(),this[i(713)]=e,this[i(1965)]=this[i(2163)](new n.v),this[i(743)]=this[i(1965)][i(993)],this[i(806)]=this[i(2163)](new n.v),this[i(1636)]=this._onRequestRender[i(993)],this[i(937)]=this[i(2163)](new n.v),this[i(610)]=this[i(937)].event,this._onHistoryAction=this[i(2163)](new n.v),this[i(1313)]=this[i(469)][i(993)],t?(this.id=t,h(t)):this.id=++a}triggerRequestRender(){const t=a2_0x43a7;this[t(806)][t(1257)]()}[s(1167)](){const t=s;this[t(469)][t(1257)]()}[s(2022)](){const t=s;this[t(937)][t(1257)]()}[s(1736)](t){const e=s;if(-1!==t&&this[e(713)].width*this._parentLayer.height>t)return"Moving layer exceeded maximum pixel count allowed ("+this[e(713)][e(1847)]*this._parentLayer[e(1096)]+e(825)+t+")"}[s(1644)](){const t=s;return{id:this.id,parentLayerId:this[t(713)].id,type:this.type,staticState:(0,r.t)(this[t(1539)]),initialState:(0,r.t)(this[t(1501)]),currentState:(0,r.t)(this[t(752)]),stepState:this[t(1457)][t(562)]((t=>(0,r.t)(t)))}}}},9199:(t,e,i)=>{"use strict";const s=a2_0x43a7;i.d(e,{r:()=>a});var n=i(4852),o=i(8549),r=i(3491);class a extends r.w{constructor(t,e,i,s){const n=a2_0x43a7;super(i,t),this[n(1915)]=e,this[n(1457)]=s}get[s(1582)](){}get[s(1220)](){}[s(1997)](t,e=!1){const i=s,r=this[i(965)](this[i(752)]);if(this[i(1457)][i(961)]>0){let s=!1;if(e){const e=this[i(1915)].entries[this[i(1915)][i(1832)][i(961)]-1];e[i(392)]===t&&(e[i(1457)]=r,this.stepState[this[i(1457)].length-1]=r,s=!0)}!s&&(this[i(1915)][i(2232)](new n.S(t,this.requiresTool,r,this._parentLayer[i(2012)],this[i(713)].id,this.id)),this[i(1457)][i(2226)](r))}else this._historyService[i(2232)](this[i(1352)]?new(this[i(1352)])(this[i(877)],r,this[i(713)][i(2012)],this[i(713)].id,this.id):new o.i(this[i(877)],this[i(1172)],r,this[i(713)][i(2012)],this[i(713)].id,this.id)),this[i(1457)][i(2226)](r);this[i(806)][i(1257)]()}[s(721)](t,e,i,n){const o=s;this[o(752)][e]!==t&&(this[o(752)][e]=t,this[o(1997)](i,n),this[o(1704)]())}async[s(957)](){const t=s;await this._historyService.createCompositeEntry(this[t(355)],(async()=>{const e=t;this[e(1915)][e(2232)](new this._finishHistoryEntryCtor(this[e(355)],this[e(713)][e(2012)],this._parentLayer.id,this.id)),await this[e(775)]()})),this[t(1965)][t(1257)]()}}},2811:(t,e,i)=>{"use strict";const s=a2_0x43a7;i.d(e,{B:()=>l});var n=i(116),o=i(1003),r=i(7605),a=i(6495),h=i(8286),c=i(9199);class l extends c.r{constructor(t,e,i,s,n,o,r,a=[]){const c=a2_0x43a7;super(t,s,r,a),this[c(1539)]=e,this[c(1501)]=i,this._selectionService=n,this._taskWorkerService=o,this[c(1653)]="line",this[c(1172)]=c(1422),this[c(1879)]=h.Z,this[c(877)]="Draw Line",this._finishHistoryEntryOperationName=c(637),this[c(752)]=this[c(965)](a[c(961)]?a[a[c(961)]-1]:this[c(1501)]),this[c(1313)]((()=>this[c(466)]())),a[c(961)]>0&&this[c(466)]()}get[s(1220)](){return this[s(2137)]}get imageTexture(){return this[s(556)]}step(t,e=!1){const i=s;super[i(1997)](t,e),this[i(466)]()}async[s(466)](){const t=s,{image:e,resolve:i,reject:r}=(0,n.W)(this[t(713)][t(1847)],this[t(713)][t(1096)]);this[t(556)]=e,this._imageTextureRange=(0,o.DI)(this[t(713)][t(1847)],this._parentLayer.height);const a=this.currentState;try{await this[t(1834)].runTask("drawLine",{targetImage:e.resource,color:this[t(1539)].invertColors?a[t(869)]:a[t(1131)],pointA:a[t(489)],pointB:a[t(2001)],strokeWidth:a[t(795)],smoothing:a[t(558)],blendMode:a[t(533)],selection:this[t(540)].range}),e[t(1496)]=!0,i(e[t(1263)]),this[t(806)][t(1257)]()}catch(i){this[t(556)]===e&&(this[t(556)]=void 0),r(i)}}async _applyCommit(){const t=s;if(this[t(556)]){const e=await this._imageTexture[t(2044)],i=(0,o.DI)(e.width,e.height);await this[t(1915)][t(607)](new a.Z(this[t(355)],i,this._parentLayer,(async(e,i,s)=>{const n=t;await this[n(1298)](e,i,s)})))}}async[s(1298)](t,e,i){const n=s;if(this[n(556)]){const s=await this[n(556)][n(2044)],r=(0,o.DI)(s.width,s[n(1096)]);await this._taskWorkerService.runTask(n(1854),{blend:this[n(752)][n(533)],targetImage:{data:t,width:e,height:i},putImage:s,putRange:r,replacedImage:void 0})}}[s(965)](t){const e=s;return{pointA:{...t[e(489)]},pointB:{...t[e(2001)]},primaryColor:t[e(1131)],secondaryColor:t.secondaryColor,blendMode:t[e(533)],strokeWidth:t[e(795)],smoothing:t[e(558)]}}static[s(522)](t,e,i,n,o){const a=s;return new l(e,(0,r.e)(t[a(1539)]),(0,r.e)(t[a(1501)]),i,n,o,t.id,t[a(1457)].map((t=>(0,r.e)(t))))}}},270:(t,e,i)=>{"use strict";const s=a2_0x43a7;i.d(e,{m:()=>d});var n=i(2939),o=i(1003),r=i(7605),a=i(4852),h=i(6628),c=i(1375),l=i(3491);class d extends l.w{constructor(t,e,i,s,n,r,a,h=[]){const c=a2_0x43a7;super(a,t),this[c(1539)]=e,this[c(1915)]=s,this[c(540)]=n,this[c(1834)]=r,this[c(1457)]=h,this[c(1653)]=c(528),this[c(1501)]=typeof i===c(623)?i:{offsetX:e[c(1767)][c(702)],offsetY:e[c(1767)][c(632)],flipX:!1,flipY:!1,scaledWidth:(0,o.Oq)(e[c(1767)]),scaledHeight:(0,o.rY)(e[c(1767)]),quality:typeof i===c(1325)?i:c(1986)},this.currentState={...h?.[c(961)]?h[h[c(961)]-1]:this[c(1501)]},this[c(1313)]((()=>this[c(544)]())),h[c(961)]>0&&this[c(544)](),this[c(1539)][c(1109)][c(2044)].then((()=>this[c(806)][c(1257)]()))}get data(){const t=a2_0x43a7;return this[t(1539)][t(1109)].resource[t(1218)]}get width(){const t=a2_0x43a7;return this.staticState.image[t(1263)][t(1847)]}get[s(1096)](){const t=s;return this[t(1539)][t(1109)][t(1263)][t(1096)]}[s(706)](t){const e=s;this[e(752)][e(1676)]===t[e(702)]&&this[e(752)].offsetY===t[e(632)]&&this[e(752)].scaledWidth===(0,o.Oq)(t)&&this[e(752)].scaledHeight===(0,o.rY)(t)||(this[e(752)][e(1676)]=t.left,this[e(752)][e(586)]=t.top,this[e(752)][e(1985)]=(0,o.Oq)(t),this.currentState[e(1693)]=(0,o.rY)(t),this[e(806)][e(1257)]())}[s(1138)](){const t=s,e={...this[t(752)]};this.stepState[t(961)]>0?this._historyService.addEntry(new a.S(t(2076),t(797),e,this._parentLayer[t(2012)],this[t(713)].id,this.id)):this[t(1915)][t(2232)](new c.C(t(829),this[t(1834)],e,this._parentLayer[t(2012)],this[t(713)].id,this.id,this[t(1539)][t(1109)][t(1263)][t(1847)],this[t(1539)][t(1109)].resource[t(1096)])),this[t(544)](),this.stepState[t(2226)](e),this[t(806)][t(1257)]()}[s(1776)](t){const e=s,i={...this.currentState};this[e(1915)][e(2232)](new a.S(t,e(797),i,this._parentLayer[e(2012)],this[e(713)].id,this.id)),this[e(544)](),this[e(1457)].push(i),this[e(806)][e(1257)]()}_updatePreviewIfNeeded(){const t=s,e=this[t(399)]?.[t(1263)][t(1847)]||this[t(1539)].image[t(1263)].width,i=this[t(399)]?.[t(1263)][t(1096)]||this[t(1539)][t(1109)][t(1263)][t(1096)];if(e===this.currentState.scaledWidth&&i===this.currentState[t(1693)]&&this.scaledImageQuality===this[t(752)][t(1743)])return;if(this.scaledImageQuality=this[t(752)][t(1743)],this[t(752)][t(1985)]===this[t(1539)].image.resource[t(1847)]&&this.currentState[t(1693)]===this.staticState[t(1109)].resource[t(1096)])return this[t(399)]=this.staticState[t(1109)],void this[t(806)][t(1257)]();let n;const o=new Promise((t=>n=t)),r={width:this[t(752)][t(1985)],height:this[t(752)][t(1693)],data:new Uint8Array(0)};this.scaledImage={isReady:!1,readyPromise:o,resource:r},this[t(1539)][t(1109)][t(2044)][t(624)]((async e=>{const i=t,s=await this[i(1834)][i(766)]("layer/resize",{width:this[i(752)].scaledWidth,height:this[i(752)].scaledHeight,resampling:this[i(752)][i(1743)]},e,void 0)[i(2188)];r[i(1218)]=s.dest[i(1218)],this[i(399)]&&(this[i(399)][i(1496)]=!0),n(r),this[i(806)].fire()}))}async commit(){const t=s,e=await(this[t(399)]?.readyPromise||this[t(1539)].image.readyPromise),i=Math[t(590)](this.currentState[t(1676)],0),o=Math.max(this.currentState[t(586)],0),r=Math.min(this[t(752)][t(1676)]+this[t(752)][t(1985)],this[t(713)][t(1847)]),a=Math[t(507)](this.currentState[t(586)]+this.currentState[t(1693)],this[t(713)][t(1096)]),c=r-i,l=a-o,d=(0,n.u)(c,this[t(713)][t(1847)],0)*(0,n.u)(l,this[t(713)].height,0)*4,u={width:c,height:l,data:new Uint8Array(new SharedArrayBuffer(d))},g={left:this[t(752)][t(1676)],top:this[t(752)].offsetY,right:this.currentState[t(1676)]+this[t(752)].scaledWidth,bottom:this[t(752)][t(586)]+this[t(752)][t(1693)]};d>0&&await this[t(713)][t(351)]((async(i,s,n)=>{const o=t;return await this[o(1834)].runTask(o(1854),{putRange:g,targetImage:{data:i,width:s,height:n},putImage:e,replacedImage:u,blend:"replace",flipX:this[o(752)].flipX,flipY:this[o(752)][o(577)]}),g})),this[t(1915)][t(2232)](new h.$(t(1606),this._taskWorkerService,g,{left:i,top:o,right:r,bottom:a},this[t(713)][t(2012)],this[t(713)].id,this.id,u)),this[t(1965)].fire()}static[s(522)](t,e,i,n,o){const a=s;return new d(e,(0,r.e)(t.staticState),(0,r.e)(t.initialState),i,n,o,t.id,t[a(1457)][a(562)]((t=>(0,r.e)(t))))}}},807:(t,e,i)=>{"use strict";const s=a2_0x43a7;i.d(e,{F:()=>l});var n=i(7517),o=i(1003),r=i(7605),a=i(6495),h=i(3817),c=i(9199);class l extends c.r{constructor(t,e,i,s,n,o,r,a=[]){const c=a2_0x43a7;super(t,s,r,a),this[c(1539)]=e,this[c(1501)]=i,this._selectionService=n,this[c(1834)]=o,this.type=c(1101),this[c(1172)]=c(1101),this._finishHistoryEntryCtor=h.O,this[c(877)]="Draw Rectangle",this[c(355)]=c(1895),this[c(752)]=this[c(965)](a.length?a[a[c(961)]-1]:this[c(1501)])}async _applyCommit(){const t=a2_0x43a7;await this[t(1915)][t(607)](new a.Z(this[t(355)],this[t(752)][t(1767)],this[t(713)],(async(e,i,s)=>{this[t(1298)](e,i,s)})))}async[s(1298)](t,e,i){const n=s,r=this[n(752)][n(1767)],a=this[n(752)].blendMode,h=this[n(1962)]();if((0,o.U6)(r)>25e4){const s=[];for(const o of h)for(const r of o.ranges)s[n(2226)](this[n(1834)][n(579)](n(767),{targetImage:{data:t,width:e,height:i},range:r,color:new Uint8Array(o[n(736)]),blendMode:a}));await Promise.all(s)}else for(const i of h)for(const s of i[n(1237)])this[n(1314)](t,e,s,i[n(736)],a)}[s(965)](t){const e=s;return{primaryColor:t.primaryColor,secondaryColor:t[e(869)],blendMode:t[e(533)],range:(0,o.BN)(t.range),outlineSize:t.outlineSize,style:t[e(1728)]}}[s(1314)](t,e,i,o,r){const a=s;for(let s=i[a(632)];s<i[a(719)];s++)for(let h=i[a(702)];h<i[a(557)];h++)(0,n.B)(r,t,4*(s*e+h),o,0)}getRanges(){const t=s,e=[],i=this[t(752)],n=this[t(1539)][t(603)]?i[t(869)]:i.primaryColor,r=this[t(1539)][t(603)]?i.primaryColor:i[t(869)],a=2===i[t(1728)]?n:r,h=2===i[t(1728)]?r:n,c=this[t(540)][t(1767)]||(0,o.DI)(this[t(713)][t(1847)],this[t(713)].height),l=(0,o.l$)({left:i[t(1767)][t(702)],right:i[t(1767)][t(557)],top:i[t(1767)][t(632)],bottom:Math.min(i[t(1767)][t(632)]+i[t(1848)],i[t(1767)][t(719)])},c),d=(0,o.l$)({left:i[t(1767)][t(702)],right:i[t(1767)].right,top:Math[t(590)](l[t(719)],i[t(1767)][t(719)]-i.outlineSize),bottom:i[t(1767)][t(719)]},c),u=(0,o.l$)({left:i[t(1767)][t(702)],right:i[t(1767)].left+i[t(1848)],top:l[t(719)],bottom:d[t(632)]},c),g=(0,o.l$)({left:Math[t(590)](u[t(557)],i[t(1767)][t(557)]-i.outlineSize),right:i[t(1767)][t(557)],top:l[t(719)],bottom:d[t(632)]},c);return 2!==i.style&&e[t(2226)]({ranges:[l,d,u,g],color:h}),3===i[t(1728)]?e[t(2226)]({ranges:[{left:u[t(557)],right:g[t(702)],top:l[t(719)],bottom:d[t(632)]}],color:a}):2===i[t(1728)]&&e.push({ranges:[{left:u.left,right:g[t(557)],top:l.top,bottom:d.bottom}],color:a}),e}static create(t,e,i,n,o){const a=s;return new l(e,(0,r.e)(t[a(1539)]),(0,r.e)(t.initialState),i,n,o,t.id,t[a(1457)][a(562)]((t=>(0,r.e)(t))))}}},3670:(t,e,i)=>{"use strict";const s=a2_0x43a7;i.d(e,{n:()=>l});var n=i(116),o=i(1003),r=i(7605),a=i(6495),h=i(3089),c=i(9199);class l extends c.r{constructor(t,e,i,s,n,o,r,a=[]){const c=a2_0x43a7;super(t,s,r,a),this[c(1539)]=e,this.initialState=i,this[c(540)]=n,this[c(1834)]=o,this.type=c(617),this[c(1172)]=c(617),this[c(1879)]=h.o,this[c(877)]="Draw Shape",this[c(355)]="Finish Shape",this.currentState=this[c(965)](a[c(961)]?a[a[c(961)]-1]:this[c(1501)]),this[c(1313)]((()=>this[c(466)]())),a[c(961)]>0&&this[c(466)]()}get[s(1220)](){return this[s(2137)]}get imageTexture(){return this[s(556)]}step(t,e=!1){const i=s;super[i(1997)](t,e),this[i(466)]()}async[s(466)](){const t=s,e=this[t(752)];(!this[t(2137)]||!(0,o.ap)(this[t(2137)],e[t(1767)]))&&(this._imageTextureRange=(0,o.kq)((0,o.BN)(e[t(1767)])));const{image:i,resolve:r,reject:a}=(0,n.W)((0,o.Oq)(this[t(2137)]),(0,o.rY)(this[t(2137)]));this[t(556)]=i;try{await this[t(1834)][t(579)](t(676),{targetImage:i[t(1263)],primaryColor:this.staticState[t(603)]?e[t(869)]:e.primaryColor,secondaryColor:this[t(1539)].invertColors?e.primaryColor:e[t(869)],dimensions:e[t(1767)],type:e[t(1653)],strokeWidth:this[t(752)][t(1848)],smoothing:e[t(558)],style:e.style,blendMode:e[t(533)],selection:this[t(540)][t(1767)],flipX:e.flipX,flipY:e.flipY}),i[t(1496)]=!0,r(i[t(1263)]),this._onRequestRender.fire()}catch(e){this[t(556)]===i&&(this[t(556)]=void 0),a(e)}}async[s(775)](){const t=s;this[t(556)]&&this[t(2137)]&&(await this[t(556)][t(2044)],await this[t(1915)][t(607)](new a.Z(this[t(355)],this[t(2137)],this[t(713)],(async(e,i,s)=>{const n=t;await this[n(1298)](e,i,s)}))))}async[s(1298)](t,e,i){const n=s;if(!this[n(556)]||!this[n(2137)])return;const o=await this[n(556)].readyPromise;await this[n(1834)][n(579)]("putImage",{blend:this[n(752)][n(533)],targetImage:{data:t,width:e,height:i},putImage:o,putRange:this._imageTextureRange,replacedImage:void 0})}[s(965)](t){const e=s;return{primaryColor:t[e(1131)],secondaryColor:t[e(869)],blendMode:t[e(533)],range:(0,o.BN)(t[e(1767)]),outlineSize:t.outlineSize,style:t[e(1728)],smoothing:t[e(558)],type:t[e(1653)],flipX:t[e(2117)],flipY:t.flipY}}static[s(522)](t,e,i,n,o){const a=s;return new l(e,(0,r.e)(t.staticState),(0,r.e)(t[a(1501)]),i,n,o,t.id,t[a(1457)][a(562)]((t=>(0,r.e)(t))))}}},7233:(t,e,i)=>{"use strict";const s=a2_0x43a7;i.d(e,{o:()=>l});var n=i(116),o=i(1003),r=i(7605),a=i(6495),h=i(707),c=i(9199);class l extends c.r{constructor(t,e,i,s,n,o,r,a=[]){const c=a2_0x43a7;super(t,s,r,a),this[c(1539)]=e,this[c(1501)]=i,this[c(540)]=n,this._taskWorkerService=o,this[c(1653)]=c(2199),this[c(1172)]=c(2199),this[c(1879)]=h.o,this[c(877)]="Draw Text",this._finishHistoryEntryOperationName=c(933),this[c(752)]=this[c(965)](a[c(961)]?a[a[c(961)]-1]:this.initialState),this[c(1313)]((()=>this[c(1946)]())),(a.length>0||i[c(2199)].length>0)&&this[c(1946)]()}get imageTextureRange(){return this[a2_0x43a7(2137)]}get[s(1582)](){return this[s(556)]}[s(1997)](t,e=!1){const i=s;super[i(1997)](t,e),this[i(1946)]()}async[s(1946)](){const t=s,{image:e,resolve:i,reject:r}=(0,n.W)(this._parentLayer[t(1847)],this._parentLayer[t(1096)]);this[t(556)]=e,this[t(2137)]=(0,o.DI)(this[t(713)][t(1847)],this._parentLayer[t(1096)]);const a=this[t(752)];try{await this._taskWorkerService[t(579)](t(1069),{targetImage:e[t(1263)],primaryColor:this[t(1539)][t(603)]?a[t(869)]:a[t(1131)],secondaryColor:this[t(1539)][t(603)]?a[t(1131)]:a.secondaryColor,dimensions:a[t(1767)],blendMode:a[t(533)],selection:this._selectionService.range,text:a[t(2199)],isBold:a[t(1436)],isItalic:a[t(401)],fontSize:a.fontSize,fontFamily:a[t(1596)],alignment:a[t(1663)],verticalAlignment:a[t(1865)]}),e.isReady=!0,i(e[t(1263)]),this[t(806)][t(1257)]()}catch(i){this[t(556)]===e&&(this[t(556)]=void 0,this[t(806)].fire()),r(i)}}async[s(775)](){const t=s;if(this[t(556)]){const e=await this[t(556)].readyPromise,i=(0,o.DI)(e[t(1847)],e[t(1096)]);await this._historyService[t(607)](new a.Z(this._finishHistoryEntryOperationName,i,this[t(713)],(async(e,i,s)=>{const n=t;await this[n(1298)](e,i,s)})))}}async[s(1298)](t,e,i){const n=s;if(this[n(556)]){const s=await this._imageTexture[n(2044)],r=(0,o.DI)(s.width,s[n(1096)]);await this[n(1834)][n(579)](n(1854),{blend:this[n(752)][n(533)],targetImage:{data:t,width:e,height:i},putImage:s,putRange:r,replacedImage:void 0})}}_cloneState(t){const e=s;return{primaryColor:t[e(1131)],secondaryColor:t[e(869)],blendMode:t[e(533)],range:(0,o.BN)(t.range),text:t[e(2199)],isBold:t[e(1436)],isItalic:t[e(401)],fontSize:t[e(739)],fontFamily:t[e(1596)],alignment:t[e(1663)],verticalAlignment:t.verticalAlignment}}static create(t,e,i,n,o){const a=s;return new l(e,(0,r.e)(t.staticState),(0,r.e)(t[a(1501)]),i,n,o,t.id,t[a(1457)].map((t=>(0,r.e)(t))))}}},1038:(t,e,i)=>{const s=a2_0x43a7;var n={"./renderers/moveImageRangeRenderer.js":[504,504],"./tools/colorPicker.js":[6471,6471],"./tools/crop.js":[3976,3976],"./tools/eraser.js":[2996,2996],"./tools/fill.js":[7643,7643],"./tools/hand.js":[2333,2333],"./tools/line.js":[2844,2844],"./tools/movePixels.js":[687,687],"./tools/moveSelection.js":[403,403],"./tools/pencil.js":[5525,5525],"./tools/rectangle.js":[7440,7440],"./tools/selection.js":[3040,3040],"./tools/shape.js":[9113,9113],"./tools/text.js":[8488,8488],"./tools/zoom.js":[7710,7710]};function o(t){const e=a2_0x43a7;if(!i.o(n,t))return Promise[e(1665)]()[e(624)]((()=>{const i=e;var s=new Error("Cannot find module '"+t+"'");throw s[i(1347)]=i(1624),s}));var s=n[t],o=s[0];return i.e(s[1])[e(624)]((()=>i(o)))}o[s(587)]=()=>Object[s(587)](n),o.id=1038,t.exports=o},1123:(t,e,i)=>{"use strict";function s(t,e){const i=a2_0x43a7;t[i(1856)][i(1359)](e[i(1653)])&&m(t,u(e,i(1188)+e[i(1653)]+i(1306),e.offset+4))}function n(t,e,i){const s=a2_0x43a7;if(e[s(1266)]!==i){const n=u(e,"Invalid data length: "+e[s(1266)]+" !== "+i,e[s(1031)]);if(!(e.dataLength>i))throw n;m(t,n)}}function o(t,e,i){const s=a2_0x43a7;if(e[s(1266)]<i)throw l(t,e,s(746)+e.dataLength+s(685)+i,e[s(1031)])}function r(t,e,i){const s=a2_0x43a7;t[s(1856)][s(1359)](i)&&m(t,u(e,s(1633)+i,e[s(1031)]+4))}function a(t,e,i){const s=a2_0x43a7;if(!t[s(1856)].has(i))throw l(t,e,s(2146)+i,e[s(1031)]+4)}function h(t,e,i){const s=a2_0x43a7;t[s(1856)][s(1359)](i)&&m(t,u(e,"Should not be present alongside "+i,e[s(1031)]+4))}function c(t,e,i,s){0!==i&&m(t,u(e,'Unknown compression method "'+i+'"',s))}function l(t,e,i,s){return new d(t,e.type+": "+i,s)}i.d(e,{qA:()=>s,_c:()=>n,uf:()=>o,iw:()=>r,nW:()=>a,lf:()=>h,a1:()=>c,gS:()=>l,_9:()=>d,iU:()=>u,b4:()=>g,pP:()=>m});class d extends Error{constructor(t,e,i){const s=a2_0x43a7;super(e),this.offset=i,this[s(628)]={details:s(1703)in t&&t[s(1703)]?{width:t.header.width,height:t[s(1703)][s(1096)],bitDepth:t[s(1703)][s(1818)],colorType:t.header[s(1186)],interlaceMethod:t[s(1703)][s(1013)]}:void 0,info:t[s(1021)],metadata:t.metadata,rawChunks:t.rawChunks,warnings:t[s(1341)]}}}function u(t,e,i){return new g(t[a2_0x43a7(1653)]+": "+e,i)}class g extends Error{constructor(t,e){const i=a2_0x43a7;super(t),this[i(1031)]=e}}function m(t,e){const i=a2_0x43a7;if(t[i(542)][i(1944)])throw e;t[i(1341)][i(2226)](e)}},473:(t,e,i)=>{"use strict";i.d(e,{v8:()=>s,E:()=>n,pP:()=>o});class s extends Error{constructor(t,e){const i=a2_0x43a7;super(t),this[i(1031)]=e}}class n extends Error{constructor(t,e){const i=a2_0x43a7;super(t),this[i(1031)]=e}}function o(t,e){const i=a2_0x43a7;if(t[i(542)][i(1944)])throw e;t[i(1341)].push(e)}},6815:(t,e,i)=>{"use strict";async function s(t,e){const s=a2_0x43a7;return(await Promise.all([i.e(7885),i.e(9247)])[s(624)](i.bind(i,9247)))[s(1211)](t,e)}async function n(t,e){const s=a2_0x43a7;return(await Promise[s(922)]([i.e(7885),i.e(1551)])[s(624)](i[s(1618)](i,1551)))[s(583)](t,e)}i.d(e,{dX:()=>s,Vx:()=>n}),i(1123),i(473)},8984:(t,e,i)=>{"use strict";i.d(e,{_9:()=>s,b4:()=>n,pP:()=>o});class s extends Error{constructor(t,e,i){const s=a2_0x43a7;super(e),this[s(1031)]=i,this[s(628)]={details:{header:t[s(1703)],footer:t[s(421)],imageId:t[s(403)],developerDirectory:t[s(2031)],extensionArea:t[s(802)]},warnings:t[s(1341)]}}}class n extends Error{constructor(t,e){const i=a2_0x43a7;super(t),this[i(1031)]=e}}function o(t,e){const i=a2_0x43a7;if(t.options.strictMode)throw e;t[i(1341)].push(e)}},4371:(t,e,i)=>{"use strict";const s=a2_0x43a7;function n(t,e=2*t[s(961)]){const i=s;let n;if(t instanceof Float32Array)n=new Float32Array(e);else if(t instanceof Uint8Array)n=new Uint8Array(e);else if(t instanceof Uint16Array)n=new Uint16Array(e);else{if(!(t instanceof Uint32Array))throw new Error(i(1326));n=new Uint32Array(e)}return n[i(2112)](t),n}function o(t,e,i=!1){const n=s;return e<Math[n(400)](2,8)?i?new Uint8Array(new SharedArrayBuffer(t)):new Uint8Array(t):e<Math[n(400)](2,16)?i?new Uint16Array(new SharedArrayBuffer(2*t)):new Uint16Array(t):i?new Uint32Array(new SharedArrayBuffer(4*t)):new Uint32Array(t)}function r(t){const e=s;if(window[e(2123)]&&!(t[e(1392)]instanceof SharedArrayBuffer)){const i=new Uint8Array(new SharedArrayBuffer(t[e(961)]));i[e(2112)](t),t=i}return t}function a(t,e,i,s){t[e]=i[s],t[e+1]=i[s+1],t[e+2]=i[s+2],t[e+3]=i[s+3]}function h(t){return t instanceof Uint8Array||t instanceof Uint16Array||t instanceof Uint32Array||t instanceof Int8Array||t instanceof Int16Array||t instanceof Int32Array||t instanceof Float32Array||t instanceof Float64Array}i.d(e,{Rs:()=>n,X$:()=>o,pZ:()=>r,Yr:()=>a,fU:()=>h})},7517:(t,e,i)=>{"use strict";const s=a2_0x43a7;i.d(e,{B:()=>h});var n=i(4371);const o=new Float32Array(6);let r;const a={normal:(t,e)=>e,darken:(t,e)=>Math.min(t,e),multiply:(t,e)=>t*e,linearBurn:(t,e)=>Math[s(590)](t+e-1,0),lighten:(t,e)=>Math[s(590)](t,e),screen:(t,e)=>1-(1-t)*(1-e),linearDodgeAdd:(t,e)=>Math[s(507)](t+e,1),overlay:(t,e)=>t<.5?2*t*e:1-2*(1-t)*(1-e),softLight:(t,e)=>e<.5?2*t*e+t*t*(1-2*e):Math[s(1384)](t)*(2*e-1)+2*t*(1-e),difference:(t,e)=>Math[s(791)](t-e),exclusion:(t,e)=>t+e-2*t*e};function h(t,e,i,h,l,d=e,u=i){const g=s;if(t!==g(1408)){if(o[0]=h[l+3]/255,0===o[0])return e[i]=d[u],e[i+1]=d[u+1],e[i+2]=d[u+2],void(e[i+3]=d[u+3]);if(o[1]=d[u+3]/255,0===o[1])return e[i]=h[l],e[i+1]=h[l+1],e[i+2]=h[l+2],void(e[i+3]=h[l+3]);r=a[t],o[3]=r(d[u]/255,h[l]/255),o[4]=r(d[u+1]/255,h[l+1]/255),o[5]=r(d[u+2]/255,h[l+2]/255),o[2]=o[0]+o[1]*(1-o[0]),e[i]=Math.round(c(d[u]/255,o[1],h[l]/255,o[0],o[3])/o[2]*255),e[i+1]=Math.round(c(d[u+1]/255,o[1],h[l+1]/255,o[0],o[4])/o[2]*255),e[i+2]=Math[g(597)](c(d[u+2]/255,o[1],h[l+2]/255,o[0],o[5])/o[2]*255),e[i+3]=Math.round(255*o[2])}else(0,n.Yr)(e,i,h,l)}function c(t,e,i,s,n){return(e-e*s)*t+(s-e*s)*i+e*s*n}},8752:(t,e,i)=>{"use strict";i.d(e,{WC:()=>h,FK:()=>c,B8:()=>s,m4:()=>n,mC:()=>r});var s,n,o,r,a=i(2939);function h(t,e){const i=a2_0x43a7;if(t[i(961)]!==e.length||t.type!==e[i(1653)])return!1;for(let i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}function c(t){const e=a2_0x43a7,i=new Float32Array(t);return i[e(1653)]=t[e(1653)],i}!function(t){const e=a2_0x43a7;function i(){const t=a2_0x43a7,e=new Float32Array(3);return e.type=t(1336),e}function s(t,e,s){const n=i();return n[0]=t,n[1]=e,n[2]=s,n}t.createEmptyRgbColor=i,t[e(671)]=s,t.createReadonlyRgbColor=function(t,e,i){return s(t,e,i)},t[e(638)]=function(t,i){const s=e,n=t[0]/255,o=t[1]/255,h=t[2]/255,c=Math.max(n,o,h),l=c-Math[s(507)](n,o,h);let d;d=0===l?0:c===n?(o-h)/l%6:c===o?(h-n)/l+2:(n-o)/l+4,d=Math.round(60*d),d<0&&(d+=360);const u=(0,a.s)(0===c?0:l/c,2),g=(0,a.s)(c,2);return void 0!==i&&(0===u||0===g)&&(d=i),r[s(1907)](d,u,g)},t[e(1814)]=function(t){const i=e,s=o[i(1233)](),n=t[0]/255,r=t[1]/255,a=t[2]/255,h=Math[i(590)](n,r,a),c=Math[i(507)](n,r,a),l=h-c,d=(h+c)/2;return s[0]=0===l?0:h===n?(r-a)/l%6:h===r?(a-n)/l+2:(n-r)/l+4,s[0]=Math[i(597)](60*s[0]),s[0]<0&&(s[0]+=360),s[1]=0===l?0:l/(1-Math[i(791)](2*d-1)),s[2]=d,s},t[e(687)]=function(t,e){return n.createRgbaColor(t[0],t[1],t[2],e)}}(s||(s={})),function(t){const e=a2_0x43a7;function i(){const t=a2_0x43a7,e=new Float32Array(4);return e[t(1653)]=t(1374),e}function n(t,e,s,n=255){const o=i();return o[0]=t,o[1]=e,o[2]=s,o[3]=n,o}t.createEmptyRgbaColor=i,t[e(1897)]=n,t.createReadonlyRgbaColor=function(t,e,i,s=255){return n(t,e,i,s)},t[e(1591)]=function(t){return s[e(1130)](t[0],t[1],t[2])}}(n||(n={})),function(t){const e=a2_0x43a7;function i(){const t=a2_0x43a7,e=new Float32Array(3);return e[t(1653)]=t(1236),e}function s(t,e,s){const n=i();return n[0]=t,n[1]=e,n[2]=s,n}t[e(1233)]=i,t[e(1839)]=s,t[e(311)]=function(t,e,i){return s(t,e,i)},t.toRgba=function(t,i=255){const s=e,o=n[s(1445)]();o[3]=i;const r=(1-Math[s(791)](2*t[2]-1))*t[1],a=r*(1-Math[s(791)](t[0]/60%2-1)),h=t[2]-r/2;return t[0]<60?(o[0]=r,o[1]=a,o[2]=0):t[0]<120?(o[0]=a,o[1]=r,o[2]=0):t[0]<180?(o[0]=0,o[1]=r,o[2]=a):t[0]<240?(o[0]=0,o[1]=a,o[2]=r):t[0]<300?(o[0]=a,o[1]=0,o[2]=r):(o[0]=r,o[1]=0,o[2]=a),o[0]=Math[s(597)](255*(o[0]+h)),o[1]=Math[s(597)](255*(o[1]+h)),o[2]=Math.round(255*(o[2]+h)),o}}(o||(o={})),function(t){const e=a2_0x43a7;function i(){const t=a2_0x43a7,e=new Float32Array(3);return e[t(1653)]="hsv",e}function o(t,e,s){const n=i();return n[0]=t,n[1]=e,n[2]=s,n}function r(t){const i=e,n=s[i(412)](),o=t[2]*t[1],r=o*(1-Math.abs(t[0]/60%2-1)),a=t[2]-o;return t[0]<60?(n[0]=o,n[1]=r,n[2]=0):t[0]<120?(n[0]=r,n[1]=o,n[2]=0):t[0]<180?(n[0]=0,n[1]=o,n[2]=r):t[0]<240?(n[0]=0,n[1]=r,n[2]=o):t[0]<300?(n[0]=r,n[1]=0,n[2]=o):(n[0]=o,n[1]=0,n[2]=r),n[0]=Math.round(255*(n[0]+a)),n[1]=Math[i(597)](255*(n[1]+a)),n[2]=Math.round(255*(n[2]+a)),n}t.createEmptyHsvColor=i,t[e(1666)]=o,t[e(1907)]=function(t,e,i){return o(t,e,i)},t[e(1591)]=r,t[e(687)]=function(t,i=255){const s=e,o=r(t);return n[s(1897)](o[0],o[1],o[2],(0,a.u)(i,255,0))}}(r||(r={}))},1815:(t,e,i)=>{"use strict";const s=a2_0x43a7;i.d(e,{v:()=>n,B:()=>o});class n{constructor(t){const e=a2_0x43a7;this._options=t,this[e(1103)]=[],this[e(1651)]=!1}get[s(993)](){const t=s;return!this._event&&(this._event=t=>{const e=a2_0x43a7;return 0===this[e(1103)][e(961)]&&this[e(329)]&&this[e(329)][e(1550)]&&this[e(329)][e(1550)](),this[e(1103)].push(t),{dispose:()=>{const i=e;if(!this[i(1651)])for(let e=0;e<this[i(1103)][i(961)];e++)if(this[i(1103)][e]===t)return this[i(1103)][i(1998)](e,1),void(0===this[i(1103)][i(961)]&&this._options&&this._options[i(968)]&&this[i(329)][i(968)]())}}}),this[t(364)]}[s(1257)](t,e){const i=s,n=[];for(let t=0;t<this._listeners.length;t++)n.push(this[i(1103)][t]);for(let s=0;s<n[i(961)];s++)n[s][i(1515)](void 0,t,e)}async fireAndWait(t,e){const i=s,n=[];for(let t=0;t<this[i(1103)][i(961)];t++)n[i(2226)](this[i(1103)][t]);for(let i=0;i<n.length;i++)await n[i].call(void 0,t,e)}[s(835)](){this[s(1103)]&&(this._listeners.length=0),this._disposed=!0}}function o(t,e){const i=s;return t(((t,s)=>e[i(1257)](t,s)))}},7166:(t,e,i)=>{"use strict";i.d(e,{uF:()=>n,Qf:()=>o,M_:()=>r});var s=i(1003);function n(t,e){const i=a2_0x43a7,s=typeof t===i(1896)?t:t[i(1847)];return e=typeof t===i(1896)?e:t[i(1096)],{data:new Uint8Array(new(i(2123)in window?SharedArrayBuffer:ArrayBuffer)(s*e*4)),width:s,height:e}}function o(t,e){const i=a2_0x43a7,n=(0,s.Oq)(e),o=(0,s.rY)(e),r=new Uint8Array(n*o*4);let a=0,h=0;for(let s=0;s<o;s++)h=s+e[i(632)],a=4*(h*t[i(1847)]+e[i(702)]),r[i(2112)](t[i(1218)].subarray(a,a+4*n),s*n*4);return r}function r(t,e,i,s,n=!0){const o=a2_0x43a7;if(!n&&e<s&&t<i)return{left:Math[o(597)]((i-t)/2),top:Math.round((s-e)/2),width:t,height:e};const r={left:0,top:0,width:i,height:s};if(e>t){const s=t/e;r.left=Math.round(i*(.5-s/2)),r[o(1847)]=Math[o(597)](i*s)}else if(t>e){const i=e/t;r[o(632)]=Math[o(597)](s*(.5-i/2)),r[o(1096)]=Math.round(s*i)}return r}},5120:(t,e,i)=>{"use strict";const s=a2_0x43a7;i.d(e,{JT:()=>o,OF:()=>r,_c:()=>a,Lw:()=>h});var n=i(1815);class o{constructor(){const t=a2_0x43a7;this[t(944)]=[],this[t(1878)]=!1,this[t(1383)]=this[t(2163)](new n.v),this.onDispose=this[t(1383)][t(993)]}[s(835)](){const t=s;if(this._isDisposed)throw new Error(t(1844));this[t(1383)][t(1257)](),this[t(1878)]=!0;for(const e of this[t(944)])e[t(835)]();this[t(944)][t(961)]=0}[s(2163)](t){return this._disposables.push(t),t}[s(1607)](t){const e=this[s(944)].indexOf(t);-1!==e&&this._disposables.splice(e,1)}}function r(t){return{dispose:t}}function a(t){const e=s;if(t){for(const e of t)e.dispose();t[e(961)]=0}}function h(t,e,i,s){t.addEventListener(e,i);let n=!1;return{dispose:()=>{n||(n=!0,t[a2_0x43a7(1719)](e,i,s))}}}},2939:(t,e,i)=>{"use strict";function s(t,e,i=0){const s=a2_0x43a7;return Math[s(590)](Math[s(507)](t,e),i)}function n(t,e){const i=a2_0x43a7,s=Math[i(400)](10,e);return Math[i(597)](t*s)/s}i.d(e,{u:()=>s,s:()=>n})},116:(t,e,i)=>{"use strict";i.d(e,{d:()=>n,W:()=>o});var s=i(7166);function n(t){const e=a2_0x43a7;return typeof t===e(623)&&e(2044)in t?t:{resource:t,readyPromise:Promise[e(1665)](t),isReady:!0}}function o(t,e){let i,n;const o=new Promise(((t,e)=>{i=t,n=e})),r=(0,s.uF)(t,e);return{image:{isReady:!1,readyPromise:o,resource:r},resource:r,resolve:i,reject:n}}},7896:(t,e,i)=>{"use strict";const s=a2_0x43a7;i.d(e,{V5:()=>n,jn:()=>o});const n=[s(1153),"MacIntel",s(1136),s(1019)][s(810)](navigator[s(1214)]),o=([s(402),"Win16","Win32",s(585)][s(810)](navigator[s(1214)]),"vscode-webview:"===window[s(1498)][s(1514)])},1003:(t,e,i)=>{"use strict";function s(t){const e=a2_0x43a7;if(t)return{left:t[e(702)],top:t[e(632)],right:t[e(557)],bottom:t[e(719)]}}function n(){return{left:-1,top:-1,right:-1,bottom:-1}}function o(t,e){return{left:t,top:e,right:t+1,bottom:e+1}}function r(t,e){return{left:0,top:0,right:t,bottom:e}}function a(t,e,i,s){const n=a2_0x43a7,o=w({left:t,top:e,right:i,bottom:s});return o[n(557)]++,o[n(719)]++,o}function h(t,e){const i=a2_0x43a7;return c(t)?s(e):c(e)?s(t):{left:Math[i(507)](t.left,e[i(702)]),top:Math.min(t[i(632)],e[i(632)]),right:Math[i(590)](t[i(557)],e[i(557)]),bottom:Math[i(590)](t.bottom,e[i(719)])}}function c(t){const e=a2_0x43a7;return t.left===t.right||t[e(632)]===t[e(719)]}function l(t,e){const i=a2_0x43a7;return t[i(702)]=Math[i(507)](Math.max(t[i(702)],e[i(702)]),e[i(557)]),t[i(632)]=Math[i(507)](Math[i(590)](t[i(632)],e.top),e[i(719)]),t[i(557)]=Math[i(590)](Math.min(t[i(557)],e[i(557)]),e[i(702)]),t[i(719)]=Math.max(Math[i(507)](t[i(719)],e.bottom),e[i(632)]),t}function d(t){const e=a2_0x43a7;return t[e(702)]=Math.floor(t[e(702)]),t[e(557)]=Math.ceil(t[e(557)]),t[e(632)]=Math[e(723)](t[e(632)]),t[e(719)]=Math[e(509)](t.bottom),t}function u(t,e,i){const s=a2_0x43a7,n=e-t[s(702)],o=i-t[s(632)];t.left=t.left+n,t.right=t[s(557)]+n,t[s(632)]=t[s(632)]+o,t[s(719)]=t[s(719)]+o}function g(t,e,i){const s=a2_0x43a7;if(c(t))return t.left=e,t[s(557)]=e+1,t.top=i,void(t.bottom=i+1);t[s(702)]=Math[s(507)](t[s(702)],e),t.top=Math[s(507)](t[s(632)],i),t.right=Math[s(590)](t[s(557)],e+1),t[s(719)]=Math[s(590)](t.bottom,i+1)}function m(t,e){const i=a2_0x43a7;return t.left===e[i(702)]&&t[i(632)]===e[i(632)]&&t[i(557)]===e[i(557)]&&t.bottom===e.bottom}function f(t,e,i){const s=a2_0x43a7;return e>=t[s(702)]&&e<t[s(557)]&&i>=t[s(632)]&&i<t[s(719)]}function p(t,e){const i=a2_0x43a7;return e[i(702)]>=t[i(702)]&&e[i(557)]<=t[i(557)]&&e[i(632)]>=t[i(632)]&&e[i(719)]<=t[i(719)]}function _(t,e){const i=a2_0x43a7;return!(t[i(719)]<e.top||t[i(632)]>e[i(719)]||t.right<e[i(702)]||t[i(702)]>e[i(557)])}function w(t){const e=a2_0x43a7;if(t[e(702)]>t.right){const i=t[e(557)];t[e(557)]=t.left,t[e(702)]=i}if(t[e(632)]>t[e(719)]){const i=t[e(719)];t[e(719)]=t.top,t[e(632)]=i}if(t[e(557)]<t[e(702)]){const i=t.left;t[e(702)]=t.right,t.right=i}if(t[e(719)]<t[e(632)]){const i=t[e(632)];t[e(632)]=t.bottom,t[e(719)]=i}return t}function y(t){const e=a2_0x43a7;return(t.right-t[e(702)])*(t.bottom-t[e(632)])}function v(t){const e=a2_0x43a7;return(t.right-t[e(702)])/(t.bottom-t[e(632)])}function b(t){const e=a2_0x43a7;return"("+t.left+","+t[e(632)]+e(1287)+t[e(557)]+","+t[e(719)]+")"}function x(t){const e=a2_0x43a7;return t[e(557)]-t[e(702)]}function I(t){const e=a2_0x43a7;return t[e(719)]-t[e(632)]}i.d(e,{BN:()=>s,Pq:()=>n,Re:()=>o,DI:()=>r,tH:()=>a,qi:()=>h,Bu:()=>c,l$:()=>l,kq:()=>d,Hd:()=>u,Hv:()=>g,ap:()=>m,RB:()=>f,ur:()=>p,b8:()=>_,FJ:()=>w,U6:()=>y,n3:()=>v,PW:()=>b,Oq:()=>x,rY:()=>I})},7605:(t,e,i)=>{"use strict";i.d(e,{t:()=>n,e:()=>o});var s=i(4371);function n(t){const e=a2_0x43a7;if(!t||"object"!=typeof t)return t;const i={};for(const s of Object[e(587)](t)){const o=t[s];"object"==typeof o?e(2044)in o?i[s]={dataType:"pending",data:n(o[a2_0x43a7(1263)])}:o instanceof Float32Array?i[s]=a(o,e(955)):o instanceof Uint8Array?i[s]=a(o,e(1621)):o instanceof Uint16Array?i[s]=a(o,"Uint16Array"):o instanceof Uint32Array?i[s]=a(o,e(440)):i[s]=o:i[s]=o}return i}function o(t){const e=a2_0x43a7;if(!t||typeof t!==e(623)||(0,s.fU)(t))return t;const i={};for(const s of Object[e(587)](t)){const n=t[s];typeof n!==e(623)||Array[e(2086)](n)?i[s]=n:e(1088)in n?n[e(1088)]===e(837)?i[s]=r(n):i[s]=h(n):i[s]=o(n)}return i}function r(t){const e=a2_0x43a7,i=o(t.data);return{resource:i,readyPromise:Promise[e(1665)](i),isReady:!0}}function a(t,e){return{dataType:e,data:Array.from(t)}}function h(t){const e=a2_0x43a7;return new(self[t[e(1088)]])(t[e(1218)])}}},e={};function i(s){const n=a2_0x43a7;var o=e[s];if(void 0!==o)return o[n(818)];var r=e[s]={exports:{}};return t[s](r,r[n(818)],i),r[n(818)]}i.m=t,i.n=t=>{const e=a2_0x43a7;var s=t&&t.__esModule?()=>t[e(689)]:()=>t;return i.d(s,{a:s}),s},i.d=(t,e)=>{const s=a2_0x43a7;for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object[s(614)](t,n,{enumerable:!0,get:e[n]})},i.f={},i.e=t=>{const e=a2_0x43a7;return Promise.all(Object[e(587)](i.f)[e(1771)](((e,s)=>(i.f[s](t,e),e)),[]))},i.u=t=>""+t+a2_0x43a7(1554),(()=>{const t=a2_0x43a7;i[t(820)]=e=>""+(6122===e?"vscode.main":e)+t(1565)})(),i.g=function(){const t=a2_0x43a7;if(typeof globalThis===t(623))return globalThis;try{return this||new Function(t(1971))()}catch(t){if("object"==typeof window)return window}}(),i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{const t=a2_0x43a7;var e={},s=t(1702);i.l=(n,o,r,a)=>{const h=t;if(e[n])e[n][h(2226)](o);else{var c,l;if(void 0!==r)for(var d=document[h(1375)](h(1399)),u=0;u<d[h(961)];u++){var g=d[u];if(g[h(989)](h(1437))==n||g[h(989)](h(1412))==s+r){c=g;break}}!c&&(l=!0,(c=document[h(1541)](h(1399)))[h(1146)]=h(729),c[h(2120)]=120,i.nc&&c[h(959)](h(1056),i.nc),c[h(959)](h(1412),s+r),c[h(1437)]=n),e[n]=[o];var m=(t,i)=>{const s=h;c[s(2051)]=c.onload=null,clearTimeout(f);var o=e[n];if(delete e[n],c[s(1029)]&&c.parentNode[s(1221)](c),o&&o[s(2149)]((t=>t(i))),t)return t(i)},f=setTimeout(m[h(1618)](null,void 0,{type:h(2120),target:c}),12e4);c[h(2051)]=m[h(1618)](null,c[h(2051)]),c[h(1712)]=m[h(1618)](null,c[h(1712)]),l&&document[h(391)][h(828)](c)}}})(),i.r=t=>{const e=a2_0x43a7;typeof Symbol!==e(407)&&Symbol[e(1005)]&&Object[e(614)](t,Symbol.toStringTag,{value:e(636)}),Object[e(614)](t,e(654),{value:!0})},(()=>{const t=a2_0x43a7;var e;i.g[t(1344)]&&(e=i.g[t(1498)]+"");var s=i.g[t(2221)];if(!e&&s&&(s[t(1549)]&&(e=s[t(1549)][t(1437)]),!e)){var n=s[t(1375)](t(1399));n.length&&(e=n[n[t(961)]-1][t(1437)])}if(!e)throw new Error(t(1499));e=e[t(1408)](/#.*$/,"")[t(1408)](/\?.*$/,"")[t(1408)](/\/[^\/]+$/,"/"),i.p=e})(),(()=>{const t=a2_0x43a7;var e={6122:0};i.f.j=(t,s)=>{const n=a2_0x43a7;var o=i.o(e,t)?e[t]:void 0;if(0!==o)if(o)s[n(2226)](o[2]);else{var r=new Promise(((i,s)=>o=e[t]=[i,s]));s.push(o[2]=r);var a=i.p+i.u(t),h=new Error;i.l(a,(s=>{const r=n;if(i.o(e,t)&&(0!==(o=e[t])&&(e[t]=void 0),o)){var a=s&&(s[r(1653)]===r(662)?r(1071):s[r(1653)]),c=s&&s[r(1696)]&&s[r(1696)][r(1437)];h.message=r(381)+t+" failed.\n("+a+": "+c+")",h.name=r(686),h.type=a,h[r(1413)]=c,o[1](h)}}),n(1085)+t,t)}};var s=(t,s)=>{const n=a2_0x43a7;var o,r,[a,h,c]=s,l=0;if(a[n(2124)]((t=>0!==e[t]))){for(o in h)i.o(h,o)&&(i.m[o]=h[o]);c&&c(i)}for(t&&t(s);l<a[n(961)];l++)r=a[l],i.o(e,r)&&e[r]&&e[r][0](),e[r]=0},n=self[t(1288)]=self[t(1288)]||[];n[t(2149)](s[t(1618)](null,0)),n[t(2226)]=s[t(1618)](null,n[t(2226)][t(1618)](n))})(),(()=>{"use strict";const t=a2_0x43a7;var e=i(5120),s=i(1003),n=i(1815);class o extends e.JT{constructor(t){const e=a2_0x43a7;super(),this[e(527)]=t,this._onConfigChanged=this[e(2163)](new n.v),this[e(1954)]=this[e(631)][e(993)]}get[t(1689)](){return this[t(527)]}set config(e){const i=t;!this._configEquals(e)&&(this[i(527)]=e,this[i(631)][i(1257)](this[i(527)]))}[t(2229)](e){const i=t,s=Object.keys(this[i(527)]);if(s[i(961)]!==Object[i(587)](e)[i(961)])return!1;for(const t of s)if(this[i(527)][t]!==e[t])return!1;return!0}}class r extends e.JT{constructor(){const e=t;super(...arguments),this[e(1155)]=this[e(2163)](new n.v),this.onAttach=this[e(1155)].event}[t(455)](e){const i=t;this[i(796)]=e,this[i(1155)][i(1257)](this[i(796)])}}class a{constructor(){const e=t;this.type=e(1841),this[e(392)]=e(738),this[e(727)]=0}[t(1644)](){return{id:"unknown"}}static[t(522)](t){return new a}}class h extends e.JT{constructor(){const e=t;super(),this._entries=[],this[e(512)]=-1,this[e(1659)]=new Map,this[e(1842)]=new Map,this[e(881)]=this[e(2163)](new n.v),this[e(1976)]=this[e(881)].event,this._onUndo=this[e(2163)](new n.v),this.onUndo=this[e(1335)][e(993)],this._onRedo=this[e(2163)](new n.v),this[e(737)]=this[e(1557)][e(993)],this[e(1417)]=this[e(2163)](new n.v),this[e(763)]=this[e(1417)][e(993)],this.registerHistoryEntryHandler(e(1861),{undo:t=>t[e(1090)](),redo:t=>t[e(568)]()}),this[e(1880)]("composite",(t=>this[e(747)](t))),this.registerHistoryEntryFactory("unknown",a.create)}get activeEntry(){return this[t(404)][this._currentEntryPointer]}get[t(1832)](){return this[t(404)]}get[t(2224)](){const e=t;return this._entries.length>1&&0!==this[e(512)]}get canRedo(){const e=t;return this[e(404)][e(961)]>1&&this._currentEntryPointer!==this[e(404)][e(961)]-1}addEntry(e,i){const s=t;if(this._currentCompositeEntry){if("composite"===e[s(1653)])throw new Error(s(2165));if(e[s(1653)]===s(1841))throw new Error(s(1083));this[s(1950)][s(2226)](e)}else this[s(404)][++this[s(512)]]=e,this[s(404)][s(961)]=this[s(512)]+1,!i&&this._onEntriesChange.fire(!0)}async[t(607)](e){const i=t,s=await e[i(1538)]();s&&this.addEntry(s)}[t(1540)](e){const i=t,s=e.run();s&&this[i(2232)](s)}[t(602)](){const e=t;this._currentEntryPointer=-1,this[e(1950)]=void 0,this[e(404)][e(961)]=0,this[e(881)][e(1257)](!0)}async[t(1090)](){const e=t;if(-1===this[e(512)])throw new Error(e(1943));const i=this[e(404)][this[e(512)]];if(i.type===e(1841))throw new Error(e(643));if(this[e(512)]--,await this[e(2046)](i),"composite"===i.type){const t=i[e(1832)];for(let i=t[e(961)]-1;i>=0;i--)await this[e(1659)][e(1270)](t[i][e(1653)])[e(1090)](t[i])}else await this._entryHandlers[e(1270)](i[e(1653)])[e(1090)](i);this[e(881)][e(1257)](!1),this[e(1335)][e(1257)](i)}async[t(568)](){const e=t;if(this._entries[e(961)]<=this[e(512)]+1)throw new Error(e(1602));const i=this._entries[this[e(512)]+1];if(i[e(1653)]===e(1841))throw new Error(e(634));if(this[e(512)]++,await this._requestToolIfNeeded(i),i[e(1653)]===e(2071))for(const t of i.entries)await this[e(1659)][e(1270)](t[e(1653)])[e(568)](t);else await this[e(1659)][e(1270)](i.type)[e(568)](i);this[e(881)][e(1257)](!1),this._onRedo[e(1257)](i)}async createCompositeEntry(e,i){const s=t;if(this[s(1950)])return i();this[s(1950)]=[];try{await i()}catch(t){return console[s(2018)](s(2097),t),void this[s(1568)](e+s(1999))}this[s(1568)](e)}createCompositeEntrySync(e,i){const s=t;if(this[s(1950)])return i();this[s(1950)]=[];try{i()}catch(t){return console[s(2018)](s(2097),t),void this[s(1568)](e+s(1999))}this[s(1568)](e)}[t(1568)](e){const i=t;if(!this._currentCompositeEntry)throw new Error(i(1727));const s=this[i(1950)];this[i(1950)]=void 0;const n=s[i(1771)](((t,e)=>e[i(727)]>t?e[i(727)]:t),0),o={type:i(2071),operationName:e,entries:s,pixelCount:n,serialize:()=>this._serializeCompositeEntry(o)};this[i(2232)](o)}[t(951)](e,i){const s=t;if(this[s(1659)][s(1270)](e))throw new Error(s(873)+e+s(389));this[s(1659)][s(2112)](e,i)}[t(1880)](e,i){const s=t;if(this[s(1842)][s(1270)](e))throw new Error(s(1532)+e+" has already been registered");this[s(1842)][s(2112)](e,i)}serialize(e=0){const i=t;try{for(const t of this[i(404)])if(t[i(727)]>e)throw new Error(i(663)+t.operationName+'" exceeded maximum pixel count allowed ('+t[i(727)]+i(825)+e+")");const t=[];for(const e of this[i(404)]){if(!e[i(1644)])throw new Error(i(2079));t.push(e[i(1644)]())}return{currentEntry:this[i(512)],entries:t}}catch(t){return console[i(2155)](i(677),t),{currentEntry:0,entries:[]}}}[t(817)](e){const i=t;for(const t of e[i(1832)])try{this[i(2232)](this[i(1334)](t),!0)}catch{this.addEntry(new a,!0)}this[i(512)]=Math.min(e[i(1579)],this._entries[i(961)]-1),this[i(881)][i(1257)](!1)}_restoreEntry(e){const i=t;if(!e.id)throw new Error(i(2182));const s=this._entryFactories.get(e.id);if(!s)throw new Error(i(2168)+e.id+'"');return s(e)}_serializeCompositeEntry(e){const i=t;return{id:"composite",operationName:e[i(392)],entries:e.entries.map((t=>{const s=i;if(!t[s(1644)])throw console[s(2018)](s(1342),e),new Error(s(1947));return t[s(1644)]()})),requiresTool:e.requiresTool}}[t(747)](e){const i=t,s=[];for(const t of e[i(1832)])s[i(2226)](this._restoreEntry(t));const n=s[i(1771)](((t,e)=>e[i(727)]>t?e[i(727)]:t),0);try{const t={type:i(2071),operationName:e[i(392)],entries:s,pixelCount:n,requiresTool:e[i(1172)],serialize:()=>this[i(1135)](t)};return t}catch{return new a}}async[t(2046)](e){const i=t;if("composite"===e[i(1653)]){const t=e[i(1832)];for(let e=t[i(961)]-1;e>=0;e--){const s=t[e];if(s.requiresTool)return void await this._onRequestTool[i(1378)](s[i(1172)])}}else e[i(1172)]&&await this[i(1417)][i(1378)](e[i(1172)])}}var c=i(4371),l=i(7517),d=i(2939),u=i(6495);class g{constructor(e,i,s){const n=t;this[n(392)]=e,this[n(427)]=i,this[n(2131)]=s,this.type=n(1126),this.pixelCount=0}[t(1090)](e){const i=t;m(this[i(2131)],this[i(427)],e)}[t(568)](e){const i=t;m(this[i(427)],this[i(2131)],e)}serialize(){const e=t;return{id:"moveLayer",operationName:this[e(392)],initialIndex:this[e(427)],targetIndex:this[e(2131)]}}static create(e){const i=t;return new g(e.operationName,e.initialIndex,e[i(1910)])}}function m(e,i,s){const n=t;if(i>=s[n(2028)][n(961)])return!1;const o=s.list[e];if(!o)return!1;for(s[n(1068)]=e;i>s[n(1068)];)s[n(2028)][s[n(1068)]]=s[n(2028)][s[n(1068)]+1],s[n(2028)][++s[n(1068)]]=o;for(;i<s.currentLayer;)s[n(2028)][s.currentLayer]=s[n(2028)][s[n(1068)]-1],s[n(2028)][--s[n(1068)]]=o;return s[n(1243)].fire(),!0}class f{constructor(e,i,s){const n=t;this[n(2073)]=e,this[n(2131)]=i,this[n(2099)]=s}[t(1538)](){const e=t;if(this._targetIndex===this[e(2099)][e(1068)])return;const i=this._model[e(1068)]<this._targetIndex?-1:1;let s=!1;for(let t=this[e(2131)];t!==this[e(2099)][e(1068)];t+=i)if(!this[e(2099)][e(2028)][t][e(1605)]){s=!0;break}if(!s)return;const n=this[e(2099)][e(1068)];return m(n,this[e(2131)],this[e(2099)])?new g(this[e(2073)],n,this._targetIndex):void 0}}class p{constructor(e,i,s,n){const o=t;this[o(2073)]=e,this[o(1193)]=i,this[o(2131)]=s,this[o(2099)]=n}[t(1538)](){const e=t,i=this._model[e(2028)].findIndex((t=>t.id===this[e(1193)]));if(-1===i||this[e(2131)]===i)return;const s=i<this[e(2131)]?-1:1;let n=!1;for(let t=this[e(2131)];t!==i;t+=s)if(!this[e(2099)][e(2028)][t][e(1605)]){n=!0;break}return n&&m(i,this[e(2131)],this[e(2099)])?new g(this[e(2073)],i,this[e(2131)]):void 0}}class _ extends f{constructor(e,i,s){const n=t,o=i[n(2028)][i[n(1068)]],r=i.list.filter((t=>!t[n(1605)])),a=r[n(1159)](o)+s;(a<0||a>=r[n(961)])&&super(e,i[n(1068)],i);const h=r[a];super(e,i[n(2028)][n(1159)](h),i)}}class w extends _{constructor(e){super(t(348),e,1)}}class y extends _{constructor(e){super(t(1015),e,-1)}}var v=i(4852);class b{constructor(e,i,s){const n=t;this[n(392)]=e,this[n(1711)]=i,this[n(1193)]=s,this[n(1653)]="singleLayer",this.pixelCount=0}async undo(e){const i=t,s=await e[i(1698)](this[i(1711)],this[i(1193)]);if(!s)throw new Error(i(2072)+this[i(1193)]);return s[i(1605)]=!1,s[i(1343)][i(1257)](),s}async[t(568)](e){const i=t,s=await e[i(1698)](this[i(1711)],this[i(1193)]);if(!s)throw new Error(i(2072)+this[i(1193)]);return s[i(1605)]=!0,s[i(1343)][i(1257)](),s}serialize(){const e=t;return{id:e(2227),operationName:this[e(392)],imageFileId:this[e(1711)],layerId:this[e(1193)]}}static create(e){const i=t;return new b(e.operationName,e[i(2012)],e[i(477)])}}var x=i(8286),I=i(6628),S=i(3817),C=i(3089),E=i(707);class T{constructor(e,i,s){const n=t;this[n(392)]=e,this[n(605)]=i,this[n(1520)]=s,this.type=n(1016),this[n(727)]=0}[t(1090)](e){const i=t;e(this._undoDimensions[i(1847)],this[i(605)][i(1096)])}[t(568)](e){const i=t;e(this[i(1520)][i(1847)],this[i(1520)][i(1096)])}serialize(){return{id:t(1717),operationName:this.operationName,undoDimensions:this._undoDimensions,redoDimensions:this._redoDimensions}}static[t(522)](t){return new T(t.operationName,t.undoDimensions,t.redoDimensions)}}class L{constructor(e,i,s,n,o,r){const a=t;this[a(392)]=e,this[a(1711)]=i,this._layerId=s,this[a(778)]=n,this[a(500)]=o,this[a(1615)]=r,this[a(1653)]=a(1734),this[a(1172)]=a(797),this.pixelCount=this[a(500)]*this[a(1615)]}async[t(1090)](e){const i=t,s=await e[i(1698)](this[i(1711)],this[i(1193)]);if(!s)throw new Error(i(2072)+this._layerId);const n=await e[i(1251)](this[i(1711)],this[i(1193)],this._tempLayerId);if(!n)throw new Error(i(1097)+this[i(1193)]);return s[i(2219)]=void 0,n[i(2022)](),s[i(1343)].fire(),s}async[t(568)](e){const i=t,s=await e[i(1698)](this._imageFileId,this[i(1193)]);if(!s)throw new Error(i(2072)+this[i(1193)]);const n=await e[i(1251)](this[i(1711)],this[i(1193)],this[i(778)]);if(!n)throw new Error(i(1097)+this._layerId);return s[i(2219)]=n,n[i(1167)](),s[i(1343)].fire(),s}serialize(){const e=t;return{id:e(1001),operationName:this[e(392)],imageFileId:this._imageFileId,layerId:this[e(1193)],tempLayerId:this[e(778)],width:this[e(500)],height:this[e(1615)]}}static[t(522)](e){const i=t;return new L(e.operationName,e[i(2012)],e[i(477)],e.tempLayerId,e[i(1847)],e[i(1096)])}}var D=i(4378),A=i(7605);class R{constructor(e,i,s,n,o){const r=t;this.operationName=e,this[r(1711)]=i,this[r(1193)]=s,this[r(801)]=n,this[r(657)]=o,this[r(1653)]=r(1734),this[r(727)]=this[r(801)][r(1847)]*this._undoImage[r(1096)]}async undo(e){const i=t,s=await e.getLayer(this._imageFileId,this._layerId);if(!s)throw new Error(i(2072)+this._layerId);return await s[i(351)]((()=>this._undoImage)),s}async[t(568)](e){const i=t,s=await e[i(1698)](this[i(1711)],this[i(1193)]);if(!s)throw new Error(i(2072)+this._layerId);return await s[i(351)]((()=>this[i(657)])),s}[t(1644)](){const e=t;return{id:e(2129),operationName:this[e(392)],imageFileId:this[e(1711)],layerId:this[e(1193)],undoImage:(0,A.t)(this._undoImage),redoImage:(0,A.t)(this[e(657)])}}static create(e){const i=t;return new R(e.operationName,e[i(2012)],e[i(477)],(0,A.e)(e[i(383)]),(0,A.e)(e.redoImage))}}var M=i(1375);class B{constructor(e,i,s,n,o){const r=t;this[r(392)]=e,this[r(1711)]=i,this[r(1193)]=s,this[r(500)]=n,this[r(1615)]=o,this[r(1653)]=r(1734),this.pixelCount=this._width*this[r(1615)]}async[t(1090)](e){const i=t,s=await e[i(1698)](this[i(1711)],this[i(1193)]);if(!s)throw new Error(i(2072)+this[i(1193)]);return s.isSoftDeleted=!0,s[i(1343)][i(1257)](),s}async[t(568)](e){const i=t,s=await e[i(1698)](this[i(1711)],this[i(1193)]);if(!s)throw new Error(i(2072)+this[i(1193)]);return s[i(1605)]=!1,s[i(1343)][i(1257)](),s}[t(1644)](){const e=t;return{id:e(883),operationName:this[e(392)],imageFileId:this[e(1711)],layerId:this[e(1193)],width:this[e(500)],height:this._height}}static[t(522)](e){const i=t;return new B(e[i(392)],e.imageFileId,e[i(477)],e.width,e[i(1096)])}}class k{constructor(e){const i=t;this[i(392)]=e,this[i(1653)]=i(1841),this.pixelCount=0}[t(1644)](){const e=t;return{id:e(1569),operationName:this[e(392)]}}static[t(522)](e){return new k(e[t(392)])}}class U{constructor(){const e=t;this[e(1653)]=e(1841),this[e(392)]=e(1018),this.pixelCount=0}[t(1644)](){return{id:t(1913)}}static[t(522)](t){return new U}}class P{constructor(e,i,s,n){const o=t;this[o(1711)]=e,this[o(1193)]=i,this._undoBlendMode=s,this[o(566)]=n,this[o(1653)]=o(1734),this[o(727)]=0,this[o(392)]=o(518)+function(e){const i=t;return e[i(979)](0,1)[i(732)]()+e[i(979)](1)}(this[o(566)])}async[t(1090)](e){const i=t,s=await e.getLayer(this._imageFileId,this[i(1193)]);if(!s)throw new Error(i(2072)+this[i(1193)]);return s[i(533)]=this[i(1190)],s}async redo(e){const i=t,s=await e.getLayer(this[i(1711)],this._layerId);if(!s)throw new Error(i(2072)+this[i(1193)]);return s.blendMode=this[i(566)],s}serialize(){const e=t;return{id:e(372),imageFileId:this._imageFileId,layerId:this[e(1193)],undoBlendMode:this._undoBlendMode,redoBlendMode:this[e(566)]}}static create(e){const i=t;return new P(e[i(2012)],e.layerId,e[i(2105)],e[i(1701)])}}class F{constructor(e,i,s,n){const o=t;this[o(1711)]=e,this[o(1193)]=i,this[o(833)]=s,this[o(324)]=n,this[o(1653)]=o(1734),this[o(727)]=0,this.operationName=o(2055)+function(e){const i=t;return e.substring(0,1)[i(732)]()+e[i(979)](1)}(this._redoName)}async undo(e){const i=t,s=await e[i(1698)](this[i(1711)],this[i(1193)]);if(!s)throw new Error(i(2072)+this[i(1193)]);return s[i(1121)]=this[i(833)],s}async[t(568)](e){const i=t,s=await e[i(1698)](this[i(1711)],this[i(1193)]);if(!s)throw new Error(i(2072)+this[i(1193)]);return s.name=this[i(324)],s}[t(1644)](){const e=t;return{id:e(1162),imageFileId:this[e(1711)],layerId:this[e(1193)],undoName:this._undoName,redoName:this[e(324)]}}static create(e){const i=t;return new F(e[i(2012)],e[i(477)],e[i(473)],e[i(994)])}}class N{constructor(e,i,s){const n=t;this[n(1711)]=e,this[n(1193)]=i,this._isVisible=s,this.type="singleLayer",this[n(727)]=0,this[n(392)]=(this[n(1758)]?n(1434):n(519))+n(1397)}async[t(1090)](e){const i=t,s=await e[i(1698)](this[i(1711)],this[i(1193)]);if(!s)throw new Error(i(2072)+this[i(1193)]);return s.isVisible=!this[i(1758)],s}async[t(568)](e){const i=t,s=await e.getLayer(this[i(1711)],this[i(1193)]);if(!s)throw new Error("Could not find layer "+this[i(1193)]);return s[i(2115)]=this[i(1758)],s}serialize(){const e=t;return{id:e(1747),imageFileId:this[e(1711)],layerId:this[e(1193)],isVisible:this[e(1758)]}}static[t(522)](e){const i=t;return new N(e.imageFileId,e.layerId,e[i(2115)])}}var V=i(8549),O=i(116);class H{constructor(e,i){const s=t;this._blendMode=e,this[s(1321)]=i}[t(1538)](){const e=t;if(this[e(1321)].blendMode===this[e(502)])return;const i=this[e(1321)][e(533)];return this._layer[e(533)]=this[e(502)],new P(this._layer[e(2012)],this[e(1321)].id,i,this[e(502)])}}class z{constructor(e,i){const s=t;this[s(2132)]=e,this[s(1321)]=i}[t(1538)](){const e=t;if(this[e(1321)][e(1121)]===this._name)return;const i=this[e(1321)][e(1121)];return this[e(1321)].name=this[e(2132)],new F(this[e(1321)].imageFileId,this[e(1321)].id,i,this[e(2132)])}}class W{constructor(e,i){const s=t;this[s(1758)]=e,this[s(1321)]=i}[t(1538)](){const e=t;if(this[e(1321)].isVisible!==this[e(1758)])return this[e(1321)].isVisible=this[e(1758)],new N(this[e(1321)][e(2012)],this._layer.id,this[e(1758)])}}var j=i(6785);class q extends e.JT{constructor(e,i,o,r,a){const h=t;super(),this[h(1321)]=e,this[h(981)]=i,this[h(500)]=o,this[h(1615)]=r,this[h(1915)]=a,this[h(1803)]=0,this[h(876)]=new Set,this[h(2100)]=(0,s.Pq)(),this[h(725)]=(0,s.Pq)(),this[h(1817)]=this[h(2163)](new n.v),this.onUpdate=this._onUpdate[h(993)],this._onCommit=this[h(2163)](new n.v),this[h(743)]=this[h(1965)][h(993)],this[h(326)]={colorData:new Uint8Array(200),indexList:(0,c.X$)(50,this[h(500)]*this[h(1615)]*4)},this[h(1427)]={colorData:new Uint8Array(200),indexList:(0,c.X$)(50,this[h(500)]*this._height*4)}}[t(1148)](e,i,n,o){const r=t;if(e<0||e>=this[r(500)])return;const a=i*this[r(500)]+e;if(this[r(876)][r(1359)](a))return;this[r(876)][r(1492)](a),(0,s.Hv)(this[r(725)],e,i),this._pointCount>=this[r(326)][r(1519)].length&&(this[r(326)][r(1519)]=(0,c.Rs)(this[r(326)].indexList),this[r(326)].colorData=(0,c.Rs)(this[r(326)].colorData),this[r(1427)][r(1519)]=(0,c.Rs)(this._redoData[r(1519)]),this[r(1427)][r(1957)]=(0,c.Rs)(this._redoData[r(1957)]));const h=4*(i*this[r(500)]+e),d=4*this[r(1803)];this[r(326)][r(1519)][this[r(1803)]]=h,this[r(326)][r(1957)][d]=this._data[h],this[r(326)][r(1957)][d+1]=this[r(981)][h+1],this[r(326)].colorData[d+2]=this[r(981)][h+2],this[r(326)][r(1957)][d+3]=this[r(981)][h+3],this._redoData.indexList[this[r(1803)]]=h,o?((0,l.B)(o,this[r(981)],h,n,0),this[r(1427)][r(1957)][d]=this[r(981)][h],this._redoData.colorData[d+1]=this[r(981)][h+1],this[r(1427)][r(1957)][d+2]=this[r(981)][h+2],this[r(1427)][r(1957)][d+3]=this[r(981)][h+3]):(this[r(1427)][r(1957)][d]=this._data[h]=n[0],this[r(1427)][r(1957)][d+1]=this[r(981)][h+1]=n[1],this._redoData[r(1957)][d+2]=this[r(981)][h+2]=n[2],this[r(1427)][r(1957)][d+3]=this[r(981)][h+3]=n[3]),this[r(1803)]++}[t(734)](e,i,s,n,o){const r=t,a=Math[r(723)]((s-1)/2),h=s%2==0?1:0;let c=a,l=0,d=1-a;for(n?(this._setHorizontalLine(e-a,e+a+h,i,o),h&&this._setHorizontalLine(e-a,e+a+h,i+1,o)):(this[r(1148)](e+a+h,i,o),this[r(1148)](e-a,i,o),h&&(this[r(1148)](e+a+h,i+1,o),this.setPixel(e-a,i+1,o))),this[r(1148)](e,i+a+h,o),this[r(1148)](e,i-a,o);c>l&&(l++,d<=0?d=d+2*l+1:(c--,d=d+2*i-2*e+1),!(c<l));)n?(this[r(865)](e-c,e+c+h,i+l+h,o),this[r(865)](e-c,e+c+h,i-l,o),this._setHorizontalLine(e-l,e+l+h,i+c+h,o),this[r(865)](e-l,e+l+h,i-c,o)):(this[r(1148)](e+c+h,i+l+h,o),this[r(1148)](e-c,i+l+h,o),this.setPixel(e+c+h,i-l,o),this.setPixel(e-c,i-l,o),this[r(1148)](e+l,i+c+h,o),this.setPixel(e-l,i+c+h,o),this.setPixel(e+l,i-c,o),this[r(1148)](e-l,i-c,o))}[t(865)](e,i,s,n){const o=t;for(let t=e;t<=i;t++)this[o(1148)](t,s,n),this[o(1148)](t,s,n)}[t(653)](){const e=t;(0,s.Bu)(this[e(725)])||(this[e(2100)]=(0,s.qi)(this[e(2100)],this[e(725)]),this[e(1817)][e(1257)](this[e(725)]),this._rangeNotYetRequested=(0,s.Pq)())}[t(957)](e){const i=t,s={indexList:this[i(326)][i(1519)][i(1482)](0,this[i(1803)]),colorData:this[i(326)].colorData.subarray(0,4*this[i(1803)])},n={indexList:this[i(1427)].indexList.subarray(0,this[i(1803)]),colorData:this[i(1427)].colorData[i(1482)](0,4*this[i(1803)])},o=new j.x(e,this._layer[i(2012)],this[i(1321)].id,this._range,s,n);this[i(1915)].addEntry(o),this[i(1965)][i(1257)](this[i(2100)])}}var G=i(270),X=i(6815);i(8984);class Y extends e.JT{constructor(e,i,s,o,r,a,h,c,l,d){const u=t;super(),this[u(1915)]=e,this[u(540)]=i,this[u(1834)]=s,this.id=o,this[u(2012)]=r,this[u(2132)]=a,this[u(1440)]=h,this[u(1218)]=c,this[u(1847)]=l,this[u(1096)]=d,this[u(812)]=!1,this[u(502)]=u(1349),this._isVisible=!0,this._isSoftDeleted=!1,this[u(1631)]=!1,this[u(1343)]=this[u(2163)](new n.v),this[u(1025)]=this[u(1343)][u(993)],this[u(1370)]=this[u(2163)](new n.v),this[u(2027)]=this[u(1370)].event,this[u(963)]=this[u(2163)](new n.v),this.onChangedDimensions=this[u(963)][u(993)],this._onVisibilityChange=this[u(2163)](new n.v),this[u(1289)]=this[u(1510)][u(993)],this[u(806)]=this[u(2163)](new n.v),this[u(1636)]=this[u(806)].event,this[u(1242)]=this[u(2163)](new n.v),this[u(956)]=this._onTemporaryLayerRegistered[u(993)],this[u(1388)]=this[u(2163)](new n.v),this[u(578)]=this._onTemporaryLayerUnregistered[u(993)]}get[t(1121)](){return this[t(2132)]}set name(e){const i=t;e!==this._name&&(this[i(2132)]=e,this[i(1343)][i(1257)]())}get[t(533)](){return this[t(502)]}set blendMode(e){const i=t;e!==this[i(502)]&&(this._blendMode=e,this[i(1343)][i(1257)]())}get isSoftDeleted(){return this[t(1207)]}set isSoftDeleted(e){const i=t;e!==this._isSoftDeleted&&(this[i(1207)]=e,this[i(1370)][i(1257)]())}get isVisible(){return this[t(1758)]}set[t(2115)](e){const i=t;e!==this[i(1758)]&&(this[i(1758)]=e,this[i(1510)].fire(),this.onUpdateEmitter[i(1257)]())}get[t(447)](){const e=t;let i=this[e(1096)]-1;t:for(let t=0;t<this[e(1096)];t++)for(let s=0;s<this.width;s++)if(this[e(1218)][4*(t*this[e(1847)]+s)+3]>0){i=t;break t}let s=i;t:for(let t=this.height-1;t>i;t--)for(let i=0;i<this[e(1847)];i++)if(this[e(1218)][4*(t*this.width+i)+3]>0){s=t;break t}let n=this[e(1847)]-1;t:for(let t=0;t<this[e(1847)];t++)for(let o=i;o<=s;o++)if(this[e(1218)][4*(o*this[e(1847)]+t)+3]>0){n=t;break t}let o=n;t:for(let t=this[e(1847)]-1;t>n;t--)for(let n=i;n<=s;n++)if(this[e(1218)][4*(n*this[e(1847)]+t)+3]>0){o=t;break t}return{left:n,top:i,right:o,bottom:s}}async edit(e){const i=t;this._startEdit();try{const t=await e(this.data,this.width,this[i(1096)]),s={image:t&&i(1218)in t?t:void 0,range:t&&i(702)in t?t:void 0};this._finishEdit(s)}catch(t){throw this[i(1050)]({range:(0,s.DI)(this[i(1847)],this[i(1096)])}),t}}createExtendedEdit(){const e=t;this[e(920)]();const i=new q(this,this[e(1218)],this[e(1847)],this[e(1096)],this[e(1915)]);return(0,n.B)(i[e(1025)],this.onUpdateEmitter),i[e(743)]((t=>this._finishEdit({range:t}))),i}async[t(1267)](e){const i=t;if(e[i(2115)])return this[i(1915)].runAction(new u.Z(i(2175),(0,s.DI)(this[i(1847)],this[i(1096)]),this,(async(t,s,n)=>{const o=i;!this[o(2115)]&&t.set(e[o(1218)],0);let r=0;for(let i=0;i<n;i++)for(let n=0;n<s;n++)r=4*(i*s+n),(0,l.B)(e[o(533)],t,r,e.data,r)})))}async registerTemporaryLayer(e,i=!0){const s=t;await this[s(1303)](),this[s(2219)]=e,i&&((0,n.B)(e[s(1636)],this[s(806)]),e[s(743)]((()=>this.temporaryLayer=void 0))),this[s(1242)][s(1257)](this[s(2219)])}[t(708)](e){const i=t;this[i(2219)]===e&&(this[i(2219)]=void 0),this[i(1388)][i(1257)](e)}async finishTemporaryLayer(){const e=t;await(this[e(2219)]?.[e(957)]()),this.temporaryLayer=void 0}async exportImageClone(){const e=t;if(!this.temporaryLayer)return this.data;const i=new Uint8Array(new SharedArrayBuffer(this.data[e(961)]));if(i[e(2112)](this.data,0),"moving"===this[e(2219)].type){const t=this[e(2219)],s=await t[e(1539)][e(1109)][e(2044)],n={left:t[e(752)][e(1676)],top:t[e(752)][e(586)],right:t.currentState.offsetX+s.width,bottom:t.currentState[e(586)]+s.height};let o=0;for(let t=n.top;t<n.bottom;t++)for(let r=n[e(702)];r<n[e(557)];r++){o=4*(t*this[e(1847)]+r);const a=4*((t-n[e(632)])*s[e(1847)]+r-n[e(702)]);(0,c.Yr)(i,o,s.data,a)}}else e(1298)in this[e(2219)]&&await this[e(2219)][e(1298)](i,this.width,this.height);return i}async exportBlob(e={}){const i=t;let n,o;if(e?.[i(328)]&&this[i(2219)]?.[i(1653)]===i(528)){const t=this.temporaryLayer;n=await t.staticState[i(1109)][i(2044)],o=(0,s.DI)(n[i(1847)],n[i(1096)])}else await this[i(1303)](),n=this,o=e[i(1767)]||(0,s.DI)(this.width,this.height);return J(function(e,i){const n=t,o=(0,s.Oq)(i),r=(0,s.rY)(i);let a,h=0;if(o===e[n(1847)])h=i[n(632)]*o*4,a=new Uint8ClampedArray(e[n(1218)][n(1482)](h,h+o*r*4));else{a=new Uint8ClampedArray(o*r*4);for(let t=i[n(632)];t<i[n(632)]+r;t++)h=4*(t*e[n(1847)]+i[n(702)]),a[n(2112)](e[n(1218)][n(1482)](h,h+4*o),(t-i[n(632)])*o*4)}return new ImageData(a,o,r)}(n,o),e)}async[t(1001)](e,i){const n=t,o=await window[n(1150)](e);let r;n(707)in window?r=new OffscreenCanvas(o[n(1847)],o[n(1096)]):(r=document.createElement(n(890)),r[n(1847)]=o[n(1847)],r.height=o[n(1096)]);const a=r.getContext("2d");a.drawImage(o,0,0);const h=a.getImageData(0,0,o[n(1847)],o[n(1096)]),c={data:new Uint8Array(h.data),width:h.width,height:h[n(1096)]};let l;const d=this[n(540)].range;l=d&&(0,s.Oq)(d)===h[n(1847)]&&(0,s.rY)(d)===h[n(1096)]?(0,s.BN)(d):i&&(0,s.Oq)(i)===h[n(1847)]&&(0,s.rY)(i)===h[n(1096)]?(0,s.BN)(i):(0,s.DI)(h[n(1847)],h[n(1096)]);const u={image:(0,O.d)(c),range:l},g=new G.m(this,u,void 0,this[n(1915)],this[n(540)],this[n(1834)]);g[n(1457)][n(2226)]({...g[n(752)]}),await this[n(550)](g),this._historyService[n(2232)](new L("Import Blob",this[n(2012)],this.id,g.id,g[n(1539)][n(1109)][n(1263)].width,g[n(1539)][n(1109)].resource.height));const m=(0,s.l$)((0,s.DI)(h[n(1847)],h.height),(0,s.DI)(this[n(1847)],this[n(1096)]));return this.onUpdateEmitter.fire(m),g}[t(920)](){const e=t;if(this.isReadonly)throw new Error(e(2096));if(this._isEditInProgress)throw new Error("Image is readonly because an edit is in progress");this[e(812)]=!0}[t(1050)](e){const i=t;if(e){if(e?.image){const t=this.width!==e[i(1109)][i(1847)]||this[i(1847)]!==e[i(1109)].width;this[i(1218)]=e[i(1109)][i(1218)],this[i(1847)]=e[i(1109)][i(1847)],this.height=e[i(1109)][i(1096)],t&&this._onChangedDimensions[i(1257)](this.width,this[i(1096)])}this.onUpdateEmitter.fire(e.range),this[i(812)]=!1}else this[i(812)]=!1}[t(372)](e){const i=t;this[i(1915)][i(1540)](new H(e,this))}setName(e){const i=t;this[i(1915)][i(1540)](new z(e,this))}[t(919)](e){const i=t;this[i(1915)][i(1540)](new W(e,this))}serialize(){const e=t;return{id:this.id,name:this[e(2132)],data:Array[e(1045)](this.data),blendMode:this._blendMode,isSoftDeleted:this._isSoftDeleted,isVisible:this[e(1758)]}}}async function J(e,s={}){const n=t;if("image/png"===s[n(1661)]?.[n(1653)]){const t=await(0,X.Vx)({data:new Uint8Array(e[n(1218)][n(1392)],e[n(1218)].byteOffset,e[n(1218)][n(976)]),width:e[n(1847)],height:e[n(1096)]});return new Blob([t.data],{type:s[n(1661)][n(1653)]})}if(s[n(1661)]?.[n(1653)]===n(570)){const o=await async function(e,s){const n=t;return(await i.e(2938)[n(624)](i[n(1618)](i,2938))).encodeTga(e,void 0)}({data:new Uint8Array(e[n(1218)][n(1392)],e[n(1218)][n(549)],e[n(1218)][n(976)]),width:e[n(1847)],height:e[n(1096)]});return new Blob([o.data],{type:s[n(1661)].type})}const o=await createImageBitmap(e);if(!(n(707)in window)){const t=document[n(1541)](n(890));return t[n(1847)]=o[n(1847)],t[n(1096)]=o[n(1096)],t[n(567)]("2d")[n(1312)](o,0,0),new Promise(((e,i)=>{const o=n;t[o(1410)]((t=>{if(!t)return i(t);e(t)}),s[o(1661)]?.type,s[o(1661)]?.[o(1743)])}))}const r=new OffscreenCanvas(o.width,o[n(1096)]);return r.getContext("2d").drawImage(o,0,0),r[n(1590)](s[n(1661)])}class K extends e.JT{constructor(){const e=t;super(),this.currentLayer=0,this[e(1440)]=!1,this[e(2028)]=[],this[e(1243)]=this[e(2163)](new n.v),this[e(885)]=this[e(1243)][e(993)]}}var $=i(2811),Z=i(807),Q=i(3670),tt=i(7233);class et extends e.JT{constructor(e,i,s){const o=t;super(),this[o(1915)]=e,this[o(540)]=i,this[o(1834)]=s,this[o(1847)]=0,this[o(1096)]=0,this[o(794)]=0,this[o(2207)]=0,this[o(382)]=0,this[o(1732)]=o(984),this._activeLayersModelIndex=0,this[o(730)]=new Map,this[o(1817)]=this[o(2163)](new n.v),this[o(1025)]=this[o(1817)][o(993)],this[o(963)]=this.register(new n.v),this[o(1827)]=this._onChangedDimensions[o(993)],this[o(1229)]=this[o(2163)](new n.v),this.onLayerChange=this[o(1229)][o(993)],this._onLayerVisibilityChange=this[o(2163)](new n.v),this.onLayerVisibilityChange=this[o(1451)][o(993)],this[o(806)]=this[o(2163)](new n.v),this[o(1636)]=this[o(806)][o(993)],this[o(1242)]=this.register(new n.v),this[o(956)]=this[o(1242)].event,this._onTemporaryLayerUnregistered=this.register(new n.v),this[o(578)]=this[o(1388)][o(993)],this._onMimeTypeChange=this[o(2163)](new n.v),this[o(1796)]=this[o(1887)].event;const r=new K;(0,n.B)(r[o(885)],this._onLayerChange),this[o(724)]=[r],this[o(1915)].registerHistoryEntryHandler(o(1126),{undo:t=>t[o(1090)](this[o(510)]),redo:t=>t.redo(this[o(510)])}),this[o(1915)].registerHistoryEntryHandler(o(1016),{undo:t=>t[o(1090)](this.resize.bind(this)),redo:t=>t.redo(this[o(1016)][o(1618)](this))}),this[o(1915)][o(1880)](o(1569),k[o(522)]),this._historyService.registerHistoryEntryFactory("layerRange",D.$[o(522)]),this[o(1915)][o(1880)](o(2129),R.create),this[o(1915)][o(1880)](o(1717),T[o(522)]),this[o(1915)][o(1880)](o(372),P[o(522)]),this[o(1915)][o(1880)](o(1162),F[o(522)]),this[o(1915)].registerHistoryEntryFactory(o(1747),N[o(522)]),this._historyService.registerHistoryEntryFactory(o(2227),b[o(522)]),this[o(1915)][o(1880)]("newImage",B[o(522)]),this._historyService[o(1880)](o(1716),g.create),this[o(1915)][o(1880)](o(1913),U[o(522)]),this[o(1915)][o(1880)]("importBlob",L[o(522)]),this._historyService[o(1880)]("startVector",V.i[o(522)]),this[o(1915)][o(1880)](o(2053),v.S[o(522)]),this[o(1915)][o(1880)](o(1053),x.Z[o(522)]),this._historyService[o(1880)]("finishMovePixels",I.$[o(522)][o(1618)](null,this._taskWorkerService)),this._historyService[o(1880)](o(1730),M.C.create[o(1618)](null,this._taskWorkerService)),this._historyService.registerHistoryEntryFactory(o(755),S.O[o(522)]),this[o(1915)][o(1880)](o(1587),C.o.create),this[o(1915)].registerHistoryEntryFactory("finishText",E.o[o(522)]),this[o(956)]((t=>this[o(730)][o(2112)](t.id,t))),this[o(578)]((t=>this._activeTemporaryLayers[o(1367)](t.id)))}get[t(1068)](){const e=t;return this[e(510)][e(2028)][this[e(510)][e(1068)]]}get[t(1735)](){const e=t;return this[e(510)][e(2028)][e(1460)]((t=>!t[e(1605)]))}get[t(1176)](){return this[t(1732)]}set[t(1176)](e){const i=t;this[i(1732)]=e,this._onMimeTypeChange[i(1257)](e)}get[t(510)](){const e=t;return this[e(724)][this[e(1272)]]}[t(1644)](e=0){const i=t;if(-1!==e&&this[i(1847)]*this[i(1096)]>e)throw new Error(i(1094)+this[i(1847)]*this.height+i(825)+e+")");for(const t of this[i(730)][i(491)]())if(t.canSerialize){const s=t[i(1736)](e);if(s)throw new Error(s)}const s=[];for(const t of this._activeTemporaryLayers.values())s[i(2226)](t.serialize());const n={dimensions:{width:this[i(1847)],height:this.height},currentLayer:this[i(510)][i(1068)],imageFileId:this[i(794)],isReadonly:this._activeLayersModel[i(1440)],layers:this._activeLayersModel[i(2028)][i(562)]((t=>t[i(1644)]())),temporaryLayers:s,currentTemporaryLayerId:this[i(1068)]?.temporaryLayer?.id};if(0===n[i(1735)][i(961)])throw new Error(i(1770));return n}[t(817)](e,i){const s=t;if(this[s(1847)]=e.dimensions.width,this[s(1096)]=e[s(622)][s(1096)],this[s(794)]=e[s(2012)],i&&(this[s(510)][s(2028)][s(961)]=0,this[s(730)][s(1778)]()),this._activeLayersModel[s(2028)].length>0)throw new Error("Cannot restore layers when layer(s) exist");for(const t of e[s(1735)]){const i=new Y(this[s(1915)],this[s(540)],this[s(1834)],t.id,e[s(2012)],t[s(1121)],e[s(1440)],new Uint8Array(t[s(1218)]),e.dimensions.width,e[s(622)][s(1096)]);i[s(533)]=t.blendMode,i[s(1605)]=t[s(1605)],i[s(2115)]=t[s(2115)],this._activeLayersModel[s(2028)][s(2226)](i),this[s(849)](i),this[s(2207)]=Math[s(590)](this[s(2207)],t.id+1)}this[s(510)][s(1440)]=e[s(1440)],this[s(510)][s(1068)]=e[s(1068)];for(const t of e[s(1672)]){const e=this[s(748)](t.parentLayerId);let i;switch(t[s(1653)]){case s(1422):i=$.B[s(522)];break;case"moving":i=G.m[s(522)];break;case s(1101):i=Z.F[s(522)];break;case s(617):i=Q.n[s(522)];break;case s(2199):i=tt.o[s(522)]}const o=i(t,e,this._historyService,this[s(540)],this[s(1834)]);o[s(752)][s(1676)]=t.currentState[s(1676)],o[s(752)][s(586)]=t[s(752)][s(586)],(0,n.B)(o.onRequestRender,this.currentLayer[s(806)]),this[s(730)].set(t.id,o)}if(void 0!==e[s(601)]){const t=this[s(1561)](e[s(601)]);this.currentLayer?.registerTemporaryLayer(t)}this[s(1324)](),this[s(1817)][s(1257)](),this._onChangedDimensions.fire(this[s(1847)],this[s(1096)]),this[s(1229)].fire()}[t(2106)](e){this[t(2207)]=e-1}acquireTemporaryLayerId(){return++this._temporaryLayerIdCounter}[t(615)](e){this[t(382)]=e-1}async[t(2162)](e,i,s){const n=t;this.activeImageFileId=0,this[n(1176)]=e;const o=await window[n(1150)](i);let r;n(707)in window?r=new OffscreenCanvas(o[n(1847)],o[n(1096)]):(r=document.createElement(n(890)),r[n(1847)]=o[n(1847)],r[n(1096)]=o[n(1096)]);const a=r[n(567)]("2d");a[n(1312)](o,0,0);const h=a.getImageData(0,0,o.width,o.height);this.openImage(e,{data:new Uint8Array(h[n(1218)][n(1392)]),width:o[n(1847)],height:o[n(1096)]},!0,s)}[t(1569)](e,i,s,n,o=t(2033)+(n?t(363):"")){const r=t;this[r(794)]="id"in i?i.id:0,this[r(1176)]=e||r(984);for(const t of this[r(510)][r(2028)])t[r(1605)]=!0,t[r(835)]();this[r(510)][r(2028)][r(961)]=0,this[r(730)][r(1778)]();const a=this.width!==i[r(1847)]||this[r(1096)]!==i.height;this[r(1847)]=i[r(1847)],this[r(1096)]=i.height,this[r(510)][r(1440)]=n,this[r(510)][r(2028)].push(this[r(418)](i[r(1218)])),this[r(1324)](),s&&(this[r(1915)][r(602)](),this[r(1915)][r(2232)](new k(o))),this[r(1817)][r(1257)](),a&&this._onChangedDimensions[r(1257)](this[r(1847)],this[r(1096)]),this[r(1229)][r(1257)]()}async newImage(e,i,s){const n=t;await this._onLayerChange[n(1378)](),this[n(1176)]=s;const o=window[n(2123)]?SharedArrayBuffer:ArrayBuffer,r=new Uint8Array(new o(e*i*4));r[n(1411)](255);const a={data:r,width:e,height:i};this[n(1569)](void 0,a,!0,!1,n(1278))}async[t(1528)](e){const i=t;if(this[i(1176)]===i(548))throw new Error(i(613));return await this[i(1439)](),this[i(510)][i(2028)][this[i(510)][i(1068)]][i(1528)](e)}async[t(1104)](e){const i=t;if("image/x-ico"===this.mimeType)throw new Error(i(613));const s=await this[i(2011)]();return J(new ImageData(new Uint8ClampedArray(s.data),s.width,s[i(1096)]),e)}[t(954)](){const e=t;return this[e(1439)](),{data:this[e(510)][e(2028)][this._activeLayersModel[e(1068)]][e(1218)][e(1815)](0,this.width*this[e(1096)]*4),width:this[e(1847)],height:this[e(1096)]}}async exportImageClone(){const e=t,i=this.layers[e(1460)]((t=>t.isVisible));if(0===i[e(961)])return{data:new Uint8Array(0),width:0,height:0};const s={data:(await i[0][e(2011)]()).slice(0,this[e(1847)]*this[e(1096)]*4),width:this[e(1847)],height:this[e(1096)]};for(let t=1;t<i[e(961)];t++){const n=i[t],o=await n[e(2011)]();let r=0;for(let t=0;t<this[e(1096)];t++)for(let i=0;i<this[e(1847)];i++)r=4*(t*this[e(1847)]+i),(0,l.B)(n.blendMode,s[e(1218)],r,o,r)}return s}getPixel(e,i){const s=t,n=this[s(1735)][s(1460)]((t=>t.isVisible));if(0===n[s(961)])return;const o=4*(i*this[s(1847)]+e),r=n[0][s(1218)][s(1482)](o,o+4);let a;for(let t=1;t<n[s(961)];t++)a=n[t],(0,l.B)(a[s(533)],r,0,a[s(1218)],o);return r}[t(435)](){const e=t;return this[e(1176)]!==e(548)}[t(983)](){const e=t;if(!this[e(435)]())throw new Error(e(1824))}[t(458)](){const e=t;if(this[e(510)].isReadonly)throw new Error(e(2096))}[t(1426)](e){const i=t;this.currentLayer?.id!==e&&(this[i(983)](),this[i(510)][i(1068)]=this[i(1963)](e),this[i(1229)].fire())}async newLayer(){const e=t;this._checkCanEdit(),this[e(983)](),await(this[e(1068)]?.[e(1303)]());const i=window[e(2123)]?SharedArrayBuffer:ArrayBuffer,s=this._createLayer(new Uint8Array(new i(this[e(1847)]*this[e(1096)]*4)));this[e(510)][e(2028)][e(1998)](++this[e(510)][e(1068)],0,s),this._historyService[e(2232)](new B("New Layer",s[e(2012)],s.id,s[e(1847)],s[e(1096)])),this[e(1817)].fire(),this[e(1229)][e(1257)]()}async deleteLayer(e){const i=t;if(this[i(458)](),this._checkLayerSupport(),this[i(510)][i(2028)][i(961)]<=1)throw new Error("Cannot delete the last layer");await(this.currentLayer?.[i(1303)]()),e?this[i(1452)](this[i(1963)](e)):this._deleteCurrentLayer(),this[i(1229)][i(1257)]()}async duplicateLayer(e){const i=t;let s;this._checkCanEdit(),void 0===e?(s=this[i(1068)],e=s.id):s=this.getLayerById(e),this[i(1735)][i(961)]>0&&this._checkLayerSupport(),await s.finishTemporaryLayer();const n=(0,c.X$)(s[i(1218)].length,255,!0);let o;if(n[i(2112)](s[i(1218)],0),s[i(1121)][i(1189)](/ Copy$/)){let t=1;o=s[i(1121)]+" 1";do{o=o.replace(/ \d+$/," "+ ++t)}while(this[i(510)][i(2028)][i(2124)]((t=>t[i(1121)]===o)))}else{const t=s[i(1121)][i(1189)](/ Copy (\d)+$/);if(t&&t[1]){let e=parseInt(t[1]);do{o=s.name[i(1408)](/ \d+$/," "+ ++e)}while(this[i(510)].list.some((t=>t[i(1121)]===o)))}else o=s[i(1121)]+i(753)}const r=++this[i(2207)],a=new Y(this._historyService,this[i(540)],this[i(1834)],r,this.activeImageFileId,o,this._activeLayersModel[i(1440)],n,this.width,this[i(1096)]);this[i(849)](a);const h=this[i(1963)](e);this[i(510)][i(2028)].splice(h+1,0,a),this[i(1426)](r),this._historyService[i(2232)](new B(i(2187),s.imageFileId,r,s[i(1847)],s[i(1096)])),this[i(1817)][i(1257)](),this[i(1229)][i(1257)]()}async[t(745)](){const e=t;if(this[e(458)](),this._checkLayerSupport(),0===this._activeLayersModel[e(1068)]||this[e(1735)][0]===this[e(1068)])throw new Error(e(1238));const i=this[e(510)].list[this[e(510)][e(1068)]];await i[e(1303)]();const s=this[e(1735)][e(1159)](i),n=this[e(1735)][s-1],o=this[e(510)][e(2028)][e(1159)](n);await this[e(1915)][e(1908)]("Merge Layer Down",(async()=>{const t=e;i.setVisible(!0),n[t(919)](!0),await this[t(510)].list[o].merge(i),this._deleteCurrentLayer(),this[t(510)][t(1068)]=o,this[t(1068)]?.[t(919)](!0)}))}[t(2037)](e,i){const s=t;let n;this._checkCanEdit(),void 0===i?(n=this[s(1068)],i=n.id):n=this[s(748)](i),n.setName(e),this._onLayerChange[s(1257)]()}goToTopLayer(){const e=t;this[e(983)](),this.setActiveLayer(this[e(1735)][this[e(1735)][e(961)]-1].id)}[t(641)](){const e=t;this._checkLayerSupport(),this[e(1426)](this[e(1735)][0].id)}[t(365)](){const e=t;this._checkLayerSupport(),this[e(1132)](1)}[t(2094)](){const e=t;this._checkLayerSupport(),this[e(1132)](-1)}[t(1132)](e){const i=t,s=this.currentLayer;if(!s)throw new Error(i(506));const n=this[i(1735)],o=n[i(1159)](s);if(-1===o)throw new Error(i(555));const r=(0,d.u)(o+e,n[i(961)]-1,0);this[i(1426)](n[r].id)}[t(1332)](){const e=t;this[e(458)](),this[e(983)](),this._historyService[e(1540)](new f("Move Layer to Top",this[e(510)].list[e(961)]-1,this[e(510)]))}moveLayerToBottom(){const e=t;this[e(458)](),this[e(983)](),this[e(1915)][e(1540)](new f(e(1304),0,this[e(510)]))}[t(541)](){const e=t;this._checkCanEdit(),this._checkLayerSupport(),this._historyService[e(1540)](new w(this[e(510)]))}[t(1042)](){const e=t;this[e(458)](),this[e(983)](),this[e(1915)][e(1540)](new y(this[e(510)]))}[t(504)](e,i){const s=t;this._checkCanEdit(),this[s(983)]();const n=this[s(510)].list[s(1108)]((t=>t.id===i));-1!==n&&this[s(1915)][s(1540)](new p(s(359),e,n,this[s(510)]))}containsCoord(e,i){const s=t;return e>=0&&e<this[s(1847)]&&i>=0&&i<this[s(1096)]}resize(e,i){const s=t;this._checkCanEdit(),this.width===e&&this[s(1096)]===i||(this[s(1847)]=e,this.height=i,this[s(1817)][s(1257)](),this[s(963)][s(1257)](e,i))}_createLayer(e){const i=t;this[i(1735)][i(961)]>0&&this[i(983)](),e=(0,c.pZ)(e);const s=++this[i(2207)],n=new Y(this[i(1915)],this[i(540)],this[i(1834)],s,this[i(794)],1===s?i(768):"Layer "+this[i(1930)](),this[i(510)][i(1440)],e,this.width,this[i(1096)]);return this._forwardLayerEvents(n),n}[t(849)](e){const i=t;(0,n.B)(e[i(1025)],this._onUpdate),(0,n.B)(e[i(2027)],this[i(1229)]),(0,n.B)(e[i(1827)],this[i(963)]),(0,n.B)(e.onVisibilityChange,this[i(1451)]),(0,n.B)(e[i(1636)],this._onRequestRender),(0,n.B)(e.onTemporaryLayerRegistered,this[i(1242)]),(0,n.B)(e[i(578)],this[i(1388)])}_getUnusedLayerLabelId(){const e=t,i=this.layers[e(562)]((t=>t[e(1121)]))[e(1460)]((t=>t[e(1189)](/^Layer \d+$/))).map((t=>parseInt(t.substring(6))));let s=1;for(;i.includes(s);)s++;return s}_deleteCurrentLayer(){const e=t;this[e(1452)](this[e(510)][e(1068)])}[t(1452)](e){const i=t;if(1===this[i(360)]())throw new Error(i(969));if(this[i(510)][i(1068)]===e){let t=this._activeLayersModel[i(1068)]-1;for(;t>0&&this[i(510)].list[t][i(1605)];)t--;if(t<0)for(t=this[i(510)][i(1068)]+1;t<this[i(510)][i(2028)].length-1&&this[i(510)][i(2028)][t][i(1605)];)t++;this[i(510)][i(1068)]=Math[i(590)](t,0)}const s=this._activeLayersModel[i(2028)][e];s.isSoftDeleted=!0,this[i(1915)][i(2232)](new b("Delete Layer",s[i(2012)],s.id)),this[i(1324)]()}async[t(1439)](){const e=t;this[e(983)](),this[e(360)]()>1&&(await this._historyService[e(1908)]("Flatten Layers",(async()=>{const t=e;for(let e=this[t(1735)][t(961)]-1;e>=1;e--){const i=this[t(1735)][e];await i[t(1303)](),await this[t(1735)][e-1][t(1267)](i),this[t(1452)](e)}})),this[e(1817)][e(1257)](),this[e(1229)][e(1257)]())}[t(1324)](){const e=t;this._activeLayersModel[e(2028)][0][e(1631)]=!0;for(let t=1;t<this._activeLayersModel[e(2028)].length;t++)this[e(510)][e(2028)][t][e(1631)]=!1}[t(1963)](e){const i=t,s=this[i(510)][i(2028)].findIndex((t=>t.id===e));if(-1===s)throw new Error(i(720));return s}[t(748)](e){const i=t;return this[i(510)][i(2028)][this[i(1963)](e)]}[t(1561)](e){const i=t;return this._activeTemporaryLayers[i(1270)](e)}_getNonSoftDeletedLayerCount(){const e=t;let i=0;for(const t of this._activeLayersModel[e(2028)])!t[e(1605)]&&i++;return i}async[t(940)](e=!1){const i=t;if(!this[i(540)][i(1767)])return;const s=this[i(1068)];s&&(await(this.currentLayer?.finishTemporaryLayer()),await this[i(1915)][i(1908)](i(1826),(async()=>{const t=i;this[t(540)][t(2e3)](s[t(1847)],s[t(1096)]),this[t(540)][t(957)](t(690));const n=this._selectionService.range;n&&(await this[t(1915)][t(607)](new u.Z(t(1826),n,s,((e,i)=>{const s=t;for(let t=n[s(632)];t<n[s(719)];t++){const o=t*i*4;e.fill(0,o+4*n[s(702)],o+4*n[s(557)])}}))),!e&&this[t(540)].deselect())})))}[t(1536)](){const e=t,i=(0,s.DI)(this.width,this[e(1096)]);return this._selectionService[e(691)](e(841),i),i}}class it{constructor(e,i,s){const n=t;this[n(392)]=e,this[n(1711)]=i,this[n(1193)]=s,this.type=n(1734),this[n(727)]=0}async undo(e){const i=t,s=await e[i(1698)](this[i(1711)],this._layerId);if(!s)throw new Error(i(645));return s}async[t(568)](e){const i=t,s=await e.getLayer(this[i(1711)],this[i(1193)]);if(!s)throw new Error(i(645));return s}serialize(){const e=t;return{id:"Empty",operationName:this[e(392)],imageFileId:this[e(1711)],layerId:this[e(1193)]}}static[t(522)](e){const i=t;return new it(e.operationName,e.imageFileId,e[i(477)])}}var st=i(3491);class nt{constructor(e,i){const s=t;this[s(392)]=e,this[s(1711)]=i,this[s(1653)]="imageFile",this.pixelCount=0}async[t(1090)](e){const i=t;e.setImageSoftDeleted(this[i(1711)],!0)}async[t(568)](e){const i=t;e[i(884)](this[i(1711)],!1)}serialize(){const e=t;return{id:e(1583),operationName:this.operationName,imageFileId:this[e(1711)]}}static create(e){return new nt(e[t(392)],e.imageFileId)}}class ot{constructor(e,i){const s=t;this[s(392)]=e,this._imageFileId=i,this.type=s(1697),this[s(727)]=0}async[t(1090)](e){e[t(884)](this._imageFileId,!1)}async redo(e){const i=t;e[i(884)](this[i(1711)],!0)}[t(1644)](){const e=t;return{id:e(1385),operationName:this[e(392)],imageFileId:this[e(1711)]}}static create(e){return new ot(e[t(392)],e.imageFileId)}}class rt{constructor(e,i,s){const n=t;this.operationName=e,this[n(427)]=i,this._targetIndex=s,this[n(1653)]="imageFile",this[n(727)]=0}[t(1090)](e){e[t(2038)](this._targetIndex,this._initialIndex)}[t(568)](e){const i=t;e[i(2038)](this._initialIndex,this[i(2131)])}[t(1644)](){const e=t;return{id:e(1804),operationName:this[e(392)],initialIndex:this._initialIndex,targetIndex:this._targetIndex}}static create(e){const i=t;return new rt(e.operationName,e[i(665)],e[i(1910)])}}class at extends e.JT{constructor(e,i,s,o){const r=t;super(),this[r(1915)]=e,this._imageService=i,this[r(540)]=s,this[r(2109)]=o,this._isReadonly=!1,this[r(1916)]=new Map,this[r(1938)]=new Map,this._imageIdCounter=0,this._onImagesChange=this[r(2163)](new n.v),this[r(772)]=this[r(433)].event,this[r(1679)]=this.register(new n.v),this.onImageDeleted=this[r(1679)][r(993)],this[r(1915)].registerHistoryEntryHandler(r(1734),{undo:async t=>{const e=r,i=await t.undo(this);i[e(1605)]?this._imageService[e(1426)](this._imageService.layers[0].id):this._imageService[e(1426)](i.id)},redo:async t=>{const e=r,i=await t[e(568)](this);i[e(1605)]?this[e(1008)][e(1426)](this[e(1008)][e(1735)][0].id):this._imageService[e(1426)](i.id)}}),this._historyService[r(951)]("imageFile",{undo:async t=>{const e=r;t[e(1090)]({setImageSoftDeleted:this._setSoftDeleted[e(1618)](this),swapImagePositions:this[e(497)][e(1618)](this,!0)})},redo:async t=>{const e=r;t[e(568)]({setImageSoftDeleted:this[e(2197)][e(1618)](this),swapImagePositions:this[e(497)].bind(this,!0)})}}),this[r(1915)][r(1880)](r(1438),j.x[r(522)]),this[r(1915)][r(1880)]("Empty",it.create),this[r(1915)][r(1880)](r(1583),nt[r(522)]),this._historyService[r(1880)](r(1385),ot[r(522)]),this[r(1915)][r(1880)]("MoveImage",rt[r(522)]),this[r(540)].onCommit((()=>{const t=r;void 0!==this[t(2047)]&&this[t(1915)][t(2232)](new it(t(2220),this[t(1406)]()?.id||0,this[t(1008)].currentLayer?.id||0))})),this[r(1008)][r(1827)]((()=>this[r(2225)]()))}async[t(2197)](e,i){const s=t,n=this[s(2170)]?.find((t=>t.id===e));n&&(i?(n[s(1605)]=i,this._getActiveImage()?.id===e&&await this[s(552)](this[s(2047)],this[s(2170)]),this._onImageDeleted.fire(e),this[s(433)][s(1257)]()):(n[s(1605)]=i,this._onImagesChange[s(1257)](),this[s(1920)](n.id)))}get imageSet(){const e=t;if(this[e(2170)])return this[e(2225)](),ht(this[e(2170)])}[t(2225)](){const e=t;if(this[e(2170)]&&this[e(2047)]){const t=this[e(2170)][this.activeImageSetIndex],i=this[e(1008)][e(1068)];t&&i&&i[e(1218)]!==t[e(1218)]&&(t.data=i[e(1218)],t[e(1847)]=i[e(1847)],t[e(1096)]=i[e(1096)])}}[t(2162)](e,i,s){const n=t;return this[n(1072)]=s,this[n(1008)].openBlob(e,i,s)}openImage(e,i,s){const n=t;let o;if(this._isReadonly=s,Array[n(2086)](i)){this._unloadImageSet();const t=i;this[n(1176)]=e,this[n(2170)]=t[n(562)]((t=>({...t,id:++this._imageIdCounter})));for(const t of this[n(2170)])t[n(1218)]=(0,c.pZ)(t.data);const s=t.reduce(((t,e,i)=>{const s=n;return e[s(1847)]*e[s(1096)]>t[s(683)]?(t[s(683)]=e.width*e[s(1096)],{index:i,dims:e[s(1847)]*e[s(1096)]}):t}),{index:0,dims:0})[n(1802)];this[n(2047)]=s,o=this[n(2170)][s]}else o=i;this[n(1008)].openImage(e,o,!0,this._isReadonly),Array[n(2086)](i)&&this[n(433)][n(1257)]()}async[t(883)](e,i,s){const n=t;if(this._unloadImageSet(),e===n(548)){await this[n(1008)].newImage(i,s,e);const t=this[n(1008)].currentLayer;this[n(1176)]=e,this._imageSet=[{data:t[n(1218)],width:i,height:s,bitness:32,id:++this[n(918)]}],this[n(2047)]=0,this[n(433)][n(1257)]()}else await this[n(1008)][n(883)](i,s,e)}[t(308)](){const e=t;if(this[e(2170)]){for(const t of ht(this[e(2170)]))this[e(1679)][e(1257)](t.id);this.activeImageSetIndex=void 0}}async[t(1528)](e){const s=t;if(this[s(2170)]){const t=(await i.e(7495)[s(624)](i[s(1618)](i,7495)))[s(1523)],e=await t(ht(this[s(2170)]));return new Blob([e])}return this[s(1008)][s(1528)](e)}async exportBlobClone(e){const i=t;return this[i(2170)]?this[i(1528)](e):this[i(1008)][i(1104)](e)}[t(1275)](){const e=t;if(!this[e(2170)])throw new Error("This image type doesn't support multiple images");return this[e(2170)]}[t(458)](){const e=t;if(this[e(1072)])throw new Error(e(2096))}async[t(1041)](e,i){const s=t,n=this[s(1275)]();if(e>=n.length)throw new Error(s(1608)+e+s(1322));if(void 0!==this.activeImageSetIndex){const t=n[this.activeImageSetIndex];!i&&(await(this[s(1008)][s(1068)]?.[s(1303)]()),this[s(540)][s(1767)]&&this[s(540)][s(501)]());const e=this[s(1008)][s(1644)](-1);this[s(1916)].set(t.id,e),this._savedViewport[s(2112)](t.id,{x:this[s(2109)].x,y:this._viewportService.y,zoom:this[s(2109)][s(1905)]})}this.activeImageSetIndex=e;const o=n[e],r=this[s(1916)][s(1270)](o.id);r?this[s(1008)][s(817)](r,!0):this[s(1008)][s(1569)](o[s(1176)],o,!1,this._isReadonly);const a=this[s(1938)].get(o.id);a?(this[s(2109)].x=a.x,this[s(2109)].y=a.y,this[s(2109)][s(1905)]=a[s(1905)]):this[s(2109)][s(1871)](),this[s(433)][s(1257)]()}async[t(1920)](e,i){const s=t,n=this._checkSupportsMultipleImages()[s(1108)]((t=>t.id===e));await this[s(1041)](n,i)}async[t(439)](e,i,s){const n=t;this[n(458)]();const o=this[n(1275)](),r={id:++this._imageIdCounter,width:e,height:i,data:new Uint8Array(e*i*4),bitness:s,mimeType:n(32===s?984:2019)};r[n(1218)][n(1411)](255),o[n(2226)](r),await this[n(1041)](o.length-1),this[n(1915)][n(2232)](new nt(n(1181),r.id))}async[t(1333)](e){const i=t;this[i(458)]();const s=this[i(1275)]();if(s[i(961)]<=1)throw new Error(i(1553));const n=this[i(1609)](e);if(void 0===n)throw new Error(i(973));await this[i(552)](n,s);const o=s[n];o[i(1605)]=!0,this[i(1679)][i(1257)](o.id),this[i(433)].fire(),this._historyService[i(2232)](new ot(i(1489),o.id))}async[t(1657)](e){const i=t;this[i(458)]();const s=this._checkSupportsMultipleImages(),n=this._getImageOrActiveIndex(e);if(void 0===n)throw new Error(i(973));!e&&(e=s[n]);const o={id:++this._imageIdCounter,width:e[i(1847)],height:e[i(1096)],data:e.data[i(1815)](0),bitness:e[i(895)],mimeType:e[i(1176)]},r=n+1;s[i(1998)](r,0,o),await this[i(1041)](r),this[i(1915)][i(2232)](new nt("Duplicate Image",o.id))}[t(1609)](e){const i=this[t(1275)]();let s;return e?(s=i.findIndex((t=>t.id===e.id)),-1===s&&(s=void 0)):s=this.activeImageSetIndex,s}async _focusNonActiveImage(e,i){const s=t,n=e+1<i.length-1?e+1:e-1;await this[s(1041)](n)}async goToTopImage(){const e=t;await this[e(1041)](this[e(1275)]()[e(961)]-1)}async[t(1485)](){const e=t;await this[e(1041)](0)}async[t(576)](){const e=t;await this[e(1041)]((this[e(2047)]||0)+1)}async goToImageBelow(){const e=t;await this[e(1041)]((this[e(2047)]||0)-1)}async[t(1772)](){const e=t;this._moveActiveImageToIndex(e(1393),this[e(1275)]().length-1)}async[t(744)](){const e=t;this[e(612)](e(1379),0)}async[t(340)](){const e=t;void 0!==this[e(2047)]&&this[e(612)](e(1416),this[e(2047)]+1)}async[t(847)](){const e=t;void 0!==this[e(2047)]&&this[e(612)]("Move Image Down",this[e(2047)]-1)}async[t(1715)](e,i){const s=t,n=this[s(1275)](),o=(n.findIndex((t=>t.id===e)),n.findIndex((t=>t.id===i)));await this.setActiveImageById(e),this[s(612)](s(398),o)}[t(612)](e,i){const s=t;if(void 0===this[s(2047)])return;this[s(458)]();const n=this[s(1275)]();i=Math[s(590)](Math.min(i,n[s(961)]-1),0),this[s(2047)]!==i&&(this[s(1915)][s(2232)](new rt(e,this[s(2047)],i)),this._swapImagePositions(!1,this[s(2047)],i))}[t(497)](e,i,s){const n=t;if(i===s)return;const o=this[n(1275)](),r=this[n(1406)](),a=o[s],h=o.splice(i,1)[0];o[n(1998)](s,0,h),(r?.id===h.id||r?.id===a.id)&&this[n(2047)]!==s&&(this[n(2047)]=s),this[n(433)][n(1257)]()}_getActiveImage(){const e=t,i=this._checkSupportsMultipleImages();if(void 0!==this[e(2047)])return i[this.activeImageSetIndex]}async[t(1698)](e,i){const s=t;if(!this[s(2170)]){if(0!==e)throw new Error(s(571));return this[s(1008)][s(748)](i)}let n=this[s(1406)]();return n?.id!==e&&(await this.setActiveImageById(e,!0),n=this._getActiveImage()),this[s(1008)][s(748)](i)}async getTempLayer(e,i,s){const n=t;return await this[n(1698)](e,i),this._imageService[n(1561)](s)}[t(1644)](e=0){const i=t;if(void 0!==this[i(2047)]){if(-1!==e){const t=this[i(2170)][i(1771)](((t,e)=>{const s=i,n=e.width*e[s(1096)];return n>t?n:t}),0);if(t>e)throw new Error(i(1094)+t+i(825)+e+")")}const t=Array[i(1045)](this[i(1916)].values());return{mimeType:this[i(1176)]||"image/png",activeImageSetIndex:this.activeImageSetIndex||0,loadedImages:t,unloadedImages:this[i(2170)].map((t=>(0,A.t)(t)))}}return{mimeType:this[i(1176)]||i(984),activeImageSetIndex:0,loadedImages:[this._imageService[i(1644)](e)],unloadedImages:void 0}}[t(817)](e){const i=t;if(this.mimeType=e[i(1176)],e[i(468)]){let t=0;for(const s of e[i(1904)].values())t=s.layers[i(1771)](((t,e)=>e.id>t?e.id:t),t),s[i(1672)].forEach((t=>(0,st.M)(t.id)));this[i(1008)][i(2106)](t+1),this[i(2170)]=e[i(468)][i(562)]((t=>(0,A.e)(t)));for(const t of e[i(1904)])this._loadedImages.set(t[i(2012)],t);this._imageSet&&this.setActiveImageByIndex(e[i(2047)])}else this[i(2170)]=void 0,this[i(1008)].deserialize(e[i(1904)][0]);this[i(1008)][i(1176)]=this[i(1176)],this[i(433)].fire()}}function ht(e){const i=t;return e[i(1460)]((t=>!0!==t[i(1605)]))}class ct extends e.JT{constructor(e){const i=t;super(),this._attachedDisposables=[],this._onDblClick=this.register(new n.v),this[i(771)]=this._onDblClick[i(993)],this[i(1574)]=this[i(2163)](new n.v),this[i(680)]=this[i(1574)][i(993)],this[i(974)]=this.register(new n.v),this[i(1760)]=this[i(974)][i(993)],this._onPointerDown=this[i(2163)](new n.v),this[i(672)]=this[i(523)].event,this[i(1529)]=this[i(2163)](new n.v),this.onPointerDownMove=this[i(1529)].event,this[i(1062)]=this.register(new n.v),this[i(1906)]=this[i(1062)][i(993)],this[i(479)]=this[i(2163)](new n.v),this[i(1641)]=this[i(479)].event,this[i(2145)]=this.register(new n.v),this[i(1256)]=this[i(2145)][i(993)],e[i(1500)]((t=>this[i(1366)](t))),this[i(2163)]({dispose:()=>this[i(584)]?.dispose()})}get[t(1858)](){return!!this[t(584)]}[t(1366)](i){const s=t;(0,e._c)(this[s(1952)]),this._attachedDisposables[s(961)]=0,this.register((0,e.Lw)(document[s(1893)],s(1594),(t=>this[s(1574)][s(1257)](t)))),this.register((0,e.Lw)(document[s(1893)],"keyup",(t=>this._onKeyUp[s(1257)](t)))),this.register((0,e.Lw)(i,s(1790),(t=>{const n=s;i.setPointerCapture(t[n(1556)]),this[n(584)]=(0,e.Lw)(i,"pointermove",(t=>this[n(1529)][n(1257)](t))),this[n(523)][n(1257)](t)}))),this[s(2163)]((0,e.Lw)(i,s(1677),(t=>{const e=s;i[e(2087)](t[e(1556)]),this[e(584)]?.[e(835)](),this[e(584)]=void 0,this[e(479)].fire(t)}))),this[s(2163)]((0,e.Lw)(i,s(1049),(t=>this[s(1111)][s(1257)](t)))),this[s(2163)]((0,e.Lw)(i,s(1115),(t=>t.preventDefault()))),this.register((0,e.Lw)(i,s(1914),(t=>this[s(1062)][s(1257)](t)))),this[s(2163)]((0,e.Lw)(i,"wheel",(t=>this._onWheel[s(1257)](t)),{passive:!0}))}}var lt=i(8752);class dt{constructor(e,i=255){const s=t;this[s(1086)]=e,this[s(816)]=new Map,this[s(1817)]=new n.v,this.onUpdate=this[s(1817)].event,this[s(2077)]=i,this[s(1025)]((()=>this[s(816)][s(1778)]()))}[t(835)](){this[t(1817)].dispose()}get sourceColor(){return this[t(1086)]}set[t(498)](e){const i=t;this[i(1086)]=e,this[i(1817)].fire()}get a(){return this[t(2077)]}set a(e){const i=t,s=(0,d.u)(e,255,0);this._alpha!==s&&(this[i(2077)]=s,this._onUpdate.fire())}get hue(){return this[t(1297)][0]}set[t(780)](e){const i=t;switch(this._color[i(1653)]){case"hsv":if(e===this[i(1086)][0])return;this[i(1086)]=lt.mC[i(1666)](e,this[i(1086)][1],this[i(1086)][2]);break;case i(1336):{const t=lt.B8[i(638)](this[i(1086)]);if(e===t[0])return;this._color=lt.mC[i(1666)](e,t[1],t[2]);break}}this[i(1817)][i(1257)]()}get hsv(){const e=t;switch(this[e(1086)][e(1653)]){case"hsv":return this[e(1086)];case"rgb":return this[e(1650)](this._color,"hsv",lt.B8.toHsv)}}set[t(1297)](e){const i=t,s=this[i(1086)].type===i(1297)?this._color:lt.B8.toHsv(this[i(1086)]);(0,lt.WC)(s,e)||(this[i(1086)]=e,this[i(1817)][i(1257)]())}get[t(1336)](){const e=t;switch(this[e(1086)].type){case e(1297):return this[e(1650)](this[e(1086)],e(1336),lt.mC[e(1591)]);case e(1336):return this._color}}set[t(1336)](e){const i=t,s=this[i(1086)].type===i(1336)?this[i(1086)]:lt.mC.toRgb(this._color);(0,lt.WC)(s,e)||(this._color=e,this._onUpdate[i(1257)]())}get[t(1374)](){const e=t;switch(this[e(1086)][e(1653)]){case e(1297):return this._getWithCache(this[e(1086)],e(1374),(t=>lt.mC.toRgba(t,this[e(2077)])));case"rgb":return this[e(1650)](this[e(1086)],e(1374),(t=>lt.B8[e(687)](t,this[e(2077)])))}}set[t(1374)](e){const i=t,s="rgb"===this[i(1086)][i(1653)]?this[i(1086)]:lt.mC.toRgb(this[i(1086)]);s[0]===e[0]&&s[1]===e[1]&&s[2]===e[2]&&this._alpha===e[3]||(this[i(1086)]=lt.m4[i(1591)](e),this[i(2077)]=e[3],this[i(1817)][i(1257)]())}[t(1650)](e,i,s){const n=t,o=this[n(816)].get(i);if(o)return o;const r=s(e);return this[n(816)][n(2112)](i,r),r}}class ut extends e.JT{constructor(){const e=t;super(),this[e(1948)]=this[e(2163)](new dt(lt.B8[e(671)](0,0,0),255)),this[e(1903)]=this[e(2163)](new dt(lt.B8[e(671)](255,255,255),255)),this._onUpdate=this.register(new n.v),this.onUpdate=this._onUpdate.event,(0,n.B)(this.primary[e(1025)],this._onUpdate),(0,n.B)(this.secondary.onUpdate,this[e(1817)])}[t(886)](){const e=t,i=this[e(1903)][e(498)],s=this[e(1903)].a;this.secondary[e(498)]=this[e(1948)][e(498)],this[e(1903)].a=this[e(1948)].a,this[e(1948)][e(498)]=i,this.primary.a=s,this[e(1817)].fire()}[t(1984)](e,i){const s=t;this._validate(e),this[s(1662)](i),(!(0,lt.WC)(this.primary[s(1374)],e)||!(0,lt.WC)(this.secondary[s(1374)],i))&&(this.primary.rgba=e,this[s(1903)][s(1374)]=i,this[s(1817)][s(1257)]())}getColorFromPointerEvent(e){const i=t;return 1&e.buttons?this[i(1948)][i(1374)]:2&e[i(312)]?this[i(1903)][i(1374)]:void 0}[t(484)](e){const i=t;return 1&e.buttons?[this[i(1948)].rgba,this[i(1903)].rgba]:[this[i(1903)][i(1374)],this[i(1948)].rgba]}[t(1662)](e){const i=t;if(4!==e[i(961)])throw new Error(i(539))}}let gt=Float32Array;function mt(t,e,i,s,n,o,r=new gt(16)){return r[0]=2/(e-t),r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=2/(s-i),r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2/(n-o),r[11]=0,r[12]=(t+e)/(t-e),r[13]=(i+s)/(i-s),r[14]=(n+o)/(n-o),r[15]=1,r}function ft(t,e,i,s,n=new gt(16)){var o=t[0],r=t[1],a=t[2],h=t[3],c=t[4],l=t[5],d=t[6],u=t[7],g=t[8],m=t[9],f=t[10],p=t[11],_=t[12],w=t[13],y=t[14],v=t[15];return t!==n&&(n[0]=o,n[1]=r,n[2]=a,n[3]=h,n[4]=c,n[5]=l,n[6]=d,n[7]=u,n[8]=g,n[9]=m,n[10]=f,n[11]=p),n[12]=o*e+c*i+g*s+_,n[13]=r*e+l*i+m*s+w,n[14]=a*e+d*i+f*s+y,n[15]=h*e+u*i+p*s+v,n}const pt=[0,0,0,1,1,0,1,0,0,1,1,1];function _t(e,i,s){const n=t,o=e[n(1065)]();if(e.attachShader(o,yt(wt(e,e[n(786)],i))),e.attachShader(o,yt(wt(e,e[n(1464)],s))),e[n(303)](o),e[n(1850)](o,e[n(2179)]))return o;console[n(2018)](e.getProgramInfoLog(o)),e[n(1035)](o)}function wt(e,i,s){const n=t,o=yt(e[n(1634)](i));if(e[n(1707)](o,s),e[n(1354)](o),e[n(2136)](o,e.COMPILE_STATUS))return o;console.error(e[n(1779)](o),{source:s}),e[n(297)](o)}function yt(e){if(!e)throw new Error(t(1219));return e}function vt(){return[new Float32Array(16),new Float32Array(16)]}function bt(e,i,s,n,o){const r=t;mt(0,e.canvas[r(1847)]/window[r(1988)],e[r(890)][r(1096)]/window[r(1988)],0,-1,1,o[0]),ft(o[0],Math[r(597)](e[r(890)].width/window.devicePixelRatio/2)-s[r(1847)]/2*n[r(1905)]+n.x*n[r(1905)],Math[r(597)](e[r(890)][r(1096)]/window.devicePixelRatio/2)-s[r(1096)]/2*n[r(1905)]+n.y*n[r(1905)],0,o[1]),e[r(1137)](i,!1,o[1])}function xt(e,i=e.canvas[t(1847)],s=e[t(890)][t(1096)]){const n=t,o=yt(e[n(1430)]());return e[n(376)](e[n(1140)],o),e[n(2042)](e[n(1140)],e[n(1252)],e.CLAMP_TO_EDGE),e[n(2042)](e[n(1140)],e[n(1685)],e.CLAMP_TO_EDGE),e[n(2042)](e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e[n(870)]),e[n(2042)](e[n(1140)],e[n(1684)],e[n(870)]),e[n(1619)](e[n(1140)],0,e[n(864)],i,s,0,e[n(864)],e.UNSIGNED_BYTE,null),o}const It="#version 300 es\nlayout (location = 0"+t(386)+"u_matrix"+t(1154)+t(621)+t(1100);class St extends e.JT{constructor(e,i,s){const n=t;super(),this[n(851)]=e,this._imageService=i,this[n(2109)]=s,this[n(1560)]=2,this[n(1028)]=new Float32Array(8),this[n(1966)]=vt(),this._positionsNeedsUpdate=!0,this[n(1183)]=!0;const o=this[n(851)];this[n(2157)]=yt(_t(o,It,"#version 300 es\nprecision mediump float;\n\nout vec4 outColor;\n\nvoid main() {\n  outColor = vec4(0, 0, 0, 1);\n}")),this[n(2205)]=yt(o.createVertexArray()),o[n(2107)](this[n(2205)]),this[n(1253)]=yt(o[n(1713)]()),this[n(688)]=yt(o[n(384)](this[n(2157)],"u_matrix")),o[n(1009)](o.ARRAY_BUFFER,this[n(1253)]),o.enableVertexAttribArray(0),o[n(679)](0,2,o[n(1030)],!1,0,0),this[n(2163)](this[n(1008)].onChangedDimensions((()=>{const t=n;this[t(1169)]=!0,this[t(1183)]=!0}))),this.register(this._viewportService.onUpdate((()=>{const t=n;this._matrixNeedsUpdate=!0,this[t(1169)]=!0})))}render(){const e=t;if(!this._imageService[e(1068)])return;const i=this[e(851)];i.useProgram(this[e(2157)]),i[e(2107)](this[e(2205)]),this[e(1043)](i,this[e(2109)]),this[e(1431)](i,this._viewportService),i[e(668)](i[e(1466)],0,4)}_updateAttributeBuffers(e,i){const s=t;this[s(1169)]&&(e.bindVertexArray(this[s(2205)]),e.bindBuffer(e[s(1546)],this._positionBuffer),1===window[s(1988)]?(this[s(1028)][0]=this[s(1028)][2]=-.5,this._positionsArray[1]=this._positionsArray[7]=-.5,this._positionsArray[4]=this[s(1028)][6]=this._imageService[s(1847)]*i[s(1905)]+.5,this._positionsArray[3]=this[s(1028)][5]=this[s(1008)].height*i[s(1905)]+.5):(this._positionsArray[0]=this[s(1028)][2]=0,this[s(1028)][1]=this[s(1028)][7]=0,this[s(1028)][4]=this[s(1028)][6]=this._imageService[s(1847)]*i[s(1905)],this._positionsArray[3]=this[s(1028)][5]=this[s(1008)].height*i[s(1905)]),e[s(830)](e[s(1546)],this._positionsArray,e[s(1601)]),this[s(1169)]=!1)}[t(1431)](e,i){const s=t;this._matrixNeedsUpdate&&(bt(e,this[s(688)],this[s(1008)],i,this[s(1966)]),this[s(1183)]=!1)}}var Ct=i(3318),Et=i.n(Ct),Tt=i(3716),Lt=i.n(Tt),Dt=i(4738),At=i.n(Dt),Rt=i(7542),Mt=i.n(Rt),Bt=i(98),kt=i.n(Bt),Ut=i(7034),Pt=i.n(Ut);const Ft=new Map([[t(1349),1],[t(1408),28],[t(1995),3],[t(1939),4],[t(872),6],[t(1589),8],[t(1709),9],[t(1835),11],[t(896),13],[t(609),14],["difference",20],[t(441),21]]),Nt=new Int32Array([0,1,2,3,4,5,6]);let Vt=0;class Ot extends e.JT{constructor(e,i,n){const o=t;super(),this[o(851)]=e,this[o(1008)]=i,this[o(2109)]=n,this.order=1,this[o(2211)]=[],this[o(1201)]=!1,this._renderLayers=new Map,this[o(1052)]=new Float32Array(2),this[o(1254)]=new Int32Array(8);const r=this[o(851)];this._program=yt(_t(r,Lt(),Et())),this._vertexArrayObject=yt(r.createVertexArray()),r[o(2107)](this[o(2205)]),0===Vt&&(Vt=r[o(2024)](r[o(1478)]));const a=r[o(1490)](this[o(2157)],o(948));this[o(1253)]=yt(r[o(1713)]()),r.bindBuffer(r[o(1546)],this[o(1253)]),r[o(830)](r[o(1546)],new Float32Array(pt),r.STATIC_DRAW),r[o(912)](a),r.vertexAttribPointer(a,2,r[o(1030)],!1,0,0);const h=r.getAttribLocation(this._program,o(759));this[o(1545)]=yt(r[o(1713)]()),r.bindBuffer(r[o(1546)],this[o(1545)]),r[o(830)](r[o(1546)],new Float32Array(pt),r[o(1601)]),r[o(912)](h),r[o(679)](h,2,r[o(1030)],!1,0,0),this[o(1077)]=yt(r.getUniformLocation(this[o(2157)],"a")),this[o(1291)]=yt(r[o(384)](this._program,"b")),this[o(569)]=yt(r.getUniformLocation(this[o(2157)],"c")),this[o(1737)]=yt(r[o(384)](this[o(2157)],"l")),this._frameBufferUniformLocation=yt(r[o(384)](this[o(2157)],"n")),this[o(464)]=yt(r[o(384)](this._program,"m")),this[o(338)]=yt(r[o(384)](this[o(2157)],"h")),this[o(805)]=yt(r[o(384)](this._program,"d")),this[o(2006)]=yt(r[o(384)](this[o(2157)],"f")),this._imageDimensionsUniformLocation=yt(r[o(384)](this[o(2157)],"g")),this[o(449)]=yt(r[o(384)](this._program,"j")),this[o(731)]=yt(r[o(384)](this[o(2157)],"k")),this._flippedAxisUniformLocation=yt(r[o(384)](this._program,"o")),this[o(1855)]=yt(r.createFramebuffer()),this._nullTexture=yt(r[o(1430)]()),r[o(486)](r[o(1518)]),r.bindTexture(r[o(1140)],this[o(411)]),r[o(2042)](r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r[o(667)]),r[o(2042)](r[o(1140)],r[o(1684)],r[o(870)]),r[o(2042)](r[o(1140)],r[o(1252)],r[o(1768)]),r[o(2042)](r[o(1140)],r[o(1685)],r.CLAMP_TO_EDGE),r[o(1619)](r[o(1140)],0,r.RGBA,1,1,0,r[o(864)],r[o(1731)],new Uint8Array([255,255,255,255])),this[o(2163)](this._imageService[o(1025)]((t=>{const e=o;typeof t===e(623)&&typeof this[e(1201)]===e(623)?this[e(1201)]=(0,s.qi)(t,this[e(1201)]):this._needsAttributeUpdate=!0}))),this.register(this[o(1008)][o(1827)]((()=>{const t=o;this[t(1201)]=!0,this[t(1748)]()}))),this[o(2163)](this[o(2109)].onZoomChange((()=>{this[o(1748)]()}))),this[o(1043)](),this[o(1748)](),this[o(2217)]()}resize(){const e=t,i=this[e(851)];for(;this[e(2211)][e(961)]>0;)i.deleteTexture(this[e(2211)][e(2003)]());this._frameBufferRenderBuffer&&(i[e(306)](this[e(1660)]),this[e(1660)]=void 0),this[e(1846)]?.[e(1016)](),this[e(1174)]?.[e(1016)](),this[e(2217)]()}[t(331)](){const e=t,i=this[e(1008)][e(1735)];if(0===i[e(961)])return;this[e(1201)]&&(!0===this[e(1201)]?this._updateAttributeBuffers():this[e(1043)](this[e(1201)]));const n=this[e(851)];n.useProgram(this[e(2157)]),n[e(2107)](this[e(2205)]),n[e(2029)](n[e(1600)],null),n[e(1547)](n.BLEND);const o=this[e(2109)],r=this[e(1008)];let a=-1,h=null;const c=[],l=[],d=[],u=[],g=[];let m=!1;for(const t of i){if(!t[e(2115)])continue;const i=this[e(911)][e(1270)](t.id);if(i){const o=t===this[e(1008)].currentLayer;let r;o?r=l:m?((0===g[e(961)]||7===g[g[e(961)]-1][0][e(961)])&&g[e(2226)]([]),r=g[g.length-1]):((0===c[e(961)]||7===c[c[e(961)]-1][0][e(961)])&&c.push([]),r=c[c[e(961)]-1]);for(let t=0;t<i[e(373)][e(961)];t++)!r[t]&&(r[t]=[]),r[t].push(i[e(373)][t]);if(o)if(m=!0,t[e(2219)]?.[e(1653)]!==e(1422)&&t[e(2219)]?.[e(1653)]!==e(617)&&t[e(2219)]?.[e(1653)]!==e(2199)||!this[e(1008)][e(1068)][e(2219)][e(1582)]?.[e(1496)]){if(t[e(2219)]?.[e(1653)]===e(528)&&t.temporaryLayer[e(1539)][e(1109)].isReady){const i=t[e(2219)];if(this._cachedMovingLayer?.[e(2219)]!==i){if(this[e(789)]?.[e(853)]){for(const t of this[e(789)][e(853)][e(373)])n[e(862)](t.texture);this[e(789)]=void 0}const t=(i[e(399)]?.[e(1496)]?i[e(399)]?.[e(1263)]:void 0)||i.staticState[e(1109)].resource,o=yt(n[e(1430)]());n[e(486)](n[e(1518)]+0),n[e(376)](n[e(1140)],o),n[e(2042)](n[e(1140)],n.TEXTURE_MIN_FILTER,n[e(667)]),n[e(2042)](n[e(1140)],n[e(1684)],n.NEAREST),n[e(2042)](n[e(1140)],n[e(1252)],n.CLAMP_TO_EDGE),n[e(2042)](n[e(1140)],n[e(1685)],n[e(1768)]),n[e(1619)](n[e(1140)],0,n[e(864)],t.width,t[e(1096)],0,n[e(864)],n[e(1731)],t.data),this[e(789)]={temporaryLayer:i,renderLayer:{tiles:[{blendMode:Ft.get(this[e(1008)].currentLayer.blendMode),texture:o,textureImage:t,range:(0,s.DI)(t[e(1847)],t[e(1096)]),width:t[e(1847)],height:t.height,scaledWidth:i[e(752)].scaledWidth,scaledHeight:i[e(752)][e(1693)],offsetX:i[e(752)][e(1676)],offsetY:i[e(752)][e(586)],flipX:i[e(752)].flipX,flipY:i[e(752)][e(577)]}]}}}else{const t=this._cachedMovingLayer.renderLayer[e(373)][0];if(t[e(1676)]=i[e(752)][e(1676)],t[e(586)]=i[e(752)][e(586)],t.flipX=i[e(752)].flipX,t[e(577)]=i[e(752)][e(577)],t[e(533)]=Ft[e(1270)](this[e(1008)][e(1068)][e(533)]),t[e(1985)]=i[e(752)].scaledWidth,t.scaledHeight=i[e(752)].scaledHeight,i.scaledImage?.[e(1496)]&&t.textureImage!==i[e(399)][e(1263)]){n[e(862)](t[e(852)]);const s=yt(n[e(1430)]());n[e(486)](n[e(1518)]+0),n[e(376)](n[e(1140)],s),n[e(2042)](n.TEXTURE_2D,n[e(2216)],n[e(667)]),n[e(2042)](n.TEXTURE_2D,n[e(1684)],n[e(870)]),n[e(2042)](n[e(1140)],n[e(1252)],n.CLAMP_TO_EDGE),n[e(2042)](n.TEXTURE_2D,n[e(1685)],n[e(1768)]),n.texImage2D(n.TEXTURE_2D,0,n[e(864)],i[e(399)][e(1263)].width,i[e(399)][e(1263)][e(1096)],0,n.RGBA,n[e(1731)],i[e(399)][e(1263)][e(1218)]),t[e(852)]=s,t[e(564)]=i[e(399)][e(1263)]}}0!==this._cachedMovingLayer[e(853)][e(373)][0][e(1693)]&&0!==this[e(789)][e(853)][e(373)][0][e(1985)]&&d.push(this[e(789)][e(853)][e(373)])}}else{const i=t[e(2219)];if(this[e(1328)]?.[e(2219)]!==i){if(this[e(1328)]?.[e(853)]){for(const t of this[e(1328)][e(853)][e(373)])n.deleteTexture(t[e(852)]);this._cachedVectorLayer=void 0}const t=(i.imageTexture?.isReady?i[e(1582)]?.[e(1263)]:void 0)||void 0,o=i[e(1220)];if(t&&o){const r=yt(n[e(1430)]());n[e(486)](n[e(1518)]+0),n[e(376)](n.TEXTURE_2D,r),n[e(2042)](n[e(1140)],n[e(2216)],n.LINEAR),n[e(2042)](n[e(1140)],n[e(1684)],n.NEAREST),n.texParameteri(n[e(1140)],n[e(1252)],n[e(1768)]),n.texParameteri(n[e(1140)],n.TEXTURE_WRAP_T,n[e(1768)]),n[e(1619)](n.TEXTURE_2D,0,n[e(864)],t.width,t[e(1096)],0,n[e(864)],n[e(1731)],t[e(1218)]),this._cachedVectorLayer={temporaryLayer:i,renderLayer:{tiles:[{blendMode:Ft[e(1270)](this._imageService[e(1068)][e(533)]),texture:r,textureImage:t,width:t[e(1847)],height:t.height,range:(0,s.DI)(t[e(1847)],t[e(1096)]),offsetX:o[e(702)],offsetY:o[e(632)]}]}}}}else{const t=this[e(1328)][e(853)][e(373)][0];t[e(533)]=Ft.get(this._imageService[e(1068)].blendMode);const o=(i[e(1582)]?.[e(1496)]?i[e(1582)]?.resource:void 0)||void 0,r=i[e(1220)];if(o&&r&&t[e(564)]!==o){n[e(862)](t[e(852)]);const i=yt(n[e(1430)]());n[e(486)](n[e(1518)]+0),n[e(376)](n[e(1140)],i),n[e(2042)](n.TEXTURE_2D,n[e(2216)],n.LINEAR),n[e(2042)](n[e(1140)],n[e(1684)],n[e(870)]),n[e(2042)](n[e(1140)],n[e(1252)],n[e(1768)]),n[e(2042)](n.TEXTURE_2D,n.TEXTURE_WRAP_T,n[e(1768)]),n[e(1619)](n.TEXTURE_2D,0,n[e(864)],o[e(1847)],o[e(1096)],0,n.RGBA,n[e(1731)],o.data),t[e(852)]=i,t[e(564)]=o,t.width=o[e(1847)],t[e(1096)]=o[e(1096)],t[e(1767)]=(0,s.DI)(o[e(1847)],o.height),t[e(1676)]=r[e(702)],t[e(586)]=r[e(632)]}}this[e(1328)]&&u[e(2226)](this[e(1328)][e(853)][e(373)])}}}const f=[];f.push(...c),l[e(961)]>0&&f[e(2226)](l),d[e(961)]>0&&f[e(2226)](d),f.push(...g);for(const[t,i]of f.entries()){let s;if(t<f[e(961)]-1?(s=this[e(1054)](n,++a),n[e(2029)](n[e(1600)],this[e(1855)]),n.framebufferTexture2D(n[e(1600)],n[e(511)],n[e(1140)],s,0)):n[e(2029)](n[e(1600)],null),i===l&&this._imageService[e(1068)][e(2219)]?.type===e(1101)){const c=this[e(1008)].currentLayer[e(2219)];!s&&(s=this[e(1054)](n,++a),n.bindFramebuffer(n[e(1600)],this[e(1855)]),n.framebufferTexture2D(n[e(1600)],n[e(511)],n[e(1140)],s,0)),this[e(1626)](n,i,!1,!1,r,o),n[e(376)](n.TEXTURE_2D,null),!this[e(1174)]&&(this[e(1174)]=new zt(n,this[e(2109)]));const l=Ft[e(1270)](c[e(752)][e(533)]),d=c[e(1962)](),u=this[e(1174)][e(1912)](this[e(1008)].currentLayer,d);!this._blendShader&&(this[e(1846)]=new Ht(n)),t<f[e(961)]-1?(s=this[e(1846)][e(815)](s,u,l),h&&(s=this[e(1846)][e(815)](h,s,i[0][0][e(533)]))):h?(s=this[e(1846)].blend(s,u,l),this[e(1846)].blend(h,s,i[0][0][e(533)],!1)):this._blendShader[e(815)](s,u,l,!1),n[e(337)](this._program),n.bindVertexArray(this[e(2205)])}else if(i!==l||"line"!==this[e(1008)][e(1068)][e(2219)]?.[e(1653)]&&"shape"!==this[e(1008)].currentLayer.temporaryLayer?.type&&this[e(1008)][e(1068)][e(2219)]?.[e(1653)]!==e(2199)||!this._imageService[e(1068)][e(2219)][e(1582)])i===l&&d[e(961)]>0?(n.activeTexture(n.TEXTURE0+7),n[e(376)](n[e(1140)],h||this[e(411)]),this[e(1660)]?n.bindRenderbuffer(n[e(1807)],this[e(1660)]):(this[e(1660)]=yt(n[e(1235)]()),n.bindRenderbuffer(n.RENDERBUFFER,this[e(1660)]),n.renderbufferStorage(n[e(1807)],n[e(1668)],n[e(890)][e(1847)],n[e(890)][e(1096)])),n.framebufferRenderbuffer(n.FRAMEBUFFER,n[e(1284)],n[e(1807)],this[e(1660)]),n.clear(n[e(339)]|n[e(1598)]|n[e(582)]),n[e(2151)](n.STENCIL_TEST),n[e(1936)](n[e(1575)],1,255),n[e(1599)](n[e(2085)],n[e(2085)],n[e(1548)]),n[e(1787)](!1,!1,!1,!1),this[e(1626)](n,d,!1,!0,r,o),n[e(1936)](n[e(1919)],1,255),n[e(1599)](n[e(2085)],n.KEEP,n[e(2085)]),n.colorMask(!0,!0,!0,!0),this[e(1626)](n,i,!1,!1,r,o),n[e(376)](n.TEXTURE_2D,null),n[e(1547)](n[e(776)]),h&&(n[e(991)](n[e(1600)],n[e(1284)],n[e(1807)],null),n[e(2048)](n[e(1807)],null),!this[e(1846)]&&(this[e(1846)]=new Ht(n)),s=this._blendShader.blend(h,s,i[0][0].blendMode),n.useProgram(this[e(2157)]),n[e(2107)](this[e(2205)]))):(n[e(486)](n[e(1518)]+7),n.bindTexture(n[e(1140)],h||this[e(411)]),this[e(1626)](n,i,!!h,!1,r,o),n[e(376)](n[e(1140)],null));else{const c=this._imageService[e(1068)][e(2219)];!s&&(s=this._getFrameBufferTexture(n,++a),n[e(2029)](n.FRAMEBUFFER,this[e(1855)]),n[e(503)](n[e(1600)],n[e(511)],n[e(1140)],s,0)),this[e(1626)](n,i,!1,!1,r,o),n.bindTexture(n[e(1140)],null);const l=xt(n);n[e(503)](n[e(1600)],n.COLOR_ATTACHMENT0,n.TEXTURE_2D,l,0),this[e(1626)](n,u,!1,!1,r,o);const d=Ft[e(1270)](c[e(752)][e(533)]);n[e(376)](n[e(1140)],null),n[e(991)](n[e(1600)],n[e(1284)],n.RENDERBUFFER,null),n[e(2048)](n[e(1807)],null),!this._blendShader&&(this[e(1846)]=new Ht(n)),t<f[e(961)]-1?(s=this._blendShader.blend(s,l,d),h&&(s=this._blendShader.blend(h,s,i[0][0].blendMode))):h?(s=this[e(1846)][e(815)](s,l,d),this[e(1846)][e(815)](h,s,i[0][0][e(533)],!1)):this[e(1846)][e(815)](s,l,d,!1),n.useProgram(this[e(2157)]),n[e(2107)](this[e(2205)])}s&&(h=s)}}_getFrameBufferTexture(e,i){const s=t;for(;this[s(2211)][s(961)]<i+1;)this._frameBufferTextures[s(2226)](xt(e));return this._frameBufferTextures[i]}[t(1626)](e,i,s,n,o,r){const a=t,h=new Float32Array(16),c=Math.round(e.canvas[a(1847)]/window[a(1988)]/2)-o[a(1847)]/2*r[a(1905)]+r.x*r.zoom,l=Math[a(597)](e[a(890)].height/window[a(1988)]/2)-o[a(1096)]/2*r.zoom+r.y*r[a(1905)];for(const t of i){const i=t[0];ft(this[a(1208)],c+i.range[a(702)]*r.zoom,l+i.range[a(632)]*r[a(1905)],0,h),e[a(2223)](this[a(1737)],e[a(890)][a(1847)],e[a(890)][a(1096)]),e[a(868)](this[a(1264)],7),e[a(868)](this._blendWithframeBufferUniformLocation,s?1:0),e[a(1137)](this[a(1077)],!1,h),e.uniform1iv(this[a(449)],Nt),e.uniform2f(this._zoomLocation,this[a(1052)][0],this[a(1052)][1]);let d=0;for(;d<t[a(961)];d++)this._uniformValueBlendModes[d]=t[d][a(533)],e.activeTexture(e.TEXTURE0+d),e.bindTexture(e[a(1140)],t[d][a(852)]);for(;d<=6;d++)e[a(486)](e[a(1518)]+d),e[a(376)](e.TEXTURE_2D,this._nullTexture);e[a(1202)](this[a(569)],this[a(1254)]),e.uniform1i(this[a(338)],t[a(961)]),e[a(2223)](this[a(805)],i[a(1676)]||0,i[a(586)]||0),e.uniform2f(this._tileScaledDimensionsUniformLocation,i.scaledWidth??i.width,i[a(1693)]??i[a(1096)]),e[a(2223)](this[a(629)],o.width,o[a(1096)]),e[a(868)](this[a(731)],n?1:0),e[a(2223)](this[a(309)],i.flipX?1:0,i[a(577)]?1:0),e.drawArrays(e[a(2140)],0,6)}}[t(1043)](e){const i=t;if(0===this[i(1008)][i(1735)][i(961)])return;this[i(1201)]=!1;const s=this[i(851)];s[i(2107)](this[i(2205)]);for(const t of this[i(1008)][i(1735)])this._updateAttributeBuffersForLayer(s,t,e)}[t(1360)](e,i,s){const n=t;e[n(2107)](this._vertexArrayObject);let o=this[n(911)][n(1270)](i.id);!o&&(o={tiles:[]},this[n(911)][n(2112)](i.id,o)),this._updateRenderLayerTiles(e,o,i,s)}[t(594)](e,i,n,o){const r=t,a=n.width,h=Math[r(509)](n[r(1096)]/128);let c=0;i[r(373)][r(961)]=h;for(let t=0;t<h;t++){const l=c,d=Math[r(597)](n.height/h*(t+1)),u=d-c;c=d;const g={top:l,bottom:d,left:0,right:a};if(i.tiles[t]){if(o&&!(0,s.b8)(o,g))continue;e[r(862)](i[r(373)][t][r(852)])}const m=yt(e[r(1430)]());i[r(373)][t]={width:a,height:u,range:g,texture:m,blendMode:Ft.get(n[r(533)])||1},n[r(1676)]&&(i[r(373)][t][r(1676)]=n[r(1676)]),n.offsetY&&(i.tiles[t][r(586)]=n.offsetY),e.activeTexture(e[r(1518)]+0),e[r(376)](e.TEXTURE_2D,m),e[r(2042)](e[r(1140)],e[r(2216)],e.LINEAR),e[r(2042)](e.TEXTURE_2D,e[r(1684)],e[r(870)]),e[r(2042)](e[r(1140)],e[r(1252)],e.CLAMP_TO_EDGE),e[r(2042)](e.TEXTURE_2D,e[r(1685)],e[r(1768)]),e[r(1619)](e.TEXTURE_2D,0,e.RGBA,a,u,0,e[r(864)],e[r(1731)],n[r(1218)],l*n[r(1847)]*4)}}_updateUniformValueZoom(){const e=t;this[e(1052)][0]=this[e(2109)][e(1905)]*this[e(1008)].width,this[e(1052)][1]=this[e(2109)][e(1905)]*this[e(1008)][e(1096)]}[t(2217)](){const e=t;this[e(1208)]=mt(0,this._gl[e(890)][e(1847)]/window.devicePixelRatio,this[e(851)][e(890)][e(1096)]/window[e(1988)],0,-1,1)}}class Ht{constructor(e){const i=t;this[i(851)]=e;const s=this._gl;this._program=yt(_t(s,Mt(),At())),this[i(2205)]=yt(s[i(733)]()),s[i(2107)](this[i(2205)]),this[i(1855)]=yt(s[i(840)]()),this[i(664)]=xt(s),s[i(2029)](s.FRAMEBUFFER,this[i(1855)]);const n=s.createBuffer();s[i(1009)](s[i(1546)],n),s[i(830)](s[i(1546)],new Float32Array([-1,-1,-1,1,1,-1,1,-1,-1,1,1,1]),s[i(1601)]),s.enableVertexAttribArray(0),s.vertexAttribPointer(0,2,s.FLOAT,!1,0,0),this._textureAUniformLocation=yt(s[i(384)](this._program,"b")),this[i(2020)]=yt(s[i(384)](this[i(2157)],"c")),this[i(415)]=yt(s[i(384)](this[i(2157)],"a"))}[t(815)](e,i,s,n=!0){const o=t,r=this[o(851)];return r[o(337)](this[o(2157)]),r[o(2107)](this[o(2205)]),n?(r[o(2029)](r[o(1600)],this._frameBuffer),r[o(503)](r[o(1600)],r[o(511)],r[o(1140)],this[o(664)],0)):r[o(2029)](r[o(1600)],null),r[o(486)](r[o(1518)]),r[o(376)](r[o(1140)],e),r.uniform1i(this[o(1888)],0),r[o(486)](r[o(1518)]+1),r[o(376)](r[o(1140)],i),r[o(868)](this[o(2020)],1),r[o(868)](this[o(415)],s),r.drawArrays(r[o(2140)],0,6),r[o(486)](r[o(1518)]),r.bindTexture(r.TEXTURE_2D,null),r[o(486)](r[o(1518)]+1),r.bindTexture(r[o(1140)],null),r[o(2029)](r[o(1600)],null),this._frameBufferTexture}[t(1016)](){const e=t;this[e(851)].deleteTexture(this._frameBufferTexture),this[e(664)]=xt(this[e(851)])}}class zt{constructor(e,i){const s=t;this[s(851)]=e,this[s(2109)]=i,this[s(1966)]=vt();const n=this[s(851)];this._program=yt(_t(n,Pt(),kt())),this[s(2205)]=yt(n[s(733)]()),n[s(2107)](this[s(2205)]),this._colorUniformLocation=yt(n[s(384)](this[s(2157)],"c")),this._matrixUniformLocation=yt(n[s(384)](this[s(2157)],"a")),this._zoomUniformLocation=yt(n[s(384)](this._program,"b")),this[s(1855)]=yt(n[s(840)]()),this._frameBufferTexture=xt(n),n[s(2029)](n[s(1600)],this[s(1855)]),this[s(354)]=yt(n.createBuffer()),n[s(1009)](n[s(1546)],this[s(354)]),n[s(912)](0),n[s(679)](0,2,n[s(1030)],!1,0,0)}[t(1912)](e,i){const s=t,n=this._gl;n[s(337)](this[s(2157)]),n[s(2107)](this[s(2205)]),n[s(2029)](n[s(1600)],this[s(1855)]),n[s(503)](n[s(1600)],n[s(511)],n[s(1140)],this._frameBufferTexture,0),n[s(1778)](n.COLOR_BUFFER_BIT),bt(n,this[s(1077)],e,this[s(2109)],this[s(1966)]),n[s(2223)](this[s(2164)],this._viewportService[s(1905)],this[s(2109)].zoom);for(const t of i){n[s(650)](this._colorUniformLocation,t[s(736)][0]/255,t.color[1]/255,t.color[2]/255,t[s(736)][3]/255),n.bindBuffer(n[s(1546)],this[s(354)]);const e=new Float32Array(12*t[s(1237)][s(961)]);for(let i=0;i<t[s(1237)][s(961)];i++){const n=t[s(1237)][i],o=12*i;e[o]=e[o+2]=e[o+8]=n.left,e[o+1]=e[o+5]=e[o+7]=n[s(632)],e[o+4]=e[o+6]=e[o+10]=n[s(557)],e[o+3]=e[o+9]=e[o+11]=n[s(719)]}n[s(830)](n[s(1546)],e,n[s(1981)]),n.drawArrays(n.TRIANGLES,0,e[s(961)]/2)}return this[s(664)]}resize(){const e=t;this[e(851)][e(862)](this._frameBufferTexture),this._frameBufferTexture=xt(this[e(851)])}}const Wt=t(1369)+0+t(386)+t(621)+t(1154)+t(621)+t(1100),jt=t(494)+"u_color"+t(352)+t(315)+";\n}";class qt extends e.JT{constructor(e,i,s){const n=t;super(),this[n(851)]=e,this[n(1008)]=i,this[n(2109)]=s,this.order=2,this._positionsArray=new Float32Array(48),this[n(1966)]=vt(),this._positionsNeedsUpdate=!0,this[n(1183)]=!0,this[n(2102)]=new Float32Array(4);const o=this[n(851)];this[n(2157)]=yt(_t(o,Wt,jt)),this._vertexArrayObject=yt(o[n(733)]()),o[n(2107)](this[n(2205)]),this._positionBuffer=yt(o[n(1713)]()),this[n(2215)]=yt(o[n(384)](this[n(2157)],n(315))),this[n(688)]=yt(o.getUniformLocation(this._program,n(621))),this[n(1279)](),o.bindBuffer(o[n(1546)],this._positionBuffer),o[n(912)](0),o[n(679)](0,2,o.FLOAT,!1,0,0),this.register(this[n(1008)][n(1827)]((()=>{this[n(1169)]=!0,this._matrixNeedsUpdate=!0}))),this[n(2163)](this[n(2109)][n(1025)]((()=>{const t=n;this[t(1183)]=!0,this[t(1169)]=!0})))}[t(1279)](e=3){const i=t,s=window[i(701)](document.documentElement)[i(1076)](i(2119))[i(1544)]();if(!s&&e>0)return void setTimeout((()=>this[i(1279)](--e)),0);const n=function(e){const i=t;switch(e[i(961)]){case 7:return(parseInt(e[i(1815)](1),16)<<8|255)>>>0;case 9:return parseInt(e.slice(1),16)>>>0}throw new Error("css.toColor: Unsupported css format")}(s||i(1857));this._backgroundColor[0]=(n>>24&255)/255,this[i(2102)][1]=(n>>16&255)/255,this[i(2102)][2]=(n>>8&255)/255,this._backgroundColor[3]=(255&n)/255}[t(331)](){const e=t;if(!this[e(1008)][e(1068)])return;const i=this[e(851)];i[e(337)](this[e(2157)]),i[e(2107)](this[e(2205)]),i.disable(i.BLEND),i.uniform4f(this._colorLocation,this[e(2102)][0],this[e(2102)][1],this[e(2102)][2],this[e(2102)][3]),this[e(1043)](i,this[e(2109)]),this[e(1431)](i,this[e(2109)]),i.drawArrays(i[e(924)],0,24)}[t(1043)](e,i){const s=t;if(!this[s(1169)])return;e[s(2107)](this._vertexArrayObject),e[s(1009)](e[s(1546)],this[s(1253)]);const n=this[s(1673)](),o=this[s(1028)];o[0]=o[2]=o[36]=o[38]=o[40]=o[44]=n[s(702)],o[4]=o[6]=o[32]=o[34]=o[42]=o[46]=0,o[8]=o[10]=o[18]=o[22]=o[26]=o[28]=o[30]=this[s(1008)][s(1847)]*i[s(1905)],o[12]=o[14]=o[16]=o[20]=o[24]=n[s(557)],o[1]=o[5]=o[9]=o[13]=n.top,o[3]=o[7]=o[11]=o[15]=o[17]=o[19]=o[45]=o[47]=0,o[21]=o[23]=o[31]=o[35]=o[39]=o[41]=o[43]=this._imageService.height*i.zoom,o[25]=o[27]=o[29]=o[33]=o[37]=n.bottom,e[s(830)](e[s(1546)],this[s(1028)],e[s(1601)]),this._positionsNeedsUpdate=!1}[t(1431)](e,i){const s=t;this._matrixNeedsUpdate&&(bt(e,this[s(688)],this[s(1008)],i,this[s(1966)]),this[s(1183)]=!1)}_getCanvasBounds(){const e=t,i=this[e(1812)](-1,-1),s=this[e(1812)](this[e(851)][e(890)][e(1847)],this[e(851)][e(890)][e(1096)]);return{left:i[0],top:i[1],right:s[0],bottom:s[1]}}[t(1812)](e,i){const s=t,n=this[s(851)];let o=e-n[s(890)].width/2,r=i-n[s(890)][s(1096)]/2;return o+=this[s(1008)].width*this._viewportService[s(1905)]/2,r+=this[s(1008)][s(1096)]*this[s(2109)][s(1905)]/2,o-=this[s(2109)].x*this[s(2109)][s(1905)],r-=this._viewportService.y*this[s(2109)][s(1905)],[o,r]}}const Gt=t(1369)+0+t(386)+t(621)+t(832)+"u_matrix * a_position;\n  v_position = a_position.xy;\n}",Xt="#version 300 es\nprecision mediump float;\n\nuniform float "+t(939)+t(2133)+t(939)+t(1004)+"u_pixelsize"+t(1725)+t(939)+t(1004)+"u_pixelsize"+t(1363);class Yt extends e.JT{constructor(e,i,s){const n=t;super(),this[n(851)]=e,this[n(1008)]=i,this._viewportService=s,this[n(1560)]=2,this[n(1028)]=new Float32Array(8),this[n(1966)]=vt(),this._positionsNeedsUpdate=!0,this[n(1183)]=!0;const o=this[n(851)];this[n(2157)]=yt(_t(o,Gt,Xt)),this[n(2205)]=yt(o.createVertexArray()),o[n(2107)](this[n(2205)]),this[n(1253)]=yt(o.createBuffer()),this[n(688)]=yt(o[n(384)](this._program,n(621))),this._pixelSizeLocation=yt(o[n(384)](this[n(2157)],n(939))),o[n(1009)](o[n(1546)],this[n(1253)]),o[n(912)](0),o[n(679)](0,2,o[n(1030)],!1,0,0),this[n(2163)](this[n(1008)][n(1827)]((()=>{const t=n;this[t(1169)]=!0,this[t(1183)]=!0}))),this.register(this[n(2109)].onUpdate((()=>{this[n(1183)]=!0,this._positionsNeedsUpdate=!0})))}[t(331)](){const e=t;if(!this[e(1008)].currentLayer)return;if(!this[e(2109)][e(580)]||this._viewportService[e(1905)]<4)return;const i=this._gl;i[e(337)](this[e(2157)]),i[e(2107)](this[e(2205)]),i[e(2151)](i[e(2005)]),i[e(842)](i.SRC_ALPHA,i[e(627)],i[e(508)],i[e(627)]),this[e(1043)](i,this._viewportService),this[e(1431)](i,this[e(2109)]),i[e(856)](this[e(1675)],this._viewportService.zoom/1),i[e(668)](i[e(347)],0,4)}[t(1043)](e,i){const s=t;this._positionsNeedsUpdate&&(e[s(2107)](this._vertexArrayObject),e[s(1009)](e.ARRAY_BUFFER,this[s(1253)]),this[s(1028)][4]=this._positionsArray[6]=this[s(1008)][s(1847)]*i[s(1905)],this[s(1028)][3]=this._positionsArray[5]=this._imageService.height*i[s(1905)],e[s(830)](e[s(1546)],this[s(1028)],e[s(1601)]),this[s(1169)]=!1)}_updateMatrixUniform(e,i){const s=t;this[s(1183)]&&(bt(e,this[s(688)],this[s(1008)],i,this[s(1966)]),this._matrixNeedsUpdate=!1)}}const Jt=t(1369)+0+") in vec4 a_position;\n\nuniform mat4 u_matrix"+t(1154)+t(621)+t(1100),Kt="#version 300 es\nprecision mediump float;\n\nuniform float u_shift"+t(1517)+t(1282)+") / 4., 2.));\n  outColor = vec4(c, c, c, 1);\n}";class $t extends e.JT{constructor(e,i,s,o){const r=t;super(),this._gl=e,this._imageService=i,this[r(540)]=s,this[r(2109)]=o,this.order=2,this._positionsArray=new Float32Array(8),this[r(1966)]=vt(),this[r(1169)]=!1,this._matrixNeedsUpdate=!0,this[r(1473)]=0,this._isAnimating=!1,this[r(1982)]=this.register(new n.v),this[r(926)]=this._onStartAnimating[r(993)],this[r(1285)]=this[r(2163)](new n.v),this[r(2206)]=this[r(1285)][r(993)];const a=this[r(851)];this[r(2157)]=yt(_t(a,Jt,Kt)),this[r(2205)]=yt(a[r(733)]()),a[r(2107)](this[r(2205)]),this[r(1253)]=yt(a[r(1713)]()),this[r(688)]=yt(a[r(384)](this[r(2157)],r(621))),this[r(1656)]=yt(a[r(384)](this[r(2157)],"u_shift")),a[r(1009)](a.ARRAY_BUFFER,this._positionBuffer),a[r(912)](0),a[r(679)](0,2,a[r(1030)],!1,0,0),this[r(2163)](this[r(540)].onUpdate((()=>{const t=r;this[t(1169)]=!0,this[t(1513)]!==!!this[t(540)][t(1767)]&&(this._isAnimating=!!this[t(540)].range,this[t(1513)]?this._onStartAnimating[t(1257)]():this[t(1285)].fire())}))),this[r(2163)](this[r(1008)][r(1827)]((()=>{const t=r;this[t(1183)]=!0,this[t(1169)]=!0}))),this[r(2163)](this[r(2109)].onUpdate((()=>{this[r(1183)]=!0,this._positionsNeedsUpdate=!0})))}render(){const e=t;if(!this._imageService[e(1068)])return;const i=this[e(540)][e(1767)];if(!i)return;const s=this[e(851)];s[e(337)](this[e(2157)]),s[e(2107)](this[e(2205)]),s[e(2151)](s[e(2005)]),s[e(1337)](s[e(619)],s[e(627)]),this[e(1043)](s,i,this[e(2109)]),this[e(1431)](s,this._viewportService),s[e(668)](s[e(1466)],0,4)}updateAnimation(){this[t(678)](this._gl)}_updateAttributeBuffers(e,i,s){const n=t;this._positionsNeedsUpdate&&(e[n(2107)](this[n(2205)]),e[n(1009)](e[n(1546)],this[n(1253)]),1===window[n(1988)]?(this[n(1028)][0]=this._positionsArray[2]=i[n(702)]*s[n(1905)]-.5,this[n(1028)][4]=this[n(1028)][6]=i[n(557)]*s[n(1905)]+.5,this[n(1028)][1]=this._positionsArray[7]=i[n(632)]*s[n(1905)]-.5,this[n(1028)][3]=this._positionsArray[5]=i[n(719)]*s[n(1905)]+.5):(this._positionsArray[0]=this._positionsArray[2]=i[n(702)]*s.zoom,this._positionsArray[4]=this._positionsArray[6]=i[n(557)]*s[n(1905)],this[n(1028)][1]=this[n(1028)][7]=i[n(632)]*s[n(1905)],this[n(1028)][3]=this[n(1028)][5]=i.bottom*s[n(1905)]),e[n(830)](e[n(1546)],this[n(1028)],e.STATIC_DRAW),this._positionsNeedsUpdate=!1)}[t(1431)](e,i){const s=t;this._matrixNeedsUpdate&&(bt(e,this[s(688)],this._imageService,i,this[s(1966)]),this[s(1183)]=!1)}[t(678)](e){const i=t;e.useProgram(this._program),e[i(2107)](this[i(2205)]),this[i(1473)]=(this[i(1473)]+1)%8,e.uniform1f(this[i(1656)],this._shiftValue)}}const Zt=t(1369)+0+") in vec4 a_position;\n\nuniform mat4 "+t(621)+";\n\nvoid main() {\n  gl_Position = u_matrix"+t(1100);class Qt extends e.JT{constructor(e,i,s,n,o){const r=t;super(),this[r(851)]=e,this[r(1008)]=i,this[r(540)]=s,this[r(1586)]=n,this[r(2109)]=o,this[r(1560)]=2,this[r(867)]=new Float32Array(8),this[r(1966)]=vt(),this[r(1169)]=!1,this[r(1183)]=!0;const a=this._gl;this[r(2157)]=yt(_t(a,Zt,"#version 300 es\nprecision mediump float;\n\nout vec4 outColor;\n\nvoid main() {\n  outColor = vec4(0.5, 0.5, 1, 0.5);\n}")),this[r(2205)]=yt(a.createVertexArray()),a[r(2107)](this[r(2205)]),this._positionBuffer=yt(a[r(1713)]()),this._matrixLocation=yt(a[r(384)](this[r(2157)],r(621))),a[r(1009)](a[r(1546)],this[r(1253)]),a.enableVertexAttribArray(0),a[r(679)](0,2,a[r(1030)],!1,0,0),this[r(2163)](this[r(540)].onUpdate((()=>this[r(1169)]=!0))),this[r(2163)](this[r(2109)][r(1025)]((()=>{const t=r;this[t(1169)]=!0,this[t(1183)]=!0})))}[t(331)](){const e=t;if(!this[e(1008)][e(1068)])return;if(!this[e(1586)][e(2059)]?.[e(946)])return;const i=this[e(540)].range;if(!i)return;const s=this._gl;s.useProgram(this[e(2157)]),s[e(2107)](this[e(2205)]),function(e,i){const s=t;if(i!==s(1349))throw new Error("Unrecognized blend mode");e.enable(e[s(2005)]),e[s(842)](e[s(619)],e[s(627)],e.ONE,e[s(627)])}(s,e(1349)),this[e(1043)](s,i,this._viewportService),this[e(1431)](s,this[e(2109)]),s[e(668)](s[e(347)],0,4)}[t(1043)](e,i,s){const n=t;this[n(1169)]&&(e[n(1009)](e.ARRAY_BUFFER,this[n(1253)]),this[n(867)][0]=this[n(867)][2]=i[n(702)]*s[n(1905)],this[n(867)][4]=this[n(867)][6]=i.right*s[n(1905)],this[n(867)][1]=this[n(867)][7]=i[n(632)]*s[n(1905)],this[n(867)][3]=this._positionArray[5]=i[n(719)]*s[n(1905)],e[n(830)](e[n(1546)],this[n(867)],e.DYNAMIC_DRAW),this[n(1169)]=!1)}[t(1431)](e,i){const s=t;this._matrixNeedsUpdate&&(bt(e,this[s(688)],this._imageService,i,this[s(1966)]),this._matrixNeedsUpdate=!1)}}class te extends e.JT{constructor(i,s,n,o,r){const a=t;if(super(),this._container=i,this._imageService=s,this[a(540)]=n,this[a(1586)]=o,this[a(2109)]=r,this._renderPrograms=[],this[a(774)]=[],this[a(942)]=new Set,this[a(1829)]=0,this[a(419)]=0,this[a(1234)]=!1,this._lastAnimationFrame=0,this[a(1578)]=!1,this[a(2148)]=[],this[a(1860)]=[],this._canvas=document[a(1541)](a(890)),this._canvasSelection=document[a(1541)](a(890)),this[a(1781)][a(1777)][a(1492)](a(1941)),this._viewsElement=document[a(1541)]("div"),this[a(1443)][a(1777)][a(1492)](a(342)),this[a(408)][a(813)](this[a(1014)],this[a(1781)],this[a(1443)]),this[a(2163)]({dispose:()=>{const t=a;this[t(1014)].parentElement&&this[t(408)][t(1221)](this[t(1014)]),this[t(1014)][t(1022)]&&this._container.removeChild(this[t(1781)]),this[t(408)][t(1221)](this[t(1443)])}}),this.register(this[a(2109)][a(1979)](((t,e)=>{const i=a;this[i(2066)](t,e),this[i(331)](),this[i(1171)](!0)}))),this[a(2163)](this._viewportService[a(1025)]((()=>{this[a(331)](),this.renderSelection(!0)}))),this.register(this[a(540)][a(1025)]((()=>this.renderSelection(!0)))),this[a(2163)](this[a(1008)][a(1025)]((()=>this[a(331)]()))),this.register(this[a(1008)][a(1636)]((()=>this[a(331)]()))),this[a(2163)](this[a(1008)][a(885)]((()=>this[a(331)]()))),this[a(2163)](this[a(1586)][a(850)]((t=>this.setTool(t)))),this[a(2163)]((0,e.Lw)(this[a(1014)],"webglcontextlost",(()=>this.showError(a(1476))))),!(a(2123)in window)){const t=a(790);throw this.showError(t),new Error(t)}const h=this[a(1014)][a(567)](a(1588),{antialias:!1,premultipliedAlpha:!1,stencil:!0});if(!h){const t=a(1362);throw this[a(1761)](t),new Error(t)}this._gl=h,this[a(1403)]=yt(this._canvasSelection.getContext(a(1588),{antialias:!1})),this[a(2066)](this[a(408)][a(1931)],this[a(408)][a(1168)]),this[a(851)][a(726)](0,0,0,0),this[a(851)].clear(this[a(851)][a(339)]),this[a(1403)][a(726)](0,0,0,0),this._glSelection[a(1778)](this._gl[a(339)]),this[a(516)][a(2226)](new qt(this._gl,this[a(1008)],this[a(2109)])),this._renderPrograms.push(new St(this[a(851)],this[a(1008)],this._viewportService)),this[a(1228)]=new Ot(this[a(851)],this[a(1008)],this[a(2109)]),this[a(516)][a(2226)](new Yt(this._gl,this[a(1008)],this._viewportService)),this[a(774)][a(2226)](new Qt(this._glSelection,this[a(1008)],this._selectionService,this[a(1586)],this[a(2109)])),this[a(774)][a(2226)](new $t(this._glSelection,this[a(1008)],this._selectionService,this[a(2109)]));for(const t of this._animationRenderPrograms)t[a(926)]&&t[a(2206)]&&(t[a(926)]((()=>this[a(2091)](t))),t[a(2206)]((()=>this._stopAnimatingProgram(t))));const c=new MutationObserver((()=>{this[a(2104)](),this.render()}));c.observe(document.documentElement,{attributes:!0,attributeFilter:["style"]}),this[a(2163)]({dispose:()=>c.disconnect()}),this[a(2104)](),this[a(331)]();let l=this._imageService[a(1025)]((()=>{const t=a;this[t(408)][t(1777)][t(1492)](t(1655)),l?.dispose(),l=void 0}));this.register({dispose:()=>l?.[a(835)]()})}_refreshTheme(){const e=t;for(const t of this[e(516)])t[e(1279)]?.()}[t(2066)](e,i){const s=t,n=e*window[s(1988)],o=i*window.devicePixelRatio;this[s(1014)][s(1847)]=n,this[s(1014)].height=o,this[s(1014)][s(1728)].width=e+"px",this[s(1014)].style[s(1096)]=i+"px",this._canvasSelection[s(1847)]=n,this[s(1781)][s(1096)]=o,this[s(1781)].style.width=e+"px",this[s(1781)][s(1728)][s(1096)]=i+"px",this[s(851)][s(838)](0,0,n,o),this._glSelection.viewport(0,0,n,o),this[s(1443)].style.position=s(1087),this[s(1443)][s(1728)][s(702)]="0",this[s(1443)][s(1728)][s(632)]="0",this[s(1443)][s(1728)][s(557)]="0",this._viewsElement[s(1728)].bottom="0",this[s(1228)]?.[s(1016)]()}[t(1680)](){this[t(1578)]=!0}[t(1969)](){const e=t;this[e(1578)]&&(this[e(1578)]=!1,this[e(331)](),this[e(1171)](!0))}render(){const e=t;0===this[e(1829)]&&(this[e(1829)]=window[e(470)]((()=>this[e(1283)]())))}[t(1171)](e=!1){const i=t;if(this._isPaused&&!e)return window[i(826)](this[i(419)]),void(this[i(419)]=0);this[i(1234)]=this._forceSelectionAnimation||e,0===this._selectionAnimationFrame&&(this[i(419)]=window[i(470)]((()=>this[i(1494)]())))}[t(1283)](){const e=t;this[e(1371)](this[e(516)],1),!this[e(1586)][e(2059)]?.isSelectionTool&&this._renderProgramsWithOrder(this[e(2148)],1),this[e(1228)][e(331)](),this[e(1371)](this[e(516)],2),!this[e(1586)].activeTool?.isSelectionTool&&this[e(1371)](this[e(2148)],2),this[e(1829)]=0}[t(1494)](){const e=t,i=!!this[e(540)].range;if(this._canvasSelection[e(1728)][e(2121)]=i?"block":e(1194),this._selectionAnimationFrame=0,!i)return void(this[e(1234)]=!1);const s=this[e(460)]<=Date[e(1706)]()-50;if(!this[e(1234)]&&!s)return this[e(1234)]=!1,void this[e(1171)]();if(this[e(1234)]=!1,s){for(const t of this[e(774)])t[e(1463)]&&t[e(1463)]();this[e(460)]=Date.now()}this[e(942)][e(2015)]>0&&this[e(1371)](this._animationRenderPrograms,2),this._toolService[e(2059)]?.[e(946)]&&this._renderProgramsWithOrder(this[e(2148)],2),this[e(1171)]()}_renderProgramsWithOrder(t,e){for(const i of t)i.order===e&&i.render()}[t(2091)](e){const i=t;this[i(942)][i(1492)](e),this[i(1171)]()}[t(1836)](e){const i=t;this[i(942)][i(1367)](e)}setTool(i){const s=t;(0,e._c)(this._toolDisposables),this[s(1860)].length=0;for(const t of this[s(2148)])t.dispose&&t[s(835)]();let n;this[s(2148)][s(961)]=0,i.createRenderProgram?n=i[s(1122)](this[s(851)]):i[s(880)]&&(n=i[s(880)](this[s(1443)])),n&&(Array[s(2086)](n)?this[s(2148)][s(2226)](...n):this[s(2148)][s(2226)](n),i[s(1636)]&&this[s(1860)][s(2226)](i[s(1636)]((()=>this[s(331)]())))),n&&this[s(331)]()}showError(e){const i=t;this[i(1014)][i(1022)]&&this[i(408)][i(1221)](this[i(1014)]);const s=document[i(1541)](i(1505));s.textContent=e,s[i(1728)][i(1964)]=i(1087),s[i(1728)].left="50%",s[i(1728)].top=i(428),s[i(1728)][i(1978)]=i(1816),this._container[i(1777)][i(554)](i(1655)),this[i(408)].appendChild(s)}showToast(e){const i=t,s=document[i(1541)](i(1505));s.textContent=e,s[i(1777)][i(1492)](i(1687)),this[i(408)].appendChild(s),setTimeout((()=>{const t=i;s[t(1777)].add(t(294)),setTimeout((()=>{s.remove()}),500)}),250)}}class ee extends e.JT{constructor(e,i,s,n,o){const r=t;super(),this[r(1632)]=e,this[r(1008)]=i,this[r(540)]=s,this[r(1586)]=n,this._viewportService=o,this[r(2163)](this._elementService[r(1500)]((t=>this[r(1366)](t)))),this[r(2163)]({dispose:()=>this[r(823)]?.dispose()})}[t(331)](){const e=t;this[e(823)]?.[e(331)]()}pause(){const e=t;this[e(823)]?.[e(1680)]()}[t(1969)](){const e=t;this._renderer?.[e(1969)]()}[t(1366)](e){const i=t;this[i(823)]?.[i(835)](),this._renderer=new te(e,this._imageService,this[i(540)],this[i(1586)],this[i(2109)])}[t(1761)](e){const i=t;this._renderer?.[i(1761)](e)}[t(909)](e){const i=t;this[i(823)]?.[i(909)](e)}}class ie{constructor(e,i,s,n,o){const r=t;this[r(540)]=e,this[r(392)]=i,this[r(1172)]=s,this[r(2176)]=n,this[r(1447)]=o,this.type=r(1435),this[r(727)]=0}[t(1090)](){const e=t;this[e(1714)](this[e(2176)])}[t(568)](){const e=t;this[e(1714)](this[e(1447)])}_apply(e){const i=t;this[i(540)][i(1767)]=e?{left:e[i(702)],top:e[i(632)],right:e[i(557)],bottom:e[i(719)]}:void 0}[t(1644)](){const e=t;return{id:e(1435),operationName:this.operationName,requiresTool:this[e(1172)],undoRange:this[e(2176)],redoRange:this[e(1447)]}}static create(e,i){const s=t;return new ie(e,i.operationName,i[s(1172)],i.undoRange,i[s(1642)])}}class se extends e.JT{constructor(e){const i=t;super(),this[i(1915)]=e,this[i(1817)]=this[i(2163)](new n.v),this.onUpdate=this._onUpdate.event,this[i(1965)]=this[i(2163)](new n.v),this[i(743)]=this[i(1965)][i(993)],this[i(1915)].registerHistoryEntryHandler("selection",{undo:t=>{const e=i;t[e(1090)](this[e(2100)]),this._lastCommittedRange=t[e(2176)]},redo:t=>{const e=i;t[e(568)](this._range),this[e(1142)]=t[e(2176)]}}),this[i(1915)][i(1880)](i(1435),ie[i(522)].bind(null,this))}get[t(1767)](){return this[t(2100)]}set[t(1767)](e){const i=t;if(e&&(e[i(702)]>e[i(557)]||e.top>e[i(719)]))throw new Error(i(2228)+e[i(702)]+i(931)+e[i(557)]+i(728)+e[i(632)]+i(2150)+e[i(719)]);this._range=e,this._onUpdate[i(1257)]()}[t(831)](e,i){const n=t;if(!this[n(2100)])return;const o=(0,s.BN)(this[n(1767)]);(0,s.Hd)(o,e,i),this[n(1767)]=o}[t(2e3)](e,i){const s=t;this[s(2100)]&&(this._range[s(702)]>=e||this[s(2100)][s(632)]>=i||this[s(2100)][s(719)]<=0||this[s(2100)][s(557)]<=0?this[s(2100)]=void 0:this[s(1767)]={left:Math[s(590)](this._range.left,0),top:Math.max(this[s(2100)][s(632)],0),right:Math.min(this._range[s(557)],e),bottom:Math.min(this._range[s(719)],i)})}[t(501)](){const e=t;this[e(1767)]=void 0,this[e(957)](e(1849))}[t(691)](e,i){this[t(1767)]=i,this.commit(e)}[t(957)](e,i){const s=t;if(function(e,i){const s=t;return i&&e?e.left===i[s(702)]&&e[s(632)]===i.top&&e.right===i[s(557)]&&e[s(719)]===i[s(719)]:!e&&!i}(this[s(1142)],this.range))return;const n=new ie(this,e,i,this[s(1142)],this.range);this[s(1915)][s(704)](e,(()=>{const t=s;this[t(1915)][t(2232)](n),this[t(1965)].fire()})),this[s(1142)]=this[s(1767)]}containsCoord(e,i){const s=t;return!this[s(2100)]||e>=this._range[s(702)]&&e<this[s(2100)][s(557)]&&i>=this[s(2100)].top&&i<this._range[s(719)]}serialize(){return this[t(2100)]}[t(817)](e){this[t(1767)]=e}}var ne=i(7166);class oe{constructor(e,i,s){const n=t;this.operationName=e,this[n(1321)]=i,this._f=s}async[t(1538)](){const e=t,i={data:(0,ne.Qf)(this[e(1321)],(0,s.DI)(this[e(1321)][e(1847)],this._layer[e(1096)])),width:this[e(1321)][e(1847)],height:this[e(1321)][e(1096)]};let n;await this._layer[e(351)]((async(t,e,i)=>(n=await this._f(t,e,i),n)));const o={data:(0,ne.Qf)(n,(0,s.DI)(n[e(1847)],n.height)),width:n[e(1847)],height:n[e(1096)]};return new R(this[e(392)],this[e(1321)][e(2012)],this[e(1321)].id,i,o)}}class re{constructor(e,i,s,n){const o=t;this[o(2073)]=e,this._imageService=i,this[o(500)]=s,this[o(1615)]=n}[t(1538)](){const e=t;if(this[e(1008)][e(1847)]===this[e(500)]&&this[e(1008)][e(1096)]===this[e(1615)])return;const i={width:this._imageService.width,height:this[e(1008)].height},s={width:this[e(500)],height:this[e(1615)]},n=new T(this[e(2073)],i,s);return n[e(568)](this[e(1008)][e(1016)].bind(this[e(1008)])),n}}class ae extends e.JT{constructor(e,i,s,o){const r=t;super(),this[r(1915)]=e,this[r(1008)]=i,this[r(540)]=s,this[r(1834)]=o,this._onProgress=this.register(new n.v),this[r(320)]=this[r(649)].event,this[r(1507)]=this[r(2163)](new n.v),this[r(1415)]=this[r(1507)][r(993)]}async[t(1877)](e,i){const s=t,n=this[s(1008)][s(1735)];if(0===n[s(961)])return;await this[s(1507)][s(1378)](this[s(1459)](e));const o={left:0,top:0,right:this[s(1008)][s(1847)],bottom:this[s(1008)].height},r=s(1182)+he(e);await this[s(1915)][s(1908)](r,(async()=>{const t=s;let a;for(const s of n)a=await this[t(1629)](e,i,s,r,o);a&&(a[t(960)].width!==o.right||a[t(960)][t(1096)]!==o[t(719)])&&this._historyService[t(1540)](new re(t(1032),this._imageService,a[t(960)][t(1847)],a[t(960)].height)),a?.[t(1435)]!==this[t(540)][t(1767)]&&(this[t(540)].range=a?.[t(1435)],this[t(540)][t(957)]("Update Selection"))}))}async[t(531)](e,i){const s=t,n=this[s(1008)][s(1068)];if(!n)return;await this[s(1507)][s(1378)](this[s(1459)](e));const o={left:0,top:0,right:n[s(1847)],bottom:n[s(1096)]},r=s(2026)+he(e);await this[s(1915)][s(1908)](r,(async()=>{const t=s,a=await this[t(1629)](e,i,n,r,o);if(a?.selection!==this[t(540)][t(1767)]&&(this[t(540)][t(1767)]=a?.selection,this._selectionService[t(957)](t(1955))),a&&(a[t(960)][t(1847)]!==o.right||a[t(960)][t(1096)]!==o[t(719)]))throw new Error("Cannot resize image in single layer task")}))}async[t(1629)](e,i,s,o,r){const a=t;let h;return await this[a(1915)][a(607)](new oe(o,s,(async(t,s,o)=>{const r=a,c=this[r(1834)][r(766)](e,i,{data:t,width:s,height:o},this[r(540)].range);return(0,n.B)(c.onProgress,this._onProgress),h=await c[r(2188)],h[r(960)]}))),h}[t(1459)](t){return{finishSelection:"layer/expandCanvasToSelection"!==t}}}function he(e){const i=t;switch(e){case i(934):return i(1683);case i(901):return i(658);case i(897):return"Expand Canvas to Selection";case i(2193):return i(1133);case i(2126):return"Flip Vertical";case i(366):return"Invert Colors";case i(1222):return"Resize";case i(1418):return i(1258);case i(2160):return i(661);case i(1302):return i(2034);case i(581):return i(1511);default:return"Unknown"}}function ce(){return new Worker(i.p+"task.worker.worker.js")}const le=new Map;le[t(2112)](t(767),(t=>(0,s.rY)(t.range))),le[t(2112)]("cutImage",(t=>t.cutImage.height)),le[t(2112)](t(710),(()=>1)),le[t(2112)](t(676),(()=>1)),le[t(2112)](t(1069),(()=>1)),le[t(2112)](t(1462),(e=>(0,s.rY)(e[t(1767)]))),le[t(2112)](t(1980),(()=>1)),le[t(2112)](t(432),(()=>1)),le[t(2112)](t(642),(e=>e.destImage[t(1096)])),le[t(2112)](t(1854),(e=>(0,s.rY)(e[t(1718)])));let de=!1;class ue extends e.JT{get[t(1806)](){return de}set[t(1806)](t){de=t}[t(766)](t,e,i,s){return new me(t,e,i,s)}runTask(e,i){const s=t;return new fe(e,i,this._getJobDimension(e,i))[s(2188)]}_getJobDimension(e,i){const s=t,n=le[s(1270)](e);if(!n)throw new Error(s(1581)+e+'"');return n(i)}async generateLayerPreview(e,i,s){const n=t,o={sourceImage:e,destImage:(0,ne.uF)(i,s)};let r;return e[n(1847)]===i&&e[n(1096)]===s?r=new ImageData(new Uint8ClampedArray(o[n(1477)][n(1218)]),i,s):(await this[n(579)]("generatePreview",o),r=new ImageData(new Uint8ClampedArray(o[n(1158)][n(1218)]),i,s)),createImageBitmap(r)}}class ge extends e.JT{constructor(e,i){const s=t;super(),this._name=e,this[s(429)]=i,this._progressLast=0,this._progressTimeout=0,this[s(649)]=this.register(new n.v),this[s(320)]=this[s(649)].event,this[s(1113)]=performance[s(1706)](),this[s(1185)]=setInterval((()=>this[s(454)]()),1e3)}_finish(){const e=t;this[e(1185)]&&(clearInterval(this[e(1185)]),this._reportInterval=0,this[e(454)]())}[t(1968)](e,i){const s=t;this[s(429)][e]=i,this[s(1124)]()}[t(1124)](){const e=t;!this[e(1899)]&&(this[e(1899)]=window[e(1040)]((()=>{const t=e;this[t(807)](),this[t(1899)]=0}),0))}[t(807)](){const e=t,i=this._progress[e(1771)](((t,e)=>t+e),0)/this._progress[e(961)];this._progressLast!==i&&(this[e(649)][e(1257)](i),this[e(773)]=i)}_logProgress(){const e=t,i=this[e(429)][e(1771)](((t,e)=>t+e),0)/this[e(429)][e(961)],s=Math[e(597)](i/.05),n=20-s;let o="["+"â"[e(1382)](s)+" "[e(1382)](n)+"]";if(1===i){const t=" "+(performance.now()-this[e(1113)])[e(660)](0)+e(1909);o="["+t.padStart(t[e(961)]+Math.floor((20-t[e(961)])/2),"â")[e(2208)](20,"â")+"]"}console[e(1021)](o+" "+Math[e(597)](100*i)[e(452)]()[e(2069)](3," ")+"% "+this[e(2132)])}}class me extends ge{constructor(e,i,n,o){const r=t,a=r(1847)in i&&r(1096)in i;let h=a?i[r(1847)]:n[r(1847)],c=a?i.height:n[r(1096)];switch(e){case r(901):if(!o)throw new Error(r(639));const t=(0,s.l$)(o,(0,s.DI)(n[r(1847)],n.height));h=(0,s.Oq)(t),c=(0,s.rY)(t);break;case"layer/expandCanvasToSelection":if(!o)throw new Error(r(2196));const e=(0,s.DI)(n[r(1847)],n[r(1096)]),i=(0,s.qi)(e,o);h=(0,s.Oq)(i),c=(0,s.rY)(i);break;case r(1302):case"layer/rotate90CounterClockwise":h=n[r(1096)],c=n[r(1847)]}const l=h*c*4,d=r(960)in i?i.dest:{data:new Uint8Array(new SharedArrayBuffer(l)),width:h,height:c},u=[],g=Math[r(507)](navigator[r(1310)]||1,Math[r(590)](d[r(1096)]/100,1));super(e,new Float32Array(g));for(let t=0;t<g;t++){const s={id:t,yStart:Math.floor(t/g*d[r(1096)]),yEnd:Math[r(507)](Math.floor((t+1)/g*d[r(1096)]),d.height),xStart:Math[r(723)](t/g*d[r(1847)]),xEnd:Math[r(507)](Math.floor((t+1)/g*d.width),d[r(1847)])};u.push(this[r(2088)](e,i,n,d,o,s))}this[r(2188)]=Promise[r(922)](u)[r(624)]((()=>{const t=r;return this[t(2113)](),{selection:this[t(1435)],dest:d}}))[r(1269)]((t=>{throw this._finish(),t}))}_createWorker(t,e,s,n,o,r){return new Promise((async(a,h)=>{const c=a2_0x43a7;let l;if(de){const t=await i.e(9174)[c(624)](i[c(1618)](i,9174));l=new pe(t[c(1765)])}else l=new ce;const d={type:"startLayer",taskName:t,source:s,dest:n,selection:o,options:e,job:r};l[c(1204)](d),l[c(1198)]=e=>{const i=c;switch(e[i(1218)][i(1653)]){case i(742):this[i(1968)](r.id,1),this[i(1435)]=e[i(1218)][i(1435)],a(),l[i(808)]();break;case i(2018):this[i(1968)](r.id,1),h(i(1048)+t+i(2212)+e[i(1218)].message),l[i(808)]();break;case i(647):this[i(1968)](r.id,e[i(1218)][i(640)])}}}))}}class fe extends ge{constructor(e,i,s){const n=t,o=[],r=Math[n(507)](navigator[n(1310)]||1,Math.max(Math[n(509)](s/100),1));super(e,new Float32Array(r));for(let t=0;t<r;t++){const a=Math[n(723)](t/r*s),h=Math[n(723)]((t+1)/r*s),c={id:t,start:a,end:h,size:h-a};o[n(2226)](this._createWorker(e,i,c))}this[n(2188)]=Promise.all(o).then((t=>(this._finish(),0===t.length?void 0:t[0]))).catch((t=>{throw this[n(2113)](),t}))}[t(2088)](t,e,s){return new Promise((async(n,o)=>{const r=a2_0x43a7;let a;if(de){const t=await i.e(9174)[r(624)](i.bind(i,9174));a=new pe(t.createMessageHandler)}else a=new ce;const h={type:r(2125),taskName:t,args:e,job:s};a.onmessage=e=>{const i=r;switch(e[i(1218)][i(1653)]){case i(742):this[i(1968)](s.id,1),n(e[i(1218)][i(2188)]),a[i(808)]();break;case"error":this[i(1968)](s.id,1),o(i(1048)+t+i(2212)+e.data[i(992)]),a.terminate();break;case i(647):this[i(1968)](s.id,e.data[i(640)])}},a[r(1204)](h)}))}}class pe{constructor(e){const i=t;this.onmessage=()=>{},this._messageHandler=e(this[i(2178)][i(1618)](this))}[t(1204)](e){this[t(1625)]({data:e})}[t(808)](){}[t(2178)](e){this[t(1198)]({data:e})}}const _e=new Map([[t(1024),{file:t(1024)}],[t(1079),{file:"crop"}],[t(1875),{file:"eraser"}],[t(1411),{file:t(1411)}],[t(608),{file:t(608)}],[t(1422),{file:t(1422)}],[t(797),{file:t(797)}],["moveSelection",{file:t(929)}],[t(1551),{file:t(1551)}],[t(1101),{file:t(1101)}],[t(1435),{file:t(1435)}],["shape",{file:t(617)}],[t(2199),{file:t(2199)}],[t(1905),{file:t(1905)}]]);class we extends e.JT{constructor(e,i,s,o,r,a,h,c,l){const d=t;super(),this[d(543)]=e,this[d(1915)]=i,this._imageService=s,this._inputService=o,this[d(343)]=r,this[d(540)]=a,this[d(1923)]=h,this._taskWorkerService=c,this[d(2109)]=l,this._isPointerDown=!1,this._pointerDownStartTime=0,this[d(1670)]=0,this[d(1265)]=0,this[d(804)]=this.register(new n.v),this[d(850)]=this[d(804)][d(993)],this._sc={configService:this[d(543)],historyService:this[d(1915)],imageService:this[d(1008)],paletteService:this[d(343)],selectionService:this._selectionService,taskService:this[d(1923)],taskWorkerService:this[d(1834)],viewportService:this._viewportService},this[d(1491)][d(672)]((t=>{const e=d;this._isPointerDown=!0,document[e(1893)][e(1777)].toggle(e(936),0===t[e(312)]),document.body.classList[e(1882)](e(1649),2===t[e(312)]),this[e(670)]=t})),this[d(1491)][d(462)]((t=>this._lastPointerEvent=t)),this._inputService.onPointerMove((t=>this[d(670)]=t)),this[d(1491)][d(1641)]((()=>{const t=d;this[t(2192)]=!1,document[t(1893)].classList.remove("mouseleft"),document.body[t(1777)][t(554)](t(1649))})),this.register(this[d(2109)].onUpdate((()=>{const t=d;if(this[t(670)]){const e=this[t(434)]||this[t(2059)];e?.[t(675)]?.(this[t(670)],this[t(2192)]),this[t(2192)]&&e?.[t(1377)]?.(this[t(670)])}}))),this._inputService[d(1760)]((t=>{const e=d;t.key===this[e(793)]&&(this[e(793)]=void 0,this[e(882)]())})),this[d(1915)][d(763)]((t=>this[d(1058)](t))),this._imageService[d(956)]((t=>{const e=d;t[e(1653)]===e(528)&&this.setTool(e(797))})),this._historyService[d(1795)]((()=>this[d(513)]())),this[d(1915)][d(737)]((()=>this._handleHistoryAction())),this[d(1491)].onPointerDown((t=>{const e=d;this[e(1488)]=Date.now(),this[e(1670)]=t.offsetX,this[e(1265)]=t[e(586)]})),this._forwardEventToTool(this[d(1491)][d(771)],d(1117)),this[d(938)](this[d(1491)].onKeyDown,d(845)),this[d(938)](this[d(1491)].onKeyUp,"keyUp"),this._forwardEventToTool(this[d(1491)][d(672)],d(811)),this[d(938)](this[d(1491)][d(462)],d(1377)),this._forwardEventToTool(this[d(1491)][d(1906)],d(675)),this[d(2163)](this[d(1491)][d(1641)]((t=>{const e=d,i=Math[e(791)](this._pointerDownX-t[e(1676)]),s=Math[e(791)](this[e(1265)]-t.offsetY);let n=!1;i<10&&s<10&&Date[e(1706)]()-this._pointerDownStartTime<150&&(n=!0),(this._activeUntilReleaseTool||this[e(2059)])?.[e(2032)]?.(t,n),void 0===this[e(793)]&&this[e(882)]()})))}get[t(2059)](){return this[t(1935)]}async[t(1058)](e,i){const s=t;if(e===this[s(1935)]?.id)return;if(i?.[s(1991)]&&this[s(434)])return;if(!i?.[s(1991)]&&this[s(1935)]?.[s(835)](),typeof e!==s(1325))return void(i?.[s(1991)]?(this[s(434)]=e,this[s(793)]=i[s(1991)]):this._activeTool=e);const n=_e[s(1270)](e);if(!n)throw new Error("Could not find builtin tool "+e);if(!n.factory){this[s(1935)]=void 0;const t=await this[s(1900)](s(769),n.file);n[s(588)]=e=>new t(e)}const o=n.factory(this[s(604)]);i?.[s(1991)]?(this[s(434)]=o,this._activeUntilReleaseToolKey=i[s(1991)]):this._activeTool=o,document.body[s(959)](s(410),o.id),this[s(2130)](o),o.onStateChange&&o[s(397)]((()=>this[s(2130)](o))),this[s(804)][s(1257)](o)}[t(2130)](e){const i=t;e[i(875)]?document[i(1893)][i(959)](i(630),e[i(875)]):document[i(1893)][i(785)](i(630))}[t(882)](){const e=t;this[e(434)]&&!this[e(2192)]&&(this[e(793)]||(this[e(434)]=void 0,this[e(2059)]&&(document.body.setAttribute(e(410),this[e(2059)].id),this[e(2130)](this[e(2059)]),this[e(804)].fire(this.activeTool))))}async[t(1900)](e,s){const n=t,o=await i(1038)("./"+e+"/"+s+n(1554));if(!o)throw new Error(n(1161)+s+n(1928));return o.default}[t(938)](t,e){this.register(t((t=>{const i=a2_0x43a7,s=this[i(434)]||this[i(2059)],n=s?s[e]:void 0;n&&n[i(1618)](s)(t,this[i(1491)]?.[i(1858)])})))}[t(513)](){const e=t;this[e(670)]&&window[e(1040)]((()=>{const t=e;this._lastPointerEvent&&(this[t(434)]||this[t(2059)])?.[t(675)]?.(this._lastPointerEvent,this[t(2192)])}))}[t(1644)](){const e=t;return{activeToolId:this[e(1935)]?.id,activeToolState:this.activeTool?.[e(1644)]?.()}}deserialize(e){const i=t;e[i(1810)]&&this[i(1058)](e.activeToolId)[i(624)]((()=>{const t=i;e[t(563)]&&(this[t(1935)]?this._activeTool[t(817)]?this._activeTool[t(817)](e.activeToolState):console[t(2018)]('No matching deserialize call for tool "'+e.activeToolId+'"'):console[t(2018)]('Deserialize tool service failed to set tool "'+e.activeToolId+'"'))}))}}var ye=i(7896);const ve=new Uint16Array([1,2,3,4,5,6,7,8,9,10,11,12,13,15,17,19,21,24,27,30,34,38,43,48,54,60,64,70,76,82,90,100]);class be extends e.JT{constructor(e,i,s,o){const r=t;super(),this[r(543)]=e,this._elementService=i,this[r(1008)]=s,this[r(388)]="scroll",this._zoom=20,this[r(900)]=!0,this._isScrollLocked=!1,this._x=0,this._y=0,this._scrollVelocity={x:0,y:0},this[r(878)]=0,this[r(1817)]=this[r(2163)](new n.v),this[r(1025)]=this[r(1817)][r(993)],this[r(1479)]=this[r(2163)](new n.v),this.onDimensionsChange=this[r(1479)][r(993)],this[r(1141)]=this[r(2163)](new n.v),this[r(854)]=this[r(1141)][r(993)],this[r(487)]=this[r(2163)](new n.v),this.onZoomChange=this[r(487)][r(993)],this[r(1756)]=this.register(new n.v),this.onPointerCoordChange=this[r(1756)].event,this[r(543)][r(1954)]((t=>this.mouseWheelBehavior=t[r(388)])),this[r(2163)](this[r(1008)][r(1827)]((()=>this.fitToWindow()))),this[r(2163)](this._elementService[r(1500)]((t=>{const e=r;this[e(1840)]?.[e(950)](),this[e(1840)]=new ResizeObserver((([t])=>{const i=e;this[i(1479)][i(1257)](t.contentRect[i(1847)],t.contentRect[i(1096)]),this[i(1817)][i(1257)]()})),this._elementResizeObserver[e(1046)](t)}))),this[r(2163)]({dispose:()=>{const t=r;this[t(1840)]?.[t(950)]()}}),this.register(o[r(1256)]((t=>this._handleWheel(t)))),this[r(2163)](o[r(462)]((t=>this[r(1526)](t)))),this[r(2163)](o[r(1906)]((t=>this[r(1522)](t)))),this[r(2163)](o[r(1641)]((()=>this[r(480)]())))}get[t(1782)](){const e=t,i=this[e(1632)][e(796)];if(!i)throw new Error(e(1064));const s=i[e(1645)]/this[e(1905)],n=i[e(1563)]/this[e(1905)],o=this._imageService.width/2-this._x,r=this._imageService[e(1096)]/2-this._y;return{left:Math[e(590)](o-s/2,0),right:Math[e(507)](o+s/2,this._imageService.width),top:Math[e(590)](r-n/2,0),bottom:Math.min(r+n/2,this[e(1008)][e(1096)])}}get[t(1905)](){const e=t;return parseFloat(this[e(1390)][e(660)](2))}set[t(1905)](e){const i=t;e<=0||(this[i(1390)]=e,this._onUpdate.fire(),this[i(487)].fire())}get isPixelGridEnabled(){return this[t(900)]}set isPixelGridEnabled(e){const i=t;e!==this[i(900)]&&(this[i(900)]=e,this[i(1817)][i(1257)](),this[i(1141)][i(1257)]())}get x(){return this._x}set x(e){const i=t,s=this[i(1008)][i(1847)]/2;this._x=(0,d.u)(e,s,-s),this._onUpdate[i(1257)]()}get y(){return this._y}set y(e){const i=t,s=this[i(1008)][i(1096)]/2;this._y=(0,d.u)(e,s,-s),this._onUpdate[i(1257)]()}[t(894)](e=.2){return this[t(1604)](e)}[t(1078)](e=.2){return this[t(1604)](-e)}[t(1871)](){const e=t,i=this[e(1632)][e(796)];if(!i)return;const s=(i[e(1645)]-10)/this._imageService[e(1847)],n=(i[e(1563)]-10)/this._imageService[e(1096)];this[e(1905)]=Math[e(507)](s,n),this._x=0,this._y=0,this[e(781)]=!0,this[e(1817)][e(1257)]()}[t(2152)](){const e=t,i=this[e(1008)][e(1068)];if(!i)return;const n=i[e(447)];(0,s.Bu)(n)||this[e(1616)]([n.left,n[e(632)]],[n.right,n[e(719)]])}[t(1616)](e,i){const s=t,n=this[s(1632)].element;if(!n)return;const o=(n[s(1645)]-10)/(i[0]-e[0]),r=(n[s(1563)]-10)/(i[1]-e[1]);this[s(1905)]=Math.min(o,r,100),this._x=-((i[0]+e[0])/2-this[s(1008)].width/2),this._y=-((i[1]+e[1])/2-this[s(1008)].height/2),this[s(1817)][s(1257)]()}[t(1404)](e){const i=t;if(this._elementService.element){if("scroll"===this[i(388)]&&e.ctrlKey||"zoom"===this[i(388)]&&!e[i(914)]){const t=this[i(1905)],s=ye.V5?e[i(1420)]<0?this[i(894)](-e[i(1420)]/20):this[i(1078)](e[i(1420)]/20):e[i(1420)]<0?this[i(894)]():this[i(1078)](),n=s/t;if(t!==s){const t=(e[i(822)]-this[i(1632)][i(796)][i(1931)]/2)*(n-1),o=(e[i(1623)]-this._elementService[i(796)][i(1168)]/2)*(n-1);this.x-=t/s,this.y-=o/s}}else!ye.V5&&e[i(573)]?this.x-=this._normalizeWheelDelta(e[i(1420)])/this.zoom:(this.x-=this[i(1889)](e[i(1853)])/this[i(1905)],this.y-=this[i(1889)](e[i(1420)])/this[i(1905)]);this[i(781)]=!1,e[i(1160)]()}}_normalizeWheelDelta(t){return ye.V5?t:Math.abs(t)<100?40*t:t}[t(1526)](e){const i=t,s=this[i(1632)].element;s&&(e[i(1676)]<30?this[i(1401)].x=this[i(2045)](30-e[i(1676)]):e.offsetX>s[i(1931)]-30?this[i(1401)].x=-this[i(2045)](e[i(1676)]-s[i(1931)]-30):this[i(1401)].x=0,e[i(586)]<30?this._scrollVelocity.y=this[i(2045)](30-e.offsetY):e[i(586)]>s[i(1168)]-30?this._scrollVelocity.y=-this[i(2045)](e[i(586)]-s.clientHeight-30):this[i(1401)].y=0,!this[i(878)]&&(this[i(913)](),this._scrollInterval=setInterval((()=>this[i(913)]()),16)))}[t(1522)](e){const i=t,s=this[i(1945)](e);if(void 0!==s||void 0!==this[i(1764)])return void 0===s||void 0===this[i(1764)]?(this[i(1764)]=s,void this._onPointerCoordChange.fire(this._pointerCoord)):void(s[0]===this[i(1764)][0]&&s[1]===this[i(1764)][1]||(this[i(1764)]=s,this[i(1756)].fire(this[i(1764)])))}[t(2045)](e){return 1+Math[t(400)](Math.max(e/20,3),2)}[t(480)](){const e=t;this[e(1401)].x=0,this[e(1401)].y=0,clearInterval(this[e(878)]),this[e(878)]=0}[t(913)](){const e=t;this[e(781)]||(this[e(1401)].x&&(this.x+=1*this[e(1401)].x/this[e(1905)]),this[e(1401)].y&&(this.y+=1*this[e(1401)].y/this.zoom))}[t(1604)](e){const i=t,s=this._zoom+this[i(1390)]*e;if(s<=.02)return this._zoom=.02,this[i(1390)];let n=-1;if(e>0){for(const t of ve)if(t>this[i(1390)]){n=t;break}if(-1===n)return this[i(1390)];this[i(1390)]=n<s?n:s}else{for(const t of ve){if(t>=this[i(1390)])break;n=t}this._zoom=n>s?n:s}return this[i(1817)][i(1257)](),this[i(487)][i(1257)](),this[i(1390)]}getCoordsFromEvent(e){const i=t,s=this[i(923)](e);return[Math[i(723)](s[0]),Math[i(723)](s[1])]}[t(923)](e){const i=t,s=this._elementService[i(796)];if(!s)throw new Error(i(1671));let n=e[i(1676)]-Math.floor(s[i(1931)]/2),o=e.offsetY-Math[i(723)](s.clientHeight/2);return n/=this[i(1905)],o/=this[i(1905)],n+=this[i(1008)].width/2,o+=this[i(1008)].height/2,n-=this.x,o-=this.y,[n,o]}getSnapSettingCoordsFromEvent(e,i){const s=t;return i&&!this[s(543)][s(1689)][s(2009)]?this[s(923)](e):this[s(843)](e)}[t(1705)](e){const i=t,s=this[i(1632)].element;if(!s)throw new Error(i(1671));let n=e[0],o=e[1];return n+=.5,o+=.5,n+=this.x,o+=this.y,n-=this[i(1008)].width/2,o-=this[i(1008)][i(1096)]/2,n*=this[i(1905)],o*=this[i(1905)],n+=Math[i(723)](s[i(1931)]/2),o+=Math[i(723)](s[i(1168)]/2),n=Math[i(597)](n),o=Math[i(597)](o),[n,o]}_getImageCoordsFromEvent(e){const i=t,s=this[i(843)](e);if(!(s[0]<0||s[0]>=this[i(1008)][i(1847)]||s[1]<0||s[1]>=this[i(1008)][i(1096)]))return s}[t(1644)](){const e=t;return{x:this._x,y:this._y,zoom:this[e(1390)]}}[t(817)](e){const i=t;this._x=e.x,this._y=e.y,this._zoom=e.zoom,this._onUpdate[i(1257)](),this._onZoomChange[i(1257)]()}}class xe extends e.JT{constructor(e){const i=t;super(),this[i(543)]=this[i(2163)](new o(e)),this._elementService=this[i(2163)](new r),this[i(343)]=this[i(2163)](new ut),this[i(1915)]=this.register(new h),this._taskWorkerService=this.register(new ue),this[i(540)]=this[i(2163)](new se(this[i(1915)])),this._imageService=this[i(2163)](new et(this[i(1915)],this._selectionService,this._taskWorkerService)),this[i(1491)]=this[i(2163)](new ct(this[i(1632)])),this[i(2109)]=this.register(new be(this[i(543)],this[i(1632)],this._imageService,this._inputService)),this[i(893)]=this[i(2163)](new at(this[i(1915)],this[i(1008)],this[i(540)],this[i(2109)])),this[i(1923)]=this.register(new ae(this[i(1915)],this[i(1008)],this[i(540)],this[i(1834)])),this._toolService=this[i(2163)](new we(this[i(543)],this._historyService,this._imageService,this[i(1491)],this[i(343)],this._selectionService,this[i(1923)],this[i(1834)],this[i(2109)])),this._renderService=this[i(2163)](new ee(this[i(1632)],this[i(1008)],this[i(540)],this[i(1586)],this[i(2109)])),this[i(1689)]=new Ie(this[i(543)]),this.file=new Se(this[i(1915)],this[i(893)],this[i(1008)],this._selectionService,this[i(1586)],this[i(2109)]),this[i(370)]=new Ce(this._historyService),this[i(1109)]=new Ee(this[i(893)]),this.layer=new Te(this[i(1008)],this[i(540)],this[i(1834)]),this[i(2156)]=new De(this[i(343)]),this[i(331)]=new Ae(this[i(476)]),this[i(1435)]=new Re(this[i(1008)],this[i(540)]),this[i(1055)]=new Me(this._taskService,this[i(1834)]),this.test=new Be(this[i(2109)]),this[i(1486)]=new ke(this[i(1586)]),this[i(838)]=new Ue(this[i(1632)],this[i(2109)])}}class Ie{constructor(e){this[t(543)]=e}get[t(491)](){return this[t(543)].config}set[t(491)](e){this[t(543)].config=e}}class Se{constructor(e,i,s,n,o,r){const a=t;this[a(1915)]=e,this._imageFileService=i,this[a(1008)]=s,this._selectionService=n,this[a(1586)]=o,this._viewportService=r}get[t(1176)](){const e=t;return this[e(1008)][e(1176)]}get onMimeTypeChange(){return this[t(1008)].onMimeTypeChange}[t(1528)](e){const i=t;return this[i(893)][i(1528)](e)}[t(1104)](e){const i=t;return this[i(893)][i(1104)](e)}[t(954)](){const e=t;return this[e(1008)][e(954)]()}[t(2011)](){const e=t;return this[e(1008)][e(2011)]()}async[t(2023)](e,s,n){const o=t,r=s[o(1386)]();let a;switch(r){case o(1010):a=o(548);break;case o(891):a=o(984);break;case o(1891):case o(1925):a="image/x-tga";break;case o(1327):case o(1102):case o(1448):case".jpeg":a="image/jpeg";break;case o(1365):case".dib":a=o(2019);break;case o(1309):a=o(323);break;default:throw new Error('Unrecognized file extension "'+r+'"')}let h=!1;switch(a){case"image/x-ico":const s=(await i.e(6959).then(i[o(1618)](i,6959))).openIco,r=await s(e);await Promise[o(2139)](r[o(562)]((t=>t[o(2044)]))),await this[o(1231)](o(548),r[o(562)]((t=>t[o(1263)])),n);break;case o(984):{const t=await(0,X.dX)(e,{force32:!0});h=!!(t[o(1341)]&&t[o(1341)][o(961)]>0),this[o(1569)]("image/png",t[o(1109)],n);break}case"image/x-tga":{const s=await async function(e,s){const n=t;return(await i.e(7127)[n(624)](i[n(1618)](i,7127)))[n(1039)](e,{detectAmbiguousAlphaChannel:!0})}(e);h=!!(s.warnings&&s.warnings[o(961)]>0),this[o(1569)](o(570),s[o(1109)],n);break}case o(2214):case o(2019):case o(323):await this._openBlob(a,new Blob([e],{type:a}),n)}return h}async[t(1569)](e,i,s){const n=t;this[n(893)][n(1569)](e,i,s),this._viewportService[n(1871)]()}async[t(1231)](e,i,s){const n=t;this[n(893)].openImage(e,i,s),this[n(2109)].fitToWindow()}async _openBlob(e,i,s){const n=t;await this[n(1008)][n(2162)](e,i,s),this[n(2109)][n(1871)]()}async[t(883)](e,i,s){const n=t,o=s===n(1010)?n(548):n(984);await this[n(893)][n(883)](o,e,i),this._viewportService.fitToWindow()}[t(532)](e){const i=t;if(e[i(1099)]<8)throw new Error(i(1828)+e[i(1099)]+")");this[i(540)][i(817)](e[i(1893)][i(1435)]),this._historyService[i(817)](e[i(1893)][i(370)]),this._viewportService[i(817)](e[i(1893)].viewport),this[i(893)][i(817)](e.body[i(1733)]),this[i(1586)].deserialize(e.body[i(1486)])}[t(1200)](e){const i=t;return{version:8,body:{file:this._imageFileService[i(1644)](e),history:this._historyService[i(1644)](e),selection:this[i(540)][i(1644)](),tool:this._toolService[i(1644)](),viewport:this._viewportService[i(1644)]()}}}}class Ce{constructor(e){this[t(1915)]=e}get[t(1521)](){const e=t;return this[e(1915)][e(1521)]}get[t(1832)](){const e=t;return this[e(1915)][e(1832)]}get[t(445)](){const e=t;return this[e(1915)][e(445)]}get canUndo(){const e=t;return this[e(1915)][e(2224)]}get[t(1976)](){const e=t;return this[e(1915)][e(1976)]}redo(){return this[t(1915)].redo()}[t(1090)](){const e=t;return this[e(1915)][e(1090)]()}async[t(1908)](e,i){const s=t;return this._historyService[s(1908)](e,i)}[t(704)](e,i){return this[t(1915)].createCompositeEntrySync(e,i)}}class Ee{constructor(e){this[t(893)]=e}get[t(1402)](){const e=t;return this[e(893)][e(1402)]}get[t(772)](){const e=t;return this[e(893)][e(772)]}get[t(2180)](){const e=t;return this[e(893)][e(2180)]}get activeImage(){const e=t;return this[e(893)][e(2047)]}async setActiveImage(e){const i=t;if(e!==this[i(893)][i(2047)]){if(void 0===e)throw new Error("Cannot set the active image to undefined");await this._imageFileService[i(1041)](e)}}[t(439)](e,i,s){const n=t;return this[n(893)][n(439)](e,i,s)}[t(1333)](e){const i=t;return this._imageFileService[i(1333)](e)}[t(1657)](e){const i=t;return this[i(893)][i(1657)](e)}[t(1584)](){const e=t;return this[e(893)][e(1584)]()}[t(1485)](){const e=t;return this._imageFileService[e(1485)]()}goToImageAbove(){return this[t(893)].goToImageAbove()}goToImageBelow(){const e=t;return this[e(893)][e(1320)]()}[t(1772)](){const e=t;return this._imageFileService[e(1772)]()}moveImageToBottom(){const e=t;return this[e(893)][e(744)]()}[t(340)](){const e=t;return this[e(893)][e(340)]()}moveImageDown(){const e=t;return this[e(893)][e(847)]()}[t(1715)](e,i){const s=t;return this[s(893)][s(1715)](e,i)}}class Te{constructor(e,i,s){const n=t;this[n(1008)]=e,this[n(540)]=i,this[n(1834)]=s}get[t(1847)](){const e=t;return this._imageService[e(1847)]}get[t(1096)](){return this[t(1008)].height}get[t(705)](){return this[t(1008)].onChangedDimensions}get[t(1290)](){const e=t;return this._imageService[e(1025)]}get[t(885)](){const e=t;return this[e(1008)][e(885)]}get onLayerVisibilityChange(){const e=t;return this._imageService[e(325)]}get layers(){const e=t;return this[e(1008)][e(1735)][e(562)]((t=>new Le(t,this[e(540)],this[e(1834)])))||[]}get[t(327)](){const e=t,i=this[e(1008)].currentLayer;if(i)return new Le(i,this[e(540)],this[e(1834)])}set[t(327)](e){const i=t;if(void 0===e)throw new Error(i(1261));this._imageService[i(1426)](e.id)}[t(699)](){const e=t;return this._imageService[e(699)]()}[t(2227)](e){const i=t;return this._imageService[i(2227)](e?.id)}duplicateLayer(e){const i=t;return this[i(1008)][i(2169)](e?.id)}mergeLayerDown(){const e=t;return this[e(1008)][e(745)]()}[t(1439)](){const e=t;return this._imageService[e(1439)]()}[t(2037)](e,i){const s=t;return this._imageService[s(2037)](e,i?.id)}[t(1107)](){const e=t;this[e(1008)][e(1107)]()}[t(641)](){const e=t;this[e(1008)][e(641)]()}[t(365)](){const e=t;this[e(1008)][e(365)]()}goToLayerBelow(){const e=t;this[e(1008)][e(2094)]()}[t(1332)](){const e=t;this[e(1008)][e(1332)]()}[t(1808)](){const e=t;this[e(1008)][e(1808)]()}[t(541)](){const e=t;this._imageService[e(541)]()}moveLayerDown(){const e=t;this[e(1008)][e(1042)]()}[t(504)](e,i){const s=t;this[s(1008)][s(504)](e.id,i.id)}async[t(1303)](){const e=t;await(this[e(1008)].currentLayer?.[e(1303)]())}[t(2064)](e,i,s){const n=t;if(e<0||e>=this[n(1847)]||i<0||i>=this.height)return;const o=this._imageService[n(1068)];if(o){if(!s){const t=4*(i*o[n(1847)]+e);return o.data[n(1482)](t,t+4)}return this[n(1008)][n(2064)](e,i)}}}class Le{constructor(e,i,s){const n=t;this[n(1321)]=e,this._selectionService=i,this._taskWorkerService=s,this[n(2054)]=new Map,this[n(1321)][n(1025)]((()=>this._previewCache[n(1778)]()))}get[t(334)](){const e=t;return this[e(1321)][e(2027)]}get[t(1025)](){const e=t;return this[e(1321)][e(1025)]}get id(){return this[t(1321)].id}get[t(1121)](){const e=t;return this[e(1321)][e(1121)]}set[t(1121)](e){const i=t;this[i(1321)][i(1121)]=e}get[t(533)](){const e=t;return this[e(1321)][e(533)]}set[t(533)](e){const i=t;this._layer[i(372)](e)}get[t(2115)](){const e=t;return this[e(1321)][e(2115)]}set[t(2115)](e){const i=t;this[i(1321)][i(919)](e)}[t(642)](e,i){const s=t,n=e+"x"+i,o=this._previewCache[s(1270)](n);if(o)return o;const r={data:this._layer[s(1218)],width:this._layer.width,height:this[s(1321)][s(1096)]},a=this[s(1834)].generateLayerPreview(r,e,i);return this[s(2054)][s(2112)](n,a),a}[t(1528)](e){const i=t;return this[i(1321)][i(1528)](e)}async[t(1001)](e,i){const n=t,o=await this[n(1321)][n(1001)](e,i);this[n(540)][n(1767)]=(0,s.BN)(o.staticState[n(1767)]),this[n(540)][n(957)](n(1595))}}class De{constructor(e){this[t(343)]=e}get[t(1741)](){const e=t;return this[e(343)][e(1025)]}get[t(1948)](){const e=t;return this[e(343)][e(1948)]}get secondary(){const e=t;return this[e(343)][e(1903)]}swap(){this._paletteService.swap()}}class Ae{constructor(e){this[t(476)]=e}pause(){const e=t;this._renderService[e(1680)]()}[t(1969)](){const e=t;this._renderService[e(1969)]()}[t(1761)](e){const i=t;this[i(476)][i(1761)](e)}[t(909)](e){const i=t;this[i(476)][i(909)](e)}}class Re{constructor(e,i){const s=t;this._imageService=e,this[s(540)]=i}get[t(1025)](){return this._selectionService.onUpdate}get[t(1767)](){const e=t;return this[e(540)][e(1767)]}[t(501)](){const e=t;this._selectionService[e(501)]()}[t(903)](){const e=t;return this._imageService[e(940)]()}eraseKeepSelection(){return this[t(1008)].eraseSelection(!0)}[t(1536)](){const e=t;return this._imageService[e(1536)]()}}class Me{constructor(e,i){const s=t;this[s(1923)]=e,this[s(1834)]=i}get[t(1806)](){return this._taskWorkerService.disableWorkers}set[t(1806)](e){const i=t;this._taskWorkerService[i(1806)]=e}get[t(320)](){return this._taskService.onProgress}[t(1877)](e,i){const s=t;return this[s(1923)][s(1877)](e,i)}executeOnSingleLayer(e,i){const s=t;return this._taskService[s(531)](e,i)}}class Be{constructor(e){this[t(2109)]=e}getCellPosition(e,i){const s=t,[n,o]=this._viewportService[s(1705)]([e,i]);return{x:n,y:o}}}class ke{constructor(e){this[t(1586)]=e}get onToolChange(){const e=t;return this[e(1586)][e(850)]}get[t(2059)](){const e=t;return this[e(1586)][e(2059)]?.id}get actions(){const e=t;return this._toolService[e(2059)]?.[e(859)]||[]}get[t(542)](){const e=t;return this[e(1586)][e(2059)]?.[e(542)]||[]}get[t(1021)](){const e=t;return this[e(1586)][e(2059)]?.info||[]}async setTool(e,i){const s=t;await this[s(1586)][s(1058)](e,i)}}class Ue{constructor(e,i){const s=t;this._elementService=e,this[s(2109)]=i}get[t(1025)](){const e=t;return this[e(2109)][e(1025)]}get onZoomChange(){return this[t(2109)].onZoomChange}get[t(854)](){const e=t;return this[e(2109)][e(854)]}get[t(1239)](){const e=t;return this[e(2109)][e(1239)]}get x(){return this._viewportService.x}set x(e){this[t(2109)].x=e}get y(){return this[t(2109)].y}set y(e){this[t(2109)].y=e}get[t(1782)](){return this[t(2109)].visibleRange}get[t(1905)](){const e=t;return this[e(2109)][e(1905)]}set[t(1905)](e){const i=t;this[i(2109)][i(1905)]=e}get[t(580)](){return this._viewportService.isPixelGridEnabled}set[t(580)](e){this[t(2109)].isPixelGridEnabled=e}get[t(388)](){const e=t;return this[e(2109)][e(388)]}set[t(388)](e){const i=t;this._viewportService[i(388)]=e}[t(455)](e){const i=t;this[i(1632)][i(455)](e)}focus(){const e=t;document.activeElement[e(1852)]()}[t(894)](e){const i=t;this[i(2109)][i(894)](e)}zoomOut(t){this._viewportService.zoomOut(t)}fitToWindow(){const e=t;this._viewportService[e(1871)]()}[t(2152)](){this._viewportService.fitLayerToWindow()}}const Pe=t(1883),Fe=t(620),Ne=new Map;function Ve(e){const i=t;if(Ne.has(e))return Ne[i(1270)](e);const s=function(t,e,n){const o=i;if(3!==arguments[o(961)])throw new Error(o(694));Oe(s,t,n)};return s[i(452)]=()=>e,Ne[i(2112)](e,s),s}function Oe(e,i,s){const n=t;i[Pe]===i?i[Fe][n(2226)]({id:e,index:s}):(i[Fe]=[{id:e,index:s}],i[Pe]=i)}const He=Ve(t(997)),ze=Ve(t(809)),We=Ve(t(2084));class je{constructor(){this._commands=new Map}[t(2163)](t,e){this._commands.set(t,e)}get(e){const i=t,s=this._commands[i(1270)](e);if(!s)throw new Error(i(1230)+e+'"');return s}[t(1456)](){const e=t;return this._commands[e(491)]()}}const qe=new je;var Ge=function(t,e){return function(i,s){e(i,s,t)}};let Xe=class{constructor(e,i){const s=t;this[s(1118)]=e,this[s(482)]=i}[t(1611)](t){return qe.get(t)}[t(1801)](){return qe.getAll()}[t(2002)](e){const i=t,s=qe[i(1270)](e);if(void 0===s[i(888)])return!0;const n=this[i(482)].get(s.enabled);if(!n)return!0;const o=n[i(1270)]();return s[i(1187)]?!o:o}[t(488)](e,...i){const s=t;if(!this.canRunCommand(e))return void console[s(2155)](s(1398)+e+s(2004));const n=qe[s(1270)](e);return console[s(1021)](s(380)+e+" executed"),this[s(1118)][s(1640)](n.run,...i)}[t(2202)](e,i){const s=t,n=qe[s(1456)](),o=[];for(const t of n)if((t[s(1658)]+": "+t.label).toLowerCase()[s(810)](e[s(1386)]())&&(o.push(t),o[s(961)]===i))return o;return o}};Xe=function(e,i,s,n){const o=t;var r,a=arguments[o(961)],h=a<3?i:null===n?n=Object[o(656)](i,s):n;if(typeof Reflect===o(623)&&typeof Reflect.decorate===o(1524))h=Reflect[o(314)](e,i,s,n);else for(var c=e[o(961)]-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object.defineProperty(i,s,h),h}([Ge(0,We),Ge(1,ze)],Xe);const Ye=Ve(t(485));class Je extends e.JT{constructor(){const e=t;super(...arguments),this.serviceBrand=void 0,this[e(631)]=this[e(2163)](new n.v),this.onConfigChanged=this._onConfigChanged[e(993)],this[e(527)]={statusBarPointerColor:e(1068),defaultTool:e(1435)}}get[t(1689)](){return this._config}set[t(1689)](e){const i=t;!this._configEquals(e)&&(this[i(527)]=e,this[i(631)].fire(this._config))}[t(2229)](e){const i=t,s=Object[i(587)](this[i(527)]);if(s[i(961)]!==Object.keys(e)[i(961)])return!1;for(const t of s)if(this._config[t]!==e[t])return!1;return!0}}class Ke{constructor(){const e=t;this[e(1797)]=void 0,this[e(669)]=new Map}get(e){const i=t;return this[i(669)][i(1270)](e)}[t(1618)](e,i){const s=t,n=new $e(i);return this[s(669)][s(2112)](e,n),n}}class $e extends e.JT{constructor(e){const i=t;super(),this._defaultValue=e,this[i(1817)]=this[i(2163)](new n.v),this[i(1025)]=this[i(1817)].event,this[i(987)]=this[i(2065)]}[t(2112)](e){const i=t;this[i(987)]!==e&&(this[i(987)]=e,this[i(1817)][i(1257)](e))}reset(){this.set(this._defaultValue)}[t(1270)](){return this[t(987)]}}const Ze=Ve(t(344)),Qe=Ve("FileService");class ti{constructor(...e){const i=t;this._entries=new Map;for(const[t,s]of e)this[i(2112)](t,s)}set(e,i){const s=t,n=this[s(404)][s(1270)](e);return this[s(404)].set(e,i),n}[t(2149)](e){const i=t;this[i(404)][i(2149)](((t,i)=>e(i,t)))}[t(1359)](e){const i=t;return this[i(404)][i(1359)](e)}[t(1270)](e){const i=t;return this[i(404)][i(1270)](e)}}class ei{constructor(){const e=t;this[e(423)]=new ti,this[e(423)][e(2112)](We,this)}[t(1441)](e,i){this[t(423)].set(e,i)}[t(1876)](t){return this._services.get(t)}[t(1508)](e,...i){const s=t,n=(r=e,r[Fe]||[])[s(295)](((t,e)=>t[s(1802)]-e[s(1802)])),o=[];var r;for(const t of n){const i=this[s(423)][s(1270)](t.id);if(!i)throw new Error(s(409)+e[s(1121)]+s(819)+t.id+".");o[s(2226)](i)}const a=n[s(961)]>0?n[0][s(1802)]:i[s(961)];if(i.length!==a)throw new Error("[createInstance] First service dependency of "+e[s(1121)]+s(1961)+(a+1)+s(1262)+i.length+s(741));return new e(...[...i,...o])}[t(1640)](t,...e){return t({get:t=>{const e=a2_0x43a7,i=this.getService(t);if(!i)throw new Error(e(1311)+t+"'");return i}},...e)}}const ii=Ve("KeybindingService"),si=Ve(t(932)),ni=Ve("StatusBarService");class oi extends e.JT{constructor(){const e=t;super(...arguments),this[e(1145)]=new Map([[1,new ri],[0,new ri]]),this[e(1798)]=this[e(2163)](new n.v),this.onDidAddTopItem=this[e(1798)][e(993)],this[e(385)]=this[e(2163)](new n.v),this[e(369)]=this[e(385)][e(993)],this[e(2147)]=this[e(2163)](new n.v),this.onDidAddBottomItem=this._onDidAddBottomItem[e(993)],this[e(443)]=this[e(2163)](new n.v),this.onDidRemoveBottomItem=this[e(443)][e(993)]}[t(1577)](e){const i=t,s=this[i(1145)][i(1270)](e[i(1696)]),n=0===e.alignment?s[i(1116)]:s.rightItems;if(n[i(1359)](e))throw new Error(i(1637));return n.add(e),(0===e.target?this[i(1798)]:this[i(2147)])[i(1257)](e),{dispose:()=>{this[i(698)](e)}}}getLeftItems(e){const i=t;return this._items[i(1270)](e)[i(1116)][i(491)]()}[t(1990)](e){const i=t;return this._items[i(1270)](e)[i(293)][i(491)]()}[t(698)](e){const i=t,s=this._items[i(1270)](e.target);(0===e[i(1663)]?s.leftItems:s[i(293)])[i(1367)](e),(0===e[i(1696)]?this[i(385)]:this[i(443)])[i(1257)](e)}}class ri{constructor(){const e=t;this[e(1116)]=new Set,this[e(293)]=new Set}}const ai=Ve("QuickPickService"),hi=Ve("ViewService"),ci=Ve(t(1881));class li{constructor(){this[t(644)]=new Map}[t(2163)](e,i){const s=t;this[s(644)][s(2112)](e,i)}get(e){const i=t,s=this[i(644)][i(1270)](e);if(!s)throw new Error(i(1819)+e+'"');return s}[t(1456)](){const e=t;return this[e(644)][e(1832)]()}}const di=new li;class ui{constructor(){this[t(644)]=new Map}[t(2163)](t,e){this._views.set(t,e)}get(e){const i=t,s=this[i(644)][i(1270)](e);if(!s)throw new Error('Could not find non-existent window view "'+e+'"');return s}getAll(){return this[t(644)].entries()}}const gi=new ui;function mi(t,e,i){return s=(s,n)=>{const o=a2_0x43a7(1809)+n,r="$debounce$result$"+n;return function(...n){!this[r]&&(this[r]=i?i():void 0),clearTimeout(this[o]),e&&(this[r]=e(this[r],...n),n=[this[r]]),this[o]=setTimeout((()=>{s[a2_0x43a7(1530)](this,n),this[r]=i?i():void 0}),t)}},(t,e,i)=>{const n=a2_0x43a7;let o=null,r=null;if("function"==typeof i.value?(o=n(436),r=i[n(436)]):"function"==typeof i[n(1270)]&&(o=n(1270),r=i[n(1270)]),!r)throw new Error(n(492));i[o]=s(r,e)};var s}var fi=function(e,i,s,n){const o=t;var r,a=arguments.length,h=a<3?i:null===n?n=Object[o(656)](i,s):n;if(typeof Reflect===o(623)&&typeof Reflect[o(314)]===o(1524))h=Reflect[o(314)](e,i,s,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object.defineProperty(i,s,h),h},pi=function(t,e){return function(i,s){e(i,s,t)}};let _i=class extends e.JT{constructor(e,i){const s=t;super(),this[s(1118)]=e,this[s(1144)]=i,this[s(644)]=new Map,this[s(1475)]=!1,this._windowPosition=new Map,this._windowResolvedPosition=new Map,this[s(1752)]=this[s(2163)](new n.v),this[s(397)]=this[s(1752)].event,this[s(535)]=this[s(2163)](new n.v),this[s(2062)]=this[s(535)][s(993)];for(const[t,e]of di[s(1456)]()){let i;switch(e[s(313)]){case s(632):i=this[s(1118)][s(1508)](e[s(1026)],document[s(1820)](s(1497)));break;case s(719):i=this[s(1118)][s(1508)](e[s(1026)],document[s(1820)](s(1994)))}i&&this[s(644)][s(2112)](t,i)}this[s(1443)]=document[s(1820)](s(393)),window[s(2118)](s(1016),(()=>this[s(1613)]())),(0,n.B)(this.onStateChange,this[s(535)]),this[s(1144)][s(1084)](s(463),this)}showDefaults(){const e=t;for(const[t,i]of gi[e(1456)]())i[e(422)]&&this[e(1455)](t,i)}[t(1613)](){const e=t;for(const[t,i]of this[e(788)][e(1832)]())if(i){const s=this[e(644)][e(1270)](t);if(s&&"setPosition"in s){if(this._isWindowAnchor(i?.x)&&i?.x[e(1696)]||this[e(1647)](i?.y)&&i?.y[e(1696)])continue;this[e(591)](s,i||gi[e(1270)](t)[e(493)])}}}[t(879)](e){const i=t,s=this[i(644)][i(1270)](e);s?s[i(2115)]=!s[i(2115)]:this[i(1455)](e,gi[i(1270)](e)),!1===s?.[i(2115)]&&this._windowResolvedPosition[i(1367)](e),!this._isRestoringState&&(this._onStateChange.fire(),this._layoutDependentViews(e))}hideView(e){const i=t,s=this[i(644)][i(1270)](e);s&&s.isVisible&&(s[i(2115)]=!1,this[i(1614)].delete(e),!this._isRestoringState&&(this[i(1752)].fire(),this[i(1890)](e)))}[t(417)](e){const i=t,s=this._views[i(1270)](e);s?!s[i(2115)]&&(s[i(2115)]=!0,!this[i(1475)]&&(this[i(1752)][i(1257)](),this[i(1890)](e))):this.toggleView(e)}[t(2115)](e){const i=t;return this[i(644)].get(e)?.[i(2115)]||!1}[t(1455)](e,i){const s=t,n=this[s(1118)][s(1508)](i[s(1026)],this._viewsElement);this._updateWindowViewPosition(n,i[s(493)]),n.onDidChangeVisibility((()=>{const t=s;!1===n[t(2115)]&&(n.dispose(),this[t(644)][t(1367)](e),!this[t(1475)]&&(this[t(1752)][t(1257)](),this[t(1890)](e)),this[t(1614)].delete(e))})),n[s(465)]((t=>{const e=s;!this[e(345)]&&setTimeout((()=>{const i=e;this[i(345)]=document[i(1541)](i(1505)),this[i(345)][i(1777)][i(1492)](i(824)),this[i(345)][i(1728)][i(374)]="all",this[i(345)][i(2118)](i(1786),(e=>{const s=i,o=this._viewsElement[s(1373)](),r=e[s(1356)]+t[s(1676)]-o[s(702)]-10+t[s(1847)]/2>o.width/2?s(1799):s(2125),a=e.clientY+t[s(586)]-o[s(632)]-10+t[s(1096)]/2>o[s(1096)]/2?s(1799):s(2125);let h,c;h=r===s(2125)?e[s(1356)]+t[s(1676)]-o.left-10:o.width-(e[s(1356)]+t.offsetX)-t[s(1847)]-10,c="start"===a?e[s(1209)]+t.offsetY-o.top-10:o[s(1096)]-(e[s(1209)]+t.offsetY)-t[s(1096)]+10+1,this._updateWindowViewPosition(n,{x:{side:r,distance:Math[s(590)](h,0)},y:{side:a,distance:Math[s(590)](c,0)}})})),this._dropTargetElement[i(2118)](i(1225),(t=>t[i(1160)]())),this[i(1443)].appendChild(this[i(345)])}))})),n[s(1592)]((()=>{const t=s;this[t(345)]&&(this[t(1443)].removeChild(this[t(345)]),this._dropTargetElement=void 0),this[t(1752)].fire()})),this[s(644)][s(2112)](e,n)}[t(591)](e,i){const s=t;let n,o,r,a;this._windowPosition.set(e.id,i),this[s(1614)][s(1367)](e.id);const h=this._isWindowAnchor(i.x)?i.x.target:void 0,c=this._isWindowAnchor(i.y)?i.y[s(1696)]:void 0,l=this[s(1647)](i.x)?i.x[s(673)]:i.x;let u=this[s(1647)](i.x)?(i.x[s(1753)]||0)+10:10;if(h){const t=this[s(1614)][s(1270)](h);t&&(u+=("start"===l?t[s(702)]:t[s(557)])||0,u+=this._views.get(h)?.[s(1096)]||0)}if("start"===l?a=(0,d.u)(u,this[s(1443)][s(1645)]-e[s(1847)]-10,10):o=(0,d.u)(u,this[s(1443)][s(1645)]-e[s(1847)]-10,10),!h&&c){const t=this._windowResolvedPosition[s(1270)](c);t&&(a=t[s(702)],o=t[s(557)])}let g=this[s(1647)](i.y)?i.y[s(673)]:i.y,m=this[s(1647)](i.y)?(i.y.distance||0)+10:10;if(c){const t=this[s(788)][s(1270)](c),i=this[s(1614)][s(1270)](c);if(i&&(void 0!==i[s(632)]?m=i[s(632)]-m-this[s(644)][s(1270)](e.id)?.[s(1096)]||0:void 0!==i[s(719)]&&(m+=i[s(719)]),t)){const e=this[s(1184)](t.y);g===e&&(m+=this[s(644)][s(1270)](c)?.[s(1096)]||0),g=e}}if(g===s(2125)?n=(0,d.u)(m,this[s(1443)][s(1563)]-e[s(1096)]-10,10):r=(0,d.u)(m,this[s(1443)][s(1563)]-e[s(1096)]-10,10),!c&&h){const t=this[s(1614)][s(1270)](h);t&&(n=t[s(632)],r=t.bottom)}e[s(703)](n?n+"px":"",o?o+"px":"",r?r+"px":"",a?a+"px":""),this._windowResolvedPosition[s(2112)](e.id,{top:n,right:o,bottom:r,left:a}),this._layoutDependentViews(e.id)}[t(1890)](e){const i=t;for(const t of this[i(644)][i(491)]()){if(!(i(703)in t))continue;const s=this[i(788)][i(1270)](t.id)||gi[i(1270)](t.id)[i(493)];t[i(2115)]&&(this[i(1647)](s.x)&&s.x.target===e||this._isWindowAnchor(s.y)&&s.y[i(1696)]===e)&&this[i(591)](t,s)}}[t(1200)](){const e=t,i=[];for(const t of this[e(644)][e(491)]())i.push({id:t.id,position:this[e(788)][e(1270)](t.id),isVisible:t[e(2115)]});return{views:i}}[t(532)](e){const i=t;this[i(1475)]=!0;for(const t of e[i(342)])t[i(2115)]?this[i(417)](t.id):this.hideView(t.id);for(const t of this._views[i(587)]()){let s=!1;for(const n of e[i(342)].values())if(n.id===t){s=!0;break}!s&&this[i(1407)](t)}for(const t of e[i(342)])if(t[i(2115)]){const e=this[i(644)][i(1270)](t.id);if(e&&i(703)in e){if(this[i(1647)](t[i(1964)]?.x)&&t[i(1964)]?.x.target||this[i(1647)](t.position?.y)&&t[i(1964)]?.y[i(1696)])continue;this[i(591)](e,t[i(1964)]||gi[i(1270)](t.id)[i(493)])}}this[i(1475)]=!1}[t(1647)](e){return!!e&&typeof e!==t(1325)}_getAnchorSide(e){const i=t;return this[i(1647)](e)?e[i(673)]:e}};fi([mi(500)],_i[t(1454)],t(1613),null),_i=fi([pi(0,We),pi(1,ci)],_i);const wi=Ve(t(1223));class yi extends e.JT{constructor(){const e=t;super(...arguments),this[e(536)]=!0,this[e(750)]=!0,this[e(1953)]=this.register(new n.v),this.onShowViewportChange=this._onShowViewportChange[e(993)],this._onStretchEnabledChange=this[e(2163)](new n.v),this[e(2134)]=this[e(1128)][e(993)]}get[t(301)](){return this[t(536)]}set[t(301)](e){const i=t;this[i(536)]!==e&&(this[i(536)]=e,this[i(1953)].fire(e))}get[t(2061)](){return this._isStretchEnabled}set[t(2061)](e){const i=t;this._isStretchEnabled!==e&&(this[i(750)]=e,this[i(1128)].fire(e))}}const vi=Ve(t(711));let bi=class extends e.JT{constructor(e){const i=t;super(),this[i(1830)]=!1,this[i(358)]=!1,this[i(1752)]=this[i(2163)](new n.v),this[i(397)]=this[i(1752)].event,this._onShowColorDetailsChange=this[i(2163)](new n.v),this[i(1989)]=this[i(377)][i(993)],e[i(1084)]("color",this),this.onShowColorDetailsChange((()=>{const t=i;!this[t(358)]&&this._onStateChange[t(1257)]({global:!0})}))}get showColorDetails(){return this[t(1830)]}set[t(1206)](e){const i=t;this[i(1830)]!==e&&(this._showColorDetails=e,this[i(377)].fire(e))}saveState(){return{showColorDetails:this[t(1830)]}}[t(532)](e){const i=t;this[i(358)]=!0,this.showColorDetails=e[i(1206)],this[i(358)]=!1}};var xi,Ii;bi=function(e,i,s,n){const o=t;var r,a=arguments.length,h=a<3?i:null===n?n=Object[o(656)](i,s):n;if("object"==typeof Reflect&&"function"==typeof Reflect[o(314)])h=Reflect[o(314)](e,i,s,n);else for(var c=e[o(961)]-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object[o(614)](i,s,h),h}([(xi=0,Ii=ci,function(t,e){Ii(t,e,xi)})],bi);class Si extends e.JT{constructor(){const e=t;super(...arguments),this[e(499)]=new Map,this._state=new Map,this[e(1752)]=this[e(2163)](new n.v),this[e(397)]=this[e(1752)][e(993)],this[e(2204)]=this[e(2163)](new n.v),this[e(975)]=this[e(2204)][e(993)]}get[t(875)](){const e=t,i=[];for(const[t,s]of this[e(474)][e(1832)]())i[e(2226)]({id:t,state:s});return{version:3,entries:i}}registerStateHandler(e,i){const s=t;if(this._stateHandlers[s(1359)](e))throw new Error(s(2111)+e+s(1699));this[s(499)][s(2112)](e,i),i.onStateChange((t=>{const n=s,o=this[n(396)](i,e);this[n(1752)][n(1257)]({id:e,global:typeof t===n(623)?t[n(1688)]:void 0,state:o})}))}_setState(e,i){const s=t,n=e[s(1200)]();return this[s(474)][s(2112)](i,n),n}[t(1232)](e){const i=t;return this._stateHandlers[i(1359)](e)}[t(532)](e){const i=t;if(e)if(3===e.version)for(const t of e.entries){const e=this[i(499)][i(1270)](t.id);e?e[i(532)](t[i(875)]):console.warn(i(1542)+t.id+i(1862))}else console[i(2155)](i(2183)+e[i(1099)]+" < 3)");else for(const[t,e]of this[i(499)].entries())this[i(396)](e,t)}[t(1674)](e){this[t(532)](e)}}class Ci{constructor(){this[t(1559)]=[]}[t(2163)](e){this[t(1559)].push(e)}[t(1456)](){const e=t;return this[e(1559)][e(491)]()}clear(){this._contributions.length=0}}const Ei=new Ci;const Ti=Ve(t(572));class Li{constructor(e){const i=t;this[i(2203)]=e,this[i(1797)]=void 0,this[i(1845)]=new Map,this[i(368)]=new Map,window[i(2118)](i(992),(async t=>{const e=i;if(e(718)in t.data){const i=t.data[e(718)],s=this[e(368)][e(1270)](i);if(!s)throw new Error(e(299)+i+'"');return this[e(368)][e(1367)](i),void s(this[e(1864)](t[e(1218)]))}if(e(1593)in t[e(1218)]){const i=this[e(1845)].get(t.data[e(1653)]);if(!i)throw new Error(e(1127)+t.data.type+'"');const s=await i(this[e(1864)](t[e(1218)])),n={type:t[e(1218)][e(1653)],body:ye.jn?s:(0,A.t)(s),extHostRequestId:t.data[e(1593)]};this[e(2203)][e(1204)](n)}}))}[t(899)](e,i){const s=t;if(this[s(1845)].has(e))throw new Error(s(935)+e+'"');this[s(1845)][s(2112)](e,i)}async[t(1413)](e,i){const s=t,n=Math[s(597)](1e6*Math[s(1339)]());return new Promise((t=>{const o=s;this._activeRequests[o(2112)](n,t),this[o(2203)][o(1204)]({type:e,body:i,webviewRequestId:n})}))}[t(1864)](e){const i=t;if(void 0===e[i(1893)])return e[i(1893)];const s=e[i(1893)];for(const t of Object.keys(s)){const e=s[t];typeof e===i(623)&&"type"in e&&e[i(1653)]===i(1740)&&(s[t]=new Uint8Array(e.data))}return(0,A.e)(s)}}class Di{[t(2163)](t){}[t(1456)](){return[][t(491)]()}}let Ai=class{constructor(e){this[t(814)]=e}async[t(787)](e){const i=t;return this._quickPickService[i(1151)]("",e)}};var Ri,Mi;Ai=function(e,i,s,n){const o=t;var r,a=arguments[o(961)],h=a<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,s):n;if(typeof Reflect===o(623)&&typeof Reflect[o(314)]===o(1524))h=Reflect[o(314)](e,i,s,n);else for(var c=e[o(961)]-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object[o(614)](i,s,h),h}([(Ri=0,Mi=ai,function(t,e){Mi(t,e,Ri)})],Ai);class Bi{constructor(){}async[t(318)](){throw new Error(t(2198))}async[t(1387)](){throw new Error(t(2198))}async[t(1682)](){throw new Error(t(2198))}}async function ki(t){return new Promise((e=>setTimeout(e,t)))}var Ui=function(t,e){return function(i,s){e(i,s,t)}};let Pi=class{constructor(e,i){const s=t;this[s(1338)]=e,this[s(2010)]=i}async requestLayerTaskOptions(e){const i=t;switch(e){case i(1222):{const t=await this.requestNewDimensions();await ki(50);const e=await this[i(1338)][i(1413)](i(2058),{items:[{id:i(1986),label:"Bilinear",description:"Smooth edges",detail:"Gets the color by averaging the values of surrounding pixels."},{id:"nearestneighbor",label:i(1147),description:i(2080),detail:i(693)}],options:{placeHolder:i(1157)}});if(void 0===e)throw new Error("Resampling not selected");return{...t,resampling:e}}case"layer/resizeCanvas":{const t=await this[i(625)]();await ki(50);const e=await this._ipcService[i(1413)](i(2058),{items:[{id:"topleft",label:i(1301),description:"â"},{id:i(632),label:i(1692),description:"â"},{id:i(322),label:i(357),description:"â"},{id:i(702),label:i(1755),description:"â"},{id:i(988),label:"Middle",description:"Â·"},{id:i(557),label:i(1934),description:"â"},{id:i(1825),label:i(1534),description:"â"},{id:i(719),label:i(1926),description:"â"},{id:i(1248),label:i(1700),description:"â"}],options:{placeHolder:i(547)}});if(void 0===e)throw new Error(i(1273));return{...t,anchor:e}}default:throw new Error(i(2201)+e+i(1622))}}async requestNewDimensions(){const e=t;await ki(50);const i=await this[e(1338)][e(1413)]("inputBoxNumberOrDimensionsShorthand",{title:e(696),prompt:e(1355),widthDefaultValue:this[e(2010)][e(1866)][e(1847)],heightDefaultValue:this._lunaService[e(1866)][e(1096)],minValue:1});if(void 0===i)throw new Error(e(1241));let s,n;if(typeof i===e(1896)?(await ki(50),s=i,n=await this[e(1338)][e(1413)](e(2114),{title:e(1729),prompt:e(1034),defaultValue:this[e(2010)][e(1866)][e(1096)],minValue:1})):(s=i[e(1847)],n=i[e(1096)]),void 0===n)throw new Error(e(1391));return{width:s,height:n}}async[t(1151)](e,i){const s=t;return await ki(50),await this[s(1338)].request(s(2058),{options:{placeHolder:e},items:i})}async requestInput(e,i){const s=t;return await ki(50),await this[s(1338)][s(1413)](s(977),{prompt:e,defaultValue:i})}async requestInputNumber(e,i,s,n){const o=t;return await ki(50),await this[o(1338)][o(1413)]("inputBoxNumber",{prompt:e,defaultValue:i,minValue:s,maxValue:n})}};Pi=function(e,i,s,n){const o=t;var r,a=arguments[o(961)],h=a<3?i:null===n?n=Object[o(656)](i,s):n;if(typeof Reflect===o(623)&&typeof Reflect[o(314)]===o(1524))h=Reflect[o(314)](e,i,s,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object[o(614)](i,s,h),h}([Ui(0,Ti),Ui(1,si)],Pi);const Fi=Ve(t(2143));let Ni=class{constructor(e){this[t(1338)]=e}async[t(1932)](){const e=t;return this[e(1338)][e(1413)](e(1932),void 0)}};var Vi,Oi;Ni=function(e,i,s,n){const o=t;var r,a=arguments.length,h=a<3?i:null===n?n=Object[o(656)](i,s):n;if(typeof Reflect===o(623)&&"function"==typeof Reflect.decorate)h=Reflect[o(314)](e,i,s,n);else for(var c=e[o(961)]-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object[o(614)](i,s,h),h}([(Vi=0,Oi=Ti,function(t,e){Oi(t,e,Vi)})],Ni);class Hi{constructor(){this[t(404)]=[]}[t(2163)](e){const i=t;this._entries[i(2226)](e)}[t(1456)](){return this[t(404)]}[t(1778)](){const e=t;this[e(404)][e(961)]=0}}const zi=new Hi;function Wi(e){const i=t;if(qe.register(e.id,{id:e.id,label:e.label,section:e.section,run:e[i(1538)],checked:e[i(1376)],negateChecked:e.negateChecked,enabled:e[i(888)],negateEnabled:e[i(1187)]}),e[i(587)])if(Array[i(2086)](e.keys))for(const t of e[i(587)])zi[i(2163)]({commandId:e.id,keys:t});else zi[i(2163)]({commandId:e.id,keys:e[i(587)]})}Wi({id:t(515),label:t(1450),section:t(1597),run:async e=>{const i=t,s=e.get(si);await s[i(1055)].executeOnSingleLayer(i(366),{selection:s.selection[i(1767)]})},keys:"ctrl+shift+i"});class ji extends e.JT{constructor(e,i,s){const o=t;super(),this.id=e,this[o(1443)]=i,this._isVisible=!0,this._onDidChangeVisibilityEmitter=this[o(2163)](new n.v),this[o(2122)]=this._onDidChangeVisibilityEmitter[o(993)],this[o(857)]=this[o(2163)](new n.v),this.onDidStartDrag=this[o(857)][o(993)],this[o(1724)]=this[o(2163)](new n.v),this[o(1592)]=this._onDidEndDrag[o(993)],this[o(2083)]=document[o(1541)](o(1505)),this._viewElement.id=s[o(1386)]().replace(/ /g,""),this[o(2083)][o(1777)][o(1492)]("view",o(1742));const r=document[o(1541)](o(1505));r[o(1777)].add(o(1703)),r[o(2118)]("mousedown",(()=>this._viewElement[o(1396)]=!0)),r[o(2118)](o(1095),(()=>this[o(2083)][o(1396)]=!1)),r.addEventListener(o(1115),(t=>t[o(1160)]())),this[o(2083)][o(2118)](o(1020),(t=>{const e=o;t[e(1003)]&&(t.dataTransfer.dropEffect=e(871),t[e(1003)].effectAllowed=e(871));const i=this[e(2083)][e(1373)]();this._onDidStartDrag[e(1257)]({offsetX:i[e(702)]-t[e(1356)],offsetY:i.top-t.clientY,width:i[e(1847)],height:i[e(1096)]})})),this[o(2083)][o(2118)]("dragend",(()=>this._onDidEndDrag[o(1257)]())),this[o(2083)].addEventListener("contextmenu",(t=>{const e=o,i=t.target;(i[e(1552)]!==e(1293)||!(e(1653)in i)||"text"!==i[e(1653)]&&i.type!==e(1896))&&i[e(1552)]!==e(1822)&&t[e(1160)]()}));const a=document[o(1541)]("div");a[o(1777)][o(1492)](o(1863)),a[o(1033)]=s,this[o(310)]=document[o(1541)](o(1505)),this[o(310)][o(1777)][o(1492)]("header-content");const h=document[o(1541)]("button");h[o(1777)].add(o(1833),o(1246)),h.setAttribute(o(947),o(1205)+s+" window"),h.addEventListener(o(2230),(t=>t[o(1300)]())),h[o(2118)]("click",(()=>this.isVisible=!1)),r[o(813)](a,this._headerContentElement,h),this[o(952)]=document[o(1541)]("div"),this[o(952)][o(1777)][o(1492)](o(1250)),this[o(2083)][o(813)](r,this[o(952)]),this[o(1443)][o(828)](this._viewElement),this[o(2163)]({dispose:()=>{const t=o;this[t(1443)][t(1221)](this._viewElement)}})}get[t(2115)](){return this[t(1758)]}set[t(2115)](e){const i=t;this._isVisible=e,this[i(970)][i(1257)](e)}get[t(1096)](){const e=t;return this._viewElement[e(1373)]().height}get width(){const e=t;return this._viewElement[e(1373)]()[e(1847)]}[t(703)](e,i,s,n){const o=t;this[o(2083)][o(1728)][o(632)]=e||"",this[o(2083)][o(1728)][o(557)]=i||"",this._viewElement[o(1728)][o(719)]=s||"",this._viewElement[o(1728)][o(702)]=n||""}}class qi extends e.JT{constructor(i,s,o,r,a,h){const c=t;super(),this[c(424)]=i,this[c(408)]=s,this[c(1196)]=a,this._maxValue=h,this[c(2063)]=this[c(2163)](new n.v),this[c(1669)]=this._onSliderChange[c(993)],this[c(1638)]=document.createElement("div"),this._widgetContent[c(1777)][c(1492)](r),this._sliderContainer=document[c(1541)]("div"),this[c(1646)][c(1777)][c(1492)](c(1759)),this[c(1357)]=document[c(1541)](c(1505)),this[c(1357)][c(1777)][c(1492)]("slider-gradient"),this[c(1357)][c(1728)][c(2128)]=this[c(962)](),this[c(1357)][c(2118)]("mousemove",(t=>{const e=c;this[e(1646)][e(1777)][e(349)](e(2041))&&t[e(659)]&&this[e(1691)](t[e(1676)])})),this[c(1357)].addEventListener(c(1790),(t=>{const e=c;this[e(1357)][e(770)](t[e(1556)]),this[e(1646)].classList.add("active"),this[e(1691)](t[e(1676)])})),this[c(1357)][c(2118)](c(1677),(t=>{const e=c;this[e(1357)][e(2087)](t.pointerId),this._sliderContainer[e(1777)][e(554)](e(2041))})),this[c(1357)][c(2118)](c(1868),(t=>{const e=c;0!==t[e(1420)]&&this[e(1429)](this[e(305)]()+(t.deltaY>0?-1:1))})),this[c(1585)]=document.createElement(c(1505)),this[c(1585)][c(1777)].add(c(1119)),this[c(1646)][c(813)](this[c(1357)],this._sliderTabElement),this[c(1638)][c(813)](this[c(1646)]),this._container[c(813)](this._widgetContent),this[c(1504)](),this.register((0,e.OF)((()=>this._widgetContent[c(554)]()))),this[c(2163)](o((()=>this._refresh())))}[t(1504)](){const e=t;this[e(1646)].classList[e(349)](e(2041))||(this[e(1357)].style[e(2128)]=this._getSliderBackground(),this[e(1585)].style[e(702)]=this._getValue()/this[e(1389)]*(this[e(1357)][e(1645)]-1)+"px")}_updateViaSlider(e){const i=t,s=Math.max(Math[i(507)](e/(this[i(1357)][i(1645)]-1),1),0)*this[i(1389)];this[i(1429)](s),this._sliderTabElement.style.left=s/this[i(1389)]*(this[i(1357)].offsetWidth-1)+"px",this[i(2063)][i(1257)]()}}class Gi extends qi{constructor(i,s,n,o,r,a,h,c,l){const d=t;super(i,s,n,d(457),a,h);const u=d(2082)+Math[d(597)](1e8*Math[d(1339)]()),g=document.createElement("label");g[d(1033)]=o+":",g.setAttribute(d(1774),u),g.title=c;const m=document[d(1541)](d(438));m[d(1653)]=d(1896),m[d(507)]=a[d(452)](),m.max=h[d(452)](),m[d(436)]=r[d(452)](),m.id=u,m[d(2118)](d(438),(()=>this[d(1429)](parseInt(m[d(436)])))),m.addEventListener(d(1852),(()=>m[d(436)]=this._getValue().toString())),this[d(437)]=m;const f=document[d(1541)]("div");if(f[d(1777)][d(1492)](d(456)),f[d(813)](m),l){this[d(1381)]=document[d(1541)](d(1739)),this[d(1381)][d(1777)][d(1492)](d(925)),this._hiddenText[d(1033)]=m[d(436)],m[d(2118)](d(438),(()=>this[d(858)]())),m[d(2118)](d(2108),(()=>this[d(858)]())),this[d(2163)](this.onSliderChange((()=>this._syncHiddenText()))),this[d(2163)](n((()=>this[d(858)]())));const t=document[d(1541)]("div");t[d(1777)].add(d(2222)),t[d(813)](this._hiddenText,document.createTextNode(l)),f[d(813)](t)}this[d(2163)](n((()=>{const t=d;document[t(651)]!==m?(m[t(436)]=this[t(305)]().toString(),this._syncHiddenText()):this[t(858)]()}))),this._widgetContent[d(575)](g),this[d(1638)].append(f),this.register((0,e.OF)((()=>{g[d(554)](),m.remove()})))}[t(858)](){const e=t;this[e(1381)]&&(this[e(1381)][e(1033)]=this[e(437)][e(436)])}}const Xi=["r","g","b","a"];class Yi extends Gi{constructor(e,i,s){const n=t;super(e,i,e[n(2156)].onChange,s[n(732)](),e[n(2156)][n(1948)][n(1374)][Xi.indexOf(s)],0,255,"a"===s?n(1886):("r"===s?"Red":n("g"===s?1773:1794))+n(652),void 0),this[n(1318)]=s,this[n(1617)]=Xi[n(1159)](s),this[n(1504)]()}[t(633)](e){const i=t;return Math.max(Math.min(Math[i(597)](e)||0,255),0)}_getValue(){const e=t;return this[e(424)][e(2156)][e(1948)][e(1374)][Xi[e(1159)](this[e(1318)])]}_setValue(e){const i=t,s=(0,lt.FK)(this._luna[i(2156)][i(1948)][i(1374)]);s[this[i(1617)]]=this[i(633)](e),this._luna.palette.primary[i(1374)]=s}[t(962)](){const e=t;if(void 0===this._channelIndex)return e(2213);const i=this[e(424)][e(2156)][e(1948)].rgb,s=[0===this[e(1617)]?0:i[0],1===this[e(1617)]?0:i[1],2===this[e(1617)]?0:i[2],3===this[e(1617)]?0:1],n=[0===this._channelIndex?255:i[0],1===this._channelIndex?255:i[1],2===this._channelIndex?255:i[2],(this[e(1617)],1)];return e(559)+s[e(2030)](",")+") 0%, rgba("+n.join(",")+e(1791)}}class Ji extends e.JT{constructor(i,s){const n=t;super(),this[n(424)]=i,this[n(408)]=s,this[n(2092)]=document.createElement(n(1505)),this[n(2092)][n(1777)][n(1492)]("color-picker-rect"),this[n(2092)][n(2118)](n(1790),(t=>{const e=n;this[e(2092)][e(770)](t[e(1556)]),this[e(1901)][e(1777)].add(e(2041)),this._updateViaSlider(t)})),this[n(2092)][n(2118)](n(1914),(t=>this._updateViaSlider(t))),this[n(2092)][n(2118)]("pointerup",(t=>{const e=n;this[e(2092)][e(2087)](t[e(1556)]),this[e(1901)][e(1777)][e(554)](e(2041))})),this[n(361)]=document[n(1541)](n(1505)),this[n(361)][n(1777)][n(1492)](n(2103)),this[n(1901)]=document.createElement(n(1505)),this._innerContainer[n(1777)][n(1492)]("color-picker-container"),this[n(1901)][n(813)](this[n(2092)]),this[n(1901)][n(813)](this[n(361)]),this[n(408)][n(813)](this._innerContainer),this[n(1504)](),this[n(2163)]((0,e.OF)((()=>this._innerContainer[n(554)]()))),this[n(2163)](this[n(424)][n(2156)][n(1741)]((()=>{const t=n;!this[t(1901)][t(1777)].contains(t(2041))&&this._refresh()})))}[t(1691)](e){const i=t;if(!this[i(1901)].classList.contains(i(2041)))return;const s=(0,d.u)(e.offsetX/(this[i(2092)][i(1645)]-1),1,0),n=1-(0,d.u)(e[i(586)]/(this[i(2092)][i(1563)]-1),1,0),o=this[i(424)].palette.primary.hsv;this[i(424)][i(2156)][i(1948)][i(1297)]=lt.mC.createReadonlyHsvColor(o[0],s,n),this._targetElement[i(1728)][i(702)]=s*(this._rectangleElement.offsetWidth-1)+"px",this._targetElement[i(1728)][i(719)]=n*(this[i(2092)][i(1563)]-1)+"px",this._refresh()}[t(1504)](){const e=t,i=this[e(424)][e(2156)][e(1948)][e(1336)];this[e(361)][e(1728)].background="rgba("+i[0]+","+i[1]+","+i[2]+e(2141);const s=this[e(424)][e(2156)][e(1948)][e(1297)];!this[e(1901)].classList[e(349)](e(2041))&&(this[e(361)][e(1728)].left=s[1]*(this[e(2092)].offsetWidth-1)+"px",this._targetElement[e(1728)][e(719)]=s[2]*(this[e(2092)][e(1563)]-1)+"px");const n=lt.mC[e(1591)](lt.mC[e(1907)](s[0],1,1));this[e(2092)][e(1728)].background=e(1531)+(e(1414)+n[0]+",")+n[1]+","+n[2]+e(1791)}}let Ki=class extends e.JT{constructor(i,s){const n=t;super(),this._luna=i;const o=document.createElement(n(1505));o[n(1777)].add(n(316));const r=document[n(1541)](n(1474));r[n(1033)]=n(446),r[n(959)]("for",n(1894)),r[n(1863)]=n(450),this[n(1509)]=document[n(1541)](n(438)),this[n(1509)].id=n(1894),this[n(1509)][n(1603)]=n(692),this[n(1509)][n(1863)]=n(915),this[n(472)](),this[n(1509)][n(2118)](n(438),(()=>{const t=n,e=this._hexInputElement[t(436)];if(6===e[t(961)]){const i=(0,lt.FK)(this[t(424)][t(2156)][t(1948)][t(1336)]);i[0]=parseInt(e[t(979)](0,2),16),i[1]=parseInt(e[t(979)](2,4),16),i[2]=parseInt(e[t(979)](4,6),16),this[t(424)][t(2156)][t(1948)][t(1336)]=i}})),this[n(1509)][n(2118)](n(1594),(t=>{const e=n;switch(t.key){case e(453):this[e(1870)](t,ye.V5&&t.metaKey||!ye.V5&&t.ctrlKey?16:1);break;case e(1949):this._changeHexInput(t,ye.V5&&t[e(2057)]||!ye.V5&&t.ctrlKey?-16:-1);break;case e(1506):(ye.V5&&t.metaKey||!ye.V5&&t[e(914)])&&this[e(1870)](t,-255);break;case e(1467):(ye.V5&&t[e(2057)]||!ye.V5&&t.ctrlKey)&&this._changeHexInput(t,255)}})),this[n(1509)][n(2118)](n(1092),(()=>{const t=n,e=this[t(1509)].value;if(e[t(1189)](/^[0-9a-fA-F]+$/))if(3===e.length){const i=(0,lt.FK)(this[t(424)][t(2156)][t(1948)].rgb);i[0]=parseInt(e.substring(0,1).repeat(2),16),i[1]=parseInt(e[t(979)](1,2)[t(1382)](2),16),i[2]=parseInt(e[t(979)](2,3)[t(1382)](2),16),this[t(424)].palette[t(1948)][t(1336)]=i}else this[t(472)]();else this._resetHexInput()})),o[n(813)](r,this[n(1509)]),s.appendChild(o),this[n(2163)](this._luna[n(2156)][n(1741)]((()=>this[n(472)]()))),this[n(2163)]((0,e.OF)((()=>o[n(554)]())))}[t(472)](){const e=t;this[e(1509)]&&(this[e(1509)][e(436)]=this[e(2110)](this[e(424)][e(2156)].primary[e(1336)]))}[t(1870)](e,i){const s=t;if(!this[s(1509)])return;const n=this[s(1509)][s(551)],o=this[s(1509)][s(394)];if(null===n||null===o)return;const r=n<=1,a=n>1&&n<4||o>2&&o<4||n<=1&&o>=4,h=n>=4||o>4;if(!r&&!a&&!h)return;const c=(0,lt.FK)(this[s(424)][s(2156)][s(1948)].rgb);r&&(c[0]=Math[s(507)](255,Math[s(590)](0,parseInt(this[s(1509)][s(436)][s(979)](0,2),16)+i))),a&&(c[1]=Math[s(507)](255,Math[s(590)](0,parseInt(this[s(1509)][s(436)][s(979)](2,4),16)+i))),h&&(c[2]=Math.min(255,Math[s(590)](0,parseInt(this[s(1509)].value[s(979)](4,6),16)+i))),this[s(424)].palette[s(1948)][s(1336)]=c,e[s(1160)](),this[s(1509)].selectionStart=n,this[s(1509)][s(394)]=o}[t(2110)](e){const i=t;return""+this[i(307)](e[0])+this[i(307)](e[1])+this._channelToHex(e[2])}_channelToHex(e){const i=t;return e[i(452)](16)[i(2069)](2,"0").toUpperCase()}};var $i,Zi;Ki=function(e,i,s,n){const o=t;var r,a=arguments[o(961)],h=a<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,s):n;if(typeof Reflect===o(623)&&typeof Reflect[o(314)]===o(1524))h=Reflect[o(314)](e,i,s,n);else for(var c=e[o(961)]-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object[o(614)](i,s,h),h}([($i=0,Zi=si,function(t,e){Zi(t,e,$i)})],Ki);const Qi=["h","s","v"];class ts extends Gi{constructor(e,i,s){const n=t;super(e,i,e.palette[n(1741)],s[n(732)](),Math.round(e[n(2156)].primary.hsv[Qi[n(1159)](s)]*("h"===s?1:100)),0,"h"===s?360:100,n("h"===s?1922:"s"===s?1566:1902)+n(2194),"h"===s?void 0:"%"),this[n(1318)]=s,this[n(1617)]=Qi[n(1159)](s),this[n(1504)]()}[t(633)](e){const i=t;return Math[i(590)](Math[i(507)](Math[i(597)](e)||0,this[i(1389)]),0)}[t(305)](){const e=t,i=this[e(424)].palette[e(1948)][e(1297)][Qi.indexOf(this[e(1318)])];return Math.round(i*("h"===this[e(1318)]?1:100))}[t(1429)](e){const i=t,s=this[i(633)](e);if("h"===this[i(1318)])this[i(424)][i(2156)][i(1948)][i(780)]=s;else{const t=this[i(424)][i(2156)].primary.hsv;let e;e="s"===this[i(1318)]?lt.mC[i(1907)](t[0],s/100,t[2]):lt.mC[i(1907)](t[0],t[1],s/100),this[i(424)].palette.primary[i(1297)]=e}}[t(962)](){const e=t;if(void 0===this[e(1617)])return e(2213);if("h"===this[e(1318)])return e(2007);const i=this[e(424)][e(2156)].primary[e(1297)],s=[0===this[e(1617)]?0:i[0],1===this._channelIndex?0:Math[e(597)](100*i[1]),2===this[e(1617)]?0:Math[e(597)](100*i[2])],n=[0===this._channelIndex?360:i[0],1===this[e(1617)]?100:Math[e(597)](100*i[1]),2===this._channelIndex?100:Math.round(100*i[2])];return"linear-gradient(90deg, hsl("+s[0]+","+s[1]+"%,"+s[2]+e(902)+n[0]+","+n[1]+"%,"+n[2]+e(362)}}class es extends qi{constructor(e,i){const s=t;super(e,i,e[s(2156)][s(1741)],"hue",0,360)}[t(305)](){const e=t;return this._luna[e(2156)][e(1948)][e(780)]}[t(1429)](e){const i=t;this._luna[i(2156)][i(1948)][i(780)]=e>360?e%360:e}[t(962)](){return t(2007)}}var is=function(t,e){return function(i,s){e(i,s,t)}};let ss=class extends ji{constructor(i,s,n,o,r){const a=t;super(a(803),i,a(1487)),this[a(424)]=s,this._colorService=n,this[a(1974)]=o,this[a(1630)]=r[a(1618)](0,!0),this[a(2163)](this[a(2122)]((t=>this[a(1630)][a(2112)](t))));const h=this[a(1884)](a(1114),a(371),this[a(1720)].showColorDetails,a(2116));this[a(1720)][a(1989)]((t=>{const e=a;h[e(1376)]=t,this[e(1163)]()})),this[a(310)].append(h),this._luna[a(2156)].primary.rgba=lt.m4[a(1244)](0,0,0,255),this[a(424)][a(2156)][a(1903)].rgba=lt.m4[a(1244)](255,255,255,255);const c=document[a(1541)](a(1505));c[a(1777)].add(a(1956)),this[a(1e3)]=this._createColorInfo("primary"),this[a(1081)]=this[a(1927)](a(1903));const l=document[a(1541)]("button");l[a(1777)][a(1492)](a(886),a(1246)),this[a(2163)]((0,e.Lw)(l,a(1340),(()=>o[a(488)](a(985))))),c[a(813)](this[a(1e3)][a(1022)],this[a(1081)][a(1022)],l);const d=document[a(1541)](a(1505));d[a(1777)][a(1492)](a(702)),d[a(813)](c);const u=document.createElement(a(1505));u[a(1777)][a(1492)](a(988)),this[a(2209)]=document[a(1541)]("div"),this[a(2209)].classList[a(1492)](a(557)),this.register(new Ji(this[a(424)],u)),this[a(2163)](new es(this[a(424)],u)),this[a(952)].append(d,u,this[a(2209)]),this[a(2163)]((0,e.OF)((()=>{const t=a;(0,e._c)(this[t(1364)]),this[t(1364)]=void 0,d[t(554)](),u[t(554)]()}))),this._refresh(),this[a(2163)](this._luna[a(2156)].onChange((()=>this[a(1504)]())))}[t(1927)](e){const i=t,s=document[i(1541)](i(1505));s.id=e,s.classList[i(1492)](e);const n=document[i(1541)](i(1505));return n[i(1777)].add(i(1315)),s.appendChild(n),n}_refresh(){const e=t,i=this[e(424)].palette[e(1948)][e(1374)],s=i[0]+","+i[1]+","+i[2];this[e(1e3)][e(1728)][e(2128)]="linear-gradient(180deg, rgba("+s+",1) 0%, rgba("+s+","+i[3]/255+") 100%)";const n=this[e(424)][e(2156)][e(1903)][e(1374)],o=n[0]+","+n[1]+","+n[2];this[e(1081)].style[e(2128)]=e(1898)+o+e(827)+o+","+n[3]/255+e(1791)}[t(1884)](e,i,s,n){const o=t,r=document[o(1541)](o(438));return r[o(1653)]="checkbox",r.id=e,r[o(1376)]=s,r[o(1863)]=n,r[o(1777)].add(e,o(1246)),r[o(2118)](o(1340),(()=>this[o(1974)][o(488)](i))),r}[t(1163)](){const i=t;if(this[i(1720)][i(1206)]){if(!this[i(1364)]&&!this[i(1509)]){this[i(1364)]=[];for(const t of Xi)this[i(1364)][i(2226)](new Yi(this[i(424)],this._rightElement,t));this._colorDetailsDisposables[i(2226)](new Ki(this[i(424)],this._rightElement));for(const t of Qi)this[i(1364)][i(2226)](new ts(this[i(424)],this[i(2209)],t))}}else(0,e._c)(this[i(1364)]),this._colorDetailsDisposables=void 0,this[i(1509)]=void 0}};ss=function(e,i,s,n){const o=t;var r,a=arguments[o(961)],h=a<3?i:null===n?n=Object[o(656)](i,s):n;if("object"==typeof Reflect&&typeof Reflect[o(314)]===o(1524))h=Reflect[o(314)](e,i,s,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object[o(614)](i,s,h),h}([is(1,si),is(2,vi),is(3,He),is(4,ze)],ss);class ns extends e.JT{constructor(e){const i=t;super(),this._luna=e,this[i(358)]=!1,this._onStateChange=this[i(2163)](new n.v),this.onStateChange=this[i(1752)][i(993)],this[i(424)][i(2156)][i(1741)]((()=>{const t=i;!this._ignoreStateChangeEvents&&this[t(1752)].fire({global:!0})}))}saveState(){const e=t;return{primary:Array[e(1045)](this[e(424)][e(2156)][e(1948)].rgba),secondary:Array[e(1045)](this[e(424)][e(2156)][e(1903)].rgba)}}[t(532)](e){const i=t;this[i(358)]=!0,this[i(424)][i(2156)][i(1948)].rgba=lt.m4.createReadonlyRgbaColor(e[i(1948)][0],e[i(1948)][1],e[i(1948)][2],e.primary[3]),this._luna[i(2156)][i(1903)][i(1374)]=lt.m4[i(1244)](e[i(1903)][0],e[i(1903)][1],e.secondary[2],e[i(1903)][3]),this._ignoreStateChangeEvents=!1}}Ei[t(2163)]({start(e){const i=t,s=e[i(1270)](si);e[i(1270)](ci)[i(1084)]("palette",new ns(s))}}),Wi({id:"color.toggleColorsWindow",label:t(1350),section:t(2013),checked:0,run:e=>e.get(hi)[t(879)](t(803))}),Wi({id:t(985),label:"Swap Colors",section:"Colors",run:e=>e[t(1270)](si)[t(2156)].swap(),keys:"x"}),Wi({id:t(371),label:t(754),section:"Colors",run:e=>{const i=t,s=e[i(1270)](vi);s[i(1206)]=!s[i(1206)]}}),gi[t(2163)](t(803),{ctor:ss,defaultVisible:!0,defaultPosition:{x:"start",y:"end"}});class os extends e.JT{constructor(e,i){const s=t;super(),this[s(952)]=document[s(1541)](s(1505)),this[s(952)].id=i[s(1386)]()[s(1408)](/ /g,""),this[s(952)][s(1777)].add(s(1195),s(2127)),e[s(828)](this[s(952)]),this[s(2163)]({dispose:()=>{const t=s;e[t(1221)](this[t(952)])}})}}let rs=class extends os{constructor(e,i){const s=t;super(e,s(2153)),this[s(1974)]=i,this._listItemElements=[];const n=document[s(1541)](s(1505));n[s(1777)][s(1492)](s(537)),this[s(800)]=document[s(1541)](s(438)),this[s(800)].type="text",this[s(800)][s(2118)](s(438),(()=>this[s(561)]())),this[s(800)][s(2118)]("keydown",(t=>this[s(1210)](t))),n[s(828)](this[s(800)]);const o=document[s(1541)]("ul");o.classList.add(s(483));for(let t=0;t<18;t++)this._listItemElements[s(2226)](this[s(1516)]());o[s(813)](...this._listItemElements),this[s(561)](),this[s(952)][s(1777)].add(s(302)),this[s(952)][s(813)](n,o),this[s(800)][s(908)]()}[t(1516)](){return document[t(1541)]("li")}[t(561)](){const e=t,i=this._commandService[e(2202)](this[e(800)][e(436)],18);let s=0;for(;s<i.length;s++){const t=i[s],n=this[e(1987)][s];n.textContent=t.section+": "+t[e(1474)],n.classList.remove(e(925))}for(;s<18;s++)this[e(1987)][s][e(1777)].add(e(925))}[t(1210)](e){const i=t;if("Enter"===e[i(2181)]){const t=this[i(1974)][i(2202)](this[i(800)][i(436)],18);return t[i(961)]>0&&this._commandService[i(488)](t[0].id),void this.dispose()}}};var as;let hs;async function cs(e){const i=t,n=document[i(651)];if(n?.[i(1552)]===i(1293)){const t=n;let e;return e=null===t[i(551)]||null===t[i(394)]||t[i(551)]===t[i(394)]?t[i(436)]:t[i(436)].substring(t.selectionStart,t[i(394)]),void navigator[i(1918)][i(2056)](e)}const o=e[i(1270)](si);if(!o.selection.range)return;const r=o.layer[i(327)];if(!r)return;const a=await r.exportBlob({range:o.selection[i(1767)],useMovingLayer:!0});hs=o[i(1435)][i(1767)],await as[i(1345)](a),o[i(331)][i(909)](i(2089)+(0,s.Oq)(o.selection.range)+"x"+(0,s.rY)(o.selection.range)+i(1652))}var ls,ds;rs=function(e,i,s,n){const o=t;var r,a=arguments[o(961)],h=a<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,s):n;if(typeof Reflect===o(623)&&typeof Reflect.decorate===o(1524))h=Reflect[o(314)](e,i,s,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object[o(614)](i,s,h),h}([(ls=1,ds=He,function(t,e){ds(t,e,ls)})],rs),Wi({id:t(783),label:t(1123),section:t(599),run:e=>{e[t(1270)](We).createInstance(rs,document.body)},keys:[t(390),"f1"]}),function(e){const i=t;e[i(1345)]=async function(t){const e=a2_0x43a7,i=new ClipboardItem({"image/png":t});if(!(e(1345)in navigator.clipboard))throw new Error(e(1007));await navigator.clipboard[e(1345)]([i])},e.canRead=async function(){const t=i;return(await navigator[t(861)][t(674)]({name:"clipboard-read"})).state!==t(910)||(console[t(2018)](t(2101)),!1)},e[i(930)]=async function(){const t=i;if((await navigator[t(861)].query({name:t(1710)}))[t(875)]===t(910))return void console[t(2018)](t(2101));const e=await navigator[t(1918)][t(930)]();for(const i of e){if(i[t(2190)][t(810)](t(984)))return await i[t(682)](t(984));console[t(821)](t(1783))}}}(as||(as={})),Ei.register({start(e){const i=t,s=e.get(si),n=e[i(1270)](ze)[i(1618)](10,!1),o=e[i(1270)](ze)[i(1618)](9,!1);s[i(370)][i(1976)]((()=>{const t=i;n[t(2112)](s[t(370)][t(445)]),o[t(2112)](s[t(370)][t(2224)])}))}}),Wi({id:"edit.cut",label:"Cut",section:t(1564),run:function(e){const i=t,s=e[i(1270)](si);return s[i(370)].createCompositeEntry(i(413),(async()=>{const t=i;await cs(e),await s[t(1435)].erase()}))},keys:t(762)}),Wi({id:t(1274),label:t(1037),section:t(1564),run:cs,keys:t(1036)}),Wi({id:"edit.paste",label:t(1227),section:"Edit",run:async function(e){const i=t,s=e[i(1270)](si),n=s[i(1866)][i(327)];if(!n)return;if(!as[i(2093)]())return;await s[i(1866)][i(1303)]();const o=await as[i(930)]();o&&await s[i(370)][i(1908)]("Paste Image",(()=>n[i(1001)](o,hs)))},keys:t(1348)}),Wi({id:t(1060),label:t(1695),section:"Edit",run:e=>e.get(si)[t(370)].redo(),keys:ye.V5?t(1423):t(1358),enabled:10}),Wi({id:t(520),label:"Undo",section:"Edit",run:e=>e[t(1270)](si)[t(370)][t(1090)](),keys:"cmdctrl+z",enabled:9}),Wi({id:t(1442),label:t(2095),section:t(1472),run:e=>e[t(1270)](si)[t(1733)][t(883)](20,15),keys:"ctrl+n"}),Wi({id:t(346),label:t(995),section:"File",run:async e=>e[t(1270)](Qe)[t(318)](),keys:"ctrl+o"}),Wi({id:t(1281),label:t(2173),section:t(1472),run:async e=>e[t(1270)](Qe)[t(1387)](),keys:t(1555)}),Wi({id:"file.saveAs",label:t(863),section:t(1472),run:async e=>e[t(1270)](Qe).saveAs(),keys:t(341)});var us=function(t,e){return function(i,s){e(i,s,t)}};let gs=class e extends ji{constructor(e,i,s){const n=t;super(n(370),e,n(892)),this[n(424)]=i,this[n(482)]=s,this[n(1987)]=[],this[n(1630)]=this[n(482)][n(1618)](7,!0),this[n(2163)](this.onDidChangeVisibility((t=>this[n(1630)].set(t)))),this[n(697)]=document.createElement("ul"),this[n(697)][n(1777)][n(1492)](n(2039)),this[n(2163)](this[n(424)].history[n(1976)]((()=>this[n(1283)]()))),this[n(1283)](),this._contentElement[n(828)](this._listElement)}[t(1283)](){const i=t,s=document[i(986)](),n=this[i(424)][i(370)][i(1521)];let o,r=!1,a=!1;for(const[t,h]of this._luna[i(370)].entries.entries()){let c;if(t<this[i(1987)][i(961)])c=this[i(1987)][t];else{c=document[i(1541)]("li"),c[i(681)]=0;const n=async()=>{const s=i;if(!this[s(424)][s(370)][s(1521)])return;const n=t-this[s(424)].history[s(1832)].indexOf(this[s(424)].history.activeEntry),o=n>0?e[s(546)]?e.redoHandler:this[s(424)][s(370)][s(568)]:e.undoHandler?e[s(1558)]:this[s(424)][s(370)][s(1090)];for(let t=0;t<Math[s(791)](n);t++)await o()};c[i(2118)](i(1340),(()=>n())),c[i(2118)](i(1594),(t=>{const e=i;switch(t.key){case e(453):c.previousSibling?.[e(908)](),t[e(1160)](),t[e(1300)]();break;case e(1949):c[e(471)]?.focus(),t[e(1160)](),t[e(1300)]();break;case e(2167):case e(375):n(),t[e(1160)](),t[e(1300)]()}})),s.appendChild(c),this[i(1987)].push(c)}c[i(1033)]=h[i(392)],c.classList.toggle(i(568),r),a=h===n,c[i(1777)][i(1882)](i(2041),a),a&&(r=!0,o=c)}for(this._listElement[i(828)](s);this[i(1987)].length>this[i(424)][i(370)][i(1832)].length;)this[i(697)][i(1221)](this._listItemElements[i(2003)]());o?(this._contentElement[i(2050)]+this[i(697)][i(1017)]>o[i(1017)]||this[i(952)].scrollTop<o[i(1017)]-this[i(952)].offsetHeight)&&(this[i(952)][i(2050)]=o[i(1017)]-this[i(697)].offsetTop):this._contentElement[i(2050)]=this[i(952)][i(2185)]}};gs=function(e,i,s,n){const o=t;var r,a=arguments[o(961)],h=a<3?i:null===n?n=Object[o(656)](i,s):n;if(typeof Reflect===o(623)&&typeof Reflect[o(314)]===o(1524))h=Reflect[o(314)](e,i,s,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object.defineProperty(i,s,h),h}([us(1,si),us(2,ze)],gs),gi[t(2163)](t(370),{ctor:gs,defaultVisible:!0,defaultPosition:{x:t(1799),y:"start"}}),Wi({id:t(1992),label:t(1813),section:t(2013),checked:7,run:e=>e[t(1270)](hi).toggleView(t(370))});let ms=class extends e.JT{constructor(e){const i=t;super(),this._lunaService=e,this[i(1696)]=1,this[i(1663)]=1,this[i(1874)]=i(1722),this.hasImage=!0,this.commandId="image.resize",this[i(1817)]=this[i(2163)](new n.v),this[i(1025)]=this[i(1817)][i(993)],this[i(2010)][i(1866)].onDidChangeDimensions((()=>this[i(1678)]())),this[i(1678)]()}[t(1678)](){const e=t;(this[e(500)]!==this._lunaService[e(1866)][e(1847)]||this[e(1615)]!==this[e(2010)][e(1866)][e(1096)])&&(this._width=this._lunaService.layer[e(1847)],this[e(1615)]=this[e(2010)][e(1866)][e(1096)],this[e(2199)]=this[e(500)]+e(1959)+this._height,this.title="Image size is "+this[e(500)]+" pixels wide by "+this[e(1615)]+e(1240),this._onUpdate[e(1257)]())}};var fs,ps;ms=function(e,i,s,n){const o=t;var r,a=arguments[o(961)],h=a<3?i:null===n?n=Object[o(656)](i,s):n;if(typeof Reflect===o(623)&&"function"==typeof Reflect[o(314)])h=Reflect[o(314)](e,i,s,n);else for(var c=e[o(961)]-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object[o(614)](i,s,h),h}([(fs=0,ps=si,function(t,e){ps(t,e,fs)})],ms);var _s=function(t,e){return function(i,s){e(i,s,t)}};let ws=class extends ji{constructor(i,s,n,o,r,a){const h=t;super(h(2191),i,"Images"),this[h(424)]=s,this[h(1974)]=n,this._contextKeyService=o,this[h(1002)]=r,this[h(814)]=a,this[h(751)]=new Map,this[h(740)]=new Map,this[h(1630)]=this._contextKeyService[h(1618)](2,!0),this[h(2163)](this[h(2122)]((t=>this._windowVisibleContextKey[h(2112)](t)))),this._imageListElement=document[h(1541)](h(1505)),this[h(1543)].classList[h(1492)](h(2142));const c=document[h(1541)](h(1505));c[h(1777)][h(1492)](h(859)),c[h(813)](this._createButton(h(1843),(()=>this[h(1974)][h(488)]("image.addNewImage")),"Create a new image"),this._createButton(h(1380),(()=>this[h(424)][h(1109)].deleteImage()),h(1346)),this[h(1023)](h(964),(()=>this[h(424)][h(1109)][h(340)]()),h(321)),this._createButton(h(1091),(()=>this[h(424)][h(1109)][h(847)]()),h(1869))),this[h(952)][h(813)](this[h(1543)],c),this[h(2163)](this[h(424)][h(1109)].onImagesChange((()=>this._renderImages()))),this.register({dispose:()=>{const t=h;for(const i of this[t(751)].values())(0,e._c)(i[t(1409)])}}),this[h(1933)]()}_createButton(e,i,s){const n=t,o=document.createElement(n(312));o.id=e,o.title=s;const r=document.createElement(n(1299));return o.appendChild(r),o.classList[n(1492)](e,n(1246)),o.addEventListener("click",i),o}[t(1400)](){const e=t,i=this[e(424)].image[e(1402)];if(this[e(740)].clear(),i)for(const t of i)this[e(740)][e(2112)](t.id,t)}[t(1933)](){const i=t,s=this[i(424)][i(1109)].imageSet,n=this[i(424)].image[i(1503)];if(!s||void 0===n)return;this[i(1400)]();let o=null;const r=s;for(let t=r[i(961)]-1;t>=0;t--){const s=t,a=r[t].id;if(!this._imageListItems[i(1359)](a)){const t={container:document.createElement("div"),nameSpan:document.createElement("span"),previewCanvas:document[i(1541)](i(890)),disposables:[]};t[i(782)].classList[i(1492)](i(1667)),t[i(1792)][i(1777)][i(1492)](i(505)),t[i(1792)][i(1847)]=40,t[i(1792)][i(1096)]=40;let n=!1;t.disposables[i(2226)](this[i(424)][i(1866)][i(1290)]((()=>n=!0))),this[i(944)].push(this._luna.history[i(1976)]((()=>{n&&(this._generatePreview(a,t),n=!1)}))),this._generatePreview(a,t),t[i(782)][i(828)](t[i(1792)]),t[i(782)].tabIndex=0,t[i(782)][i(1396)]=!0,t.disposables[i(2226)]((0,e.Lw)(t[i(782)],i(1020),(t=>{const e=i;this[e(952)][e(1777)].add(e(1080)),t[e(1003)]&&(t.dataTransfer[e(1255)]=e(871),t[e(1003)].effectAllowed=e(871),t[e(1003)][e(1143)](e(648),e(1924)+l.id)),t[e(1300)]()}))),t[i(1409)].push((0,e.Lw)(t.container,"dragend",(()=>{const t=i;this[t(952)].classList[t(554)](t(1080))}))),t.disposables.push((0,e.Lw)(t[i(782)],i(1786),(e=>{const s=i;t[s(782)][s(1777)][s(554)](s(1562));const n=this[s(1098)](e);n&&(this._luna[s(1109)].moveImageTo(n,l.id),setTimeout((()=>{const t=s;this[t(751)][t(1270)](n)?.[t(782)][t(908)]()}))),e[s(1300)]()}))),t.disposables[i(2226)]((0,e.Lw)(t[i(782)],i(1225),(e=>{const s=i,n=this[s(1098)](e);l.id!==n&&(e[s(1160)](),t[s(782)][s(1777)][s(1492)](s(1562)))}))),t.disposables[i(2226)]((0,e.Lw)(t[i(782)],i(1461),(e=>{const s=i;t[s(782)].classList.remove(s(1562))}))),t[i(966)].classList.add(i(1121)),t[i(782)][i(2118)](i(1340),(()=>this._setActiveItem(a))),t[i(782)][i(2118)](i(1115),(async t=>{const e=i;switch(t[e(1160)](),t.stopImmediatePropagation(),await this[e(1002)][e(787)]([{id:"duplicate",label:e(1152)},{id:e(1367),label:e(655)}])){case"duplicate":await this[e(424)][e(1109)].duplicateImage(l);break;case"delete":await this[e(424)][e(1109)][e(1333)](l)}})),t[i(782)][i(2118)]("keydown",(async e=>{const n=i;switch(e[n(2181)]){case"ArrowUp":t[n(782)].previousSibling?.[n(908)](),e[n(1160)]();break;case n(1949):t.container[n(471)]?.focus(),e[n(1160)]();break;case n(2167):case"Space":await this._setActiveItem(s)}})),t[i(782)].appendChild(t[i(966)]),this[i(751)][i(2112)](a,t),t[i(1409)][i(2226)](this[i(424)].image[i(2180)]((e=>{const s=i;if(e===a){this[s(1543)][s(1221)](t[s(782)]);for(const e of t[s(1409)])e.dispose();this._imageListItems[s(1367)](a)}})))}const h=this[i(751)][i(1270)](a),c=t===n;h[i(782)][i(1777)].toggle(i(2041),c);const l=this[i(740)].get(a);this[i(779)](l,h),null===o?(!h.container[i(1022)]||null!==h[i(782)][i(1051)])&&(this[i(1543)][i(611)]?this[i(1543)][i(722)](h.container,this[i(1543)].firstChild):this[i(1543)][i(828)](h[i(782)])):h[i(782)][i(1051)]!==o&&o[i(1512)](i(941),h[i(782)]),o=h[i(782)]}}async _generatePreview(e,i){const s=t;this[s(1400)]();const n=this._imagesMap[s(1270)](e);if(!n)return;const o=new ImageData(new Uint8ClampedArray(n[s(1218)]),n[s(1847)],n[s(1096)]),r=await createImageBitmap(o),a=i.previewCanvas.getContext("2d");a[s(1405)](0,0,40,40),n[s(1847)]>=40||n.width>=40?a.drawImage(r,0,0,40,40):a[s(1312)](r,Math[s(597)]((40-n[s(1847)])/2),(40-n[s(1096)])/2,n.width,n[s(1096)]),this[s(779)](n,i)}[t(779)](e,i){const s=t,n=[-1===e[s(895)]?s(1166):e[s(895)]+s(765)];e[s(1176)]&&n.push("("+(e.mimeType===s(2019)?s(928):s(844))+")"),i[s(966)][s(1033)]=e.width+"x"+e[s(1096)]+(n[s(961)]>0?s(1993)+n[s(2030)](" "):"")}async[t(798)](e){const i=t,s=this._luna[i(1109)][i(1402)]?.[i(1108)]((t=>t.id===e));-1!==s&&await this._luna[i(1109)][i(1811)](s)}[t(1098)](e){const i=t;if(e.dataTransfer){const t=e[i(1003)][i(490)](i(648));if(t?.[i(996)](i(1924)))return parseInt(t[i(979)](13))}}};ws=function(e,i,s,n){const o=t;var r,a=arguments[o(961)],h=a<3?i:null===n?n=Object[o(656)](i,s):n;if(typeof Reflect===o(623)&&typeof Reflect[o(314)]===o(1524))h=Reflect[o(314)](e,i,s,n);else for(var c=e[o(961)]-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object[o(614)](i,s,h),h}([_s(1,si),_s(2,He),_s(3,ze),_s(4,Ze),_s(5,ai)],ws);let ys=class extends e.JT{constructor(e){const i=t;super(),this[i(2010)]=e,this[i(1696)]=1,this[i(1663)]=1,this[i(1874)]=i(887),this[i(1769)]=!0,this[i(1294)]=!1,this[i(695)]="image.resize",this._onUpdate=this[i(2163)](new n.v),this.onUpdate=this[i(1817)][i(993)],this[i(2010)][i(838)][i(1239)]((t=>this[i(1678)](t)))}[t(1678)](e){const i=t;this[i(1294)]=!!e,e&&(this.text=e[0]+","+e[1]),this._onUpdate[i(1257)]()}};var vs,bs;ys=function(e,i,s,n){const o=t;var r,a=arguments[o(961)],h=a<3?i:null===n?n=Object[o(656)](i,s):n;if(typeof Reflect===o(623)&&"function"==typeof Reflect[o(314)])h=Reflect[o(314)](e,i,s,n);else for(var c=e[o(961)]-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object[o(614)](i,s,h),h}([(vs=0,bs=si,function(t,e){bs(t,e,vs)})],ys);var xs=function(e,i,s,n){const o=t;var r,a=arguments[o(961)],h=a<3?i:null===n?n=Object[o(656)](i,s):n;if(typeof Reflect===o(623)&&typeof Reflect.decorate===o(1524))h=Reflect[o(314)](e,i,s,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object[o(614)](i,s,h),h},Is=function(t,e){return function(i,s){e(i,s,t)}};let Ss=class extends e.JT{constructor(e,i){const s=t;super(),this[s(2010)]=e,this[s(1170)]=i,this[s(1696)]=1,this.alignment=1,this[s(1874)]=s(2166),this[s(1769)]=!0,this[s(1294)]=!0,this[s(1863)]=s(700),this.commandId=s(1129),this[s(1817)]=this[s(2163)](new n.v),this[s(1025)]=this._onUpdate[s(993)],this[s(2010)][s(838)][s(1239)]((t=>{const e=s;this[e(545)]=t,this[e(1678)](t)})),this[s(2010)][s(1866)][s(1290)]((()=>this._update(this._lastCoord)))}_update(e){const i=t,s=this._workbenchConfigService[i(1689)][i(2218)]===i(1432);let n;e&&(n=this._lunaService.layer[i(2064)](e[0],e[1],s));const o=n?n[0]+","+n[1]+","+n[2]+","+n[3]:"";this[i(2199)]!==o&&(this[i(2199)]=o,this[i(1817)].fire())}};xs([mi(50)],Ss[t(1454)],t(1678),null),Ss=xs([Is(0,si),Is(1,Ye)],Ss),gi[t(2163)]("images",{ctor:ws,defaultVisible:!1,defaultPosition:{x:"end",y:{target:"minimap",side:t(1799)}}}),Ei[t(2163)]({start(e){const i=t,s=e[i(1270)](ni),n=e.get(We);s[i(1577)](n.createInstance(Ss)),s[i(1577)](n[i(1508)](ys)),s.createItem(n.createInstance(ms))}}),Wi({id:t(917),label:t(2070),section:"Window",checked:2,run:e=>{const i=t;if(void 0===e[i(1270)](si)[i(1109)][i(1402)])throw new Error(i(525));e[i(1270)](hi).toggleView(i(2191))}}),Wi({id:t(2060),label:t(1181),section:t(1533),enabled:11,run:async e=>{const i=t,s=e[i(1270)](ai),{width:n,height:o}=await s.requestNewDimensions(),r=await s[i(1151)]("How many bits per pixel should be used for the image?",[{id:"1",label:i(1502),description:"2 colors"},{id:"4",label:i(304),description:"16 colors"},{id:"8",label:"8-bit",description:i(1628)},{id:"24",label:i(904),description:i(589)},{id:"32",label:"32-bit",description:i(1178)}]);if(void 0!==r)return e[i(1270)](si)[i(1109)][i(439)](n,o,parseInt(r))}}),Wi({id:t(1892),label:"Delete Image",section:t(1533),enabled:11,run:async e=>e.get(si)[t(1109)][t(1333)]()}),Wi({id:"image.goToTopImage",label:t(1419),section:t(1533),run:e=>e[t(1270)](si)[t(1109)].goToTopImage()}),Wi({id:t(1106),label:"Go to Bottom Image",section:t(1533),run:e=>e[t(1270)](si)[t(1109)].goToBottomImage()}),Wi({id:t(1537),label:t(2186),section:t(1533),run:e=>e[t(1270)](si)[t(1109)].goToImageAbove()}),Wi({id:"image.goToImageBelow",label:t(1458),section:t(1533),run:e=>e[t(1270)](si)[t(1109)][t(1320)]()}),Wi({id:t(529),label:"Move Image to Top",section:t(1533),run:e=>e.get(si)[t(1109)].moveImageToTop()}),Wi({id:t(1664),label:t(1416),section:"Image",run:e=>e.get(si).image[t(340)]()}),Wi({id:t(333),label:"Move Image Down",section:t(1533),run:e=>e[t(1270)](si).image[t(847)]()}),Wi({id:"image.moveImageToBottom",label:t(1379),section:t(1533),run:e=>e.get(si)[t(1109)][t(744)]()}),Wi({id:"image.cropToSelection",label:t(658),section:"Image",run:async e=>{const i=t,s=e[i(1270)](si);await s.task[i(1877)]("layer/cropToSelection",{selection:s[i(1435)][i(1767)]})},keys:t(1066),enabled:8}),Wi({id:t(1305),label:t(980),section:t(1533),run:async e=>{const i=t,s=e[i(1270)](si);await s[i(1055)][i(1877)]("layer/expandCanvasToSelection",{selection:s[i(1435)][i(1767)]}),s[i(838)].fitToWindow()},enabled:8}),Wi({id:t(1110),label:t(1032),section:t(1533),run:async e=>{const i=t,s=await e.get(si),n=await e[i(1270)](ai)[i(336)](i(1222));await s[i(1055)][i(1877)](i(1222),n)},keys:t(1212)}),Wi({id:t(792),label:t(1258),section:"Image",run:async e=>{const i=t,s=e[i(1270)](si),n=await e[i(1270)](ai).requestLayerTaskOptions(i(1418));await s[i(1055)][i(1877)]("layer/resizeCanvas",n)},keys:t(1323)}),Wi({id:"image.flipHorizontal",label:t(1133),section:t(1533),run:async e=>{const i=t,s=e[i(1270)](si);await s[i(1055)][i(1877)](i(2193),{selection:s[i(1435)][i(1767)]})}}),Wi({id:t(1780),label:t(414),section:t(1533),run:async e=>{const i=t,s=e[i(1270)](si);await s[i(1055)].executeOnAllLayers("layer/flipVertical",{selection:s[i(1435)][i(1767)]})}}),Wi({id:t(898),label:"Rotate 180Â°",section:"Image",run:async e=>{const i=t,s=e.get(si);await s.task[i(1877)](i(2160),{selection:s[i(1435)][i(1767)]})},keys:t(534)}),Wi({id:t(927),label:"Rotate 90Â° Clockwise",section:t(1533),run:async e=>{const i=t,s=e[i(1270)](si);await s[i(1055)][i(1877)](i(1302),{selection:s[i(1435)][i(1767)]})},keys:t(593)}),Wi({id:"image.rotate90CounterClockwise",label:t(907),section:"Image",run:async e=>{const i=t,s=e.get(si);await s[i(1055)][i(1877)](i(581),{selection:s[i(1435)][i(1767)]})},keys:t(757)}),Wi({id:t(1681),label:t(758),section:t(1533),run:e=>e[t(1270)](si)[t(1866)].flattenLayers(),keys:"ctrl+shift+f"}),Wi({id:t(1745),label:t(2049),section:"Image",run:e=>e[t(1270)](si)[t(1866)][t(1303)](),keys:t(475)}),Wi({id:t(1129),label:t(635),section:t(1533),run:async e=>{const i=t,s=e[i(1270)](Ye),n=s.config[i(2218)],o=await e[i(1270)](ai).requestQuickPick("What pixel color do you want to show?",[{id:i(1068),label:i(2021),description:"currentLayer"===n?i(949):void 0,detail:"The color of only the current layer"},{id:i(1432),label:"Image",description:n===i(1432)?"Active":void 0,detail:i(1940)}]);if(o)switch(o){case i(1068):s[i(1689)]={...s[i(1689)],statusBarPointerColor:i(1068)};break;case i(1432):s[i(1689)]={...s[i(1689)],statusBarPointerColor:i(1432)}}}}),Ei[t(2163)]({start:()=>{const e=t;document[e(1093)](e(1192))[e(2149)]((t=>{const i=e;t.addEventListener(i(1594),(t=>{const e=i,s=t.target?.[e(1552)];if("SELECT"===s){t[e(1280)]();const i=new Event(e(438),{bubbles:!0});return void t.target[e(2025)](i)}if(s!==e(1293))return;const n=t[e(1696)];if(n.type===e(2199))return void((ye.V5&&!t[e(2057)]||!ye.V5&&!t[e(914)])&&t[e(1280)]());if(n[e(1653)]!==e(1896))return;let o;if(ye.V5&&t[e(2057)]||!ye.V5&&t[e(914)])switch(t[e(2181)]){case e(453):o=parseInt(n[e(436)])+10;break;case e(1949):o=parseInt(n[e(436)])-10;break;case e(1506):o=""!==n[e(507)]?parseInt(n[e(507)]):void 0;break;case e(1467):o=""!==n[e(590)]?parseInt(n[e(590)]):void 0}else switch(t[e(2181)]){case"ArrowUp":o=parseInt(n[e(436)])+1;break;case e(1949):o=parseInt(n.value)-1;break;case e(1506):case"ArrowRight":return void t[e(1300)]()}if(void 0===o)return;""!==n[e(507)]&&(o=Math[e(590)](o,parseInt(n[e(507)]))),""!==n.max&&(o=Math[e(507)](o,parseInt(n[e(590)]))),n[e(436)]=o.toString(),t[e(1160)](),t[e(1300)]();const r=new Event(e(438),{bubbles:!0});n.dispatchEvent(r)})),t[i(2118)](i(866),(t=>{const e=i,s=t[e(1696)]?.[e(1552)];if(s!==e(1293))return;const n=t.target;if(n.type!==e(1896))return;const o=parseInt(n[e(436)]);if(isNaN(o))n[e(436)]=n[e(507)];else{const t=parseInt(n.min);if(!isNaN(t)&&o<t)n[e(436)]=n.min;else{const t=parseInt(n[e(590)]);!isNaN(t)&&o>t&&(n[e(436)]=n[e(590)])}}}))}))}});var Cs=function(t,e){return function(i,s){e(i,s,t)}};let Es=class extends ji{constructor(e,i,s){const n=t;super(n(2156),e,n(1089)),this._luna=i,this[n(1630)]=s[n(1618)](5,!0),this[n(2163)](this[n(2122)]((t=>this[n(1630)][n(2112)](t)))),this[n(952)][n(813)](this[n(1047)](255,255,255),this[n(1047)](0,0,0),this[n(1047)](255,0,0),this[n(1047)](255,255,0),this._createPaletteButton(0,255,0),this[n(1047)](0,255,255),this[n(1047)](0,0,255),this[n(1047)](255,0,255),document[n(1541)]("br"),this[n(1047)](255,255,255,192),this._createPaletteButton(0,0,0,192),this[n(1047)](255,0,0,192),this._createPaletteButton(255,255,0,192),this[n(1047)](0,255,0,192),this._createPaletteButton(0,255,255,192),this[n(1047)](0,0,255,192),this._createPaletteButton(255,0,255,192),document[n(1541)]("br"),this[n(1047)](255,255,255,128),this._createPaletteButton(0,0,0,128),this[n(1047)](255,0,0,128),this[n(1047)](255,255,0,128),this[n(1047)](0,255,0,128),this[n(1047)](0,255,255,128),this[n(1047)](0,0,255,128),this[n(1047)](255,0,255,128),document[n(1541)]("br"),this[n(1047)](255,255,255,64),this[n(1047)](0,0,0,64),this[n(1047)](255,0,0,64),this._createPaletteButton(255,255,0,64),this[n(1047)](0,255,0,64),this[n(1047)](0,255,255,64),this._createPaletteButton(0,0,255,64),this._createPaletteButton(255,0,255,64))}[t(1047)](e,i,s,n=255){const o=t,r=document[o(1541)](o(1505));r[o(1777)][o(1492)](o(1453));const a=document[o(1541)](o(1505));r[o(2118)](o(1340),(()=>this._luna.palette.primary.rgba=lt.m4[o(1244)](e,i,s,n))),r[o(2118)](o(1115),(t=>{const r=o;this[r(424)].palette[r(1903)][r(1374)]=lt.m4.createReadonlyRgbaColor(e,i,s,n),t[r(1160)]()})),a[o(1777)][o(1492)](o(1315));const h=o(1173)+e+","+i+","+s+o(2141);return a[o(1728)][o(2128)]=o(1038)+h+o(1061)+e+","+i+","+s+","+n/255+") 100%)",r[o(828)](a),r}};Es=function(e,i,s,n){const o=t;var r,a=arguments[o(961)],h=a<3?i:null===n?n=Object[o(656)](i,s):n;if(typeof Reflect===o(623)&&typeof Reflect[o(314)]===o(1524))h=Reflect[o(314)](e,i,s,n);else for(var c=e[o(961)]-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object[o(614)](i,s,h),h}([Cs(1,si),Cs(2,ze)],Es),gi.register("palette",{ctor:Es,defaultVisible:!1,defaultPosition:{x:"start",y:{target:t(803),side:t(1799)}}}),Wi({id:t(958),label:"Toggle Palette Window",section:t(2013),checked:5,run:e=>e[t(1270)](hi).toggleView(t(2156))});let Ts=class extends e.JT{constructor(e){const i=t;super(),this[i(2010)]=e,this[i(1696)]=1,this[i(1663)]=0,this[i(1874)]="selection-size",this[i(1769)]=!0,this[i(1294)]=!1,this[i(1817)]=this[i(2163)](new n.v),this[i(1025)]=this[i(1817)][i(993)],this[i(2010)].selection[i(1025)]((()=>this[i(1678)]())),this._update()}[t(1678)](){const e=t,i=this[e(2010)].selection[e(1767)];if(!i)return void(this[e(1294)]&&(this[e(2199)]="",this[e(1294)]=!1,this[e(1817)][e(1257)]()));const n=(0,s.Oq)(i),o=(0,s.rY)(i);this[e(2199)]=n+" x "+o,this[e(1863)]=e(1361)+n+" pixels wide by "+o+e(1240),this.visible=!0,this[e(1817)].fire()}};var Ls,Ds;Ts=function(e,i,s,n){const o=t;var r,a=arguments.length,h=a<3?i:null===n?n=Object[o(656)](i,s):n;if("object"==typeof Reflect&&typeof Reflect.decorate===o(1524))h=Reflect[o(314)](e,i,s,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object[o(614)](i,s,h),h}([(Ls=0,Ds=si,function(t,e){Ds(t,e,Ls)})],Ts);let As=class extends e.JT{constructor(e){const i=t;super(),this._lunaService=e,this.target=1,this[i(1663)]=0,this[i(1874)]="selection-topleft",this[i(1769)]=!0,this[i(1294)]=!1,this[i(1817)]=this.register(new n.v),this.onUpdate=this[i(1817)][i(993)],this._lunaService[i(1435)].onUpdate((()=>this[i(1678)]())),this[i(1678)]()}_update(){const e=t,i=this._lunaService.selection[e(1767)];i?(this[e(2199)]=i[e(702)]+", "+i.top,this[e(1863)]=e(553)+i[e(702)]+e(2008)+i[e(632)],this[e(1294)]=!0,this._onUpdate.fire()):this.visible&&(this[e(2199)]="",this[e(1294)]=!1,this[e(1817)][e(1257)]())}};var Rs,Ms;As=function(e,i,s,n){const o=t;var r,a=arguments[o(961)],h=a<3?i:null===n?n=Object[o(656)](i,s):n;if("object"==typeof Reflect&&typeof Reflect[o(314)]===o(1524))h=Reflect.decorate(e,i,s,n);else for(var c=e[o(961)]-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object[o(614)](i,s,h),h}([(Rs=0,Ms=si,function(t,e){Ms(t,e,Rs)})],As),Ei[t(2163)]({start(e){const i=t;e[i(1270)](ni)[i(1577)](e[i(1270)](We)[i(1508)](As)),e.get(ni).createItem(e[i(1270)](We)[i(1508)](Ts));const s=e[i(1270)](si),n=e[i(1270)](ze)[i(1618)](8,!1);s[i(1435)][i(1025)]((()=>{const t=i;n.set(!!s[t(1435)][t(1767)])}))}}),Wi({id:t(1960),label:"Select All",section:t(2052),run:e=>e[t(1270)](si)[t(1435)][t(1536)](),keys:t(1823)}),Wi({id:t(1690),label:"Deselect",section:t(2052),run:e=>e[t(1270)](si)[t(1435)].deselect(),keys:t(356),enabled:8}),Wi({id:t(2090),label:t(2161),section:t(2052),run:e=>e[t(1270)](si).selection[t(903)](),keys:t(1367),enabled:8}),Wi({id:t(1775),label:"Erase (Keep Selection)",section:t(2052),run:e=>e.get(si)[t(1435)][t(1789)](),enabled:8});class Bs extends e.JT{constructor(e,i,s){const n=t;super(),this.id=e,this[n(1758)]=!0,this[n(952)]=document.createElement(n(1505)),this[n(952)].id=s[n(1386)]()[n(1408)](/ /g,""),this[n(952)][n(1777)][n(1492)]("view",n(426)),i[n(828)](this[n(952)]),i[n(2118)]("contextmenu",(t=>{const e=n,i=t[e(1696)];(i[e(1552)]!==e(1293)||!(e(1653)in i)||i[e(1653)]!==e(2199)&&i[e(1653)]!==e(1896))&&i[e(1552)]!==e(1822)&&t.preventDefault()})),this.register({dispose:()=>{i.removeChild(this._contentElement)}})}get[t(2115)](){return this._isVisible}set[t(2115)](e){const i=t;this[i(1758)]=e,this[i(952)][i(1728)][i(2121)]=this[i(1758)]?"":"none"}}var ks=function(e,i,s,n){const o=t;var r,a=arguments[o(961)],h=a<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,s):n;if(typeof Reflect===o(623)&&typeof Reflect.decorate===o(1524))h=Reflect.decorate(e,i,s,n);else for(var c=e[o(961)]-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object.defineProperty(i,s,h),h},Us=function(t,e){return function(i,s){e(i,s,t)}};class Ps extends Bs{constructor(e,i,s,n){const o=t;super(o(0===e?1746:379),i,o(0===e?990:514)),this[o(1572)]=e,this[o(330)]=s,this[o(1974)]=n,this[o(1635)]=new Map,this[o(952)].classList[o(1492)]("statusbar"),this[o(889)]=document.createElement(o(1505)),this[o(889)].classList[o(1492)](o(1721)),this[o(461)]=document[o(1541)](o(1505)),this[o(461)][o(1777)][o(1492)](o(1851)),(0===this[o(1572)]?this._statusBarService[o(2078)]:this[o(330)][o(1958)])((t=>this._addItem(t))),(0===this._target?this._statusBarService[o(369)]:this[o(330)][o(1105)])((t=>this._removeItem(t))),this[o(952)][o(813)](this[o(889)],this[o(461)]),this[o(2163)]({dispose:()=>{const t=o;for(const e of this[t(1635)][t(491)]())for(const i of e)i[t(835)]()}})}[t(1353)](e){const i=t,s=[],n=0===e[i(1663)]?this._leftItemsElement:this._rightItemsElement,o=document[i(1541)]("span");if(o[i(1777)].add(i(592)),e.className&&o[i(1777)][i(1492)](e[i(1874)]),e[i(1769)]&&o[i(1777)][i(1492)](i(1109),i(1470)),e[i(1863)]&&(o[i(1863)]=e[i(1863)]),o[i(2118)](i(1340),(()=>{const t=i;e[t(695)]&&this[t(1974)][t(488)](e[t(695)])})),e.input){const t=i(684)+Math[i(597)](1e6*Math[i(1339)]());switch(e[i(438)][i(1653)]){case"boolean":{const s=e.input;if(!e.hasImage){const s=document[i(1541)](i(1474));s[i(1033)]=e[i(2199)]+": ",s[i(959)](i(1774),t),o[i(813)](s)}o.addEventListener(i(1340),(()=>s[i(1643)](!o[i(1777)].contains("checked")))),s.onHistoryUpdateValue((t=>o.classList[i(1882)](i(1376),t)));break}case i(1325):{const s=e[i(438)],n=document.createElement(i(1474));n[i(1033)]=e[i(2199)]+": ",n[i(959)](i(1774),t);const r=document[i(1541)](i(691));r.id=t;for(const t of s[i(542)]){const e=document[i(1541)](i(1785));e[i(436)]=t,e.textContent=t,r[i(828)](e)}r[i(436)]=s[i(1620)],r.addEventListener(i(1092),(t=>{s[i(1643)](r.value)})),s.onHistoryUpdateValue((t=>r.value=t)),o[i(813)](n,r);break}case"string-combo":{const s=e[i(438)],n=document[i(1541)](i(1474));n[i(1033)]=e[i(2199)]+": ",n[i(959)](i(1774),t);const r=document.createElement("input");r[i(1653)]="text",r.id=t;const a=document[i(1541)]("datalist");for(const t of s.options){const e=document.createElement(i(1785));e[i(436)]=t,a[i(828)](e)}a.id=i(1967)+t,r[i(959)](i(2028),i(1967)+t),r[i(436)]=s.currentValue,r[i(2118)](i(1092),(t=>{const e=i;s.setOption(r[e(436)])})),s[i(1750)]((t=>r[i(436)]=t)),o[i(813)](n,r,a);break}case"number":{const s=e.input,n=document[i(1541)](i(1474));n[i(1033)]=e[i(2199)]+": ",n[i(959)]("for",t);const r=document[i(1541)](i(438));r.id=t,r[i(1653)]=i(1896),s[i(507)]&&(r.min=s[i(507)].toString()),s[i(590)]&&(r[i(590)]=s[i(590)].toString()),r[i(436)]=s[i(1620)][i(452)](),r[i(2118)](i(438),(t=>{const e=i;s[e(1643)](parseFloat(r[e(436)]))})),r.addEventListener("change",(t=>{const e=i;s[e(1643)](parseFloat(r[e(436)]))})),s[i(1750)]((t=>r[i(436)]=t[i(452)]())),o[i(813)](n,r);break}}}e.onUpdate&&s[i(2226)](e[i(1025)]((()=>this[i(1295)](e,o)))),this[i(1295)](e,o),n[i(828)](o),s.push({dispose:()=>n[i(1221)](o)}),this._itemDisposables.set(e,s)}[t(698)](e){const i=t,s=this[i(1635)][i(1270)](e);if(s){for(const t of s)t[i(835)]();this[i(1635)][i(1367)](e)}}_updateItem(e,i){const s=t;e[s(438)]&&!e.hasImage?i.querySelector(s(1474))[s(1033)]=e[s(2199)]+": ":(i[s(1033)]=e[s(2199)],i[s(1777)][s(1882)](s(1527),0===e[s(2199)]?.[s(961)])),e.title&&(i[s(1863)]=e.title),i[s(1728)][s(2121)]=!1===e.visible?s(1194):"",i.classList[s(1882)](s(1970),!!e[s(695)]&&!1!==e[s(888)]),i[s(1777)][s(1882)](s(1376),!!e[s(1376)]),void 0!==e.enabled&&i[s(1777)][s(1882)](s(1044),!e.enabled)}}let Fs=class extends Ps{constructor(t,e,i){super(0,t,e,i)}};Fs=ks([Us(1,ni),Us(2,He)],Fs);let Ns=class extends Ps{constructor(t,e,i){super(1,t,e,i)}};Ns=ks([Us(1,ni),Us(2,He)],Ns),di.register("topStatusBar",{anchor:t(632),ctor:Fs}),di[t(2163)](t(379),{anchor:t(719),ctor:Ns}),Wi({id:t(478),label:t(596),section:"Window",run:e=>e[t(1270)](hi).toggleView("topStatusBar")}),Wi({id:"window.toggleBottomStatusBarView",label:"Toggle Bottom Status Bar View",section:t(2013),run:e=>e[t(1270)](hi)[t(879)]("bottomStatusBar")});class Vs extends e.JT{constructor(e,i){const s=t;super(),this[s(1425)]=e,this[s(1874)]=i,this[s(1696)]=0,this[s(1663)]=0,this.hasImage=!0,this[s(2199)]="",this[s(1817)]=this[s(2163)](new n.v),this[s(1025)]=this[s(1817)][s(993)],this._action[s(1025)]&&this[s(2163)](this[s(1425)][s(1025)]((()=>this[s(1678)]()))),this._update()}[t(1678)](){const e=t;switch(this._action[e(1653)]){case"crop-to-selection":this.commandId="image.cropToSelection";break;case e(1276):this[e(695)]=e(1305);break;default:throw new Error(e(784)+this[e(1425)][e(1653)]+'"')}this[e(1863)]=this[e(1425)].name,this[e(888)]=this[e(1425)][e(888)],this._onUpdate[e(1257)]()}}class Os{constructor(){this[t(1067)]=[]}[t(2125)](e){const i=t,s=e[i(1270)](si),n=e[i(1270)](ni);s[i(1486)][i(850)]((()=>this._update(s,n)))}_update(e,i){const s=t;for(const t of this[s(1067)])t.dispose();this._activeItems.length=0;const n=e[s(1486)].actions;for(const t of n)this._activeItems[s(2226)](i[s(1577)](new Vs(t,e.tool[s(2059)]+"-"+t[s(1653)])))}}class Hs extends e.JT{constructor(e,i){const s=t;super(),this[s(2017)]=e,this[s(1874)]=i,this[s(1696)]=1,this[s(1663)]=0,this[s(1769)]=!0,this[s(1294)]=!1,this[s(1817)]=this[s(2163)](new n.v),this.onUpdate=this._onUpdate[s(993)],this[s(2163)](this._info[s(1025)]((()=>this[s(1678)]()))),this[s(1678)]()}[t(1678)](){const e=t;this[e(2017)][e(1294)]?(this.text=this[e(2017)][e(1525)](),this[e(1863)]=this._info.getDetailedInfo(),this[e(1294)]=!0,this[e(1817)].fire()):this[e(1294)]&&(this[e(2199)]="",this[e(1294)]=!1,this[e(1817)].fire())}}class zs{constructor(){this[t(1067)]=[]}start(e){const i=t,s=e[i(1270)](si),n=e.get(ni);s[i(1486)][i(850)]((()=>this[i(1678)](s,n)))}[t(1678)](e,i){const s=t;for(const t of this[s(1067)])t[s(835)]();switch(this._activeItems.length=0,e.tool.activeTool){case s(1422):case s(1101):case s(617):case s(2199):for(const t of e[s(1486)][s(1021)])("size"===t[s(1653)]||t[s(1653)]===s(1793)||"length"===t.type||t[s(1653)]===s(2159))&&this[s(1067)].push(i[s(1577)](new Hs(t,e.tool.activeTool+"-"+t[s(1653)])))}}}class Ws{constructor(){this[t(1067)]=[]}[t(2125)](e){const i=t,s=e[i(1270)](si),n=e[i(1270)](ni);s[i(1486)][i(850)]((()=>this[i(1678)](s,n)))}[t(1678)](e,i){const s=t;for(const t of this[s(1067)])t.dispose();this[s(1067)][s(961)]=0;const n=e[s(1486)][s(542)];for(const t of n)switch(t.type){case s(2098):const n=new js(e,t);this[s(1067)][s(2226)](i[s(1577)](n));break;case s(1325):const o=t;this[s(1296)](e[s(1486)][s(2059)],i,{text:t.name},{type:"string",currentValue:o[s(436)],options:o[s(542)],setOption:e=>t[s(436)]=e,onHistoryUpdateValue:t[s(1750)]});break;case s(1125):const r=t;this[s(1296)](e[s(1486)][s(2059)],i,{text:t[s(1121)]},{type:s(1125),currentValue:r[s(436)],options:r[s(542)],setOption:e=>t.value=e,onHistoryUpdateValue:t[s(1750)]});break;case s(1896):const a=t;this[s(1296)](e.tool[s(2059)],i,{text:t.name},{type:s(1896),currentValue:a[s(436)],min:a[s(507)],max:a[s(590)],setOption:e=>t.value=e,onHistoryUpdateValue:t[s(1750)]});break;default:throw new Error(s(1395)+t.type+'"')}}[t(1296)](e,i,s,n){const o=t,r={target:0,alignment:0,dispose:()=>{},text:s[o(1769)]?"":s.text,title:s[o(1769)]?s[o(2199)]:void 0,className:e+"-"+s[o(2199)].toLowerCase().replace(/ /g,"-"),hasImage:s[o(1769)],input:n};this[o(1067)][o(2226)](i[o(1577)](r))}}class js extends e.JT{constructor(e,i){const s=t;super(),this[s(2036)]=i,this[s(1696)]=0,this[s(1663)]=0,this[s(1769)]=!0,this.text="",this._onUpdate=this[s(2163)](new n.v),this[s(1025)]=this._onUpdate[s(993)],this[s(1863)]=i.name,this.className=e.tool.activeTool+"-"+i[s(1121)][s(1386)]().replace(/ /g,"-"),this.input={type:s(2098),currentValue:i.value,setOption:t=>{this.checked=t,this.update()},onHistoryUpdateValue:i.onHistoryUpdateValue},this[s(1376)]=i[s(436)]}[t(1805)](){const e=t;this.checked||this[e(2036)].allowUnchecking?(this[e(2036)].value=this[e(1376)],this._onUpdate[e(1257)]()):this[e(2036)].value=!0}}var qs=function(t,e){return function(i,s){e(i,s,t)}};const Gs=new Map([[t(1435),"S"],["crop","C"],[t(797),"M"],[t(1551),"P"],[t(929),"M"],["eraser","E"],[t(1024),"K"],[t(1411),"F"],[t(1422),"O"],[t(1101),"O"],[t(617),"O"],[t(2199),"T"],[t(608),"H"],[t(1905),"Z"]]),Xs=["selection",t(797),t(1079),t(929),t(1694),t(1551),t(1875),"colorPicker",t(1411),t(1694),t(1422),t(1101),t(617),t(2199),t(1694),t(608),t(1905)];let Ys=class extends ji{constructor(e,i,s,o,r){const a=t;super(a(769),e,a(1175)),this[a(424)]=i,this[a(482)]=s,this[a(335)]=new Map,this[a(716)]={activeTool:a(1435)},this[a(1752)]=this.register(new n.v),this[a(397)]=this._onStateChange.event,this[a(716)].activeTool=r[a(1689)][a(1329)],o[a(1084)]("toolsView",this),this[a(1630)]=this[a(482)][a(1618)](1,!0),this[a(2163)](this.onDidChangeVisibility((t=>this[a(1630)].set(t)))),this._luna[a(1486)][a(850)]((t=>{const e=a;t.id!==this[e(716)][e(2059)]&&this[e(1752)][e(1257)]()}));const h=r[a(1689)][a(1329)],c=document[a(986)]();for(const[t,e]of Xs[a(1832)]()){if(e===a(1694)){const t=document[a(1541)]("hr");t[a(1777)][a(1492)](a(1246)),c.appendChild(t);continue}const i=document.createElement(a(1505));i[a(1777)][a(1492)](a(1973));const s=document[a(1541)]("input");s[a(1121)]=a(1486),s[a(1653)]=a(1073),s[a(1777)].add(a(1486),e,"luna-icon");const n=Js(e),o=Gs[a(1270)](e);o?s.title=n+" ("+o+")":s[a(1863)]=""+n,s[a(959)](a(947),n),this[a(335)][a(2112)](e,s),s[a(1376)]=e===h,s[a(2118)](a(1092),(()=>this[a(424)][a(1486)][a(1058)](e))),s.addEventListener(a(1594),(s=>{const n=a;switch(s[n(2181)]){case n(453):i[n(1051)]?.previousSibling?.firstChild?.focus(),s.preventDefault(),s.stopImmediatePropagation();break;case n(1949):const o=i[n(471)]?.[n(471)]?.[n(611)];o?o[n(908)]():i[n(471)]?.firstChild?.[n(908)](),s[n(1160)](),s.stopImmediatePropagation();break;case n(1506):t%2==1&&i[n(1051)]?.[n(611)]?.[n(908)](),s[n(1160)](),s[n(1300)]();break;case n(1467):if(t%2==0){const t=i[n(471)]?.[n(611)];t?t[n(908)]():i[n(1051)]?.[n(611)]?.[n(908)]()}s[n(1160)](),s[n(1300)]();break;case"Enter":this[n(424)][n(1486)].setTool(e)}})),i.appendChild(s),c.appendChild(i)}this[a(952)][a(828)](c),this.register(this._luna.tool[a(850)]((t=>{const e=a;this._toolElements[e(1270)](t.id)[e(1376)]=!0;for(const[i,s]of this._toolElements[e(1832)]())s.parentElement?.[e(1777)][e(1882)](e(1376),i===t.id)}))),this[a(424)][a(1486)][a(1058)](h)}[t(1200)](){const e=t;return{activeTool:this[e(424)][e(1486)][e(2059)]}}restoreState(e){const i=t;e[i(2059)]&&e[i(2059)]!==this._luna[i(1486)][i(2059)]&&(this[i(716)][i(2059)]=e[i(2059)],this._luna.tool.setTool(e.activeTool))}};function Js(e){const i=t;return((e[i(979)](0,1).toUpperCase()+e[i(979)](1))[i(1189)](/[A-Z][a-z]+/g)||[]).join(" ")}function Ks(e,i,s){const n=t,o=e[n(1270)](si);o.tool[n(1058)](i,s),o[n(838)][n(908)]()}Ys=function(e,i,s,n){const o=t;var r,a=arguments[o(961)],h=a<3?i:null===n?n=Object[o(656)](i,s):n;if(typeof Reflect===o(623)&&typeof Reflect.decorate===o(1524))h=Reflect[o(314)](e,i,s,n);else for(var c=e[o(961)]-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object[o(614)](i,s,h),h}([qs(1,si),qs(2,ze),qs(3,ci),qs(4,Ye)],Ys),gi[t(2163)]("tools",{ctor:Ys,defaultVisible:!0,defaultPosition:{x:t(2125),y:t(2125)}}),Ei[t(2163)](new Ws),Ei.register(new Os),Ei[t(2163)](new zs),Wi({id:"tool.toggleToolsWindow",label:t(1763),section:t(2013),checked:1,run:e=>e[t(1270)](hi)[t(879)](t(769))}),Wi({id:t(2184),label:"Color Picker",section:t(1203),run:e=>Ks(e,t(1024)),keys:"k"}),Wi({id:t(1937),label:t(1683),section:t(1203),run:e=>Ks(e,t(1079)),keys:"c"}),Wi({id:t(406),label:t(1744),section:"Tool",run:e=>Ks(e,t(1875)),keys:"e"}),Wi({id:t(1012),label:t(1277),section:t(1203),run:e=>Ks(e,t(1411)),keys:"f"}),Wi({id:t(715),label:"Hand",section:t(1203),run:t=>Ks(t,"hand"),keys:"h"}),Wi({id:t(717),label:"Hand Until Release",section:t(1203),run:e=>Ks(e,t(608),{untilRelease:" "}),keys:t(1394)}),Wi({id:"tool.line",label:t(2210),section:t(1203),run:e=>Ks(e,t(1422))}),Wi({id:t(1319),label:t(319),section:t(1203),run:e=>{const i=t,s=e.get(si)[i(1486)];"line"===s[i(2059)]?Ks(e,i(1101)):"rectangle"===s.activeTool?Ks(e,i(617)):Ks(e,i(1422))},keys:"o"}),Wi({id:t(1639),label:t(2076),section:t(1203),run:e=>Ks(e,t(797))}),Wi({id:t(1286),label:"Move Selection",section:"Tool",run:e=>Ks(e,t(929))}),Wi({id:t(1268),label:t(538),section:t(1203),run:e=>{const i=t;e.get(si)[i(1486)][i(2059)]===i(797)?Ks(e,"moveSelection"):Ks(e,"movePixels")},keys:"m"}),Wi({id:"tool.pencil",label:t(836),section:t(1203),run:t=>Ks(t,"pencil"),keys:"p"}),Wi({id:t(459),label:t(2138),section:t(1203),run:e=>Ks(e,t(1101)),keys:"o"}),Wi({id:t(1686),label:t(712),section:"Tool",run:e=>Ks(e,t(617)),keys:"o"}),Wi({id:t(1368),label:t(2052),section:"Tool",run:e=>Ks(e,t(1435)),keys:"s"}),Wi({id:"tool.text",label:t(416),section:t(1203),run:t=>Ks(t,"text"),keys:"t"}),Wi({id:"tool.zoom",label:"Zoom",section:t(1203),run:e=>Ks(e,t(1905)),keys:"z"}),Wi({id:t(618),label:"Focus Canvas",section:t(1249),run:e=>e.get(si)[t(838)].focus()}),Wi({id:t(1444),label:t(2068),section:t(1249),run:e=>e[t(1270)](si)[t(838)][t(894)]()}),Wi({id:"view.zoomOut",label:"Zoom Out",section:"View",run:e=>e.get(si)[t(838)][t(1078)]()}),Wi({id:t(848),label:t(1726),section:t(1249),run:e=>e[t(1270)](si)[t(838)][t(1905)]=1,keys:t(916)}),Wi({id:t(646),label:t(378),section:t(1249),run:e=>e[t(1270)](si)[t(838)][t(1871)](),keys:"ctrl+0"}),Wi({id:t(1465),label:"Fit Layer to Window",section:t(1249),run:e=>e[t(1270)](si)[t(838)].fitLayerToWindow()}),Wi({id:"view.togglePixelGrid",label:t(521),section:"View",run:e=>{const i=t,s=e.get(si)[i(838)];s[i(580)]=!s.isPixelGridEnabled}});let $s=class extends e.JT{constructor(e){const i=t;super(),this[i(2010)]=e,this.target=0,this[i(1663)]=1,this[i(1874)]=i(1307),this[i(1769)]=!0,this[i(2199)]="",this[i(1863)]=i(1784),this[i(695)]=i(1757),this[i(1817)]=this.register(new n.v),this[i(1025)]=this._onUpdate[i(993)],this[i(2010)][i(838)][i(854)]((()=>this._update())),this[i(1678)]()}_update(){const e=t;this[e(1376)]=this[e(2010)].viewport.isPixelGridEnabled,this[e(1817)][e(1257)]()}};var Zs,Qs;$s=function(e,i,s,n){const o=t;var r,a=arguments[o(961)],h=a<3?i:null===n?n=Object[o(656)](i,s):n;if("object"==typeof Reflect&&typeof Reflect[o(314)]===o(1524))h=Reflect[o(314)](e,i,s,n);else for(var c=e[o(961)]-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object[o(614)](i,s,h),h}([(Zs=0,Qs=si,function(t,e){Qs(t,e,Zs)})],$s);let tn=class extends e.JT{constructor(e){const i=t;super(),this[i(2010)]=e,this.target=1,this.alignment=1,this[i(1874)]=i(1905),this[i(1769)]=!0,this._onUpdate=this[i(2163)](new n.v),this[i(1025)]=this[i(1817)].event,this._lunaService[i(838)][i(761)]((()=>this[i(1678)]())),this[i(1678)]()}[t(1678)](){const e=t,i=(100*this[e(2010)][e(838)][e(1905)])[e(660)](0);this[e(2199)]=i+"%",this[e(1863)]=e(2035)+i+"%",this[e(1817)][e(1257)]()}};var en,sn;tn=function(e,i,s,n){const o=t;var r,a=arguments[o(961)],h=a<3?i:null===n?n=Object[o(656)](i,s):n;if(typeof Reflect===o(623)&&"function"==typeof Reflect[o(314)])h=Reflect[o(314)](e,i,s,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object[o(614)](i,s,h),h}([(en=0,sn=si,function(t,e){sn(t,e,en)})],tn),Ei[t(2163)]({start(e){const i=t,s=e.get(ni),n=e[i(1270)](We);s[i(1577)](n[i(1508)](tn)),s[i(1577)](n[i(1508)]($s))}});var nn=function(t,e){return function(i,s){e(i,s,t)}};let on=class extends ji{constructor(i,s,n,o,r){const a=t;super(a(1259),i,"Minimap"),this[a(424)]=s,this[a(482)]=n,this[a(1974)]=o,this[a(1788)]=r,this[a(1610)]=0,this._windowVisibleContextKey=this._contextKeyService.bind(6,!0),this[a(2163)](this[a(2122)]((t=>this[a(1630)][a(2112)](t))));const h=this[a(1884)](a(905),a(666),this[a(1788)][a(2061)],"Toggle small images between actual size and stretching to fit the minimap dimensions");this[a(1788)][a(2134)]((t=>{const e=a;h[e(1376)]=t,this[e(1446)](),this._viewportUpdate()}));const c=this[a(1884)]("minimap-show-viewport",a(799),this[a(1788)][a(301)],a(442));this[a(1788)][a(999)]((t=>{c[a(1376)]=t,this._viewportUpdate()})),this[a(310)][a(813)](h,c),this[a(1014)]=document.createElement(a(890)),this[a(1014)].width=200,this[a(1014)][a(1096)]=200,this[a(1014)][a(1728)][a(1847)]="200px",this[a(1014)][a(1728)][a(1096)]="200px",this[a(2163)]((0,e.Lw)(this[a(1014)],a(1790),(t=>{const e=a;if(!this[e(2075)](t)){const i=this._createMinimapImageBounds();this[e(424)].viewport.x=-((t[e(1676)]-i.left)/i[e(1847)]*this._luna[e(1866)][e(1847)]-this._luna[e(1866)].width/2),this[e(424)][e(838)].y=-((t[e(586)]-i.top)/i.height*this[e(424)][e(1866)].height-this[e(424)][e(1866)][e(1096)]/2)}this._canvas[e(770)](t[e(1556)]),this._canvas[e(1777)][e(1492)](e(760)),this[e(1762)]=[t[e(1676)],t.offsetY],this._viewportOrigin=[this[e(424)].viewport.x,this[e(424)][e(838)].y]}))),this[a(2163)]((0,e.Lw)(this[a(1014)],a(1677),(t=>{const e=a;this[e(1014)].releasePointerCapture(t[e(1556)]),this[e(1014)].classList[e(554)](e(760)),this[e(1762)]=void 0,this[e(1911)]=void 0}))),this[a(2163)]((0,e.Lw)(this._canvas,a(1914),(t=>{const e=a,i=this._luna[e(838)].visibleRange,s=0===i[e(702)]&&0===i.top&&i.right===this[e(424)][e(1866)][e(1847)]&&i[e(719)]===this[e(424)][e(1866)][e(1096)];if(this[e(1014)][e(1777)][e(1882)]("in-viewport",!s&&this[e(2075)](t)),!this[e(1762)]||!this[e(1911)])return;const n=this[e(1027)]();this[e(424)].viewport.x=this[e(1911)][0]+(this[e(1762)][0]-n.left-(t[e(1676)]-n[e(702)]))*(this[e(424)][e(1866)][e(1847)]/n[e(1847)]),this[e(424)][e(838)].y=this[e(1911)][1]+(this[e(1762)][1]-n.top-(t[e(586)]-n[e(632)]))*(this[e(424)][e(1866)][e(1096)]/n[e(1096)])}))),this[a(2163)]((0,e.Lw)(this[a(1014)],a(517),(t=>{const e=a;this._canvas.classList[e(554)](e(598))}))),this[a(2163)]((0,e.Lw)(this[a(1014)],a(1868),(t=>{const e=a;ye.V5?t.deltaY<0?this._luna[e(838)].zoomIn(-t.deltaY/20):this[e(424)][e(838)][e(1078)](t[e(1420)]/20):t[e(1420)]<0?this._luna[e(838)][e(894)]():this._luna[e(838)][e(1078)]()}))),this[a(1983)]=this[a(1014)][a(567)]("2d"),this[a(2154)]=document[a(1541)](a(1505)),this[a(2154)][a(1777)][a(1492)](a(1612)),this[a(952)][a(813)](this[a(1014)],this[a(2154)]),this[a(2163)](this[a(424)][a(370)][a(1976)]((()=>this[a(1446)]()))),this[a(2163)](this._luna[a(1866)][a(325)]((()=>this[a(1446)]()))),this[a(2163)](this[a(424)][a(838)][a(1025)]((()=>this[a(1975)]()))),this[a(1678)](),this._viewportUpdate()}[t(1446)](){const e=t;this[e(424)][e(1866)][e(1847)]&&0===this[e(1610)]&&(this[e(1610)]=setTimeout((()=>{const t=e;this[t(1678)](),this[t(1610)]=0})))}async _update(){const e=t,i=await this[e(424)][e(1733)][e(2011)]();if(!i[e(1847)]||!i[e(1096)])return void this._canvas[e(1777)][e(1492)]("hidden");this[e(1014)][e(1777)][e(554)]("hidden");const s=new ImageData(new Uint8ClampedArray(i.data),i[e(1847)],i.height),n=await createImageBitmap(s);this._ctx[e(855)]=i[e(1847)]>200||i[e(1096)]>200,this[e(1983)][e(1405)](0,0,200,200);const o=this[e(1027)]();this[e(1983)][e(1312)](n,o[e(702)],o[e(632)],o[e(1847)],o[e(1096)])}[t(1975)](){const e=t;if(!this[e(424)].layer.width)return;const i=this._luna.layer,n=this._createMinimapImageBounds(),o=this[e(424)][e(838)][e(1782)],r=0===o.left&&0===o[e(632)]&&o[e(557)]===i[e(1847)]&&o[e(719)]===i.height;this[e(2154)][e(1777)][e(1882)](e(925),r||!this[e(1788)].showViewport),this[e(1164)]={left:n[e(702)]+Math.round(o[e(702)]/i.width*n[e(1847)]),top:n.top+Math[e(597)](o[e(632)]/i[e(1096)]*n[e(1096)]),width:Math[e(597)]((0,s.Oq)(o)/i[e(1847)]*n[e(1847)]),height:Math[e(597)]((0,s.rY)(o)/i[e(1096)]*n[e(1096)])},this[e(2154)][e(1728)].left=this[e(1164)][e(702)]+"px",this[e(2154)][e(1728)][e(632)]=this[e(1164)][e(632)]+"px",this[e(2154)][e(1728)][e(1847)]=this._viewportPosition.width+"px",this._viewportElement[e(1728)][e(1096)]=this[e(1164)][e(1096)]+"px"}[t(2075)](e){const i=t;return!!this[i(1164)]&&e[i(1676)]>this[i(1164)][i(702)]&&e[i(1676)]<this[i(1164)][i(702)]+this._viewportPosition[i(1847)]&&e.offsetY>this._viewportPosition[i(632)]&&e[i(586)]<this[i(1164)][i(632)]+this._viewportPosition[i(1096)]}[t(1884)](e,i,s,n){const o=t,r=document[o(1541)](o(438));return r[o(1653)]="checkbox",r.id=e,r[o(1376)]=s,r[o(1863)]=n,r.classList[o(1492)](e,"luna-icon"),r[o(2118)]("click",(()=>this[o(1974)][o(488)](i))),r}[t(1027)](){const e=t;return(0,ne.M_)(this[e(424)][e(1866)][e(1847)],this[e(424)][e(1866)].height,200,200,this._minimapService[e(2061)])}};on=function(e,i,s,n){const o=t;var r,a=arguments[o(961)],h=a<3?i:null===n?n=Object[o(656)](i,s):n;if(typeof Reflect===o(623)&&typeof Reflect.decorate===o(1524))h=Reflect[o(314)](e,i,s,n);else for(var c=e[o(961)]-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object.defineProperty(i,s,h),h}([nn(1,si),nn(2,ze),nn(3,He),nn(4,wi)],on);let rn=class extends e.JT{constructor(e){const i=t;super(),this[i(1535)]=e,this[i(1696)]=0,this[i(1663)]=1,this[i(1874)]=i(756),this[i(1769)]=!0,this[i(2199)]="",this[i(1863)]=i(1996),this.commandId=i(1654),this._onUpdate=this.register(new n.v),this[i(1025)]=this[i(1817)][i(993)],this._viewService[i(2062)]((()=>this[i(1678)]())),this._update()}[t(1678)](){const e=t;this[e(1376)]=this[e(1535)].isVisible(e(1259)),this[e(1817)].fire()}};var an,hn;rn=function(e,i,s,n){const o=t;var r,a=arguments[o(961)],h=a<3?i:null===n?n=Object[o(656)](i,s):n;if(typeof Reflect===o(623)&&typeof Reflect.decorate===o(1524))h=Reflect[o(314)](e,i,s,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object[o(614)](i,s,h),h}([(an=0,hn=hi,function(t,e){hn(t,e,an)})],rn),gi.register(t(1259),{ctor:on,defaultVisible:!1,defaultPosition:{x:"end",y:t(1799)}}),Ei[t(2163)]({start(e){const i=t,s=e[i(1270)](ni),n=e[i(1270)](We);s.createItem(n[i(1508)](rn))}}),Wi({id:t(1654),label:"Toggle Minimap Window",section:t(2013),checked:6,run:e=>e[t(1270)](hi).toggleView(t(1259))}),Wi({id:"minimap.toggleShowViewport",label:t(709),section:t(972),run:e=>{const i=t,s=e.get(wi);s.showViewport=!s[i(301)]}}),Wi({id:t(666),label:t(2014),section:t(972),run:e=>{const i=t,s=e[i(1270)](wi);s[i(2061)]=!s.isStretchEnabled}});var cn=function(t,e){return function(i,s){e(i,s,t)}};let ln=class extends ji{constructor(i,s,n,o,r){const a=t;super("layers",i,a(1351)),this[a(424)]=s,this[a(482)]=n,this[a(1002)]=o,this[a(814)]=r,this._layerListItems=new Map,this[a(1468)]=new Map,this._windowVisibleContextKey=this[a(482)][a(1618)](3,!0),this[a(1179)]=this[a(482)].bind(4,!1),this[a(2163)](this[a(2122)]((t=>this[a(1630)][a(2112)](t)))),this._layerListElement=document[a(1541)](a(1505)),this[a(1580)][a(1777)][a(1492)](a(524));const h=document[a(1541)](a(1505));h[a(1777)].add(a(859)),h[a(813)](this[a(1023)]("layer-new",(()=>this[a(424)][a(1866)][a(699)]()),"Create a new layer"),this[a(1023)](a(1180),(()=>this._luna[a(1866)].deleteLayer()),"Delete the active layer"),this[a(1023)](a(1059),(()=>this._luna[a(1866)][a(2169)]()),a(1165)),this._mergeLayerDownButton=this[a(1023)]("layer-merge",(()=>this[a(424)].layer.mergeLayerDown()),"Merge the active layer down"),this[a(1224)]=this[a(1023)](a(1800),(()=>this[a(424)].layer[a(541)]()),a(1191)),this[a(1217)]=this[a(1023)](a(2158),(()=>this._luna.layer[a(1042)]()),"Move the active layer down"),this[a(367)]()),this[a(952)][a(813)](this[a(1580)],h),this[a(2163)](this[a(424)][a(1866)][a(885)]((()=>this[a(911)]()))),this[a(2163)]({dispose:()=>{const t=a;for(const i of this[t(1245)][t(491)]())(0,e._c)(i[t(1409)])}}),this._renderLayers()}[t(1023)](e,i,s){const n=t,o=document[n(1541)](n(312));o.id=e,o[n(1863)]=s;const r=document[n(1541)]("img");return o[n(828)](r),o[n(1777)][n(1492)](e,n(1246)),o[n(2118)](n(1340),i),o}_createBlendModeSelect(){const e=t,i=document[e(1541)](e(691)),s=[e(1349),"darken",e(1939),e(872),"lighten",e(1709),e(1835),"overlay",e(609),e(2016),"exclusion"];for(const t of s){const s=document[e(1541)](e(1785));s[e(1033)]=t,s.value=t,this[e(1468)].set(t,s),i.appendChild(s)}return i.addEventListener(e(1092),(()=>{const t=e;this[t(424)][t(1866)][t(327)]&&(this[t(424)][t(1866)].activeLayer[t(533)]=i[t(436)])})),i}[t(911)](){const i=t,s=this[i(424)][i(1866)][i(1735)],n=this._luna[i(1866)][i(327)];let o=null;for(let t=s[i(961)]-1;t>=0;t--){const r=s[t];if(!this._layerListItems[i(1359)](r.id)){const t={container:document[i(1541)](i(1505)),nameSpan:document[i(1541)](i(1739)),previewCanvas:document[i(1541)](i(890)),visibleCheckbox:document[i(1541)](i(438)),disposables:[]};t[i(782)][i(1777)][i(1492)]("layer"),t.container[i(681)]=0,t[i(782)][i(1396)]=!0,t.disposables[i(2226)]((0,e.Lw)(t[i(782)],i(1020),(t=>{const e=i;this[e(952)][e(1777)][e(1492)]("dragging"),t[e(1003)]&&(t[e(1003)][e(1255)]=e(871),t.dataTransfer[e(1837)]=e(871),t[e(1003)][e(1143)](e(648),e(1972)+r.id)),t[e(1300)]()}))),t[i(1409)][i(2226)]((0,e.Lw)(t.container,i(834),(()=>{const t=i;this[t(952)][t(1777)][t(554)]("dragging")}))),t[i(1409)].push((0,e.Lw)(t[i(782)],i(1786),(e=>{const s=i;t[s(782)].classList.remove(s(1562));const n=this[s(595)](e),o=this._luna[s(1866)][s(1735)][s(978)]((t=>t.id===n));o&&this[s(424)][s(1866)][s(504)](o,r),e[s(1300)]()}))),t[i(1409)][i(2226)]((0,e.Lw)(t[i(782)],i(1225),(e=>{const s=i,n=this._getLayerDragEventId(e);r.id!==n&&(e.preventDefault(),t[s(782)].classList[s(1492)](s(1562)))}))),t.disposables.push((0,e.Lw)(t[i(782)],"dragleave",(e=>{const s=i;t[s(782)][s(1777)].remove(s(1562))}))),t.disposables[i(2226)]((0,e.Lw)(t[i(782)],i(908),(()=>this[i(1179)][i(2112)](!0)))),t[i(1409)][i(2226)]((0,e.Lw)(t[i(782)],i(1852),(()=>this[i(1179)][i(2112)](!1)))),t[i(1792)].classList.add(i(505)),t.previewCanvas[i(1847)]=40,t.previewCanvas[i(1096)]=40;let s=!1;t.disposables.push(r[i(1025)]((()=>{s=!0,this[i(1484)](t,r)}))),t[i(1409)][i(2226)](this[i(424)].history[i(1976)]((()=>{s&&(this[i(1156)](r,t),s=!1)}))),this[i(1156)](r,t),t.container[i(828)](t[i(1792)]),t.nameSpan[i(1777)][i(1492)](i(1121)),t.container[i(828)](t[i(966)]),t[i(431)][i(1653)]=i(1929),t[i(431)][i(1777)].add(i(1294)),t[i(431)].addEventListener(i(1092),(()=>r[i(2115)]=!r[i(2115)])),t.container.appendChild(t[i(431)]);const n=e=>{const s=i;e?.[s(1696)]!==t.visibleCheckbox&&(this[s(424)].layer[s(327)]=r)};t[i(782)].addEventListener(i(1340),(t=>{const e=i;n(t),t[e(317)]&&this[e(424)].viewport.fitLayerToWindow()})),t[i(782)][i(2118)](i(1115),(async t=>{const e=i;switch(t[e(1160)](),t[e(1300)](),await this[e(1002)][e(787)]([{id:e(2189),label:e(1449)},{id:e(1367),label:e(1260)},{id:"rename",label:e(332)},{id:"mergeDown",label:"Merge down"},{id:"sep",label:"",kind:-1},{id:e(2152),label:e(967)+(ye.V5?"â¥":e(298))+e(1247)}])){case e(2189):await this[e(424)][e(1866)][e(2169)](r);break;case"delete":this[e(424)][e(1866)][e(2227)](r);break;case e(1213):const t=await this[e(814)][e(764)](e(530),r[e(1121)]);t&&this._luna[e(1866)].renameLayer(t,r);break;case e(714):this._luna[e(1866)].activeLayer=r,await this[e(424)][e(1866)][e(745)]();break;case"fitLayerToWindow":this[e(424)][e(838)][e(2152)]()}})),t[i(782)][i(2118)](i(1594),(e=>{const s=i;switch(e.key){case s(453):t[s(782)][s(1051)]?.[s(908)](),e.preventDefault();break;case s(1949):t[s(782)][s(471)]?.[s(908)](),e[s(1160)]();break;case s(2167):case s(375):n()}})),this[i(1245)][i(2112)](r.id,t),t[i(1409)][i(2226)](r[i(334)]((()=>{const e=i;this._layerListElement.removeChild(t[e(782)]);for(const i of t[e(1409)])i[e(835)]();this._layerListItems.delete(r.id)})))}const a=this[i(1245)][i(1270)](r.id),h=r.id===n?.id;if(a.container[i(1777)][i(1882)]("active",h),this[i(1484)](a,r),h){const e=t>0?s[t-1]:void 0,n=t<s.length-1?s[t+1]:void 0;e?(this._mergeLayerDownButton[i(1751)]("disabled",!1),this._mergeLayerDownButton[i(1863)]=""):(this[i(606)].toggleAttribute("disabled",!0),this[i(606)][i(1863)]=i(1838)),this._moveLayerUpButton[i(1751)](i(1044),!n),this[i(1224)][i(1863)]=n?"":"There is no layer above this layer",this._moveLayerDownButton.toggleAttribute(i(1044),!e),this._moveLayerDownButton[i(1863)]=n?"":i(395)}null===o?(!a[i(782)][i(1022)]||null!==a[i(782)][i(1051)])&&(this[i(1580)].firstChild?this[i(1580)][i(722)](a.container,this[i(1580)][i(611)]):this._layerListElement[i(828)](a[i(782)])):a[i(782)].previousSibling!==o&&o[i(1512)](i(941),a[i(782)]),o=a[i(782)]}if(n){const t=this[i(1468)][i(1270)](n[i(533)]);t&&(t[i(874)]=!0)}}[t(1484)](e,i){const s=t;e[s(966)].textContent=i.name,e[s(431)].checked=i[s(2115)];const n=this[s(424)][s(1866)][s(327)];if(i.id===n?.id){const t=this._blendModeOptions[s(1270)](n.blendMode);t&&(t[s(874)]=!0)}}_getLayerDragEventId(e){const i=t,s=e[i(1003)].getData(i(648));if(s?.[i(996)](i(1972)))return parseInt(s[i(979)](13))}async _generatePreview(e,i){const s=t,n=await e[s(642)](40,40),o=i[s(1792)].getContext("2d");o[s(855)]=!1,o[s(1405)](0,0,40,40),o[s(1312)](n,0,0)}};ln=function(e,i,s,n){const o=t;var r,a=arguments.length,h=a<3?i:null===n?n=Object[o(656)](i,s):n;if("object"==typeof Reflect&&typeof Reflect[o(314)]===o(1524))h=Reflect[o(314)](e,i,s,n);else for(var c=e[o(961)]-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object[o(614)](i,s,h),h}([cn(1,si),cn(2,ze),cn(3,Ze),cn(4,ai)],ln),gi[t(2163)](t(1735),{ctor:ln,defaultVisible:!0,defaultPosition:{x:t(1799),y:{side:t(1799),target:t(1259)}}}),Wi({id:"layer.toggleLayersWindow",label:t(1821),section:t(2013),checked:3,run:e=>e[t(1270)](hi).toggleView(t(1735))}),Wi({id:t(1495),label:"Add New Layer",section:t(2021),run:e=>e[t(1270)](si)[t(1866)][t(699)](),keys:t(1481)}),Wi({id:t(1177),label:"Delete Layer",section:t(2021),run:e=>e.get(si)[t(1866)][t(2227)](),keys:"ctrl+shift+delete"}),Wi({id:t(1754),label:t(2187),section:t(2021),run:e=>e[t(1270)](si)[t(1866)][t(2169)](),keys:t(1075)}),Wi({id:t(1921),label:t(2177),section:t(2021),run:e=>e[t(1270)](si)[t(1866)][t(745)](),keys:t(1627)}),Wi({id:t(1483),label:t(1766),section:"Layer",run:async e=>{const i=t,s=e.get(si),n=e[i(1270)](ai),o=await n[i(764)](i(530),s[i(1866)][i(327)]?.[i(1121)]||"");o&&s[i(1866)][i(2037)](o)}}),Wi({id:"layer.flipHorizontal",label:t(1133),section:t(2021),run:async e=>{const i=t,s=e[i(1270)](si);await s[i(1055)][i(531)](i(2193),{selection:s[i(1435)][i(1767)]})}}),Wi({id:t(451),label:"Flip Vertical",section:t(2021),run:async e=>{const i=t,s=e[i(1270)](si);await s[i(1055)][i(531)]("layer/flipVertical",{selection:s[i(1435)][i(1767)]})}}),Wi({id:t(1570),label:"Rotate 180",section:t(2021),run:async e=>{const i=t,s=e[i(1270)](si);await s[i(1055)].executeOnSingleLayer("layer/rotate180",{selection:s[i(1435)][i(1767)]})}}),Wi({id:t(1011),label:t(1149),section:t(2021),run:e=>e[t(1270)](si).layer.goToTopLayer(),keys:t(1271)}),Wi({id:t(1331),label:t(2043),section:t(2021),run:e=>e[t(1270)](si).layer[t(641)](),keys:t(953)}),Wi({id:t(921),label:"Go to Layer Above",section:t(2021),run:e=>e[t(1270)](si).layer[t(365)](),keys:t(300)}),Wi({id:t(2172),label:t(1951),section:t(2021),run:e=>e[t(1270)](si)[t(1866)][t(2094)](),keys:t(1074)}),Wi({id:t(1421),label:t(430),section:t(2021),run:e=>e.get(si)[t(1866)][t(1332)]()}),Wi({id:t(1215),label:t(348),section:t(2021),run:e=>e[t(1270)](si)[t(1866)].moveLayerUp()}),Wi({id:t(1372),label:t(1015),section:t(2021),run:e=>e[t(1270)](si)[t(1866)][t(1042)]()}),Wi({id:t(2074),label:"Move Layer to Bottom",section:t(2021),run:e=>e.get(si)[t(1866)][t(1808)]()});class dn extends e.JT{constructor(){const e=t;super(...arguments),this[e(1696)]=0,this[e(1663)]=1,this[e(1874)]=e(1831),this[e(1769)]=!0,this[e(2199)]="",this[e(1863)]=e(574),this[e(695)]=e(2135)}}Ei.register({start(e){const i=t,s=e.get(ni),n=e[i(1270)](We);s[i(1577)](n[i(1508)](dn))}}),Wi({id:t(2135),label:t(1708),section:t(1308),run:e=>e[t(1270)](Fi).reportIssue()});var un=i(1123);async function gn(e,i,s,n,o=!1){const r=t;try{const t=await s[r(1733)][r(2023)](e,i,o);return i===r(1010)&&mn(n),t}catch(t){throw r(452)in t&&s[r(331)].showError(t.toString()),t}}function mn(e){const i=t;e[i(417)](i(2191)),e.hideView("layers"),e[i(1407)](i(1259))}function fn(){const e=t,i=yn(getComputedStyle(document[e(943)])[e(1076)](e(1873)));void 0!==i&&document[e(1893)][e(1728)][e(496)]("--luna-icon-brightness",i);const s=yn(getComputedStyle(document[e(943)])[e(1076)]("--vscode-list-activeSelectionForeground"));void 0!==s&&document.body[e(1728)][e(496)](e(467),s);const n=yn(getComputedStyle(document.documentElement)[e(1076)](e(495)));void 0!==n&&document[e(1893)][e(1728)][e(496)](e(1859),n)}function pn(e,i,s){const n=t;i.config[n(491)]=s,e[n(1689)]={defaultTool:s[n(1329)],statusBarPointerColor:s[n(2218)]}}function _n(e,i,s){const n=t;e[n(1270)](11)?.[n(2112)](s),wn(i,"luna:supportsMultipleImages",s)}function wn(e,i,s){const n=t;return e[n(1413)](n(749),{key:i,value:s})}function yn(e){const i=t;let s,n,o,r;if(e[i(996)](i(1374)))[s,n,o,r]=e[i(979)](5,e.indexOf(")"))[i(1723)](",")[i(562)]((t=>+t[i(1544)]()));else{if(7!==e.length)return;s=parseInt(e[i(979)](1,3),16),n=parseInt(e[i(979)](3,5),16),o=parseInt(e[i(979)](5,7),16),r=1}return((s+n+o)*r/765)[i(660)](2)}Ei.register({start(e){const i=t,s=e[i(1270)](si),n=e.get(ze),o=e[i(1270)](Ye),r=e.get(Ti),a=e.get(ci),h=e[i(1270)](hi);let c;r[i(899)](i(1493),(async t=>{const s=i;let n=!0;try{await e.get(He)[s(488)](t)}catch(e){console[s(2018)]("Command "+t+s(2171),e),n=!1}return{success:n}})),r.registerRequestHandler(i(1057),(t=>{pn(o,s,t)})),r[i(899)]("save",(async t=>{const n=i,o=e[n(1270)](ai);let r=s[n(1733)].mimeType;const a=t[n(1428)].toLowerCase();switch(a){case".ico":r=n(548);break;case n(891):r=n(984);break;case n(1891):case n(1925):r="image/x-tga";break;case n(1327):case n(1102):case n(1448):case n(860):r=n(2214);break;case n(1365):case n(1112):r=n(2019);break;case n(1309):r="image/webp";break;default:throw new Error(n(735)+a+'"')}if(void 0===c&&(r===n(2214)||r===n(323))){if(c=await o[n(1576)]("Enter save quality between 0 and 100",80,0,100),void 0===c)throw new Error(n(1573));c/=100}const h=performance[n(1706)](),l=await(t[n(387)]?s[n(1733)][n(1104)]():s[n(1733)][n(1528)]({encodeOptions:{quality:c,type:r}}));return{blobBuffer:new Uint8Array(await l[n(1571)]()),encodeDuration:performance[n(1706)]()-h}})),r[i(899)]("backup",(async t=>{const e=i;return t[e(971)]&&t[e(971)]<s[e(1866)].width*s.layer[e(1096)]?{success:!1}:{success:!0,state:s[e(1733)][e(1200)](t.hotExitMaxPixels),workbenchState:a[e(875)]}})),r.registerRequestHandler(i(318),(async t=>{const e=i;c=void 0,gn(t[e(1218)],t[e(1428)],s,h)})),r[i(1413)]("ready",void 0).then((async t=>{const e=i,c=performance.now();switch(pn(o,s,t[e(1689)]),!t[e(1440)]&&h.showDefaults(),t.type!==e(318)&&window.focus(),t[e(1653)]){case e(1063):{await s[e(1733)].newImage(t[e(622)][e(1847)],t[e(622)].height,t[e(1428)]);const i=".ico"===t[e(1428)];_n(n,r,i),i&&mn(h);break}case e(1942):try{let i=t.data;if(!i){const t=await as[e(930)]();t&&(i=new Uint8Array(await t.arrayBuffer()))}i?(s[e(1733)][e(2023)](i,e(891),!1),r.request(e(560),i)):(await s[e(1733)][e(883)](t[e(1885)][e(1847)],t[e(1885)][e(1096)]),_n(n,r,!1));break}catch(t){console.error(e(982),t)}await s[e(1733)][e(883)](t[e(1885)].width,t[e(1885)][e(1096)]),_n(n,r,!1);break;case e(318):try{const i=await gn(t.data,t[e(1428)],s,h,t[e(1440)]);_n(n,r,t[e(1428)]===e(1010)),i&&await r.request("showDecodeProblemStatusBarEntry",{level:"warning"})}catch(t){throw t instanceof un._9&&await r[e(1413)](e(1292),{level:e(2018)}),t}break;case e(1070):if((!t.restoreHistory||0===t.state[e(1893)].history?.[e(1832)]?.[e(961)])&&(t[e(875)].body[e(370)]={currentEntry:0,entries:[(new U)[e(1644)]()]}),s[e(1733)][e(532)](t[e(875)]),void 0!==t[e(425)]&&t[e(425)]!==t.state[e(1893)][e(370)][e(1579)]){let i=t.state[e(1893)][e(370)].currentEntry-t[e(425)];if(i>0)for(;0!=i--&&s.history.canUndo;)await s[e(370)][e(1090)]();else if(i<0)for(;0!=i++&&s[e(370)][e(445)];)await s.history[e(568)]()}_n(n,r,!1)}a[e(532)](t[e(1199)]),r[e(1413)]("parseFinished",{duration:performance[e(1706)]()-c})})),r[i(899)](i(1674),(t=>{a[i(1674)](t)})),a.onStateChange((t=>r[i(1413)](i(296),t))),r.registerRequestHandler("pauseanimations",(()=>s[i(331)][i(1680)]())),window[i(2118)](i(908),(()=>{const t=i;wn(r,t(626),!0),s[t(331)][t(1969)]()})),window[i(2118)](i(1852),(()=>{wn(r,i(626),!1)})),window[i(2118)](i(1872),(t=>{const e=i,s=t[e(1696)];if(s.tagName!==e(1293))wn(r,e(616),!1);else{const t=s,i="text"===t[e(1653)]||t[e(1653)]===e(1896);wn(r,"luna:textFocused",i)}})),window.addEventListener(i(866),(t=>{wn(r,i(616),!1)})),s[i(370)].onEntriesChange((t=>{const e=i;!t||s[e(370)][e(1832)][e(961)]<=1||s[e(370)][e(1521)]!==s[e(370)][e(1832)][s[e(370)][e(1832)][e(961)]-1]||r[e(1413)]("historyNewEdit",{label:s[e(370)][e(1521)][e(392)]})})),s[i(1733)][i(1796)]((t=>{const e=i;r[e(1413)](e(906),t)})),Wi({id:i(420),label:i(1480),section:i(1249),run:()=>{const t=i;return r.request(t(1197),{command:t(1330),args:t(2067)})}}),e[i(1270)](ni)[i(1577)]({text:i(2081),alignment:0,className:i(526),hasImage:!0,target:0,dispose:()=>{},commandId:i(420)}),n[i(1270)](8)?.[i(1025)]((t=>wn(r,"luna:hasSelection",t))),n[i(1270)](4)?.[i(1025)]((t=>wn(r,"luna:layerEntryFocused",t))),gs[i(546)]=()=>r.request(i(1197),{command:"redo"}),gs[i(1558)]=()=>r[i(1413)](i(1197),{command:"undo"}),new MutationObserver((()=>fn())).observe(document.documentElement,{attributes:!0,attributeFilter:[i(1728)]}),fn()}});const vn=new ei,bn=new xe({mouseWheelBehavior:"scroll",snapToPixelGrid:!0});bn[t(1055)][t(1806)]=!0,!(t(2123)in window)&&(window[t(2123)]=ArrayBuffer),vn[t(1441)](si,bn);const xn=window[t(353)]();window[t(353)]=void 0,vn[t(1441)](Ye,vn[t(1508)](Je)),vn.setService(Ti,vn[t(1508)](Li,xn)),vn[t(1441)](ci,vn[t(1508)](Si)),vn[t(1441)](ai,vn[t(1508)](Pi)),vn[t(1441)](Ze,vn[t(1508)](Ai)),vn[t(1441)](ze,vn[t(1508)](Ke)),vn[t(1441)](He,vn[t(1508)](Xe)),vn.setService(Qe,vn[t(1508)](Bi)),vn[t(1441)](ni,vn[t(1508)](oi)),vn[t(1441)](ii,vn[t(1508)](Di)),vn[t(1441)](vi,vn[t(1508)](bi)),vn.setService(wi,vn[t(1508)](yi)),vn[t(1441)](hi,vn[t(1508)](_i)),vn[t(1441)](Fi,vn.createInstance(Ni)),new class{constructor(e){const i=t,s=document.querySelector(i(2040));e.getService(si)[i(838)][i(455)](s);for(const t of Ei[i(1456)]())e[i(1640)](t[i(2125)][i(1618)](t))}}(vn)})()})();