"use strict";const a19_0x1fce=["bottomright","moveSelection","includes","pointerDownMove","_viewportService","ArrowLeft","move","MoveImageRangeRenderer","_directionalMoveElements","55609FnNFpC","_enabled","order","style","setRange","bottom","push","setTopLeft","_cursorOrigin","getPointerState","_cropToSelectionAction","ArrowDown","selectAll","ArrowUp","onUpdate","keyDown","state","offsetX","12647kOIGRv","render","clientWidth","left","_onStateChange","pointerDown","range","type","_sc","_onUpdate","currentLayer","topleft","new","_elementContainer","zoom","viewportService","enabled","altKey","Move Selection","_cursorCurrent","clientHeight","_container","set","slice","round","get","756342XJSTRQ","metaKey","_isVisible","event","4TEdpGs","top","_originalSelection","selectionService","pointerUp","max","getCoordsFromEvent","ArrowRight","_renderer","29ySgVvA","register","imageService","1113748VLfZQp","appendChild","738256yBKQVb","none","fire","_refreshActionEnabledState","setVisible","createElement","_imageService","bottomleft","topright","shiftKey","1845300sRZECr","right","_allowNewState","_directionalMoveZones","_getRange","ctrlKey","min","div","devicePixelRatio","height","isSelectionTool","1450667oHxrSQ"],a19_0x1c4d=function(t,e){return a19_0x1fce[t-=348]},a19_0x253feb=a19_0x1c4d;!function(t,e){const s=a19_0x1c4d;for(;;)try{if(940453===-parseInt(s(420))-parseInt(s(376))-parseInt(s(402))-parseInt(s(430))+parseInt(s(348))+-parseInt(s(415))*parseInt(s(358))+-parseInt(s(406))*-parseInt(s(418)))break;t.push(t.shift())}catch(e){t.push(t.shift())}}(a19_0x1fce),(self.webpackChunkluna=self.webpackChunkluna||[])[a19_0x253feb(364)]([[403,504],{6173:(t,e,s)=>{const i=a19_0x253feb;s.d(e,{f:()=>n});var o=s(1815),h=s(5120);class n extends h.JT{constructor(t,e,s){const i=a19_0x1c4d;super(),this.name=t,this[i(383)]=e,this[i(359)]=s,this[i(385)]=this[i(416)](new o.v),this[i(372)]=this._onUpdate[i(405)]}get[i(392)](){return this[i(359)]}set[i(392)](t){const e=i;this[e(359)]!==t&&(this[e(359)]=t,this[e(385)][e(422)]())}}},504:(t,e,s)=>{const i=a19_0x253feb;s.r(e),s.d(e,{MoveImageRangeRenderer:()=>n});var o=s(5120),h=s(1003);class n extends o.JT{constructor(t,e,s,i,o){const n=a19_0x1c4d;super(),this[n(397)]=t,this._getRange=e,this[n(432)]=s,this._viewportService=i,this._imageService=o,this[n(360)]=2,this[n(357)]=new Map,this._directionalMoveZones=new Map,this[n(404)]=!0,this[n(389)]=document.createElement(n(437));const r=["topleft",n(428),n(427),n(349),n(407),n(363),n(379),n(431)];for(const t of r){const e=document[n(425)](n(437));e.classList.add("move-handle",t),this[n(389)][n(419)](e),this[n(357)].set(t,e),this._directionalMoveZones[n(398)](t,(0,h.Pq)())}this[n(397)][n(419)](this[n(389)]),this[n(416)]({dispose:()=>{this[n(397)].removeChild(this._elementContainer)}})}setVisible(t){const e=a19_0x1c4d;t!==this[e(404)]&&(this[e(389)][e(361)].display=t?"":e(421),this._isVisible=t)}[i(362)](t){}[i(377)](){const t=i,e=this[t(434)]();if(!e)return;const s=this[t(426)][t(386)];if(!s)return;const o=this[t(353)],h=Math.round(this[t(397)][t(378)]/2)-s.width/2*o[t(390)],n=Math.round(this[t(397)][t(396)]/2)-s[t(439)]/2*o.zoom,r=h+(o.x+e[t(379)])*o.zoom,c=n+(o.y+e.top)*o[t(390)],a=h+(o.x+e[t(431)])*o.zoom,l=n+(o.y+e.bottom)*o[t(390)],p=Math[t(400)]((r+a)/2),f=Math[t(400)]((c+l)/2),d=10*window[t(438)],g={left:Math[t(436)](r+d,Math.max(r,p-d)),top:Math.min(c+d,Math[t(411)](c,f-d)),right:Math.max(a-d,Math[t(436)](a,p+d)),bottom:Math.max(l-d,Math.min(l,f+d))},_={left:r-d,top:c-d,right:a+d,bottom:l+d},m=this[t(433)][t(401)](t(387));m[t(379)]=_[t(379)],m[t(431)]=g.left,m[t(407)]=_[t(407)],m[t(363)]=g[t(407)];const u=this[t(357)][t(401)](t(387));u[t(361)][t(379)]=r+"px",u[t(361)][t(407)]=c+"px";const v=this[t(433)][t(401)]("topright");v.left=g[t(431)],v[t(431)]=_.right,v[t(407)]=_[t(407)],v[t(363)]=g[t(407)];const M=this._directionalMoveElements[t(401)](t(428));M[t(361)][t(379)]=a+"px",M[t(361)][t(407)]=c+"px";const x=this[t(433)][t(401)](t(427));x[t(379)]=_[t(379)],x[t(431)]=g[t(379)],x[t(407)]=g.bottom,x[t(363)]=_[t(363)];const b=this[t(357)].get(t(427));b[t(361)][t(379)]=r+"px",b.style[t(407)]=l+"px";const w=this._directionalMoveZones[t(401)](t(349));w.left=g[t(431)],w[t(431)]=_[t(431)],w[t(407)]=g[t(363)],w[t(363)]=_[t(363)];const S=this[t(357)][t(401)](t(349));S[t(361)].left=a+"px",S[t(361)][t(407)]=l+"px";const y=this[t(433)].get("top");y[t(379)]=g[t(379)],y.right=g[t(431)],y[t(407)]=_.top,y[t(363)]=g[t(407)];const C=this[t(357)][t(401)](t(407));C[t(361)][t(379)]=p+"px",C[t(361)][t(407)]=c+"px";const R=this[t(433)][t(401)](t(363));R.left=g[t(379)],R[t(431)]=g[t(431)],R[t(407)]=g[t(363)],R.bottom=_[t(363)];const k=this[t(357)][t(401)](t(363));k[t(361)][t(379)]=p+"px",k.style.top=l+"px";const I=this._directionalMoveZones[t(401)]("left");I[t(379)]=_[t(379)],I[t(431)]=g.left,I[t(407)]=g[t(407)],I[t(363)]=g[t(363)];const A=this[t(357)].get(t(379));A[t(361)].left=r+"px",A.style[t(407)]=f+"px";const T=this[t(433)].get(t(431));T.left=g.right,T[t(431)]=_[t(431)],T[t(407)]=g[t(407)],T[t(363)]=g[t(363)];const E=this[t(357)][t(401)](t(431));E[t(361)].left=a+"px",E[t(361)][t(407)]=f+"px"}[i(367)](t){const e=i;if(!this._getRange())return this[e(432)]?e(388):e(355);for(const[s,i]of this[e(433)])if((0,h.RB)(i,t[e(375)],t.offsetY))return s;const s=this[e(433)].get(e(387)),o=this[e(433)][e(401)](e(349)),n={left:s[e(379)],top:s[e(407)],right:o[e(431)],bottom:o[e(363)]};return(0,h.RB)(n,t[e(375)],t.offsetY)?e(355):this[e(432)]?e(388):e(355)}}},403:(t,e,s)=>{const i=a19_0x253feb;s.r(e),s.d(e,{default:()=>f});var o=s(1815),h=s(7896),n=s(5120),r=s(1003),c=s(6173),a=s(504);const l=[i(371),i(354),i(369),i(413)];class p extends n.JT{constructor(t){const e=i;super(),this._sc=t,this.id=e(350),this[e(440)]=!0,this[e(374)]="move",this[e(368)]=new c.f("Crop to Selection","crop-to-selection",!1),this.actions=[this[e(368)]],this[e(380)]=this[e(416)](new o.v),this.onStateChange=this[e(380)][e(405)],this.register(this._sc.selectionService[e(372)]((()=>this[e(423)]()))),this._refreshActionEnabledState()}[i(381)](t){const e=i;!this._sc.selectionService[e(382)]&&this[e(384)][e(417)][e(370)](),this._cursorOrigin=this[e(384)][e(391)].getCoordsFromEvent(t),this._cursorCurrent=this[e(366)][e(399)](),this[e(408)]=this._sc[e(409)][e(382)],this[e(374)]===e(388)||this[e(408)]&&((this.state===e(407)||"topleft"===this[e(374)]||this.state===e(428))&&(this[e(366)][1]=this[e(408)][e(407)]),("bottom"===this[e(374)]||this[e(374)]===e(427)||this[e(374)]===e(349))&&(this[e(366)][1]=this._originalSelection[e(363)]-1),("left"===this[e(374)]||this[e(374)]===e(387)||"bottomleft"===this.state)&&(this[e(366)][0]=this[e(408)][e(379)]),(this[e(374)]===e(431)||"topright"===this[e(374)]||this[e(374)]===e(349))&&(this[e(366)][0]=this[e(408)].right-1))}[i(410)](t){const e=i;this[e(384)][e(409)][e(382)]&&this._sc[e(409)].commit(e(394),e(350))}pointerMove(t,e){const s=i;if(this[s(414)]&&!e){const e=this[s(414)].getPointerState(t);this[s(374)]!==e&&(this.state=e,this[s(380)][s(422)]())}}[i(352)](t){const e=i;if(!this[e(384)][e(409)].range||!this[e(366)]||!this[e(408)])return;this[e(395)]=this[e(384)][e(391)][e(412)](t);const s=this._cursorCurrent[0]-this._cursorOrigin[0],o=this._cursorCurrent[1]-this[e(366)][1];if(this[e(374)]===e(355))return void this[e(384)][e(409)][e(365)](this[e(408)][e(379)]+s,this[e(408)][e(407)]+o);let h;if(!t[e(429)]||this[e(374)]!==e(387)&&this[e(374)]!==e(428)&&this[e(374)]!==e(427)&&this.state!==e(349))h=(0,r.BN)(this[e(408)]),(this[e(374)]===e(407)||this[e(374)]===e(387)||"topright"===this[e(374)])&&(h.top+=o,h[e(363)]<=h[e(407)]&&h.top++,t.altKey&&(h[e(363)]-=o)),(this[e(374)]===e(363)||this[e(374)]===e(427)||this[e(374)]===e(349))&&(h[e(363)]+=o,h[e(363)]<=h[e(407)]&&h[e(363)]--,t.altKey&&(h[e(407)]-=o)),(this[e(374)]===e(379)||this[e(374)]===e(387)||this[e(374)]===e(427))&&(h[e(379)]+=s,h[e(431)]<=h.left&&h[e(379)]++,t[e(393)]&&(h[e(431)]-=s)),(this[e(374)]===e(431)||this[e(374)]===e(428)||"bottomright"===this[e(374)])&&(h[e(431)]+=s,h.right<=h[e(379)]&&h[e(431)]--,t[e(393)]&&(h[e(379)]-=s));else{const i=(0,r.n3)(this[e(408)]);let n;switch(h=(0,r.BN)(this[e(408)]),this[e(374)]){case"topleft":n=(1/i*-s-o)/2,h[e(379)]-=Math[e(400)](n*i),h.top-=Math[e(400)](n),t[e(393)]&&(h[e(431)]+=Math[e(400)](n*i),h.bottom+=Math[e(400)](n));break;case"topright":n=(s*(1/i)-o)/2,h.right+=Math[e(400)](n*i),h[e(407)]-=Math[e(400)](n),t[e(393)]&&(h.left-=Math[e(400)](n*i),h[e(363)]+=Math[e(400)](n));break;case e(427):n=(1/i*-s+o)/2,h.left-=Math.round(n*i),h[e(363)]+=Math[e(400)](n),t.altKey&&(h[e(431)]+=Math[e(400)](n*i),h[e(407)]-=Math[e(400)](n));break;case e(349):n=(s*(1/i)+o)/2,h.right+=Math[e(400)](n*i),h.bottom+=Math.round(n),t[e(393)]&&(h.left-=Math[e(400)](n*i),h[e(407)]-=Math[e(400)](n))}}this._sc.selectionService[e(382)]=(0,r.FJ)(h)}[i(373)](t){const e=i;if(!this[e(384)][e(417)])return;if(!l[e(351)](t.key))return;const s=this[e(384)].selectionService[e(382)]||this[e(384)][e(417)][e(370)](),o=(h.V5?t[e(403)]:t[e(435)])?10:1;switch(t.key){case e(371):this[e(384)][e(409)].setTopLeft(s[e(379)],s[e(407)]-o);break;case"ArrowDown":this[e(384)].selectionService[e(365)](s.left,s[e(407)]+o);break;case e(354):this[e(384)][e(409)].setTopLeft(s[e(379)]-o,s[e(407)]);break;case e(413):this[e(384)][e(409)][e(365)](s[e(379)]+o,s[e(407)])}}[i(423)](){const t=i,e=this[t(384)][t(409)].range;this._cropToSelectionAction.enabled=!(!e||0===e[t(379)]&&0===e[t(407)]&&e[t(431)]===this._sc[t(417)].width&&e.bottom===this[t(384)][t(417)].height)}createDomRenderProgram(t){const e=i,s=new(a[e(356)])(t,(()=>this[e(384)][e(409)][e(382)]),!1,this._sc[e(391)],this[e(384)][e(417)]);return this[e(384)][e(409)].onUpdate((()=>s[e(424)](void 0!==this[e(384)][e(409)][e(382)]))),s[e(424)](void 0!==this[e(384)][e(409)].range),this[e(414)]=s,this[e(414)]}}const f=p}}]);