"use strict";const a9_0x12e1=["bitDepth","length","set","577fnYydh",'Unsupported bit depth for color map "',"Provided image data length (","height","entries","charCodeAt","75182NsqoXX","image","Image ID length is out of range (","No ImageType set","Cannot write color map undefined","writeUint16","view","info","Image width is out of range (","RLE encoded was used but it is larger than unencoded would be","webpackChunkluna","size","setUint8",") is not expected length (","setUint16","This image is encoded using a top right screen origin, many image editors won't read this correctly","Writing finished before expected length of stream","3bmxKvA","Bit depth and image type options must be used together","325iDBpvQ","array","writeUint8","3bHWTAk","offset","reduce","ceil","width","origin","colorToIndexMap","get","688924qUOIwc","add","slice","push","_le","colorMap","632515QZRABp","buffer","6008AclTwY","data","Image has too many colors to encode using a color map"," > 255)","imageType","imageId","Unsupported image type (","1189JvbDtz","screenOrigin","assertAtEnd"," > 65535)","options","NYI","7XMygdq","Cannot encode 24 bit image without data loss as it contains transparent colors","1669cldJXo","23011uVJaAp","map","warnings"],a9_0x432c=function(t,e){return a9_0x12e1[t-=108]},a9_0x2f76b7=a9_0x432c;!function(t,e){const n=a9_0x432c;for(;;)try{if(413294===parseInt(n(136))*parseInt(n(151))+-parseInt(n(138))*-parseInt(n(170))+parseInt(n(121))+-parseInt(n(145))*parseInt(n(130))+-parseInt(n(173))*-parseInt(n(139))+parseInt(n(123))*parseInt(n(168))+-parseInt(n(115)))break;t.push(t.shift())}catch(e){t.push(t.shift())}}(a9_0x12e1),(self.webpackChunkluna=self[a9_0x2f76b7(161)]||[])[a9_0x2f76b7(118)]([[2938],{2938:(t,e,n)=>{const i=a9_0x2f76b7;n.r(e),n.d(e,{encodeTga:()=>f});class o extends Error{constructor(t,e){const n=a9_0x432c;super(t),this[n(108)]=e}}class r extends Error{constructor(t,e){const n=a9_0x432c;super(t),this[n(108)]=e}}function a(t,e){if(t[a9_0x432c(134)].strictMode)throw e;t.warnings.push(e)}function s(t){const e=a9_0x432c,n=t.width*t[e(148)]*4;let i=!1,o=!1,r=!1,a=!1;const s=new Set;for(let h=0;h<n;h+=4)i||(i=t.data[h+3]>0&&t[e(124)][h+3]<255),o||(o=t[e(124)][h+3]<255),!r&&(r||(r=!(c(t[e(124)][h])&&c(t[e(124)][h+1])&&c(t[e(124)][h+2])&&c(t.data[h+3])))),!a&&(a=t.data[h]!==t[e(124)][h+1]||t[e(124)][h]!==t.data[h+2]),s.size<256&&s[e(116)]((t[e(124)][h]<<24)+(t[e(124)][h+1]<<16)+(t[e(124)][h+2]<<8)+t.data[h+3]);if(s[e(162)]<255){const t=new Map;let n,i=0;for(const n of s)t[e(144)](n,i++);return n=r?o?{colorToIndexMap:t,bitDepth:32}:{colorToIndexMap:t,bitDepth:24}:o?{colorToIndexMap:t,bitDepth:32}:{colorToIndexMap:t,bitDepth:15},{imageType:9,bitDepth:8,colorMap:n}}return a?r?o?{imageType:10,bitDepth:32}:{imageType:10,bitDepth:24}:o?i?{imageType:10,bitDepth:32}:{imageType:10,bitDepth:16}:{imageType:10,bitDepth:15}:o?{imageType:11,bitDepth:16}:{imageType:11,bitDepth:8}}function c(t){return(t>>5&7)==(7&t)}class h{constructor(t,e){const n=a9_0x432c;this[n(119)]=e,this[n(108)]=0,this[n(171)]=new Uint8Array(t),this.view=new DataView(this.array[n(122)],this.array.byteOffset,this[n(171)].byteLength)}[i(172)](t){const e=i;this[e(157)][e(163)](this.offset,t),this[e(108)]+=1}[i(156)](t){const e=i;this[e(157)][e(165)](this.offset,t,this[e(119)]),this[e(108)]+=2}[i(132)](){const t=i;if(this[t(108)]!==this[t(171)][t(143)])throw new Error(t(167))}}async function f(t,e={}){const n=i,c=function(t,e={}){const n=a9_0x432c,i=[],c={options:e,warnings:i};if(t[n(111)]>65535)throw new o(n(159)+t[n(111)]+n(133),-1);if(t[n(148)]>65535)throw new o("Image height is out of range ("+t[n(148)]+n(133),-1);if(t.data.length!==t[n(111)]*t[n(148)]*4)throw new o(n(147)+t[n(124)].length+n(164)+t[n(111)]*t[n(148)]*4+")",Math.min(t[n(124)].length,t[n(111)]*t[n(148)]*4)-1);if(e.imageId&&e[n(128)][n(143)]>255)throw new o(n(153)+e[n(128)][n(143)]+n(126),-1);if(e[n(112)]&&(e.origin.x||0)>65535)throw new o("X origin is out of range ("+e[n(112)].x+n(133),-1);if(e[n(112)]&&(e[n(112)].y||0)>65535)throw new o("Y origin is out of range ("+e[n(112)].y+" > 65535)",-1);if(1===e[n(131)]&&a(c,new r("This image is encoded using a bottom right screen origin, many image editors won't read this correctly",17)),3===e[n(131)]&&a(c,new r(n(166),17)),void 0!==e[n(142)]&&void 0===e[n(127)]||void 0===e[n(142)]&&void 0!==e[n(127)])throw new o(n(169),-1);let h,f=e[n(127)],p=e.bitDepth;if(24===p&&function(t){const e=a9_0x432c,n=t[e(111)]*t[e(148)]*4;let i=!1;for(let e=0;e<n;e+=4)i||(i=t.data[e+3]<255);return i}(t)&&a({options:e,warnings:i},new r(n(137),0)),9===f||1===f){const e=s(t);if(!e[n(120)])throw new o(n(125),-1);h=e[n(120)]}if(!p){const e=s(t);p=e[n(142)],f=e[n(127)],h=e.colorMap}if(!f)throw new Error(n(154));return{bitDepth:p,imageType:f,colorMap:h,imageId:e[n(128)]||"",options:e,warnings:i,info:[],image:t}}(t,e),f=[];f.push(function(t){const e=i;var n,o,r,a,s,c,f;const p=new h(18,!0);p.writeUint8(t.imageId[e(143)]),p[e(172)](t.colorMap?1:0),p[e(172)](t[e(127)]),p.writeUint16(0),p.writeUint16(null!==(o=null===(n=t[e(120)])||void 0===n?void 0:n[e(113)][e(162)])&&void 0!==o?o:0),p.writeUint8(null!==(a=null===(r=t[e(120)])||void 0===r?void 0:r.bitDepth)&&void 0!==a?a:0),p[e(156)]((null===(s=t[e(134)][e(112)])||void 0===s?void 0:s.x)||0),p[e(156)]((null===(c=t.options[e(112)])||void 0===c?void 0:c.y)||0),p[e(156)](t[e(152)][e(111)]),p[e(156)](t[e(152)][e(148)]),p[e(172)](t[e(142)]);let d=0;32===t.bitDepth&&(d=8);const l=15&d|(null!==(f=t[e(134)][e(131)])&&void 0!==f?f:0)<<4&48;return p.writeUint8(l),p[e(132)](),p[e(171)]}(c)),c.imageId[n(143)]>0&&f[n(118)](function(t){const e=i,n=new h(t[e(128)][e(143)],!0);for(let i=0;i<t[e(128)][e(143)];i++)n.writeUint8(t.imageId[e(150)](i));return n[e(132)](),n.array}(c)),c.colorMap&&f[n(118)](function(t){const e=i,n=t[e(120)];if(!n)throw new Error(e(155));const o=Math[e(110)](n[e(142)]/8),r=new h(n[e(113)].size*o,!0);let a;switch(n.bitDepth){case 15:a=d;break;case 16:a=l;break;case 24:a=g;break;case 32:a=u;break;default:throw new Error(e(146)+n[e(142)]+'"')}const s=Array.from(n[e(113)][e(149)]()).sort(((t,e)=>t[1]-e[1]))[e(140)]((t=>t[0]));for(const t of s)a(r,new Uint8Array([t>>24&255,t>>16&255,t>>8&255,255&t]),0);return r.assertAtEnd(),r[e(171)]}(c)),f[n(118)](function(t){const e=i;var n;const o=Math[e(110)](t[e(142)]/8),s=new h(t[e(152)].width*t.image[e(148)]*o,!0);let c,f=0;if(t.colorMap){const n=t.colorMap;c=(t,i,o)=>{const r=e,a=n[r(113)][r(114)]((i[o]<<24)+(i[o+1]<<16)+(i[o+2]<<8)+i[o+3]);t[r(172)](a)}}else switch(t.bitDepth){case 8:if(3!==t[e(127)]&&11!==t[e(127)])throw new Error(e(129)+t[e(127)]+") with bit depth ("+t[e(142)]+")");c=p;break;case 15:c=d;break;case 16:c=3===t[e(127)]||11===t.imageType?w:l;break;case 24:c=g;break;case 32:c=u;break;default:throw new Error(e(135))}switch(null!==(n=t[e(134)][e(131)])&&void 0!==n?n:0){case 0:for(let n=t[e(152)][e(148)]-1;n>=0;n--){f=t[e(152)][e(111)]*n*4;for(let n=0;n<t[e(152)][e(111)];n++)c(s,t[e(152)].data,f),f+=4}break;case 1:for(let n=t[e(152)].height-1;n>=0;n--){f=4*(t[e(152)].width*n+(t[e(152)].width-1));for(let n=0;n<t[e(152)][e(111)];n++)c(s,t.image[e(124)],f),f-=4}break;case 2:for(let n=0;n<t[e(152)][e(148)];n++){f=t[e(152)][e(111)]*n*4;for(let n=0;n<t.image.width;n++)c(s,t[e(152)][e(124)],f),f+=4}break;case 3:for(let n=0;n<t[e(152)].height;n++){f=4*(t[e(152)][e(111)]*n+(t[e(152)][e(111)]-1));for(let n=0;n<t[e(152)][e(111)];n++)c(s,t[e(152)][e(124)],f),f-=4}}return s[e(132)](),8&t.imageType?function(t,e){const n=i,o=Math[n(110)](t[n(142)]/8),s=o+1,c=new Uint8Array(t[n(152)][n(111)]*t[n(152)].height*s);let h=0,f=0,p=1,d=0,l=!1,w=0,g=0,u=!1;for(let t=o;t<e[n(143)];t+=o){let n=!1;for(d=0;d<o;d++)n||(n=e[f+d]!==e[t+d]);if(n){for(;p>0;){for(l=1===p,u&&l?(w=127&c[g],w<127?c[g]=w+1:(c[h]=Math.min(p,128)-1,g=h,h++)):(c[h]=Math.min(p,128)-1|(l?0:128),g=h,h++),d=0;d<o;d++)c[h+d]=e[f+d];h+=o,u=l,p-=128}f=t,p=1}else p++}for(;p>0;){for(l=1===p,u&&l?(w=127&c[g],w<127?c[g]=w+1:(c[h]=Math.min(p,128)-1,g=h,h++)):(c[h]=Math.min(p,128)-1|(l?0:128),g=h,h++),d=0;d<o;d++)c[h+d]=e[f+d];h+=o,p-=128}return h-1>e[n(143)]&&a(t,new r(n(160),-1)),c[n(117)](0,h)}(t,s[e(171)]):s[e(171)]}(c));const m=f[n(109)](((t,e)=>t+e.length),0),b=new Uint8Array(m);let y=0;for(const t of f)b.set(t,y),y+=t[n(143)];return{data:b,warnings:c[n(141)],info:c[n(158)]}}function p(t,e,n){t.writeUint8(e[n])}function d(t,e,n){t[i(156)]((e[n+0]>>3&31)<<10|(e[n+1]>>3&31)<<5|(e[n+2]>>3&31)<<0)}function l(t,e,n){t[i(156)]((e[n+0]>>3&31)<<10|(e[n+1]>>3&31)<<5|(e[n+2]>>3&31)<<0|(255===e[n+3]?32768:0))}function w(t,e,n){const o=i;t[o(172)](e[n]),t[o(172)](e[n+3])}function g(t,e,n){const o=i;t.writeUint8(e[n+2]),t.writeUint8(e[n+1]),t[o(172)](e[n+0])}function u(t,e,n){const o=i;t[o(172)](e[n+2]),t[o(172)](e[n+1]),t[o(172)](e[n+0]),t[o(172)](e[n+3])}}}]);