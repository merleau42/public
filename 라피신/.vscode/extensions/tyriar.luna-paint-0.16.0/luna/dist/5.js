"use strict";(self.webpackChunkluna=self.webpackChunkluna||[]).push([[5],{42:(e,t,i)=>{i.r(t),i.d(t,{analyze:()=>r});var n=i(43);function r(e,t={}){const i=[],r={options:t,warnings:i};if(e.width>65535)throw new n.EncodeError(`Image width is out of range (${e.width} > 65535)`,-1);if(e.height>65535)throw new n.EncodeError(`Image height is out of range (${e.height} > 65535)`,-1);if(e.data.length!==e.width*e.height*4)throw new n.EncodeError(`Provided image data length (${e.data.length}) is not expected length (${e.width*e.height*4})`,Math.min(e.data.length,e.width*e.height*4)-1);if(t.imageId&&t.imageId.length>255)throw new n.EncodeError(`Image ID length is out of range (${t.imageId.length} > 255)`,-1);if(t.origin&&(t.origin.x||0)>65535)throw new n.EncodeError(`X origin is out of range (${t.origin.x} > 65535)`,-1);if(t.origin&&(t.origin.y||0)>65535)throw new n.EncodeError(`Y origin is out of range (${t.origin.y} > 65535)`,-1);if(1===t.screenOrigin&&(0,n.handleWarning)(r,new n.EncodeWarning("This image is encoded using a bottom right screen origin, many image editors won't read this correctly",17)),3===t.screenOrigin&&(0,n.handleWarning)(r,new n.EncodeWarning("This image is encoded using a top right screen origin, many image editors won't read this correctly",17)),void 0!==t.bitDepth&&void 0===t.imageType||void 0===t.bitDepth&&void 0!==t.imageType)throw new n.EncodeError("Bit depth and image type options must be used together",-1);let o,h=t.imageType,s=t.bitDepth;if(24===s&&function(e){const t=e.width*e.height*4;let i=!1;for(let n=0;n<t;n+=4)i||(i=e.data[n+3]<255);return i}(e)&&(0,n.handleWarning)({options:t,warnings:i},new n.EncodeWarning("Cannot encode 24 bit image without data loss as it contains transparent colors",0)),9===h||1===h){const t=a(e);if(!t.colorMap)throw new n.EncodeError("Image has too many colors to encode using a color map",-1);o=t.colorMap}if(!s){const t=a(e);s=t.bitDepth,h=t.imageType,o=t.colorMap}if(!h)throw new Error("No ImageType set");return{bitDepth:s,imageType:h,colorMap:o,imageId:t.imageId||"",options:t,warnings:i,info:[],image:e}}function a(e){const t=e.width*e.height*4;let i=!1,n=!1,r=!1,a=!1;const h=new Set;for(let s=0;s<t;s+=4)i||(i=e.data[s+3]>0&&e.data[s+3]<255),n||(n=e.data[s+3]<255),r||r||(r=!(o(e.data[s])&&o(e.data[s+1])&&o(e.data[s+2])&&o(e.data[s+3]))),a||(a=e.data[s]!==e.data[s+1]||e.data[s]!==e.data[s+2]),h.size<256&&h.add((e.data[s]<<24)+(e.data[s+1]<<16)+(e.data[s+2]<<8)+e.data[s+3]);if(h.size<255){const e=new Map;let t,i=0;for(const t of h)e.set(t,i++);return t=r?n?{colorToIndexMap:e,bitDepth:32}:{colorToIndexMap:e,bitDepth:24}:n?{colorToIndexMap:e,bitDepth:32}:{colorToIndexMap:e,bitDepth:15},{imageType:9,bitDepth:8,colorMap:t}}return a?r?n?{imageType:10,bitDepth:32}:{imageType:10,bitDepth:24}:n?i?{imageType:10,bitDepth:32}:{imageType:10,bitDepth:16}:{imageType:10,bitDepth:15}:n?{imageType:11,bitDepth:16}:{imageType:11,bitDepth:8}}function o(e){return(e>>5&7)==(7&e)}},43:(e,t,i)=>{i.r(t),i.d(t,{EncodeError:()=>n,EncodeWarning:()=>r,handleWarning:()=>a});class n extends Error{constructor(e,t){super(e),this.offset=t}}class r extends Error{constructor(e,t){super(e),this.offset=t}}function a(e,t){if(e.options.strictMode)throw t;e.warnings.push(t)}},44:(e,t,i)=>{i.r(t),i.d(t,{ByteStream:()=>n});class n{constructor(e,t){this._le=t,this.offset=0,this.array=new Uint8Array(e),this.view=new DataView(this.array.buffer,this.array.byteOffset,this.array.byteLength)}writeUint8(e){this.view.setUint8(this.offset,e),this.offset+=1}writeUint16(e){this.view.setUint16(this.offset,e,this._le),this.offset+=2}assertAtEnd(){if(this.offset!==this.array.length)throw new Error("Writing finished before expected length of stream")}}},41:(e,t,i)=>{i.r(t),i.d(t,{encodeTga:()=>o});var n=i(42),r=i(44),a=i(45);async function o(e,t={}){const i=(0,n.analyze)(e,t),o=[];o.push(function(e){var t,i,n,a,o,h,s;const d=new r.ByteStream(18,!0);d.writeUint8(e.imageId.length),d.writeUint8(e.colorMap?1:0),d.writeUint8(e.imageType),d.writeUint16(0),d.writeUint16(null!==(i=null===(t=e.colorMap)||void 0===t?void 0:t.colorToIndexMap.size)&&void 0!==i?i:0),d.writeUint8(null!==(a=null===(n=e.colorMap)||void 0===n?void 0:n.bitDepth)&&void 0!==a?a:0),d.writeUint16((null===(o=e.options.origin)||void 0===o?void 0:o.x)||0),d.writeUint16((null===(h=e.options.origin)||void 0===h?void 0:h.y)||0),d.writeUint16(e.image.width),d.writeUint16(e.image.height),d.writeUint8(e.bitDepth);let g=0;32===e.bitDepth&&(g=8);const c=15&g|(null!==(s=e.options.screenOrigin)&&void 0!==s?s:0)<<4&48;return d.writeUint8(c),d.assertAtEnd(),d.array}(i)),i.imageId.length>0&&o.push(function(e){const t=new r.ByteStream(e.imageId.length,!0);for(let i=0;i<e.imageId.length;i++)t.writeUint8(e.imageId.charCodeAt(i));return t.assertAtEnd(),t.array}(i)),i.colorMap&&o.push(function(e){const t=e.colorMap;if(!t)throw new Error("Cannot write color map undefined");const i=Math.ceil(t.bitDepth/8),n=new r.ByteStream(t.colorToIndexMap.size*i,!0);let a;switch(t.bitDepth){case 15:a=s;break;case 16:a=d;break;case 24:a=c;break;case 32:a=w;break;default:throw new Error(`Unsupported bit depth for color map "${t.bitDepth}"`)}const o=Array.from(t.colorToIndexMap.entries()).sort(((e,t)=>e[1]-t[1])).map((e=>e[0]));for(const e of o)a(n,new Uint8Array([e>>24&255,e>>16&255,e>>8&255,255&e]),0);return n.assertAtEnd(),n.array}(i)),o.push(function(e){var t;const i=Math.ceil(e.bitDepth/8),n=new r.ByteStream(e.image.width*e.image.height*i,!0);let o,l=0;if(e.colorMap){const t=e.colorMap;o=(e,i,n)=>{const r=t.colorToIndexMap.get((i[n]<<24)+(i[n+1]<<16)+(i[n+2]<<8)+i[n+3]);e.writeUint8(r)}}else switch(e.bitDepth){case 8:if(3!==e.imageType&&11!==e.imageType)throw new Error(`Unsupported image type (${e.imageType}) with bit depth (${e.bitDepth})`);o=h;break;case 15:o=s;break;case 16:o=3===e.imageType||11===e.imageType?g:d;break;case 24:o=c;break;case 32:o=w;break;default:throw new Error("NYI")}switch(null!==(t=e.options.screenOrigin)&&void 0!==t?t:0){case 0:for(let t=e.image.height-1;t>=0;t--){l=e.image.width*t*4;for(let t=0;t<e.image.width;t++)o(n,e.image.data,l),l+=4}break;case 1:for(let t=e.image.height-1;t>=0;t--){l=4*(e.image.width*t+(e.image.width-1));for(let t=0;t<e.image.width;t++)o(n,e.image.data,l),l-=4}break;case 2:for(let t=0;t<e.image.height;t++){l=e.image.width*t*4;for(let t=0;t<e.image.width;t++)o(n,e.image.data,l),l+=4}break;case 3:for(let t=0;t<e.image.height;t++){l=4*(e.image.width*t+(e.image.width-1));for(let t=0;t<e.image.width;t++)o(n,e.image.data,l),l-=4}}return n.assertAtEnd(),8&e.imageType?(0,a.encodeRunLengthEncoding)(e,n.array):n.array}(i));const l=o.reduce(((e,t)=>e+t.length),0),p=new Uint8Array(l);let f=0;for(const e of o)p.set(e,f),f+=e.length;return{data:p,warnings:i.warnings,info:i.info}}function h(e,t,i){e.writeUint8(t[i])}function s(e,t,i){e.writeUint16((t[i+0]>>3&31)<<10|(t[i+1]>>3&31)<<5|(t[i+2]>>3&31)<<0)}function d(e,t,i){e.writeUint16((t[i+0]>>3&31)<<10|(t[i+1]>>3&31)<<5|(t[i+2]>>3&31)<<0|(255===t[i+3]?32768:0))}function g(e,t,i){e.writeUint8(t[i]),e.writeUint8(t[i+3])}function c(e,t,i){e.writeUint8(t[i+2]),e.writeUint8(t[i+1]),e.writeUint8(t[i+0])}function w(e,t,i){e.writeUint8(t[i+2]),e.writeUint8(t[i+1]),e.writeUint8(t[i+0]),e.writeUint8(t[i+3])}},45:(e,t,i)=>{i.r(t),i.d(t,{encodeRunLengthEncoding:()=>r});var n=i(43);function r(e,t){const i=Math.ceil(e.bitDepth/8),r=i+1,a=new Uint8Array(e.image.width*e.image.height*r);let o=0,h=0,s=1,d=0,g=!1,c=0,w=0,l=!1;for(let e=i;e<t.length;e+=i){let n=!1;for(d=0;d<i;d++)n||(n=t[h+d]!==t[e+d]);if(n){for(;s>0;){for(g=1===s,l&&g?(c=127&a[w],c<127?a[w]=c+1:(a[o]=Math.min(s,128)-1,w=o,o++)):(a[o]=Math.min(s,128)-1|(g?0:128),w=o,o++),d=0;d<i;d++)a[o+d]=t[h+d];o+=i,l=g,s-=128}h=e,s=1}else s++}for(;s>0;){for(g=1===s,l&&g?(c=127&a[w],c<127?a[w]=c+1:(a[o]=Math.min(s,128)-1,w=o,o++)):(a[o]=Math.min(s,128)-1|(g?0:128),w=o,o++),d=0;d<i;d++)a[o+d]=t[h+d];o+=i,s-=128}return o-1>t.length&&(0,n.handleWarning)(e,new n.EncodeWarning("RLE encoded was used but it is larger than unencoded would be",-1)),a.slice(0,o)}}}]);