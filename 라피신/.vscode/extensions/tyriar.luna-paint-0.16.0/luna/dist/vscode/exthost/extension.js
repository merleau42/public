"use strict";var zt=Object.defineProperty,ws=Object.defineProperties,_s=Object.getOwnPropertyDescriptor,gs=Object.getOwnPropertyDescriptors,bs=Object.getOwnPropertyNames,si=Object.getOwnPropertySymbols;var li=Object.prototype.hasOwnProperty,vs=Object.prototype.propertyIsEnumerable;var di=(e,n,t)=>n in e?zt(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t,$t=(e,n)=>{for(var t in n||(n={}))li.call(n,t)&&di(e,t,n[t]);if(si)for(var t of si(n))vs.call(n,t)&&di(e,t,n[t]);return e},Pt=(e,n)=>ws(e,gs(n)),ys=e=>zt(e,"__esModule",{value:!0});var m=(e,n)=>()=>(e&&(n=e(e=0)),n);var oe=(e,n)=>()=>(n||e((n={exports:{}}).exports,n),n.exports),M=(e,n)=>{for(var t in n)zt(e,t,{get:n[t],enumerable:!0})},ms=(e,n,t,i)=>{if(n&&typeof n=="object"||typeof n=="function")for(let r of bs(n))!li.call(e,r)&&(t||r!=="default")&&zt(e,r,{get:()=>n[r],enumerable:!(i=_s(n,r))||i.enumerable});return e};var Nt=(e=>(n,t)=>e&&e.get(n)||(t=ms(ys({}),n,1),e&&e.set(n,t),t))(typeof WeakMap!="undefined"?new WeakMap:0);var fi={};M(fi,{DecodeError:()=>q,DecodeWarning:()=>ae,assertChunkCompressionMethod:()=>ue,assertChunkDataLengthEquals:()=>F,assertChunkDataLengthGte:()=>X,assertChunkFollows:()=>Be,assertChunkMutualExclusion:()=>ot,assertChunkPrecedes:()=>x,assertChunkSinglular:()=>B,createChunkDecodeError:()=>ve,createChunkDecodeWarning:()=>C,handleWarning:()=>N});function B(e,n){e.parsedChunks.has(n.type)&&N(e,C(n,`Multiple ${n.type} chunks not allowed`,n.offset+4))}function F(e,n,t){if(n.dataLength!==t){let i=C(n,`Invalid data length: ${n.dataLength} !== ${t}`,n.offset);if(n.dataLength>t)N(e,i);else throw i}}function X(e,n,t){if(n.dataLength<t)throw ve(e,n,`Invalid data length: ${n.dataLength} < ${t}`,n.offset)}function x(e,n,t){e.parsedChunks.has(t)&&N(e,C(n,`Must precede ${t}`,n.offset+4))}function Be(e,n,t){if(!e.parsedChunks.has(t))throw ve(e,n,`Must follow ${t}`,n.offset+4)}function ot(e,n,t){e.parsedChunks.has(t)&&N(e,C(n,`Should not be present alongside ${t}`,n.offset+4))}function ue(e,n,t,i){t!==0&&N(e,C(n,`Unknown compression method "${t}"`,i))}function ve(e,n,t,i){return new q(e,`${n.type}: ${t}`,i)}function C(e,n,t){return new ae(`${e.type}: ${n}`,t)}function N(e,n){if(e.options.strictMode)throw n;e.warnings.push(n)}var q,ae,z=m(()=>{q=class extends Error{constructor(n,t,i){super(t);this.offset=i,this.partiallyDecodedImage={details:"header"in n&&n.header?{width:n.header.width,height:n.header.height,bitDepth:n.header.bitDepth,colorType:n.header.colorType,interlaceMethod:n.header.interlaceMethod}:void 0,info:n.info,metadata:n.metadata,rawChunks:n.rawChunks,warnings:n.warnings}}};ae=class extends Error{constructor(n,t){super(n);this.offset=t}}});function hi(e,n){if(e.options.strictMode)throw n;e.warnings.push(n)}var Fe,at,Wt=m(()=>{Fe=class extends Error{constructor(n,t){super(n);this.offset=t}},at=class extends Error{constructor(n,t){super(n);this.offset=t}}});function ci(e){let n=new Uint8Array(e.buffer),t=new Uint8Array(e.length);for(let i=0;i<t.length;i++)t[i]=n[i*2+1];return t}var ui=m(()=>{});function Ge(e){let n=e.length;for(;--n>=0;)e[n]=0}function En(e,n,t,i,r){this.static_tree=e,this.extra_bits=n,this.extra_base=t,this.elems=i,this.max_length=r,this.has_stree=e&&e.length}function kn(e,n){this.dyn_tree=e,this.max_code=0,this.stat_desc=n}function de(e,n,t,i,r){this.good_length=e,this.max_lazy=n,this.nice_length=t,this.max_chain=i,this.func=r}function Dl(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Zt,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(bl*2),this.dyn_dtree=new Uint16Array((2*_l+1)*2),this.bl_tree=new Uint16Array((2*gl+1)*2),Ce(this.dyn_ltree),Ce(this.dyn_dtree),Ce(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(vl+1),this.heap=new Uint16Array(2*xn+1),Ce(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*xn+1),Ce(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Kl(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}function mt(e){this.options=Kt.assign({level:nd,method:rd,chunkSize:16384,windowBits:15,memLevel:8,strategy:id},e||{});let n=this.options;n.raw&&n.windowBits>0?n.windowBits=-n.windowBits:n.gzip&&n.windowBits>0&&n.windowBits<16&&(n.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Hi,this.strm.avail_out=0;let t=bt.deflateInit2(this.strm,n.level,n.method,n.windowBits,n.memLevel,n.strategy);if(t!==Xt)throw new Error($e[t]);if(n.header&&bt.deflateSetHeader(this.strm,n.header),n.dictionary){let i;if(typeof n.dictionary=="string"?i=yt.string2buf(n.dictionary):Zi.call(n.dictionary)==="[object ArrayBuffer]"?i=new Uint8Array(n.dictionary):i=n.dictionary,t=bt.deflateSetDictionary(this.strm,i),t!==Xt)throw new Error($e[t]);this._dict_set=!0}}function Un(e,n){let t=new mt(n);if(t.push(e,!0),t.err)throw t.msg||$e[t.err];return t.result}function od(e,n){return n=n||{},n.raw=!0,Un(e,n)}function ad(e,n){return n=n||{},n.gzip=!0,Un(e,n)}function Ud(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function jd(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}function Ct(e){this.options=Kt.assign({chunkSize:1024*64,windowBits:15,to:""},e||{});let n=this.options;n.raw&&n.windowBits>=0&&n.windowBits<16&&(n.windowBits=-n.windowBits,n.windowBits===0&&(n.windowBits=-15)),n.windowBits>=0&&n.windowBits<16&&!(e&&e.windowBits)&&(n.windowBits+=32),n.windowBits>15&&n.windowBits<48&&(n.windowBits&15)===0&&(n.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Hi,this.strm.avail_out=0;let t=_e.inflateInit2(this.strm,n.windowBits);if(t!==kt)throw new Error($e[t]);if(this.header=new Vd,_e.inflateGetHeader(this.strm,this.header),n.dictionary&&(typeof n.dictionary=="string"?n.dictionary=yt.string2buf(n.dictionary):Rr.call(n.dictionary)==="[object ArrayBuffer]"&&(n.dictionary=new Uint8Array(n.dictionary)),n.raw&&(t=_e.inflateSetDictionary(this.strm,n.dictionary),t!==kt)))throw new Error($e[t])}function Pn(e,n){let t=new Ct(n);if(t.push(e),t.err)throw t.msg||$e[t.err];return t.result}function Qd(e,n){return n=n||{},n.raw=!0,Pn(e,n)}var Es,pi,wi,ks,Cs,_i,Ts,Ss,xs,_n,st,lt,je,gn,gi,ze,bn,Ds,vn,bi,vi,yi,yn,Ot,Is,mi,Us,pe,dt,ft,ht,mn,qt,Ei,ki,Ci,Ti,ct,K,se,Si,As,Rs,xi,Ms,Di,Ii,Ls,Ui,Cn,Ai,Tn,Ri,Mi,Bs,Fs,zs,Li,$s,Bi,Ps,Ns,Ws,Os,qs,Hs,Zs,Gs,js,Vs,ut,Ys,Ks,Xs,Z,$e,Ve,Js,Qs,el,ye,tl,Pe,nl,il,me,Fi,le,zi,Q,rl,Sn,ol,al,Ht,sl,ll,dl,fl,Zt,hl,cl,ul,pl,wl,xn,_l,gl,bl,vl,A,Ee,ne,yl,Gt,Dn,jt,Vt,Yt,Ne,pt,H,wt,We,Ye,ml,ke,$i,Ce,El,Te,Se,G,R,_t,kl,Pi,Oe,Cl,In,Ke,Tl,Sl,gt,xl,Ni,Wi,Il,Oi,Ul,Al,Rl,Ml,Ll,Bl,Fl,zl,$l,Pl,Nl,Wl,Ol,bt,ql,Hl,Zl,Kt,qi,vt,Gl,jl,Vl,Yl,yt,Hi,Zi,Xl,Jl,Ql,ed,Xt,td,nd,id,rd,sd,ld,dd,fd,hd,cd,Jt,ud,pd,Xe,Gi,ji,Vi,An,Yi,wd,_d,gd,bd,vd,Et,yd,Ki,Xi,Ji,md,Qt,qe,Ed,kd,ee,Qi,er,Cd,tr,nr,ir,rr,or,ar,sr,lr,dr,fr,hr,en,we,Rn,cr,Mn,ur,pr,wr,_r,tn,nn,gr,br,vr,yr,mr,Ln,Er,kr,P,Cr,Td,Sd,xd,Dd,Id,Tr,Sr,xr,Dr,Ir,Ad,Ur,Bn,Fn,Rd,Ar,Md,Ld,Bd,Fd,zd,$d,Pd,Nd,Wd,Od,qd,Hd,Zd,Gd,_e,Vd,Rr,Yd,Kd,kt,zn,$n,Xd,Mr,Jd,ef,tf,nf,rf,of,af,ec,sf,tc,nc,lf,ic,rc,oc,Lr,rn,on=m(()=>{Es=4,pi=0,wi=1,ks=2;Cs=0,_i=1,Ts=2,Ss=3,xs=258,_n=29,st=256,lt=st+1+_n,je=30,gn=19,gi=2*lt+1,ze=15,bn=16,Ds=7,vn=256,bi=16,vi=17,yi=18,yn=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Ot=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Is=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),mi=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Us=512,pe=new Array((lt+2)*2);Ge(pe);dt=new Array(je*2);Ge(dt);ft=new Array(Us);Ge(ft);ht=new Array(xs-Ss+1);Ge(ht);mn=new Array(_n);Ge(mn);qt=new Array(je);Ge(qt);Ti=e=>e<256?ft[e]:ft[256+(e>>>7)],ct=(e,n)=>{e.pending_buf[e.pending++]=n&255,e.pending_buf[e.pending++]=n>>>8&255},K=(e,n,t)=>{e.bi_valid>bn-t?(e.bi_buf|=n<<e.bi_valid&65535,ct(e,e.bi_buf),e.bi_buf=n>>bn-e.bi_valid,e.bi_valid+=t-bn):(e.bi_buf|=n<<e.bi_valid&65535,e.bi_valid+=t)},se=(e,n,t)=>{K(e,t[n*2],t[n*2+1])},Si=(e,n)=>{let t=0;do t|=e&1,e>>>=1,t<<=1;while(--n>0);return t>>>1},As=e=>{e.bi_valid===16?(ct(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=e.bi_buf&255,e.bi_buf>>=8,e.bi_valid-=8)},Rs=(e,n)=>{let t=n.dyn_tree,i=n.max_code,r=n.stat_desc.static_tree,o=n.stat_desc.has_stree,a=n.stat_desc.extra_bits,s=n.stat_desc.extra_base,f=n.stat_desc.max_length,l,d,h,u,c,p,k=0;for(u=0;u<=ze;u++)e.bl_count[u]=0;for(t[e.heap[e.heap_max]*2+1]=0,l=e.heap_max+1;l<gi;l++)d=e.heap[l],u=t[t[d*2+1]*2+1]+1,u>f&&(u=f,k++),t[d*2+1]=u,!(d>i)&&(e.bl_count[u]++,c=0,d>=s&&(c=a[d-s]),p=t[d*2],e.opt_len+=p*(u+c),o&&(e.static_len+=p*(r[d*2+1]+c)));if(k!==0){do{for(u=f-1;e.bl_count[u]===0;)u--;e.bl_count[u]--,e.bl_count[u+1]+=2,e.bl_count[f]--,k-=2}while(k>0);for(u=f;u!==0;u--)for(d=e.bl_count[u];d!==0;)h=e.heap[--l],!(h>i)&&(t[h*2+1]!==u&&(e.opt_len+=(u-t[h*2+1])*t[h*2],t[h*2+1]=u),d--)}},xi=(e,n,t)=>{let i=new Array(ze+1),r=0,o,a;for(o=1;o<=ze;o++)i[o]=r=r+t[o-1]<<1;for(a=0;a<=n;a++){let s=e[a*2+1];s!==0&&(e[a*2]=Si(i[s]++,s))}},Ms=()=>{let e,n,t,i,r,o=new Array(ze+1);for(t=0,i=0;i<_n-1;i++)for(mn[i]=t,e=0;e<1<<yn[i];e++)ht[t++]=i;for(ht[t-1]=i,r=0,i=0;i<16;i++)for(qt[i]=r,e=0;e<1<<Ot[i];e++)ft[r++]=i;for(r>>=7;i<je;i++)for(qt[i]=r<<7,e=0;e<1<<Ot[i]-7;e++)ft[256+r++]=i;for(n=0;n<=ze;n++)o[n]=0;for(e=0;e<=143;)pe[e*2+1]=8,e++,o[8]++;for(;e<=255;)pe[e*2+1]=9,e++,o[9]++;for(;e<=279;)pe[e*2+1]=7,e++,o[7]++;for(;e<=287;)pe[e*2+1]=8,e++,o[8]++;for(xi(pe,lt+1,o),e=0;e<je;e++)dt[e*2+1]=5,dt[e*2]=Si(e,5);Ei=new En(pe,yn,st+1,lt,ze),ki=new En(dt,Ot,0,je,ze),Ci=new En(new Array(0),Is,0,gn,Ds)},Di=e=>{let n;for(n=0;n<lt;n++)e.dyn_ltree[n*2]=0;for(n=0;n<je;n++)e.dyn_dtree[n*2]=0;for(n=0;n<gn;n++)e.bl_tree[n*2]=0;e.dyn_ltree[vn*2]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0},Ii=e=>{e.bi_valid>8?ct(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},Ls=(e,n,t,i)=>{Ii(e),i&&(ct(e,t),ct(e,~t)),e.pending_buf.set(e.window.subarray(n,n+t),e.pending),e.pending+=t},Ui=(e,n,t,i)=>{let r=n*2,o=t*2;return e[r]<e[o]||e[r]===e[o]&&i[n]<=i[t]},Cn=(e,n,t)=>{let i=e.heap[t],r=t<<1;for(;r<=e.heap_len&&(r<e.heap_len&&Ui(n,e.heap[r+1],e.heap[r],e.depth)&&r++,!Ui(n,i,e.heap[r],e.depth));)e.heap[t]=e.heap[r],t=r,r<<=1;e.heap[t]=i},Ai=(e,n,t)=>{let i,r,o=0,a,s;if(e.last_lit!==0)do i=e.pending_buf[e.d_buf+o*2]<<8|e.pending_buf[e.d_buf+o*2+1],r=e.pending_buf[e.l_buf+o],o++,i===0?se(e,r,n):(a=ht[r],se(e,a+st+1,n),s=yn[a],s!==0&&(r-=mn[a],K(e,r,s)),i--,a=Ti(i),se(e,a,t),s=Ot[a],s!==0&&(i-=qt[a],K(e,i,s)));while(o<e.last_lit);se(e,vn,n)},Tn=(e,n)=>{let t=n.dyn_tree,i=n.stat_desc.static_tree,r=n.stat_desc.has_stree,o=n.stat_desc.elems,a,s,f=-1,l;for(e.heap_len=0,e.heap_max=gi,a=0;a<o;a++)t[a*2]!==0?(e.heap[++e.heap_len]=f=a,e.depth[a]=0):t[a*2+1]=0;for(;e.heap_len<2;)l=e.heap[++e.heap_len]=f<2?++f:0,t[l*2]=1,e.depth[l]=0,e.opt_len--,r&&(e.static_len-=i[l*2+1]);for(n.max_code=f,a=e.heap_len>>1;a>=1;a--)Cn(e,t,a);l=o;do a=e.heap[1],e.heap[1]=e.heap[e.heap_len--],Cn(e,t,1),s=e.heap[1],e.heap[--e.heap_max]=a,e.heap[--e.heap_max]=s,t[l*2]=t[a*2]+t[s*2],e.depth[l]=(e.depth[a]>=e.depth[s]?e.depth[a]:e.depth[s])+1,t[a*2+1]=t[s*2+1]=l,e.heap[1]=l++,Cn(e,t,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],Rs(e,n),xi(t,f,e.bl_count)},Ri=(e,n,t)=>{let i,r=-1,o,a=n[0*2+1],s=0,f=7,l=4;for(a===0&&(f=138,l=3),n[(t+1)*2+1]=65535,i=0;i<=t;i++)o=a,a=n[(i+1)*2+1],!(++s<f&&o===a)&&(s<l?e.bl_tree[o*2]+=s:o!==0?(o!==r&&e.bl_tree[o*2]++,e.bl_tree[bi*2]++):s<=10?e.bl_tree[vi*2]++:e.bl_tree[yi*2]++,s=0,r=o,a===0?(f=138,l=3):o===a?(f=6,l=3):(f=7,l=4))},Mi=(e,n,t)=>{let i,r=-1,o,a=n[0*2+1],s=0,f=7,l=4;for(a===0&&(f=138,l=3),i=0;i<=t;i++)if(o=a,a=n[(i+1)*2+1],!(++s<f&&o===a)){if(s<l)do se(e,o,e.bl_tree);while(--s!==0);else o!==0?(o!==r&&(se(e,o,e.bl_tree),s--),se(e,bi,e.bl_tree),K(e,s-3,2)):s<=10?(se(e,vi,e.bl_tree),K(e,s-3,3)):(se(e,yi,e.bl_tree),K(e,s-11,7));s=0,r=o,a===0?(f=138,l=3):o===a?(f=6,l=3):(f=7,l=4)}},Bs=e=>{let n;for(Ri(e,e.dyn_ltree,e.l_desc.max_code),Ri(e,e.dyn_dtree,e.d_desc.max_code),Tn(e,e.bl_desc),n=gn-1;n>=3&&e.bl_tree[mi[n]*2+1]===0;n--);return e.opt_len+=3*(n+1)+5+5+4,n},Fs=(e,n,t,i)=>{let r;for(K(e,n-257,5),K(e,t-1,5),K(e,i-4,4),r=0;r<i;r++)K(e,e.bl_tree[mi[r]*2+1],3);Mi(e,e.dyn_ltree,n-1),Mi(e,e.dyn_dtree,t-1)},zs=e=>{let n=4093624447,t;for(t=0;t<=31;t++,n>>>=1)if(n&1&&e.dyn_ltree[t*2]!==0)return pi;if(e.dyn_ltree[9*2]!==0||e.dyn_ltree[10*2]!==0||e.dyn_ltree[13*2]!==0)return wi;for(t=32;t<st;t++)if(e.dyn_ltree[t*2]!==0)return wi;return pi},Li=!1,$s=e=>{Li||(Ms(),Li=!0),e.l_desc=new kn(e.dyn_ltree,Ei),e.d_desc=new kn(e.dyn_dtree,ki),e.bl_desc=new kn(e.bl_tree,Ci),e.bi_buf=0,e.bi_valid=0,Di(e)},Bi=(e,n,t,i)=>{K(e,(Cs<<1)+(i?1:0),3),Ls(e,n,t,!0)},Ps=e=>{K(e,_i<<1,3),se(e,vn,pe),As(e)},Ns=(e,n,t,i)=>{let r,o,a=0;e.level>0?(e.strm.data_type===ks&&(e.strm.data_type=zs(e)),Tn(e,e.l_desc),Tn(e,e.d_desc),a=Bs(e),r=e.opt_len+3+7>>>3,o=e.static_len+3+7>>>3,o<=r&&(r=o)):r=o=t+5,t+4<=r&&n!==-1?Bi(e,n,t,i):e.strategy===Es||o===r?(K(e,(_i<<1)+(i?1:0),3),Ai(e,pe,dt)):(K(e,(Ts<<1)+(i?1:0),3),Fs(e,e.l_desc.max_code+1,e.d_desc.max_code+1,a+1),Ai(e,e.dyn_ltree,e.dyn_dtree)),Di(e),i&&Ii(e)},Ws=(e,n,t)=>(e.pending_buf[e.d_buf+e.last_lit*2]=n>>>8&255,e.pending_buf[e.d_buf+e.last_lit*2+1]=n&255,e.pending_buf[e.l_buf+e.last_lit]=t&255,e.last_lit++,n===0?e.dyn_ltree[t*2]++:(e.matches++,n--,e.dyn_ltree[(ht[t]+st+1)*2]++,e.dyn_dtree[Ti(n)*2]++),e.last_lit===e.lit_bufsize-1),Os=$s,qs=Bi,Hs=Ns,Zs=Ws,Gs=Ps,js={_tr_init:Os,_tr_stored_block:qs,_tr_flush_block:Hs,_tr_tally:Zs,_tr_align:Gs},Vs=(e,n,t,i)=>{let r=e&65535|0,o=e>>>16&65535|0,a=0;for(;t!==0;){a=t>2e3?2e3:t,t-=a;do r=r+n[i++]|0,o=o+r|0;while(--a);r%=65521,o%=65521}return r|o<<16|0},ut=Vs,Ys=()=>{let e,n=[];for(var t=0;t<256;t++){e=t;for(var i=0;i<8;i++)e=e&1?3988292384^e>>>1:e>>>1;n[t]=e}return n},Ks=new Uint32Array(Ys()),Xs=(e,n,t,i)=>{let r=Ks,o=i+t;e^=-1;for(let a=i;a<o;a++)e=e>>>8^r[(e^n[a])&255];return e^-1},Z=Xs,$e={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Ve={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},{_tr_init:Js,_tr_stored_block:Qs,_tr_flush_block:el,_tr_tally:ye,_tr_align:tl}=js,{Z_NO_FLUSH:Pe,Z_PARTIAL_FLUSH:nl,Z_FULL_FLUSH:il,Z_FINISH:me,Z_BLOCK:Fi,Z_OK:le,Z_STREAM_END:zi,Z_STREAM_ERROR:Q,Z_DATA_ERROR:rl,Z_BUF_ERROR:Sn,Z_DEFAULT_COMPRESSION:ol,Z_FILTERED:al,Z_HUFFMAN_ONLY:Ht,Z_RLE:sl,Z_FIXED:ll,Z_DEFAULT_STRATEGY:dl,Z_UNKNOWN:fl,Z_DEFLATED:Zt}=Ve,hl=9,cl=15,ul=8,pl=29,wl=256,xn=wl+1+pl,_l=30,gl=19,bl=2*xn+1,vl=15,A=3,Ee=258,ne=Ee+A+1,yl=32,Gt=42,Dn=69,jt=73,Vt=91,Yt=103,Ne=113,pt=666,H=1,wt=2,We=3,Ye=4,ml=3,ke=(e,n)=>(e.msg=$e[n],n),$i=e=>(e<<1)-(e>4?9:0),Ce=e=>{let n=e.length;for(;--n>=0;)e[n]=0},El=(e,n,t)=>(n<<e.hash_shift^t)&e.hash_mask,Te=El,Se=e=>{let n=e.state,t=n.pending;t>e.avail_out&&(t=e.avail_out),t!==0&&(e.output.set(n.pending_buf.subarray(n.pending_out,n.pending_out+t),e.next_out),e.next_out+=t,n.pending_out+=t,e.total_out+=t,e.avail_out-=t,n.pending-=t,n.pending===0&&(n.pending_out=0))},G=(e,n)=>{el(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,n),e.block_start=e.strstart,Se(e.strm)},R=(e,n)=>{e.pending_buf[e.pending++]=n},_t=(e,n)=>{e.pending_buf[e.pending++]=n>>>8&255,e.pending_buf[e.pending++]=n&255},kl=(e,n,t,i)=>{let r=e.avail_in;return r>i&&(r=i),r===0?0:(e.avail_in-=r,n.set(e.input.subarray(e.next_in,e.next_in+r),t),e.state.wrap===1?e.adler=ut(e.adler,n,r,t):e.state.wrap===2&&(e.adler=Z(e.adler,n,r,t)),e.next_in+=r,e.total_in+=r,r)},Pi=(e,n)=>{let t=e.max_chain_length,i=e.strstart,r,o,a=e.prev_length,s=e.nice_match,f=e.strstart>e.w_size-ne?e.strstart-(e.w_size-ne):0,l=e.window,d=e.w_mask,h=e.prev,u=e.strstart+Ee,c=l[i+a-1],p=l[i+a];e.prev_length>=e.good_match&&(t>>=2),s>e.lookahead&&(s=e.lookahead);do if(r=n,!(l[r+a]!==p||l[r+a-1]!==c||l[r]!==l[i]||l[++r]!==l[i+1])){i+=2,r++;do;while(l[++i]===l[++r]&&l[++i]===l[++r]&&l[++i]===l[++r]&&l[++i]===l[++r]&&l[++i]===l[++r]&&l[++i]===l[++r]&&l[++i]===l[++r]&&l[++i]===l[++r]&&i<u);if(o=Ee-(u-i),i=u-Ee,o>a){if(e.match_start=n,a=o,o>=s)break;c=l[i+a-1],p=l[i+a]}}while((n=h[n&d])>f&&--t!==0);return a<=e.lookahead?a:e.lookahead},Oe=e=>{let n=e.w_size,t,i,r,o,a;do{if(o=e.window_size-e.lookahead-e.strstart,e.strstart>=n+(n-ne)){e.window.set(e.window.subarray(n,n+n),0),e.match_start-=n,e.strstart-=n,e.block_start-=n,i=e.hash_size,t=i;do r=e.head[--t],e.head[t]=r>=n?r-n:0;while(--i);i=n,t=i;do r=e.prev[--t],e.prev[t]=r>=n?r-n:0;while(--i);o+=n}if(e.strm.avail_in===0)break;if(i=kl(e.strm,e.window,e.strstart+e.lookahead,o),e.lookahead+=i,e.lookahead+e.insert>=A)for(a=e.strstart-e.insert,e.ins_h=e.window[a],e.ins_h=Te(e,e.ins_h,e.window[a+1]);e.insert&&(e.ins_h=Te(e,e.ins_h,e.window[a+A-1]),e.prev[a&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=a,a++,e.insert--,!(e.lookahead+e.insert<A)););}while(e.lookahead<ne&&e.strm.avail_in!==0)},Cl=(e,n)=>{let t=65535;for(t>e.pending_buf_size-5&&(t=e.pending_buf_size-5);;){if(e.lookahead<=1){if(Oe(e),e.lookahead===0&&n===Pe)return H;if(e.lookahead===0)break}e.strstart+=e.lookahead,e.lookahead=0;let i=e.block_start+t;if((e.strstart===0||e.strstart>=i)&&(e.lookahead=e.strstart-i,e.strstart=i,G(e,!1),e.strm.avail_out===0)||e.strstart-e.block_start>=e.w_size-ne&&(G(e,!1),e.strm.avail_out===0))return H}return e.insert=0,n===me?(G(e,!0),e.strm.avail_out===0?We:Ye):(e.strstart>e.block_start&&(G(e,!1),e.strm.avail_out===0),H)},In=(e,n)=>{let t,i;for(;;){if(e.lookahead<ne){if(Oe(e),e.lookahead<ne&&n===Pe)return H;if(e.lookahead===0)break}if(t=0,e.lookahead>=A&&(e.ins_h=Te(e,e.ins_h,e.window[e.strstart+A-1]),t=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),t!==0&&e.strstart-t<=e.w_size-ne&&(e.match_length=Pi(e,t)),e.match_length>=A)if(i=ye(e,e.strstart-e.match_start,e.match_length-A),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=A){e.match_length--;do e.strstart++,e.ins_h=Te(e,e.ins_h,e.window[e.strstart+A-1]),t=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!==0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=Te(e,e.ins_h,e.window[e.strstart+1]);else i=ye(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(i&&(G(e,!1),e.strm.avail_out===0))return H}return e.insert=e.strstart<A-1?e.strstart:A-1,n===me?(G(e,!0),e.strm.avail_out===0?We:Ye):e.last_lit&&(G(e,!1),e.strm.avail_out===0)?H:wt},Ke=(e,n)=>{let t,i,r;for(;;){if(e.lookahead<ne){if(Oe(e),e.lookahead<ne&&n===Pe)return H;if(e.lookahead===0)break}if(t=0,e.lookahead>=A&&(e.ins_h=Te(e,e.ins_h,e.window[e.strstart+A-1]),t=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=A-1,t!==0&&e.prev_length<e.max_lazy_match&&e.strstart-t<=e.w_size-ne&&(e.match_length=Pi(e,t),e.match_length<=5&&(e.strategy===al||e.match_length===A&&e.strstart-e.match_start>4096)&&(e.match_length=A-1)),e.prev_length>=A&&e.match_length<=e.prev_length){r=e.strstart+e.lookahead-A,i=ye(e,e.strstart-1-e.prev_match,e.prev_length-A),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=r&&(e.ins_h=Te(e,e.ins_h,e.window[e.strstart+A-1]),t=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!==0);if(e.match_available=0,e.match_length=A-1,e.strstart++,i&&(G(e,!1),e.strm.avail_out===0))return H}else if(e.match_available){if(i=ye(e,0,e.window[e.strstart-1]),i&&G(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return H}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(i=ye(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<A-1?e.strstart:A-1,n===me?(G(e,!0),e.strm.avail_out===0?We:Ye):e.last_lit&&(G(e,!1),e.strm.avail_out===0)?H:wt},Tl=(e,n)=>{let t,i,r,o,a=e.window;for(;;){if(e.lookahead<=Ee){if(Oe(e),e.lookahead<=Ee&&n===Pe)return H;if(e.lookahead===0)break}if(e.match_length=0,e.lookahead>=A&&e.strstart>0&&(r=e.strstart-1,i=a[r],i===a[++r]&&i===a[++r]&&i===a[++r])){o=e.strstart+Ee;do;while(i===a[++r]&&i===a[++r]&&i===a[++r]&&i===a[++r]&&i===a[++r]&&i===a[++r]&&i===a[++r]&&i===a[++r]&&r<o);e.match_length=Ee-(o-r),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=A?(t=ye(e,1,e.match_length-A),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(t=ye(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),t&&(G(e,!1),e.strm.avail_out===0))return H}return e.insert=0,n===me?(G(e,!0),e.strm.avail_out===0?We:Ye):e.last_lit&&(G(e,!1),e.strm.avail_out===0)?H:wt},Sl=(e,n)=>{let t;for(;;){if(e.lookahead===0&&(Oe(e),e.lookahead===0)){if(n===Pe)return H;break}if(e.match_length=0,t=ye(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,t&&(G(e,!1),e.strm.avail_out===0))return H}return e.insert=0,n===me?(G(e,!0),e.strm.avail_out===0?We:Ye):e.last_lit&&(G(e,!1),e.strm.avail_out===0)?H:wt};gt=[new de(0,0,0,0,Cl),new de(4,4,8,4,In),new de(4,5,16,8,In),new de(4,6,32,32,In),new de(4,4,16,16,Ke),new de(8,16,32,32,Ke),new de(8,16,128,128,Ke),new de(8,32,128,256,Ke),new de(32,128,258,1024,Ke),new de(32,258,258,4096,Ke)],xl=e=>{e.window_size=2*e.w_size,Ce(e.head),e.max_lazy_match=gt[e.level].max_lazy,e.good_match=gt[e.level].good_length,e.nice_match=gt[e.level].nice_length,e.max_chain_length=gt[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=A-1,e.match_available=0,e.ins_h=0};Ni=e=>{if(!e||!e.state)return ke(e,Q);e.total_in=e.total_out=0,e.data_type=fl;let n=e.state;return n.pending=0,n.pending_out=0,n.wrap<0&&(n.wrap=-n.wrap),n.status=n.wrap?Gt:Ne,e.adler=n.wrap===2?0:1,n.last_flush=Pe,Js(n),le},Wi=e=>{let n=Ni(e);return n===le&&xl(e.state),n},Il=(e,n)=>!e||!e.state||e.state.wrap!==2?Q:(e.state.gzhead=n,le),Oi=(e,n,t,i,r,o)=>{if(!e)return Q;let a=1;if(n===ol&&(n=6),i<0?(a=0,i=-i):i>15&&(a=2,i-=16),r<1||r>hl||t!==Zt||i<8||i>15||n<0||n>9||o<0||o>ll)return ke(e,Q);i===8&&(i=9);let s=new Dl;return e.state=s,s.strm=e,s.wrap=a,s.gzhead=null,s.w_bits=i,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=r+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+A-1)/A),s.window=new Uint8Array(s.w_size*2),s.head=new Uint16Array(s.hash_size),s.prev=new Uint16Array(s.w_size),s.lit_bufsize=1<<r+6,s.pending_buf_size=s.lit_bufsize*4,s.pending_buf=new Uint8Array(s.pending_buf_size),s.d_buf=1*s.lit_bufsize,s.l_buf=(1+2)*s.lit_bufsize,s.level=n,s.strategy=o,s.method=t,Wi(e)},Ul=(e,n)=>Oi(e,n,Zt,cl,ul,dl),Al=(e,n)=>{let t,i;if(!e||!e.state||n>Fi||n<0)return e?ke(e,Q):Q;let r=e.state;if(!e.output||!e.input&&e.avail_in!==0||r.status===pt&&n!==me)return ke(e,e.avail_out===0?Sn:Q);r.strm=e;let o=r.last_flush;if(r.last_flush=n,r.status===Gt)if(r.wrap===2)e.adler=0,R(r,31),R(r,139),R(r,8),r.gzhead?(R(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),R(r,r.gzhead.time&255),R(r,r.gzhead.time>>8&255),R(r,r.gzhead.time>>16&255),R(r,r.gzhead.time>>24&255),R(r,r.level===9?2:r.strategy>=Ht||r.level<2?4:0),R(r,r.gzhead.os&255),r.gzhead.extra&&r.gzhead.extra.length&&(R(r,r.gzhead.extra.length&255),R(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(e.adler=Z(e.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=Dn):(R(r,0),R(r,0),R(r,0),R(r,0),R(r,0),R(r,r.level===9?2:r.strategy>=Ht||r.level<2?4:0),R(r,ml),r.status=Ne);else{let a=Zt+(r.w_bits-8<<4)<<8,s=-1;r.strategy>=Ht||r.level<2?s=0:r.level<6?s=1:r.level===6?s=2:s=3,a|=s<<6,r.strstart!==0&&(a|=yl),a+=31-a%31,r.status=Ne,_t(r,a),r.strstart!==0&&(_t(r,e.adler>>>16),_t(r,e.adler&65535)),e.adler=1}if(r.status===Dn)if(r.gzhead.extra){for(t=r.pending;r.gzindex<(r.gzhead.extra.length&65535)&&!(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>t&&(e.adler=Z(e.adler,r.pending_buf,r.pending-t,t)),Se(e),t=r.pending,r.pending===r.pending_buf_size));)R(r,r.gzhead.extra[r.gzindex]&255),r.gzindex++;r.gzhead.hcrc&&r.pending>t&&(e.adler=Z(e.adler,r.pending_buf,r.pending-t,t)),r.gzindex===r.gzhead.extra.length&&(r.gzindex=0,r.status=jt)}else r.status=jt;if(r.status===jt)if(r.gzhead.name){t=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>t&&(e.adler=Z(e.adler,r.pending_buf,r.pending-t,t)),Se(e),t=r.pending,r.pending===r.pending_buf_size)){i=1;break}r.gzindex<r.gzhead.name.length?i=r.gzhead.name.charCodeAt(r.gzindex++)&255:i=0,R(r,i)}while(i!==0);r.gzhead.hcrc&&r.pending>t&&(e.adler=Z(e.adler,r.pending_buf,r.pending-t,t)),i===0&&(r.gzindex=0,r.status=Vt)}else r.status=Vt;if(r.status===Vt)if(r.gzhead.comment){t=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>t&&(e.adler=Z(e.adler,r.pending_buf,r.pending-t,t)),Se(e),t=r.pending,r.pending===r.pending_buf_size)){i=1;break}r.gzindex<r.gzhead.comment.length?i=r.gzhead.comment.charCodeAt(r.gzindex++)&255:i=0,R(r,i)}while(i!==0);r.gzhead.hcrc&&r.pending>t&&(e.adler=Z(e.adler,r.pending_buf,r.pending-t,t)),i===0&&(r.status=Yt)}else r.status=Yt;if(r.status===Yt&&(r.gzhead.hcrc?(r.pending+2>r.pending_buf_size&&Se(e),r.pending+2<=r.pending_buf_size&&(R(r,e.adler&255),R(r,e.adler>>8&255),e.adler=0,r.status=Ne)):r.status=Ne),r.pending!==0){if(Se(e),e.avail_out===0)return r.last_flush=-1,le}else if(e.avail_in===0&&$i(n)<=$i(o)&&n!==me)return ke(e,Sn);if(r.status===pt&&e.avail_in!==0)return ke(e,Sn);if(e.avail_in!==0||r.lookahead!==0||n!==Pe&&r.status!==pt){let a=r.strategy===Ht?Sl(r,n):r.strategy===sl?Tl(r,n):gt[r.level].func(r,n);if((a===We||a===Ye)&&(r.status=pt),a===H||a===We)return e.avail_out===0&&(r.last_flush=-1),le;if(a===wt&&(n===nl?tl(r):n!==Fi&&(Qs(r,0,0,!1),n===il&&(Ce(r.head),r.lookahead===0&&(r.strstart=0,r.block_start=0,r.insert=0))),Se(e),e.avail_out===0))return r.last_flush=-1,le}return n!==me?le:r.wrap<=0?zi:(r.wrap===2?(R(r,e.adler&255),R(r,e.adler>>8&255),R(r,e.adler>>16&255),R(r,e.adler>>24&255),R(r,e.total_in&255),R(r,e.total_in>>8&255),R(r,e.total_in>>16&255),R(r,e.total_in>>24&255)):(_t(r,e.adler>>>16),_t(r,e.adler&65535)),Se(e),r.wrap>0&&(r.wrap=-r.wrap),r.pending!==0?le:zi)},Rl=e=>{if(!e||!e.state)return Q;let n=e.state.status;return n!==Gt&&n!==Dn&&n!==jt&&n!==Vt&&n!==Yt&&n!==Ne&&n!==pt?ke(e,Q):(e.state=null,n===Ne?ke(e,rl):le)},Ml=(e,n)=>{let t=n.length;if(!e||!e.state)return Q;let i=e.state,r=i.wrap;if(r===2||r===1&&i.status!==Gt||i.lookahead)return Q;if(r===1&&(e.adler=ut(e.adler,n,t,0)),i.wrap=0,t>=i.w_size){r===0&&(Ce(i.head),i.strstart=0,i.block_start=0,i.insert=0);let f=new Uint8Array(i.w_size);f.set(n.subarray(t-i.w_size,t),0),n=f,t=i.w_size}let o=e.avail_in,a=e.next_in,s=e.input;for(e.avail_in=t,e.next_in=0,e.input=n,Oe(i);i.lookahead>=A;){let f=i.strstart,l=i.lookahead-(A-1);do i.ins_h=Te(i,i.ins_h,i.window[f+A-1]),i.prev[f&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=f,f++;while(--l);i.strstart=f,i.lookahead=A-1,Oe(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=A-1,i.match_available=0,e.next_in=a,e.input=s,e.avail_in=o,i.wrap=r,le},Ll=Ul,Bl=Oi,Fl=Wi,zl=Ni,$l=Il,Pl=Al,Nl=Rl,Wl=Ml,Ol="pako deflate (from Nodeca project)",bt={deflateInit:Ll,deflateInit2:Bl,deflateReset:Fl,deflateResetKeep:zl,deflateSetHeader:$l,deflate:Pl,deflateEnd:Nl,deflateSetDictionary:Wl,deflateInfo:Ol},ql=(e,n)=>Object.prototype.hasOwnProperty.call(e,n),Hl=function(e){let n=Array.prototype.slice.call(arguments,1);for(;n.length;){let t=n.shift();if(!!t){if(typeof t!="object")throw new TypeError(t+"must be non-object");for(let i in t)ql(t,i)&&(e[i]=t[i])}}return e},Zl=e=>{let n=0;for(let i=0,r=e.length;i<r;i++)n+=e[i].length;let t=new Uint8Array(n);for(let i=0,r=0,o=e.length;i<o;i++){let a=e[i];t.set(a,r),r+=a.length}return t},Kt={assign:Hl,flattenChunks:Zl},qi=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{qi=!1}vt=new Uint8Array(256);for(let e=0;e<256;e++)vt[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;vt[254]=vt[254]=1;Gl=e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let n,t,i,r,o,a=e.length,s=0;for(r=0;r<a;r++)t=e.charCodeAt(r),(t&64512)===55296&&r+1<a&&(i=e.charCodeAt(r+1),(i&64512)===56320&&(t=65536+(t-55296<<10)+(i-56320),r++)),s+=t<128?1:t<2048?2:t<65536?3:4;for(n=new Uint8Array(s),o=0,r=0;o<s;r++)t=e.charCodeAt(r),(t&64512)===55296&&r+1<a&&(i=e.charCodeAt(r+1),(i&64512)===56320&&(t=65536+(t-55296<<10)+(i-56320),r++)),t<128?n[o++]=t:t<2048?(n[o++]=192|t>>>6,n[o++]=128|t&63):t<65536?(n[o++]=224|t>>>12,n[o++]=128|t>>>6&63,n[o++]=128|t&63):(n[o++]=240|t>>>18,n[o++]=128|t>>>12&63,n[o++]=128|t>>>6&63,n[o++]=128|t&63);return n},jl=(e,n)=>{if(n<65534&&e.subarray&&qi)return String.fromCharCode.apply(null,e.length===n?e:e.subarray(0,n));let t="";for(let i=0;i<n;i++)t+=String.fromCharCode(e[i]);return t},Vl=(e,n)=>{let t=n||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,n));let i,r,o=new Array(t*2);for(r=0,i=0;i<t;){let a=e[i++];if(a<128){o[r++]=a;continue}let s=vt[a];if(s>4){o[r++]=65533,i+=s-1;continue}for(a&=s===2?31:s===3?15:7;s>1&&i<t;)a=a<<6|e[i++]&63,s--;if(s>1){o[r++]=65533;continue}a<65536?o[r++]=a:(a-=65536,o[r++]=55296|a>>10&1023,o[r++]=56320|a&1023)}return jl(o,r)},Yl=(e,n)=>{n=n||e.length,n>e.length&&(n=e.length);let t=n-1;for(;t>=0&&(e[t]&192)===128;)t--;return t<0||t===0?n:t+vt[e[t]]>n?t:n},yt={string2buf:Gl,buf2string:Vl,utf8border:Yl};Hi=Kl,Zi=Object.prototype.toString,{Z_NO_FLUSH:Xl,Z_SYNC_FLUSH:Jl,Z_FULL_FLUSH:Ql,Z_FINISH:ed,Z_OK:Xt,Z_STREAM_END:td,Z_DEFAULT_COMPRESSION:nd,Z_DEFAULT_STRATEGY:id,Z_DEFLATED:rd}=Ve;mt.prototype.push=function(e,n){let t=this.strm,i=this.options.chunkSize,r,o;if(this.ended)return!1;for(n===~~n?o=n:o=n===!0?ed:Xl,typeof e=="string"?t.input=yt.string2buf(e):Zi.call(e)==="[object ArrayBuffer]"?t.input=new Uint8Array(e):t.input=e,t.next_in=0,t.avail_in=t.input.length;;){if(t.avail_out===0&&(t.output=new Uint8Array(i),t.next_out=0,t.avail_out=i),(o===Jl||o===Ql)&&t.avail_out<=6){this.onData(t.output.subarray(0,t.next_out)),t.avail_out=0;continue}if(r=bt.deflate(t,o),r===td)return t.next_out>0&&this.onData(t.output.subarray(0,t.next_out)),r=bt.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===Xt;if(t.avail_out===0){this.onData(t.output);continue}if(o>0&&t.next_out>0){this.onData(t.output.subarray(0,t.next_out)),t.avail_out=0;continue}if(t.avail_in===0)break}return!0};mt.prototype.onData=function(e){this.chunks.push(e)};mt.prototype.onEnd=function(e){e===Xt&&(this.result=Kt.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};sd=mt,ld=Un,dd=od,fd=ad,hd=Ve,cd={Deflate:sd,deflate:ld,deflateRaw:dd,gzip:fd,constants:hd},Jt=30,ud=12,pd=function(n,t){let i,r,o,a,s,f,l,d,h,u,c,p,k,b,_,y,g,w,I,$,v,U,D,E,S=n.state;i=n.next_in,D=n.input,r=i+(n.avail_in-5),o=n.next_out,E=n.output,a=o-(t-n.avail_out),s=o+(n.avail_out-257),f=S.dmax,l=S.wsize,d=S.whave,h=S.wnext,u=S.window,c=S.hold,p=S.bits,k=S.lencode,b=S.distcode,_=(1<<S.lenbits)-1,y=(1<<S.distbits)-1;e:do{p<15&&(c+=D[i++]<<p,p+=8,c+=D[i++]<<p,p+=8),g=k[c&_];t:for(;;){if(w=g>>>24,c>>>=w,p-=w,w=g>>>16&255,w===0)E[o++]=g&65535;else if(w&16){I=g&65535,w&=15,w&&(p<w&&(c+=D[i++]<<p,p+=8),I+=c&(1<<w)-1,c>>>=w,p-=w),p<15&&(c+=D[i++]<<p,p+=8,c+=D[i++]<<p,p+=8),g=b[c&y];n:for(;;){if(w=g>>>24,c>>>=w,p-=w,w=g>>>16&255,w&16){if($=g&65535,w&=15,p<w&&(c+=D[i++]<<p,p+=8,p<w&&(c+=D[i++]<<p,p+=8)),$+=c&(1<<w)-1,$>f){n.msg="invalid distance too far back",S.mode=Jt;break e}if(c>>>=w,p-=w,w=o-a,$>w){if(w=$-w,w>d&&S.sane){n.msg="invalid distance too far back",S.mode=Jt;break e}if(v=0,U=u,h===0){if(v+=l-w,w<I){I-=w;do E[o++]=u[v++];while(--w);v=o-$,U=E}}else if(h<w){if(v+=l+h-w,w-=h,w<I){I-=w;do E[o++]=u[v++];while(--w);if(v=0,h<I){w=h,I-=w;do E[o++]=u[v++];while(--w);v=o-$,U=E}}}else if(v+=h-w,w<I){I-=w;do E[o++]=u[v++];while(--w);v=o-$,U=E}for(;I>2;)E[o++]=U[v++],E[o++]=U[v++],E[o++]=U[v++],I-=3;I&&(E[o++]=U[v++],I>1&&(E[o++]=U[v++]))}else{v=o-$;do E[o++]=E[v++],E[o++]=E[v++],E[o++]=E[v++],I-=3;while(I>2);I&&(E[o++]=E[v++],I>1&&(E[o++]=E[v++]))}}else if((w&64)===0){g=b[(g&65535)+(c&(1<<w)-1)];continue n}else{n.msg="invalid distance code",S.mode=Jt;break e}break}}else if((w&64)===0){g=k[(g&65535)+(c&(1<<w)-1)];continue t}else if(w&32){S.mode=ud;break e}else{n.msg="invalid literal/length code",S.mode=Jt;break e}break}}while(i<r&&o<s);I=p>>3,i-=I,p-=I<<3,c&=(1<<p)-1,n.next_in=i,n.next_out=o,n.avail_in=i<r?5+(r-i):5-(i-r),n.avail_out=o<s?257+(s-o):257-(o-s),S.hold=c,S.bits=p},Xe=15,Gi=852,ji=592,Vi=0,An=1,Yi=2,wd=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),_d=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),gd=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),bd=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),vd=(e,n,t,i,r,o,a,s)=>{let f=s.bits,l=0,d=0,h=0,u=0,c=0,p=0,k=0,b=0,_=0,y=0,g,w,I,$,v,U=null,D=0,E,S=new Uint16Array(Xe+1),Le=new Uint16Array(Xe+1),Lt=null,oi=0,ai,Bt,Ft;for(l=0;l<=Xe;l++)S[l]=0;for(d=0;d<i;d++)S[n[t+d]]++;for(c=f,u=Xe;u>=1&&S[u]===0;u--);if(c>u&&(c=u),u===0)return r[o++]=1<<24|64<<16|0,r[o++]=1<<24|64<<16|0,s.bits=1,0;for(h=1;h<u&&S[h]===0;h++);for(c<h&&(c=h),b=1,l=1;l<=Xe;l++)if(b<<=1,b-=S[l],b<0)return-1;if(b>0&&(e===Vi||u!==1))return-1;for(Le[1]=0,l=1;l<Xe;l++)Le[l+1]=Le[l]+S[l];for(d=0;d<i;d++)n[t+d]!==0&&(a[Le[n[t+d]]++]=d);if(e===Vi?(U=Lt=a,E=19):e===An?(U=wd,D-=257,Lt=_d,oi-=257,E=256):(U=gd,Lt=bd,E=-1),y=0,d=0,l=h,v=o,p=c,k=0,I=-1,_=1<<c,$=_-1,e===An&&_>Gi||e===Yi&&_>ji)return 1;for(;;){ai=l-k,a[d]<E?(Bt=0,Ft=a[d]):a[d]>E?(Bt=Lt[oi+a[d]],Ft=U[D+a[d]]):(Bt=32+64,Ft=0),g=1<<l-k,w=1<<p,h=w;do w-=g,r[v+(y>>k)+w]=ai<<24|Bt<<16|Ft|0;while(w!==0);for(g=1<<l-1;y&g;)g>>=1;if(g!==0?(y&=g-1,y+=g):y=0,d++,--S[l]===0){if(l===u)break;l=n[t+a[d]]}if(l>c&&(y&$)!==I){for(k===0&&(k=c),v+=h,p=l-k,b=1<<p;p+k<u&&(b-=S[p+k],!(b<=0));)p++,b<<=1;if(_+=1<<p,e===An&&_>Gi||e===Yi&&_>ji)return 1;I=y&$,r[I]=c<<24|p<<16|v-o|0}}return y!==0&&(r[v+y]=l-k<<24|64<<16|0),s.bits=c,0},Et=vd,yd=0,Ki=1,Xi=2,{Z_FINISH:Ji,Z_BLOCK:md,Z_TREES:Qt,Z_OK:qe,Z_STREAM_END:Ed,Z_NEED_DICT:kd,Z_STREAM_ERROR:ee,Z_DATA_ERROR:Qi,Z_MEM_ERROR:er,Z_BUF_ERROR:Cd,Z_DEFLATED:tr}=Ve,nr=1,ir=2,rr=3,or=4,ar=5,sr=6,lr=7,dr=8,fr=9,hr=10,en=11,we=12,Rn=13,cr=14,Mn=15,ur=16,pr=17,wr=18,_r=19,tn=20,nn=21,gr=22,br=23,vr=24,yr=25,mr=26,Ln=27,Er=28,kr=29,P=30,Cr=31,Td=32,Sd=852,xd=592,Dd=15,Id=Dd,Tr=e=>(e>>>24&255)+(e>>>8&65280)+((e&65280)<<8)+((e&255)<<24);Sr=e=>{if(!e||!e.state)return ee;let n=e.state;return e.total_in=e.total_out=n.total=0,e.msg="",n.wrap&&(e.adler=n.wrap&1),n.mode=nr,n.last=0,n.havedict=0,n.dmax=32768,n.head=null,n.hold=0,n.bits=0,n.lencode=n.lendyn=new Int32Array(Sd),n.distcode=n.distdyn=new Int32Array(xd),n.sane=1,n.back=-1,qe},xr=e=>{if(!e||!e.state)return ee;let n=e.state;return n.wsize=0,n.whave=0,n.wnext=0,Sr(e)},Dr=(e,n)=>{let t;if(!e||!e.state)return ee;let i=e.state;return n<0?(t=0,n=-n):(t=(n>>4)+1,n<48&&(n&=15)),n&&(n<8||n>15)?ee:(i.window!==null&&i.wbits!==n&&(i.window=null),i.wrap=t,i.wbits=n,xr(e))},Ir=(e,n)=>{if(!e)return ee;let t=new Ud;e.state=t,t.window=null;let i=Dr(e,n);return i!==qe&&(e.state=null),i},Ad=e=>Ir(e,Id),Ur=!0,Rd=e=>{if(Ur){Bn=new Int32Array(512),Fn=new Int32Array(32);let n=0;for(;n<144;)e.lens[n++]=8;for(;n<256;)e.lens[n++]=9;for(;n<280;)e.lens[n++]=7;for(;n<288;)e.lens[n++]=8;for(Et(Ki,e.lens,0,288,Bn,0,e.work,{bits:9}),n=0;n<32;)e.lens[n++]=5;Et(Xi,e.lens,0,32,Fn,0,e.work,{bits:5}),Ur=!1}e.lencode=Bn,e.lenbits=9,e.distcode=Fn,e.distbits=5},Ar=(e,n,t,i)=>{let r,o=e.state;return o.window===null&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new Uint8Array(o.wsize)),i>=o.wsize?(o.window.set(n.subarray(t-o.wsize,t),0),o.wnext=0,o.whave=o.wsize):(r=o.wsize-o.wnext,r>i&&(r=i),o.window.set(n.subarray(t-i,t-i+r),o.wnext),i-=r,i?(o.window.set(n.subarray(t-i,t),0),o.wnext=i,o.whave=o.wsize):(o.wnext+=r,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=r))),0},Md=(e,n)=>{let t,i,r,o,a,s,f,l,d,h,u,c,p,k,b=0,_,y,g,w,I,$,v,U,D=new Uint8Array(4),E,S,Le=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!e||!e.state||!e.output||!e.input&&e.avail_in!==0)return ee;t=e.state,t.mode===we&&(t.mode=Rn),a=e.next_out,r=e.output,f=e.avail_out,o=e.next_in,i=e.input,s=e.avail_in,l=t.hold,d=t.bits,h=s,u=f,U=qe;e:for(;;)switch(t.mode){case nr:if(t.wrap===0){t.mode=Rn;break}for(;d<16;){if(s===0)break e;s--,l+=i[o++]<<d,d+=8}if(t.wrap&2&&l===35615){t.check=0,D[0]=l&255,D[1]=l>>>8&255,t.check=Z(t.check,D,2,0),l=0,d=0,t.mode=ir;break}if(t.flags=0,t.head&&(t.head.done=!1),!(t.wrap&1)||(((l&255)<<8)+(l>>8))%31){e.msg="incorrect header check",t.mode=P;break}if((l&15)!==tr){e.msg="unknown compression method",t.mode=P;break}if(l>>>=4,d-=4,v=(l&15)+8,t.wbits===0)t.wbits=v;else if(v>t.wbits){e.msg="invalid window size",t.mode=P;break}t.dmax=1<<t.wbits,e.adler=t.check=1,t.mode=l&512?hr:we,l=0,d=0;break;case ir:for(;d<16;){if(s===0)break e;s--,l+=i[o++]<<d,d+=8}if(t.flags=l,(t.flags&255)!==tr){e.msg="unknown compression method",t.mode=P;break}if(t.flags&57344){e.msg="unknown header flags set",t.mode=P;break}t.head&&(t.head.text=l>>8&1),t.flags&512&&(D[0]=l&255,D[1]=l>>>8&255,t.check=Z(t.check,D,2,0)),l=0,d=0,t.mode=rr;case rr:for(;d<32;){if(s===0)break e;s--,l+=i[o++]<<d,d+=8}t.head&&(t.head.time=l),t.flags&512&&(D[0]=l&255,D[1]=l>>>8&255,D[2]=l>>>16&255,D[3]=l>>>24&255,t.check=Z(t.check,D,4,0)),l=0,d=0,t.mode=or;case or:for(;d<16;){if(s===0)break e;s--,l+=i[o++]<<d,d+=8}t.head&&(t.head.xflags=l&255,t.head.os=l>>8),t.flags&512&&(D[0]=l&255,D[1]=l>>>8&255,t.check=Z(t.check,D,2,0)),l=0,d=0,t.mode=ar;case ar:if(t.flags&1024){for(;d<16;){if(s===0)break e;s--,l+=i[o++]<<d,d+=8}t.length=l,t.head&&(t.head.extra_len=l),t.flags&512&&(D[0]=l&255,D[1]=l>>>8&255,t.check=Z(t.check,D,2,0)),l=0,d=0}else t.head&&(t.head.extra=null);t.mode=sr;case sr:if(t.flags&1024&&(c=t.length,c>s&&(c=s),c&&(t.head&&(v=t.head.extra_len-t.length,t.head.extra||(t.head.extra=new Uint8Array(t.head.extra_len)),t.head.extra.set(i.subarray(o,o+c),v)),t.flags&512&&(t.check=Z(t.check,i,c,o)),s-=c,o+=c,t.length-=c),t.length))break e;t.length=0,t.mode=lr;case lr:if(t.flags&2048){if(s===0)break e;c=0;do v=i[o+c++],t.head&&v&&t.length<65536&&(t.head.name+=String.fromCharCode(v));while(v&&c<s);if(t.flags&512&&(t.check=Z(t.check,i,c,o)),s-=c,o+=c,v)break e}else t.head&&(t.head.name=null);t.length=0,t.mode=dr;case dr:if(t.flags&4096){if(s===0)break e;c=0;do v=i[o+c++],t.head&&v&&t.length<65536&&(t.head.comment+=String.fromCharCode(v));while(v&&c<s);if(t.flags&512&&(t.check=Z(t.check,i,c,o)),s-=c,o+=c,v)break e}else t.head&&(t.head.comment=null);t.mode=fr;case fr:if(t.flags&512){for(;d<16;){if(s===0)break e;s--,l+=i[o++]<<d,d+=8}if(l!==(t.check&65535)){e.msg="header crc mismatch",t.mode=P;break}l=0,d=0}t.head&&(t.head.hcrc=t.flags>>9&1,t.head.done=!0),e.adler=t.check=0,t.mode=we;break;case hr:for(;d<32;){if(s===0)break e;s--,l+=i[o++]<<d,d+=8}e.adler=t.check=Tr(l),l=0,d=0,t.mode=en;case en:if(t.havedict===0)return e.next_out=a,e.avail_out=f,e.next_in=o,e.avail_in=s,t.hold=l,t.bits=d,kd;e.adler=t.check=1,t.mode=we;case we:if(n===md||n===Qt)break e;case Rn:if(t.last){l>>>=d&7,d-=d&7,t.mode=Ln;break}for(;d<3;){if(s===0)break e;s--,l+=i[o++]<<d,d+=8}switch(t.last=l&1,l>>>=1,d-=1,l&3){case 0:t.mode=cr;break;case 1:if(Rd(t),t.mode=tn,n===Qt){l>>>=2,d-=2;break e}break;case 2:t.mode=pr;break;case 3:e.msg="invalid block type",t.mode=P}l>>>=2,d-=2;break;case cr:for(l>>>=d&7,d-=d&7;d<32;){if(s===0)break e;s--,l+=i[o++]<<d,d+=8}if((l&65535)!==(l>>>16^65535)){e.msg="invalid stored block lengths",t.mode=P;break}if(t.length=l&65535,l=0,d=0,t.mode=Mn,n===Qt)break e;case Mn:t.mode=ur;case ur:if(c=t.length,c){if(c>s&&(c=s),c>f&&(c=f),c===0)break e;r.set(i.subarray(o,o+c),a),s-=c,o+=c,f-=c,a+=c,t.length-=c;break}t.mode=we;break;case pr:for(;d<14;){if(s===0)break e;s--,l+=i[o++]<<d,d+=8}if(t.nlen=(l&31)+257,l>>>=5,d-=5,t.ndist=(l&31)+1,l>>>=5,d-=5,t.ncode=(l&15)+4,l>>>=4,d-=4,t.nlen>286||t.ndist>30){e.msg="too many length or distance symbols",t.mode=P;break}t.have=0,t.mode=wr;case wr:for(;t.have<t.ncode;){for(;d<3;){if(s===0)break e;s--,l+=i[o++]<<d,d+=8}t.lens[Le[t.have++]]=l&7,l>>>=3,d-=3}for(;t.have<19;)t.lens[Le[t.have++]]=0;if(t.lencode=t.lendyn,t.lenbits=7,E={bits:t.lenbits},U=Et(yd,t.lens,0,19,t.lencode,0,t.work,E),t.lenbits=E.bits,U){e.msg="invalid code lengths set",t.mode=P;break}t.have=0,t.mode=_r;case _r:for(;t.have<t.nlen+t.ndist;){for(;b=t.lencode[l&(1<<t.lenbits)-1],_=b>>>24,y=b>>>16&255,g=b&65535,!(_<=d);){if(s===0)break e;s--,l+=i[o++]<<d,d+=8}if(g<16)l>>>=_,d-=_,t.lens[t.have++]=g;else{if(g===16){for(S=_+2;d<S;){if(s===0)break e;s--,l+=i[o++]<<d,d+=8}if(l>>>=_,d-=_,t.have===0){e.msg="invalid bit length repeat",t.mode=P;break}v=t.lens[t.have-1],c=3+(l&3),l>>>=2,d-=2}else if(g===17){for(S=_+3;d<S;){if(s===0)break e;s--,l+=i[o++]<<d,d+=8}l>>>=_,d-=_,v=0,c=3+(l&7),l>>>=3,d-=3}else{for(S=_+7;d<S;){if(s===0)break e;s--,l+=i[o++]<<d,d+=8}l>>>=_,d-=_,v=0,c=11+(l&127),l>>>=7,d-=7}if(t.have+c>t.nlen+t.ndist){e.msg="invalid bit length repeat",t.mode=P;break}for(;c--;)t.lens[t.have++]=v}}if(t.mode===P)break;if(t.lens[256]===0){e.msg="invalid code -- missing end-of-block",t.mode=P;break}if(t.lenbits=9,E={bits:t.lenbits},U=Et(Ki,t.lens,0,t.nlen,t.lencode,0,t.work,E),t.lenbits=E.bits,U){e.msg="invalid literal/lengths set",t.mode=P;break}if(t.distbits=6,t.distcode=t.distdyn,E={bits:t.distbits},U=Et(Xi,t.lens,t.nlen,t.ndist,t.distcode,0,t.work,E),t.distbits=E.bits,U){e.msg="invalid distances set",t.mode=P;break}if(t.mode=tn,n===Qt)break e;case tn:t.mode=nn;case nn:if(s>=6&&f>=258){e.next_out=a,e.avail_out=f,e.next_in=o,e.avail_in=s,t.hold=l,t.bits=d,pd(e,u),a=e.next_out,r=e.output,f=e.avail_out,o=e.next_in,i=e.input,s=e.avail_in,l=t.hold,d=t.bits,t.mode===we&&(t.back=-1);break}for(t.back=0;b=t.lencode[l&(1<<t.lenbits)-1],_=b>>>24,y=b>>>16&255,g=b&65535,!(_<=d);){if(s===0)break e;s--,l+=i[o++]<<d,d+=8}if(y&&(y&240)===0){for(w=_,I=y,$=g;b=t.lencode[$+((l&(1<<w+I)-1)>>w)],_=b>>>24,y=b>>>16&255,g=b&65535,!(w+_<=d);){if(s===0)break e;s--,l+=i[o++]<<d,d+=8}l>>>=w,d-=w,t.back+=w}if(l>>>=_,d-=_,t.back+=_,t.length=g,y===0){t.mode=mr;break}if(y&32){t.back=-1,t.mode=we;break}if(y&64){e.msg="invalid literal/length code",t.mode=P;break}t.extra=y&15,t.mode=gr;case gr:if(t.extra){for(S=t.extra;d<S;){if(s===0)break e;s--,l+=i[o++]<<d,d+=8}t.length+=l&(1<<t.extra)-1,l>>>=t.extra,d-=t.extra,t.back+=t.extra}t.was=t.length,t.mode=br;case br:for(;b=t.distcode[l&(1<<t.distbits)-1],_=b>>>24,y=b>>>16&255,g=b&65535,!(_<=d);){if(s===0)break e;s--,l+=i[o++]<<d,d+=8}if((y&240)===0){for(w=_,I=y,$=g;b=t.distcode[$+((l&(1<<w+I)-1)>>w)],_=b>>>24,y=b>>>16&255,g=b&65535,!(w+_<=d);){if(s===0)break e;s--,l+=i[o++]<<d,d+=8}l>>>=w,d-=w,t.back+=w}if(l>>>=_,d-=_,t.back+=_,y&64){e.msg="invalid distance code",t.mode=P;break}t.offset=g,t.extra=y&15,t.mode=vr;case vr:if(t.extra){for(S=t.extra;d<S;){if(s===0)break e;s--,l+=i[o++]<<d,d+=8}t.offset+=l&(1<<t.extra)-1,l>>>=t.extra,d-=t.extra,t.back+=t.extra}if(t.offset>t.dmax){e.msg="invalid distance too far back",t.mode=P;break}t.mode=yr;case yr:if(f===0)break e;if(c=u-f,t.offset>c){if(c=t.offset-c,c>t.whave&&t.sane){e.msg="invalid distance too far back",t.mode=P;break}c>t.wnext?(c-=t.wnext,p=t.wsize-c):p=t.wnext-c,c>t.length&&(c=t.length),k=t.window}else k=r,p=a-t.offset,c=t.length;c>f&&(c=f),f-=c,t.length-=c;do r[a++]=k[p++];while(--c);t.length===0&&(t.mode=nn);break;case mr:if(f===0)break e;r[a++]=t.length,f--,t.mode=nn;break;case Ln:if(t.wrap){for(;d<32;){if(s===0)break e;s--,l|=i[o++]<<d,d+=8}if(u-=f,e.total_out+=u,t.total+=u,u&&(e.adler=t.check=t.flags?Z(t.check,r,u,a-u):ut(t.check,r,u,a-u)),u=f,(t.flags?l:Tr(l))!==t.check){e.msg="incorrect data check",t.mode=P;break}l=0,d=0}t.mode=Er;case Er:if(t.wrap&&t.flags){for(;d<32;){if(s===0)break e;s--,l+=i[o++]<<d,d+=8}if(l!==(t.total&4294967295)){e.msg="incorrect length check",t.mode=P;break}l=0,d=0}t.mode=kr;case kr:U=Ed;break e;case P:U=Qi;break e;case Cr:return er;case Td:default:return ee}return e.next_out=a,e.avail_out=f,e.next_in=o,e.avail_in=s,t.hold=l,t.bits=d,(t.wsize||u!==e.avail_out&&t.mode<P&&(t.mode<Ln||n!==Ji))&&Ar(e,e.output,e.next_out,u-e.avail_out),h-=e.avail_in,u-=e.avail_out,e.total_in+=h,e.total_out+=u,t.total+=u,t.wrap&&u&&(e.adler=t.check=t.flags?Z(t.check,r,u,e.next_out-u):ut(t.check,r,u,e.next_out-u)),e.data_type=t.bits+(t.last?64:0)+(t.mode===we?128:0)+(t.mode===tn||t.mode===Mn?256:0),(h===0&&u===0||n===Ji)&&U===qe&&(U=Cd),U},Ld=e=>{if(!e||!e.state)return ee;let n=e.state;return n.window&&(n.window=null),e.state=null,qe},Bd=(e,n)=>{if(!e||!e.state)return ee;let t=e.state;return(t.wrap&2)===0?ee:(t.head=n,n.done=!1,qe)},Fd=(e,n)=>{let t=n.length,i,r,o;return!e||!e.state||(i=e.state,i.wrap!==0&&i.mode!==en)?ee:i.mode===en&&(r=1,r=ut(r,n,t,0),r!==i.check)?Qi:(o=Ar(e,n,t,t),o?(i.mode=Cr,er):(i.havedict=1,qe))},zd=xr,$d=Dr,Pd=Sr,Nd=Ad,Wd=Ir,Od=Md,qd=Ld,Hd=Bd,Zd=Fd,Gd="pako inflate (from Nodeca project)",_e={inflateReset:zd,inflateReset2:$d,inflateResetKeep:Pd,inflateInit:Nd,inflateInit2:Wd,inflate:Od,inflateEnd:qd,inflateGetHeader:Hd,inflateSetDictionary:Zd,inflateInfo:Gd};Vd=jd,Rr=Object.prototype.toString,{Z_NO_FLUSH:Yd,Z_FINISH:Kd,Z_OK:kt,Z_STREAM_END:zn,Z_NEED_DICT:$n,Z_STREAM_ERROR:Xd,Z_DATA_ERROR:Mr,Z_MEM_ERROR:Jd}=Ve;Ct.prototype.push=function(e,n){let t=this.strm,i=this.options.chunkSize,r=this.options.dictionary,o,a,s;if(this.ended)return!1;for(n===~~n?a=n:a=n===!0?Kd:Yd,Rr.call(e)==="[object ArrayBuffer]"?t.input=new Uint8Array(e):t.input=e,t.next_in=0,t.avail_in=t.input.length;;){for(t.avail_out===0&&(t.output=new Uint8Array(i),t.next_out=0,t.avail_out=i),o=_e.inflate(t,a),o===$n&&r&&(o=_e.inflateSetDictionary(t,r),o===kt?o=_e.inflate(t,a):o===Mr&&(o=$n));t.avail_in>0&&o===zn&&t.state.wrap>0&&e[t.next_in]!==0;)_e.inflateReset(t),o=_e.inflate(t,a);switch(o){case Xd:case Mr:case $n:case Jd:return this.onEnd(o),this.ended=!0,!1}if(s=t.avail_out,t.next_out&&(t.avail_out===0||o===zn))if(this.options.to==="string"){let f=yt.utf8border(t.output,t.next_out),l=t.next_out-f,d=yt.buf2string(t.output,f);t.next_out=l,t.avail_out=i-l,l&&t.output.set(t.output.subarray(f,f+l),0),this.onData(d)}else this.onData(t.output.length===t.next_out?t.output:t.output.subarray(0,t.next_out));if(!(o===kt&&s===0)){if(o===zn)return o=_e.inflateEnd(this.strm),this.onEnd(o),this.ended=!0,!0;if(t.avail_in===0)break}}return!0};Ct.prototype.onData=function(e){this.chunks.push(e)};Ct.prototype.onEnd=function(e){e===kt&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=Kt.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};ef=Ct,tf=Pn,nf=Qd,rf=Pn,of=Ve,af={Inflate:ef,inflate:tf,inflateRaw:nf,ungzip:rf,constants:of},{Deflate:ec,deflate:sf,deflateRaw:tc,gzip:nc}=cd,{Inflate:lf,inflate:ic,inflateRaw:rc,ungzip:oc}=af,Lr=sf,rn=lf});function Tt(e,n,t){let i=e+n-t,r=Math.abs(i-e),o=Math.abs(i-n),a=Math.abs(i-t);return r<=o&&r<=a?e:o<=a?n:t}var Wn=m(()=>{});function Br(e,n,t){let i=df(e,t),r;n.interlaceMethod===1?r=cf(e,n,i):r=Fr(e,n,i);let o=e.metadata.find(s=>s.type==="tRNS"),a=uf(e,n,r,e.palette,o);return o&&(n.colorType===0||n.colorType===2)&&pf(n,a,o),a}function df(e,n){let t=new rn,i=0;for(let r of n)i=r.offset+4+4,t.push(e.view.buffer.slice(e.view.byteOffset+i,e.view.byteOffset+i+r.dataLength));if(t.err)throw ve(e,n[0],`Inflate error: ${t.msg}`,n[0].offset);if(t.result===void 0)throw new q(e,"IDAT: Failed to decompress data chunks",0);return t.result}function Fr(e,n,t,i=0,r=n.width,o=n.height){let a=0,s=On(n),f=an(n),l=zr(n,r),d=Math.ceil(r*f),h=new Uint8Array(o*d),u=new Map;for(let c=0;c<o;c++){let p=i+c*(l+1),k=t[p++];if(!ff)throw new q(e,`IDAT: Invalid filter type ${k}`,0);let b=u.get(k);b||(b=hf(f,l,r,k),u.set(k,b));let _=1,y=0;switch(k){case 0:case 1:{for(;y<s;y++)h[a]=t[p+y],a++;break}case 3:{let g=0;for(;y<s;y++)g=a-r*s,h[a]=t[p+y]+Math.floor(0+(g<0?0:h[g]))/2,a++;break}case 2:{_=0;break}case 4:{for(;y<s;y++){let g=Math.floor(a-l);h[a]=(t[p+y]+Tt(0,g<0?0:h[g],0))%256,a++}break}}if(n.bitDepth>=8)for(;_<r;_++)for(let g=0;g<s;g++)h[a]=b(t,p+_*s+g,h,a),a++;else{for(_&&(a-=_),y=_;y<l;y++)h[a+y]=b(t,p+y,h,a+y);a+=l}}return h}function ff(e){return e%1===0&&e>=0&&e<=4}function hf(e,n,t,i){let r=0,o=0,a=0;switch(i){case 0:return(s,f)=>s[f];case 1:return(s,f,l,d)=>(s[f]+l[Math.floor(d-e)])%256;case 2:return(s,f,l,d)=>(o=Math.floor(d-t*e),o<0?s[f]:(s[f]+l[o])%256);case 3:return(s,f,l,d)=>(r=Math.floor(d-e),o=Math.floor(d-t*e),s[f]+Math.floor((r<0?0:l[r])+(o<0?0:l[o]))/2);case 4:return(s,f,l,d)=>(r=Math.floor(d-Math.ceil(e)),o=Math.floor(d-n),a=Math.floor(d-n-Math.ceil(e)),(s[f]+Tt(r<0?0:l[r],o<0?0:l[o],a<0?0:l[a]))%256)}}function On(e){return Math.ceil(an(e))}function an(e){return $r(e.colorType)*e.bitDepth/8}function zr(e,n){return Math.ceil($r(e.colorType)*e.bitDepth*n/8)}function $r(e){switch(e){case 0:return 1;case 2:return 3;case 3:return 1;case 4:return 2;case 6:return 4}}function cf(e,n,t){let i=an(n),r=Math.ceil(n.width*i),o=new Uint8Array(r*n.height),a=On(n),s=8/n.bitDepth,f=(1<<n.bitDepth)-1,l=[0,4,0,2,0,1,0],d=[0,0,4,0,2,0,1],h=[8,8,4,4,2,2,1],u=[8,8,8,4,4,2,2],c=0;for(let p=0;p<7;p++){let k=l[p],b=d[p],_=h[p],y=u[p],g=Math.ceil((n.width-k)/_),w=Math.ceil((n.height-b)/y),I=Math.ceil(i*g);if(g===0||w===0)continue;let $=Fr(e,n,t,c,g,w),v=0;for(let U=0;U<w;U++){v=(b+U*y)*r+k*i;for(let D=0;D<g;D++){if(n.bitDepth<8){let E=$[U*I+Math.floor(D*i)];E>>=(s-D%s-1)*n.bitDepth,E&=f,E<<=(s-1-v%1*s)*n.bitDepth,o[Math.floor(v)]|=E}else for(let E=0;E<a;E++)o[v+E]=$[(U*g+D)*a+E];v+=_*i}}c+=w*(1+zr(n,g))}return o}function uf(e,n,t,i,r){let o=new(n.bitDepth===16?Uint16Array:Uint8Array)(n.width*n.height*4),a=0,s=On(n),f=an(n),l=Math.ceil(n.width*f);switch(n.colorType){case 0:{switch(n.bitDepth){case 1:case 2:case 4:{let d=8/n.bitDepth,h=(1<<n.bitDepth)-1,u=n.bitDepth/8;for(let c=0;c<n.height;c++)for(let p=0;p<n.width;p++)a=(c*n.width+p)*4,o[a]=t[c*l+Math.floor(p*u)],o[a]>>=(d-p%d-1)*n.bitDepth,o[a]&=h,o[a]*=255/h,o[a+1]=o[a],o[a+2]=o[a],o[a+3]=255;break}case 8:case 16:{for(let d=0;d<n.height;d++)for(let h=0;h<n.width;h++)a=(d*n.width+h)*4,n.bitDepth===16?o[a]=t[(d*n.width+h)*s]<<8|t[(d*n.width+h)*s+1]:o[a]=t[(d*n.width+h)*s],o[a+1]=o[a],o[a+2]=o[a],o[a+3]=n.bitDepth===16?65535:255;break}}break}case 4:{for(let d=0;d<n.height;d++)for(let h=0;h<n.width;h++)a=(d*n.width+h)*4,n.bitDepth===16?o[a]=t[(d*n.width+h)*s]<<8|t[(d*n.width+h)*s+1]:o[a]=t[(d*n.width+h)*s],o[a+1]=o[a],o[a+2]=o[a],n.bitDepth===16?o[a+3]=t[(d*n.width+h)*s+2]<<8|t[(d*n.width+h)*s+3]:o[a+3]=t[(d*n.width+h)*s+1];break}case 3:{if(!i)throw new q(e,"IDAT: Cannot decode indexed color type without a palette",0);switch(n.bitDepth){case 1:case 2:case 4:{let d=8/n.bitDepth,h=(1<<n.bitDepth)-1,u=n.bitDepth/8;for(let c=0;c<n.height;c++)for(let p=0;p<n.width;p++){a=(c*n.width+p)*4;let k=t[c*l+Math.floor(p*u)];k>>=(d-p%d-1)*n.bitDepth,k&=h,i.setRgba(o,a,k),r&&r.transparency.length>k&&(o[a+3]=r.transparency[k])}break}case 8:{let d=0;for(let h=0;h<n.height;h++)for(let u=0;u<n.width;u++)a=(h*n.width+u)*4,d=t[h*n.width+u],i.setRgba(o,a,d),r&&r.transparency.length>d&&(o[a+3]=r.transparency[d]);break}}break}case 2:{for(let d=0;d<n.height;d++)for(let h=0;h<n.width;h++)a=(d*n.width+h)*4,n.bitDepth===16?(o[a]=t[(d*n.width+h)*s]<<8|t[(d*n.width+h)*s+1],o[a+1]=t[(d*n.width+h)*s+2]<<8|t[(d*n.width+h)*s+3],o[a+2]=t[(d*n.width+h)*s+4]<<8|t[(d*n.width+h)*s+5]):(o[a]=t[(d*n.width+h)*s],o[a+1]=t[(d*n.width+h)*s+1],o[a+2]=t[(d*n.width+h)*s+2]),o[a+3]=n.bitDepth===16?65535:255;break}case 6:{for(let d=0;d<n.height;d++)for(let h=0;h<n.width;h++)a=(d*n.width+h)*4,n.bitDepth===16?(o[a]=t[(d*n.width+h)*s]<<8|t[(d*n.width+h)*s+1],o[a+1]=t[(d*n.width+h)*s+2]<<8|t[(d*n.width+h)*s+3],o[a+2]=t[(d*n.width+h)*s+4]<<8|t[(d*n.width+h)*s+5],o[a+3]=t[(d*n.width+h)*s+6]<<8|t[(d*n.width+h)*s+7]):(o[a]=t[(d*n.width+h)*s],o[a+1]=t[(d*n.width+h)*s+1],o[a+2]=t[(d*n.width+h)*s+2],o[a+3]=t[(d*n.width+h)*s+3]);break}}return o}function pf(e,n,t){let i=(1<<e.bitDepth)-1,r=e.bitDepth===16?65535:255;if(e.colorType===0){let o=r/i*t.transparency;for(let a=0;a<n.length;a+=4)n[a]===o&&(n[a+3]=0);return}if(e.colorType===2){let o=[r/i*t.transparency[0],r/i*t.transparency[1],r/i*t.transparency[2]];for(let a=0;a<n.length;a+=4)n[a]===o[0]&&n[a+1]===o[1]&&n[a+2]===o[2]&&(n[a+3]=0);return}}var Pr=m(()=>{on();z();Wn()});function Nr(e,n,t){Be(e,t,"IDAT"),F(e,t,0)}var Wr=m(()=>{z()});function Or(e){return e===1||e===2||e===4||e===8||e===16}function qr(e,n){return e===0&&n>=1&&n<=16||e===2&&n>=8&&n<=16||e===3&&n>=1&&n<=8||e===4&&n>=8&&n<=16||e===6&&n>=8&&n<=16}function Hr(e){return e===0}function Zr(e){return e===0||e===1}var Gr=m(()=>{});function jr(e,n){F(e,n,13);let t=n.offset+4+4,i=e.view.getUint32(t);t+=4;let r=e.view.getUint32(t);t+=4;let o=e.view.getUint8(t);if(!Or(o))throw ve(e,n,`Bit depth "${o}" is not valid`,t);t++;let a=e.view.getUint8(t);if(!qr(a,o))throw ve(e,n,`Color type "${a}" is not valid with bit depth "${o}"`,t);t++;let s=e.view.getUint8(t);ue(e,n,s,t),t++;let f=e.view.getUint8(t);Hr(f)||(N(e,C(n,`Filter method "${f}" is not valid`,t)),f=0),t++;let l=e.view.getUint8(t);return Zr(l)||(N(e,C(n,`Interlace method "${l}" is not valid`,t)),l=0),t++,{width:i,height:r,bitDepth:o,colorType:a,interlaceMethod:l}}var Vr=m(()=>{z();Gr()});function wf(){if(St)return St;St=[];for(let e=0;e<256;e++){let n=e;for(let t=0;t<8;t++)n&1?n=3988292384^n>>>1:n=n>>>1;St[e]=n>>>0}return St}function _f(e,n,t,i){let r=wf(),o=e;for(let a=0;a<i;a++)o=r[(o^n.getUint8(t+a))&255]^o>>>8;return o}function xt(e,n,t){return(_f(4294967295,e,n,t)^4294967295)>>>0}var St,qn=m(()=>{});var Yr={};M(Yr,{parseChunk:()=>gf});function gf(e,n,t){B(e,t),x(e,t,"IDAT");let i=t.offset+4+4,r,o;switch(n.colorType){case 0:case 4:{r=e.view.getUint16(i),o=2;break}case 2:case 6:{r=[e.view.getUint16(i),e.view.getUint16(i+2),e.view.getUint16(i+4)],o=6;break}case 3:{r=e.view.getUint8(i),o=1;break}default:throw C(t,`Unrecognized color type "${n.colorType}"`,i)}return F(e,t,o),{type:"bKGD",color:r}}var Kr=m(()=>{z()});var Xr={};M(Xr,{parseChunk:()=>bf});function bf(e,n,t){B(e,t),x(e,t,"PLTE"),x(e,t,"IDAT"),F(e,t,32);let i=t.offset+4+4,r={x:e.view.getUint32(i)/1e5,y:e.view.getUint32(i+4)/1e5};if(r.x>1||r.y>1)throw C(t,`Invalid white point (${r.x},${r.y})`,i);i+=8;let o={x:e.view.getUint32(i)/1e5,y:e.view.getUint32(i+4)/1e5};if(o.x>1||o.y>1)throw C(t,`Invalid red (${o.x},${o.y})`,i);i+=8;let a={x:e.view.getUint32(i)/1e5,y:e.view.getUint32(i+4)/1e5};if(a.x>1||a.y>1)throw C(t,`Invalid green (${a.x},${a.y})`,i);i+=8;let s={x:e.view.getUint32(i)/1e5,y:e.view.getUint32(i+4)/1e5};if(s.x>1||s.y>1)throw C(t,`Invalid blue (${s.x},${s.y})`,i);return{type:"cHRM",whitePoint:r,red:o,green:a,blue:s}}var Jr=m(()=>{z()});var Qr={};M(Qr,{parseChunk:()=>vf});function vf(e,n,t){let i=t.offset+4+4;return{type:"eXIf",value:e.view.buffer.slice(e.view.byteOffset+i,e.view.byteOffset+i+t.dataLength)}}var eo=m(()=>{});var to={};M(to,{parseChunk:()=>yf});function yf(e,n,t){B(e,t),x(e,t,"PLTE"),x(e,t,"IDAT"),F(e,t,4);let i=t.offset+4+4,r=e.view.getUint32(i)/1e5;return r===0&&N(e,C(t,"A value of 0 is meaningless",i)),{type:"gAMA",value:r}}var no=m(()=>{z()});var io={};M(io,{parseChunk:()=>mf});function mf(e,n,t){B(e,t),Be(e,t,"PLTE"),x(e,t,"IDAT"),F(e,t,e.palette.size*2);let i=t.offset+4+4,r=[];for(let o=0;o<e.palette.size*2;o+=2)r.push(e.view.getUint16(i+o));return{type:"hIST",frequency:r}}var ro=m(()=>{z()});function W(e,n,t,i,r,o,a,s){let f=[],l=0,d=0;for(;(i===void 0||d<i)&&!(!a&&r===o);d++){try{l=e.view.getUint8(r)}catch(u){throw u instanceof Error&&u.message==="Offset is outside the bounds of the DataView"?C(n,"EOF while reading text",r):u}if(!s&&l===0)break;r++,f.push(l)}if(a&&e.view.getUint8(r)!==0)throw C(n,"No null character after text",r);let h=new Uint8Array(f);if(s){let u=new rn;if(u.push(h),u.err)throw C(n,`Inflate error: ${u.msg}`,r);h=u.result}return{text:t?t.decode(h):String.fromCharCode(...f),bytesRead:d+1}}var xe=m(()=>{on();z()});var oo={};M(oo,{parseChunk:()=>Ef});function Ef(e,n,t){B(e,t),ot(e,t,"sRGB"),x(e,t,"PLTE"),x(e,t,"IDAT"),X(e,t,3);let i=t.offset+4+4,r=i+t.dataLength,o=i,a=new TextDecoder("latin1"),s=W(e,t,a,79,o,r,!0);o+=s.bytesRead;let f=s.text,l=e.view.getUint8(o);ue(e,t,l,o),o++;let d=new Uint8Array(e.view.buffer.slice(e.view.byteOffset+o,e.view.byteOffset+r));return{type:"iCCP",name:f,data:d}}var ao=m(()=>{z();xe()});var so={};M(so,{parseChunk:()=>kf});function kf(e,n,t){X(e,t,6);let i=t.offset+4+4,r=i+t.dataLength,o=new TextDecoder("utf8"),a;a=W(e,t,o,79,i,r,!0),i+=a.bytesRead;let s=a.text,f=e.view.getUint8(i++)===1,l=e.view.getUint8(i);f&&ue(e,t,l,i),i++,a=W(e,t,o,void 0,i,r,!0),i+=a.bytesRead;let d=a.text;a=W(e,t,o,void 0,i,r,!0),i+=a.bytesRead;let h=a.text;a=W(e,t,o,void 0,i,r,!1,f),i+=a.bytesRead;let u=a.text;return{type:"iTXt",keyword:s,languageTag:d,translatedKeyword:h,text:u}}var lo=m(()=>{z();xe()});var fo={};M(fo,{parseChunk:()=>Cf});function Cf(e,n,t){B(e,t),F(e,t,7);let i=t.offset+4+4,r=e.view.getUint16(i);i+=2;let o=e.view.getUint8(i++),a=e.view.getUint8(i++),s=e.view.getUint8(i++),f=e.view.getUint8(i++),l=e.view.getUint8(i++);return{type:"tIME",value:new Date(r,o,a,s,f,l)}}var ho=m(()=>{z()});var co={};M(co,{parseChunk:()=>Tf});function Tf(e,n,t){B(e,t),x(e,t,"IDAT"),F(e,t,9);let i=t.offset+4+4,r=e.view.getInt32(i);i+=4;let o=e.view.getInt32(i);i+=4;let a=e.view.getUint8(i),s;switch(a){case 0:s="pixel";break;case 1:s="micrometer";break;default:throw C(t,`Invalid oFFs unit type ("${a}")`,i)}return{type:"oFFs",offset:{x:r,y:o},unitType:s}}var uo=m(()=>{z()});function Dt(e,n,t,i,r,o){let a=W(e,n,t,void 0,i,r,o);i+=a.bytesRead,Sf(a.text)||N(e,C(n,`Invalid character in floating point number ("${a.text}")`,i));let s=parseFloat(a.text);return{bytesRead:a.bytesRead,value:s}}function Sf(e){return e.match(/^[+-]?[0-9]+\.[0-9]+([eE][+-]?[0-9]+)?$/)||e.match(/^[+-]?[0-9]+\.?([eE][+-]?[0-9]+)?$/)||e.match(/^[+-]?\.[0-9]+([eE][+-]?[0-9]+)?$/)}var Hn=m(()=>{z();xe()});var po={};M(po,{parseChunk:()=>xf});function xf(e,n,t){B(e,t),x(e,t,"IDAT"),X(e,t,4);let i=t.offset+4+4,r=i+t.dataLength,o=i,a=new TextDecoder("latin1"),s;s=W(e,t,a,79,o,r,!0),o+=s.bytesRead;let f=s.text,l=e.view.getInt32(o);o+=4;let d=e.view.getInt32(o);o+=4;let h=e.view.getUint8(o++),u;switch(h){case 0:u="linear-mapping";break;case 1:u="base-e exponential mapping";break;case 2:u="arbitrary-base exponential mapping";break;case 3:u="hyperbolic mapping";break;default:throw C(t,`Invalid equation type "${h}"`,o)}let c=e.view.getUint8(o++);s=W(e,t,a,79,o,r,!0),o+=s.bytesRead;let p=s.text,k=[],b;for(let _=0;_<c;_++)b=Dt(e,t,a,o,r,_<c-1),o+=b.bytesRead,k.push(b.value);return{type:"pCAL",calibrationName:f,x0:l,x1:d,equationType:u,unitName:p,params:k}}var wo=m(()=>{z();Hn();xe()});var _o={};M(_o,{parseChunk:()=>Df});function Df(e,n,t){B(e,t),x(e,t,"IDAT"),F(e,t,9);let i=t.offset+4+4,r=e.view.getUint32(i);i+=4;let o=e.view.getUint32(i);i+=4;let a=e.view.getUint8(i)===1?"meter":"unknown";return{type:"pHYs",pixelsPerUnit:{x:r,y:o},unitType:a}}var go=m(()=>{z()});var bo={};M(bo,{parseChunk:()=>If});function If(e,n,t){B(e,t),x(e,t,"PLTE"),x(e,t,"IDAT");let i=t.offset+4+4,r,o;switch(n.colorType){case 0:{r=e.view.getUint8(i),o=1;break}case 2:case 3:{r=[e.view.getUint8(i),e.view.getUint8(i+1),e.view.getUint8(i+2)],o=3;break}case 4:{r=[e.view.getUint8(i),e.view.getUint8(i+1)],o=2;break}case 6:{r=[e.view.getUint8(i),e.view.getUint8(i+1),e.view.getUint8(i+2),e.view.getUint8(i+3)],o=4;break}default:throw C(t,`Unrecognized color type "${n.colorType}"`,i)}return F(e,t,o),{type:"sBIT",value:r}}var vo=m(()=>{z()});var yo={};M(yo,{parseChunk:()=>Uf});function Uf(e,n,t){B(e,t),x(e,t,"IDAT"),X(e,t,4);let i=t.offset+4+4,r=i+t.dataLength,o=i,a=new TextDecoder("latin1"),s=e.view.getUint8(o),f;switch(s){case 0:f="meter";break;case 1:f="radian";break;default:throw C(t,`Invalid sCAL unit type ("${s}")`,o)}o++;let l;l=Dt(e,t,a,o,r,!0),o+=l.bytesRead;let d=l.value;l=Dt(e,t,a,o,r,!1),o+=l.bytesRead;let h=l.value;if(d<0||h<0)throw C(t,`Values cannot be negative (${d}, ${h})`,o);return{type:"sCAL",pixelsPerUnit:{x:d,y:h},unitType:f}}var mo=m(()=>{z();Hn()});var Eo={};M(Eo,{parseChunk:()=>Af});function Af(e,n,t){x(e,t,"IDAT");let i=t.offset+4+4,r=i,o=r+t.dataLength,a=new TextDecoder("latin1"),s=W(e,t,a,void 0,r,o,!0);r+=s.bytesRead;let f=s.text,l=e.view.getUint8(r++),d=l===16?2:1,h=d*4+2,u=t.dataLength-(r-i),c=u/h;if(c%1!==0)throw C(t,`Invalid data length: ${u} should be divisible by entry size ${h}`,r);let p=[];for(let k=0;k<c;k++){let b=[];for(let y=0;y<4;y++)b.push(d===2?e.view.getUint16(r):e.view.getUint8(r)),r+=d;let _=e.view.getUint16(r);r+=2,p.push({red:b[0],green:b[1],blue:b[2],alpha:b[3],frequency:_})}return{type:"sPLT",name:f,sampleDepth:l,entries:p}}var ko=m(()=>{z();xe()});var Co={};M(Co,{parseChunk:()=>Rf});function Rf(e,n,t){B(e,t),ot(e,t,"iCCP"),x(e,t,"PLTE"),x(e,t,"IDAT"),F(e,t,1);let i=t.offset+4+4,r=e.view.getUint8(i),o;switch(r){case 0:case 1:case 2:case 3:o=r;break;default:throw C(t,`Invalid rendering intent "${r}"`,i)}return{type:"sRGB",renderingIntent:o}}var To=m(()=>{z()});var So={};M(So,{parseChunk:()=>Mf});function Mf(e,n,t){B(e,t),x(e,t,"IDAT"),F(e,t,1);let i=t.offset+4+4,r=e.view.getUint8(i),o;switch(r){case 0:o="cross-fuse";break;case 1:o="diverging-fuse";break;default:throw C(t,`Invalid layout mode "${r}"`,i)}let a=15-(n.width-1)%16;if(a>7)throw C(t,`Invalid padding value "${a}" for image width ${n.width}`,i);let s=Math.floor((n.width-a)/2);return{type:"sTER",layoutMode:o,subimageWidth:s,padding:a}}var xo=m(()=>{z()});var Do={};M(Do,{parseChunk:()=>Lf});function Lf(e,n,t){X(e,t,6);let i=t.offset+4+4,r=i+t.dataLength,o=i,a=new TextDecoder("latin1"),s;s=W(e,t,a,79,o,r,!0),o+=s.bytesRead;let f=s.text;s=W(e,t,a,void 0,o,r,!1),o+=s.bytesRead;let l=s.text;return{type:"tEXt",keyword:f,text:l}}var Io=m(()=>{z();xe()});var Uo={};M(Uo,{parseChunk:()=>Bf});function Bf(e,n,t){switch(x(e,t,"IDAT"),n.colorType){case 0:F(e,t,2);break;case 2:F(e,t,6);break;case 3:if(Be(e,t,"PLTE"),t.dataLength>e.palette.size)throw C(t,`Invalid data length for color type ${n.colorType}: ${t.dataLength} > ${e.palette.size}`,t.offset+4+4);break;case 4:case 6:throw C(t,`Chunk invalid when color type has alpha (${n.colorType})`,t.offset+4+4)}let i=t.offset+4+4,r;switch(n.colorType){case 0:r=e.view.getUint16(i);break;case 2:r=[e.view.getUint16(i),e.view.getUint16(i+2),e.view.getUint16(i+4)];break;case 3:r=[];for(let o=0;o<t.dataLength;o++)r.push(e.view.getUint8(i+o));break}return{type:"tRNS",transparency:r}}var Ao=m(()=>{z()});var Ro={};M(Ro,{parseChunk:()=>Ff});function Ff(e,n,t){X(e,t,6);let i=t.offset+4+4,r=i+t.dataLength,o=i,a=new TextDecoder("latin1"),s;s=W(e,t,a,79,o,r,!0),o+=s.bytesRead;let f=s.text,l=e.view.getUint8(o);ue(e,t,l,o),o++,s=W(e,t,a,void 0,o,r,!1,!0),o+=s.bytesRead;let d=s.text;return{type:"zTXt",keyword:f,text:d}}var Mo=m(()=>{z();xe()});var Lo={};M(Lo,{Palette:()=>Zn,parseChunk:()=>zf});function zf(e,n,t){B(e,t),x(e,t,"bKGD"),x(e,t,"hIST"),x(e,t,"tRNS"),x(e,t,"IDAT");let i=t.offset+4;if(n.colorType===0||n.colorType===4)throw C(t,`Color type "${n.colorType}" cannot have a palette`,i);if(i+=4,t.dataLength===0)throw C(t,"Cannot have 0 entries",i);if(t.dataLength%3!==0)throw C(t,`Chunk length must be divisible by 3 (actual "${t.dataLength}")`,i);return t.dataLength/3>256&&N(e,C(t,`Too many entries (${t.dataLength/3} > 256)`,i)),t.dataLength/3>Math.pow(2,n.bitDepth)&&N(e,C(t,`Too many entries for bit depth (${t.dataLength/3} > 2^${n.bitDepth})`,i)),new Zn(e.view,t.offset+4+4,t.dataLength)}var Zn,Bo=m(()=>{z();Zn=class{constructor(n,t,i){this._view=n,this._paletteOffset=t,this._length=i}get size(){return this._length/3}getRgb(n){return this._checkIndex(n),new Uint8Array(this._view.buffer.slice(this._view.byteOffset+this._paletteOffset+n*3,this._view.byteOffset+this._paletteOffset+n*3+3))}setRgba(n,t,i){this._checkIndex(i);let r=this._paletteOffset+i*3;n[t]=this._view.getUint8(r),n[t+1]=this._view.getUint8(r+1),n[t+2]=this._view.getUint8(r+2),n[t+3]=255}_checkIndex(n){if(n<0||n*3>this._length-3)throw new Error(`Palette does not contain color index "${n}"`)}}});var Oo={};M(Oo,{decodePng:()=>Pf,readChunk:()=>Wo,readChunks:()=>No,verifyPngSignature:()=>Fo});function Fo(e){if(e.view.byteLength<7)throw new q(e,`Not enough bytes in file for png signature (${e.view.byteLength})`,0);if(!(e.view.getUint8(0)===137&&e.view.getUint8(1)===80&&e.view.getUint8(2)===78&&e.view.getUint8(3)===71&&e.view.getUint8(4)===13&&e.view.getUint8(5)===10&&e.view.getUint8(6)===26&&e.view.getUint8(7)===10)){let t=zo(Array.from(new Uint8Array(e.view.buffer).slice(e.view.byteOffset,e.view.byteOffset+8))),i=zo([137,80,78,71,13,10,26,10]);throw new q(e,`Png signature is not correct (${t} != ${i})`,0)}}function zo(e){return`0x${e.map(n=>n.toString(16).padStart(2,"0")).join("")}`}function $f(e){switch(e){case"bKGD":return Promise.resolve().then(()=>(Kr(),Yr));case"cHRM":return Promise.resolve().then(()=>(Jr(),Xr));case"eXIf":return Promise.resolve().then(()=>(eo(),Qr));case"gAMA":return Promise.resolve().then(()=>(no(),to));case"hIST":return Promise.resolve().then(()=>(ro(),io));case"iCCP":return Promise.resolve().then(()=>(ao(),oo));case"iTXt":return Promise.resolve().then(()=>(lo(),so));case"tIME":return Promise.resolve().then(()=>(ho(),fo));case"oFFs":return Promise.resolve().then(()=>(uo(),co));case"pCAL":return Promise.resolve().then(()=>(wo(),po));case"pHYs":return Promise.resolve().then(()=>(go(),_o));case"sBIT":return Promise.resolve().then(()=>(vo(),bo));case"sCAL":return Promise.resolve().then(()=>(mo(),yo));case"sPLT":return Promise.resolve().then(()=>(ko(),Eo));case"sRGB":return Promise.resolve().then(()=>(To(),Co));case"sTER":return Promise.resolve().then(()=>(xo(),So));case"tEXt":return Promise.resolve().then(()=>(Io(),Do));case"tRNS":return Promise.resolve().then(()=>(Ao(),Uo));case"zTXt":return Promise.resolve().then(()=>(Mo(),Ro));default:throw new Error(`Could not get decoder for chunk type "${e}"`)}}async function Pf(e,n={}){let t={view:new DataView(e.buffer,e.byteOffset,e.byteLength),image:void 0,palette:void 0,metadata:[],parsedChunks:new Set,warnings:[],info:[],options:n};Fo(t);let i=No(t);t.rawChunks=i;let r=jr(t,i[0]),o=Pt($t({},t),{header:r}),a;n&&n.parseChunkTypes?n.parseChunkTypes==="*"?a=Po:a=$o.concat(n.parseChunkTypes):a=$o;for(let s=1;s<i.length;s++){let f=i[s];switch(f.type){case"IHDR":N(o,C(f,"Multiple IHDR chunks not allowed",f.offset+4));break;case"IDAT":{let l=[f];for(;i.length>s+1&&i[s+1].type==="IDAT";)l.push(i[++s]);o.image={width:r.width,height:r.height,data:Br(o,r,l)};break}case"PLTE":o.palette=(await Promise.resolve().then(()=>(Bo(),Lo))).parseChunk(o,r,f);break;case"IEND":Nr(o,r,f);break;default:if(a.includes(f.type))try{o.metadata.push((await $f(f.type)).parseChunk(o,r,f))}catch(l){if(l instanceof ae)N(o,l);else throw l}else if(!Po.includes(f.type))if(f.isAncillary)o.info.push(`Unrecognized chunk type "${f.type}"`);else throw new q(o,`Unrecognized critical chunk type "${f.type}"`,f.offset+4);break}o.parsedChunks.add(f.type)}if(!o.image)throw new q(o,"Failed to decode, no IDAT chunk",0);return n&&n.force32&&o.image.data.BYTES_PER_ELEMENT===2&&(o.image.data=ci(o.image.data)),{image:o.image,details:{width:r.width,height:r.height,bitDepth:r.bitDepth,colorType:r.colorType,interlaceMethod:r.interlaceMethod},palette:o.palette,metadata:o.metadata,rawChunks:i,warnings:o.warnings,info:o.info}}function No(e){let n=[],t=8,i=!1,r=!1,o;for(;t<e.view.byteLength;){try{o=Wo(e,t)}catch(a){if(!r||!(a instanceof Error))throw a;N(e,new ae("Could not parse chunk after IEND: "+a.message,t))}t+=4+4+o.dataLength+4,n.push(o),i||(i=o.type==="IDAT"),r||(r=o.type==="IEND")}if(n[0].type!=="IHDR")throw new q(e,"First chunk is not IHDR",n[0].offset+4);if(n[n.length-1].type!=="IEND"&&N(e,new ae("Last chunk is not IEND",n[n.length-1].offset+4)),!i)throw new q(e,"No IDAT chunk",0);return n}function Wo(e,n){if(e.view.byteLength<n+4)throw new q(e,"EOF while reading chunk length",n);let t=e.view.getUint32(n);if(e.view.byteLength<n+4+4)throw new q(e,"EOF while reading chunk type",n);let i=String.fromCharCode(e.view.getUint8(n+4),e.view.getUint8(n+5),e.view.getUint8(n+6),e.view.getUint8(n+7));if(e.view.byteLength<n+4+4+t+4)throw new q(e,`EOF while reading chunk "${i}"`,n);let r=e.view.getUint32(n+4+4+t)>>>0,o=xt(e.view,n+4,4+t);return r!==o&&N(e,new ae(`CRC for chunk "${i}" at offset 0x${n.toString(16)} doesn't match (0x${r.toString(16)} != 0x${o.toString(16)})`,n)),{offset:n,type:i,dataLength:t,isAncillary:Gn(i,0),isPrivate:Gn(i,1),isSafeToCopy:Gn(i,3)}}function Gn(e,n){return!!(e.charCodeAt(n)&32)}var $o,Po,qo=m(()=>{ui();z();Pr();Wr();Vr();qn();$o=Object.freeze(["tRNS"]),Po=Object.freeze(["bKGD","cHRM","eXIf","gAMA","hIST","iCCP","iTXt","tIME","oFFs","pCAL","pHYs","sBIT","sCAL","sPLT","sRGB","sTER","tEXt","tRNS","zTXt"])});var De,sn=m(()=>{De=class{constructor(n){this.offset=0,this.array=new Uint8Array(n),this.view=new DataView(this.array.buffer,this.array.byteOffset,this.array.byteLength)}writeUint8(n){this.view.setUint8(this.offset,n),this.offset+=1}writeUint16(n){this.view.setUint16(this.offset,n),this.offset+=2}writeUint32(n){this.view.setUint32(this.offset,n),this.offset+=4}writeArray(n){this.array.set(n,this.array.byteOffset+this.offset),this.offset+=n.length}assertAtEnd(){if(this.offset!==this.array.length)throw new Error("Writing finished before expected length of stream")}}});function Ho(e,n){e.writeUint8(n.charCodeAt(0)),e.writeUint8(n.charCodeAt(1)),e.writeUint8(n.charCodeAt(2)),e.writeUint8(n.charCodeAt(3))}function ln(e,n){let t=new De(4+4+n.length+4);if(t.writeUint32(n.length),e.length!==4)throw new Error(`Cannot encode a chunk type of length ${e.length}`);return Ho(t,e),t.writeArray(n),t.writeUint32(xt(t.view,4,4+n.length)),t.assertAtEnd(),t.array}function fe(e,n,t){let i=new De(4+4+n+4);if(i.writeUint32(n),e.length!==4)throw new Error(`Cannot encode a chunk type of length ${e.length}`);return Ho(i,e),t(i),i.writeUint32(xt(i.view,4,4+n)),i.assertAtEnd(),i.array}var He=m(()=>{sn();qn()});function Zo(e,n){let t=Nf(e,n),i=new De(t);Wf(e,n,i);let r=Lr(i.array);return ln("IDAT",r)}function Nf(e,n){if(e.bitDepth<8)throw new Error("Only bit depth 8 and 16 is supported currently");if(n.data.BYTES_PER_ELEMENT===2&&e.bitDepth===8)throw new Error("16 to 8 bit conversion isn't supported yet");if(e.interlaceMethod!==0)throw new Error("Only interlace method 0 is supported currently");let t;switch(e.colorType){case 0:t=1;break;case 2:t=3;break;case 3:t=1;break;case 4:t=2;break;case 6:t=4;break}let i=e.bitDepth===16?2:1,r=t*i;return(1+r*n.width)*n.height}function Wf(e,n,t){let i=0,r=0,o=0;if(e.colorType===3){if(!e.palette)throw new Error("Cannot encode indexed file without palette");if(n.data.BYTES_PER_ELEMENT===2)throw new Error("Cannot encode indexed file from 16-bit image");for(;o<n.height;o++)for(t.writeUint8(0),r=0;r<n.width;r++)t.writeUint8(e.palette.get(n.data[i]<<24|n.data[i+1]<<16|n.data[i+2]<<8|n.data[i+3])),i+=4;return}let a;if(e.options.filterPattern){if(e.options.filterPattern.length===0)throw new Error("Filter pattern with 0 entries");a=e.options.filterPattern}let s=4*n.data.BYTES_PER_ELEMENT,f=[];for(let d of[0,1,2,3,4])f[d]=qf(s,s*n.width,d);let l=Go(e.colorType);for(;o<n.height;o++){let d=a?a[o%a.length]:Of(e.colorType,n,o*n.width*4,f),h=new Uint8Array(n.data.buffer,n.data.byteOffset,n.data.byteLength);t.writeUint8(d);let u=0,c=0;for(r=0;r<n.width;r++){for(c of l)for(u=n.data.BYTES_PER_ELEMENT-1;u>=0;u--)t.writeUint8(f[d](h,(i+c)*n.data.BYTES_PER_ELEMENT+u,r===0));i+=4}}}function Of(e,n,t,i){let r=[],o=4*n.data.BYTES_PER_ELEMENT;for(let f of[0,1,2,3,4]){let l=0,d=Go(e),h=new Uint8Array(n.data.buffer,n.data.byteOffset,n.data.byteLength),u=0,c=0;for(let p=t;p<t+n.width*4;p+=4)for(u of d)for(c=n.data.BYTES_PER_ELEMENT-1;c>=0;c--)l+=i[f](h,(p+u)*n.data.BYTES_PER_ELEMENT+c,p===t);r[f]=l}let a=0,s=r[0];for(let f of[1,2,3,4])r[f]<s&&(a=f,s=r[f]);return a}function qf(e,n,t){let i=0,r=0,o=0;switch(t){case 0:return(a,s)=>a[s];case 1:return(a,s,f)=>(i=f?-1:s-e,(a[s]-(i<0?0:a[s-e])+256)%256);case 2:return(a,s)=>(r=s-n,(a[s]-(r<0?0:a[r])+256)%256);case 3:return(a,s,f)=>(i=f?-1:s-e,r=s-n,(a[s]-Math.floor(((i<0?0:a[i])+(r<0?0:a[r]))/2)+256)%256);case 4:return(a,s,f)=>(i=f?-1:s-e,r=s-n,o=f?-1:s-e-n,(a[s]-Tt(i<0?0:a[i],r<0?0:a[r],o<0?0:a[o])+256)%256)}}function Go(e){switch(e){case 0:return[0];case 2:return[0,1,2];case 4:return[0,3];case 6:return[0,1,2,3]}}var jo=m(()=>{on();sn();Wn();He()});function Vo(){return ln("IEND",new Uint8Array(0))}var Yo=m(()=>{He()});function Ko(e,n){if(n.width<=0||n.height<=0)throw new Error(`Invalid dimensions ${n.width}x${n.height}`);return fe("IHDR",13,t=>{t.writeUint32(n.width),t.writeUint32(n.height),t.writeUint8(e.bitDepth),t.writeUint8(e.colorType),t.writeUint8(0),t.writeUint8(0),t.writeUint8(e.interlaceMethod)})}var Xo=m(()=>{He()});var Jo={};M(Jo,{encodeChunk:()=>Hf});function Hf(e,n){switch(e.colorType){case 0:{if(e.firstTransparentColor===void 0)throw new Error("Cannot write tRNS for grayscale without any transparent colors");let t=e.firstTransparentColor;return fe("tRNS",2,i=>{n.data.BYTES_PER_ELEMENT===2?i.writeUint16(t>>48&65535):i.writeUint16(t>>24&255)})}case 3:{if(!e.palette)throw new Error("Cannot encode tRNS chunk for indexed image without palette");return fe("tRNS",e.palette.size,t=>{for(let i of e.colorSet)t.writeUint8(i&255)})}case 2:{if(e.firstTransparentColor===void 0)throw new Error("Cannot write tRNS for True color without any transparent colors");let t=e.firstTransparentColor;return fe("tRNS",6,i=>{n.data.BYTES_PER_ELEMENT===2?(i.writeUint16(t>>48&65535),i.writeUint16(t>>32&65535),i.writeUint16(t>>16&65535)):(i.writeUint16(t>>24&255),i.writeUint16(t>>16&255),i.writeUint16(t>>8&255))})}default:throw new Error(`Cannot encode tRNS chunk for color type "${e.colorType}"`)}}var Qo=m(()=>{He()});var ea={};M(ea,{encodeChunk:()=>Zf});function Zf(e,n){if(e.bitDepth===16||n.data.BYTES_PER_ELEMENT===2)throw new Error("Cannot encode 16 bit images using indexed color type");if(e.colorSet.size>Math.pow(2,e.bitDepth))throw new Error(`Too many colors ${e.colorSet.size} to encode into indexed image (2^${e.bitDepth} = ${Math.pow(2,e.bitDepth)})`);let t=fe("PLTE",e.colorSet.size*3,r=>{for(let o of e.colorSet.values())r.writeUint8(o>>24&255),r.writeUint8(o>>16&255),r.writeUint8(o>>8&255)}),i=new Map;for(let r of e.colorSet.values())i.set(r,i.size);return{chunkData:t,palette:i}}var ta=m(()=>{He()});var jn={};M(jn,{encodeChunk:()=>Gf});function Gf(e,n,t,i){if(t.length===0||t.length>79)throw new Fe(`tEXt: Invalid keyword length: 0 < ${t.length} < 80`,0);let r=t.length+1+i.length;return fe("tEXt",r,o=>{let a=0;for(;a<t.length;a++)o.writeUint8(t.charCodeAt(a));for(o.writeUint8(0),a=0;a<i.length;a++)o.writeUint8(i.charCodeAt(a))})}var Vn=m(()=>{Wt();He()});var na={};M(na,{encodePng:()=>Vf});function jf(e){switch(e){case"tRNS":return Promise.resolve().then(()=>(Qo(),Jo));default:throw new Error(`Could not get encoder for chunk type "${e}"`)}}async function Vf(e,n={}){if(e.data.length!==e.width*e.height*4)throw new Fe(`Provided image data length (${e.data.length}) is not expected length (${e.width*e.height*4})`,Math.min(e.data.length,e.width*e.height*4)-1);let t=[];t.push(Yf());let i=Kf(e,n);if(t.push(Ko(i,e)),i.colorType===3){let s=(await Promise.resolve().then(()=>(ta(),ea))).encodeChunk(i,e);i.palette=s.palette,t.push(s.chunkData)}if(i.useTransparencyChunk&&t.push((await jf("tRNS")).encodeChunk(i,e)),t.push(Zo(i,e)),(n==null?void 0:n.ancillaryChunks)===void 0)t.push((await Promise.resolve().then(()=>(Vn(),jn))).encodeChunk(i,e,"Software","@lunapaint/png-codec"));else for(let s of n.ancillaryChunks)switch(s.type){case"tEXt":t.push((await Promise.resolve().then(()=>(Vn(),jn))).encodeChunk(i,e,s.keyword,s.text));break;default:throw new Error(`Cannot encode chunk type "${s.type}"`)}t.push(Vo());let r=t.reduce((s,f)=>s+f.length,0),o=new Uint8Array(r),a=0;for(let s of t)o.set(s,a),a+=s.length;return{data:o,warnings:i.warnings,info:i.info}}function Yf(){let e=new De(8);return e.writeUint8(137),e.writeUint8(80),e.writeUint8(78),e.writeUint8(71),e.writeUint8(13),e.writeUint8(10),e.writeUint8(26),e.writeUint8(10),e.assertAtEnd(),e.array}function Kf(e,n={}){let t=[],i=[],o=e.width*e.height*4,a=new Set,s=new Set,f=0;if(e.data.BYTES_PER_ELEMENT===2)for(let h=0;h<o;h+=4)f=e.data[h]<<48|e.data[h+1]<<32|e.data[h+2]<<16|e.data[h+3],e.data[h+3]<65535&&s.add(f),a.add(f);else for(let h=0;h<o;h+=4)f=e.data[h]<<24|e.data[h+1]<<16|e.data[h+2]<<8|e.data[h+3],e.data[h+3]<255&&s.add(f),a.add(f);let l=n.colorType;l===void 0&&(a.size>256||e.data.BYTES_PER_ELEMENT===2?l=2:l=3);let d;switch(l){case 0:case 2:d=s.size===1,!d&&s.size>1&&(l=l===2?6:4,n.colorType===2&&hi({options:n,warnings:t},new at(`Cannot encode image as color type Truecolor as it contains ${s.size} transparent colors`,0)));break;case 3:d=s.size>0;break;default:d=!1}return n.colorType===void 0&&i.push(`Using color type ${l}`),{colorType:l,bitDepth:e.data.BYTES_PER_ELEMENT===2?16:8,interlaceMethod:0,colorSet:a,transparentColorCount:s.size,firstTransparentColor:s.size>0?s.values().next().value:void 0,useTransparencyChunk:d,options:n,warnings:t,info:i}}var ia=m(()=>{sn();jo();Yo();Xo();Wt()});var ra={};M(ra,{DecodeError:()=>q,DecodeWarning:()=>ae,EncodeError:()=>Fe,EncodeWarning:()=>at,decodePng:()=>Xf,encodePng:()=>Jf});async function Xf(e,n){return(await Promise.resolve().then(()=>(qo(),Oo))).decodePng(e,n)}async function Jf(e,n){return(await Promise.resolve().then(()=>(ia(),na))).encodePng(e,n)}var oa=m(()=>{z();Wt()});var aa={};M(aa,{DecodeError:()=>Ie,DecodeWarning:()=>j,handleWarning:()=>J});function J(e,n){if(e.options.strictMode)throw n;e.warnings.push(n)}var Ie,j,It=m(()=>{Ie=class extends Error{constructor(n,t,i){super(t);this.offset=i,this.partiallyDecodedImage={details:{header:n.header,footer:n.footer,imageId:n.identificationField,developerDirectory:n.developerDirectory,extensionArea:n.extensionArea},warnings:n.warnings}}},j=class extends Error{constructor(n,t){super(n);this.offset=t}}});var Yn,sa=m(()=>{Yn=class{constructor(n,t){this.data=n,this._le=t,this.offset=0,this.view=new DataView(n.buffer,n.byteOffset,n.byteLength)}readUint8(){return this.view.getUint8(this.offset++)}readUint16(){let n=this.view.getUint16(this.offset,this._le);return this.offset+=2,n}readUint32(){let n=this.view.getUint32(this.offset,this._le);return this.offset+=4,n}}});function Ue(e,n,t,i){let r=[],o=0,a=0,s=e.reader.offset;for(;a<t;a++){try{o=e.reader.view.getUint8(e.reader.offset)}catch(f){throw f instanceof Error&&f.message==="Offset is outside the bounds of the DataView"&&J(e,new j("EOF while reading text",e.reader.offset)),f}if(!i&&o===0)break;e.reader.offset++,r.push(o)}return e.reader.offset=s+t,n?n.decode(new Uint8Array(r)):String.fromCharCode(...r)}var la=m(()=>{It()});function da(e){return e===1||e===2||e===3||e===9||e===10||e===11}function fa(e){return e===15||e===16||e===24||e===32}function ha(e,n){return n===1||n===9?e===8:n===3||n===11?e===8||e===16:e===15||e===16||e===24||e===32}var ca=m(()=>{});var _a={};M(_a,{decodeTga:()=>Qf});async function Qf(e,n={}){var t,i;let r={reader:new Yn(e,!0),hasAlpha:!1,ambiguousAlpha:!1,options:n,warnings:[]},o=eh(r),a=Pt($t({},r),{header:o});a.identificationField=Ue(a,void 0,a.header.idLength);let s=a.reader.offset;return a.footer=hh(a),a.extensionArea=sh(a),a.developerDirectory=lh(a),a.reader.offset=s,((t=a.header.colorMap)===null||t===void 0?void 0:t.type)===1&&(a.colorMap=th(a,a.header.colorMap)),a.hasAlpha=a.colorMap&&((i=a.header.colorMap)===null||i===void 0?void 0:i.depth)===32||(a.header.attributeBitsPerPixel>0||a.header.bitDepth===32)&&(a.extensionArea===void 0||a.extensionArea.attributesType>2),a.ambiguousAlpha=a.hasAlpha&&a.header.attributeBitsPerPixel===0,a.image=nh(a,a.reader.offset),{image:a.image,details:{header:a.header,imageId:a.identificationField,footer:a.footer,extensionArea:a.extensionArea,developerDirectory:a.developerDirectory},warnings:a.warnings}}function eh(e){let n=e.reader.readUint8(),t=e.reader.readUint8(),i;t===0||t===1?i=t:(J(e,new j("Color map type unrecognized",e.reader.offset-1)),i=2);let r=e.reader.readUint8();if(!da(r))throw new Ie(e,`Invalid image type "${r}"`,e.reader.offset-1);i===1&&r!==1&&r!==9&&J(e,new j(`Image type "${r}" cannot have a color map`,e.reader.offset-2));let o=e.reader.readUint16(),a=e.reader.readUint16(),s=e.reader.readUint8();if(i===1&&(o>=a&&J(e,new j(`Color map origin "${o}" is greater than color map length "${a}"`,e.reader.offset-5)),!fa(s)))throw new Ie(e,`Unsupported color map bit depth "${s}"`,e.reader.offset-1);let f=e.reader.readUint16(),l=e.reader.readUint16(),d=e.reader.readUint16(),h=e.reader.readUint16(),u=e.reader.readUint8();if(!ha(u,r))throw new Ie(e,`Unsupported TGA bit depth "${u}" with image type ${r}`,16);let c=e.reader.readUint8(),p=(c&15)>>0,k=(c&48)>>4;return k===1&&J(e,new j("This image is encoded using a bottom right screen origin, many image editors won't read this correctly",e.reader.offset-1)),k===3&&J(e,new j("This image is encoded using a top right screen origin, many image editors won't read this correctly",e.reader.offset-1)),{idLength:n,colorMap:i!==0?{type:i,depth:s,length:a,origin:o}:void 0,imageType:r,origin:{x:f,y:l},width:d,height:h,bitDepth:u,imageDescriptor:c,attributeBitsPerPixel:p,screenOrigin:k}}function th(e,n){let t=e.reader.offset,i=Math.ceil(n.depth/8);e.reader.offset+=n.length*i;let r;switch(n.depth){case 15:r=dn;break;case 16:e.hasAlpha?r=ua:r=dn;break;case 24:r=pa;break;case 32:r=wa;break}return(o,a,s,f)=>{let l=s.getUint8(f);return r(o,a,e.reader.view,t+l*i),1}}function nh(e,n){let t={width:e.header.width,height:e.header.height,data:new Uint8Array(e.header.width*e.header.height*4)},i;if(e.colorMap)i=e.colorMap;else switch(e.header.bitDepth){case 8:i=rh;break;case 15:i=dn;break;case 16:e.header.imageType===11||e.header.imageType===3?i=oh:e.hasAlpha?i=ua:i=dn;break;case 24:i=pa;break;case 32:e.hasAlpha?i=wa:i=ah;break}let r=e.reader.view;if(e.header.imageType&8){let o=ih(e);r=new DataView(o.buffer,o.byteOffset,o.length),n=0}switch(e.header.screenOrigin){case 0:{let o=0;for(let a=t.height-1;a>=0;a--){o=e.header.width*a*4;for(let s=0;s<t.width;s++)n+=i(t.data,o,r,n),o+=4}break}case 1:{let o=0;for(let a=t.height-1;a>=0;a--){o=(e.header.width*a+(e.header.width-1))*4;for(let s=0;s<t.width;s++)n+=i(t.data,o,r,n),o-=4}break}case 2:{let o=0;for(let a=0;a<t.height;a++)for(let s=0;s<t.width;s++)n+=i(t.data,o,r,n),o+=4;break}case 3:{let o=0;for(let a=0;a<t.height;a++){o=(e.header.width*a+(e.header.width-1))*4;for(let s=0;s<t.width;s++)n+=i(t.data,o,r,n),o-=4}break}}if(e.ambiguousAlpha&&!e.options.strictMode&&e.options.detectAmbiguousAlphaChannel){let o=!1;for(let a=3;a<t.width*t.height*4;a+=4)t.data[a]>0&&(o=!0);if(!o){J(e,new j("Image has ambiguous alpha and is fully transparent, alpha has been disabled",-1));for(let a=3;a<t.width*t.height*4;a+=4)t.data[a]=255}}return t}function ih(e){let n=Math.ceil(e.header.bitDepth/8),t=new Uint8Array(e.header.width*e.header.height*n),i=0,r=0,o=0,a=0,s=0;for(;o<t.length;)if(i=e.reader.readUint8(),r=(i&127)+1,i&128){for(a=0;a<n;a++)for(i=e.reader.readUint8(),s=0;s<r;s++)t[o+s*n+a]=i;o+=r*n}else{r*=n;for(let f=0;f<r;f++)t[o++]=e.reader.readUint8()}return t}function rh(e,n,t,i){return e[n]=t.getUint8(i),e[n+1]=e[n],e[n+2]=e[n],e[n+3]=255,1}function oh(e,n,t,i){return e[n]=t.getUint8(i),e[n+1]=e[n],e[n+2]=e[n],e[n+3]=t.getUint8(i+1),2}function dn(e,n,t,i){return ge=t.getUint16(i,!0),e[n]=ge>>10&31,e[n+1]=ge>>5&31,e[n+2]=ge&31,e[n]=e[n]<<3|e[n]>>2,e[n+1]=e[n+1]<<3|e[n+1]>>2,e[n+2]=e[n+2]<<3|e[n+2]>>2,e[n+3]=255,2}function ua(e,n,t,i){return ge=t.getUint16(i,!0),e[n]=ge>>10&31,e[n+1]=ge>>5&31,e[n+2]=ge&31,e[n]=e[n]<<3|e[n]>>2,e[n+1]=e[n+1]<<3|e[n+1]>>2,e[n+2]=e[n+2]<<3|e[n+2]>>2,e[n+3]=ge&32768?0:255,2}function pa(e,n,t,i){return e[n]=t.getUint8(i+2),e[n+1]=t.getUint8(i+1),e[n+2]=t.getUint8(i),e[n+3]=255,3}function wa(e,n,t,i){return e[n]=t.getUint8(i+2),e[n+1]=t.getUint8(i+1),e[n+2]=t.getUint8(i),e[n+3]=t.getUint8(i+3),4}function ah(e,n,t,i){return e[n]=t.getUint8(i+2),e[n+1]=t.getUint8(i+1),e[n+2]=t.getUint8(i),e[n+3]=255,4}function sh(e){var n;if(((n=e.footer)===null||n===void 0?void 0:n.extensionAreaOffset)===void 0||e.footer.extensionAreaOffset===0)return;e.reader.offset=e.footer.extensionAreaOffset;let t=e.reader.readUint16();t!==495&&J(e,new j("TGA file is a version other than v2",e.reader.offset-2));let i=Ue(e,void 0,41).trim()||void 0,r=Ue(e,void 0,324).trim()||void 0,o=dh(e),a=Ue(e,void 0,41).trim()||void 0,s=fh(e),f=Ue(e,void 0,41).trim()||void 0,l=e.reader.readUint8()/100,d=Ue(e,void 0,2),h;l===0&&(d===" "||d.length===0)?h=void 0:h=`${l}${d}`;let u=e.reader.readUint8(),c=e.reader.readUint8(),p=e.reader.readUint8(),k=e.reader.readUint8(),b;u===0&&c===0&&p===0&&k===0?b=void 0:b=new Uint8Array([c,p,k,u]);let _=e.reader.readUint16(),y=e.reader.readUint16(),g;y===0?g=void 0:g=_/y;let w=e.reader.readUint16(),I=e.reader.readUint16(),$;I===0?$=void 0:$=w/I;let v=e.reader.readUint32(),U=e.reader.readUint32(),D=e.reader.readUint32(),E=e.reader.readUint8();return{extensionSize:t,authorName:i,authorComments:r,dateTimestamp:o,jobName:a,jobTime:s,softwareId:f,softwareVersion:h,keyColor:b,aspectRatio:g,gamma:$,colorCorrectionOffset:v,postageStampOffset:U,scanLineOffset:D,attributesType:E}}function lh(e){var n;if(((n=e.footer)===null||n===void 0?void 0:n.developerDirectoryOffset)===void 0||e.footer.developerDirectoryOffset===0)return[];e.reader.offset=e.footer.developerDirectoryOffset;let t=e.reader.readUint16(),i=[];for(let r=0;r<t;r++){let o=e.reader.readUint16(),a=e.reader.readUint32(),s=e.reader.readUint32();i.push({tag:o,offset:a,length:s})}return i}function dh(e){let n=e.reader.readUint16(),t=e.reader.readUint16(),i=e.reader.readUint16(),r=e.reader.readUint16(),o=e.reader.readUint16(),a=e.reader.readUint16();if(!(n===0&&t===0&&i===0&&r===0&&o===0&&a===0))return new Date(i,n,t,r,o,a)}function fh(e){let n=e.reader.readUint16(),t=e.reader.readUint16(),i=e.reader.readUint16();if(!(n===0&&t===0&&i===0))return{hours:n,minutes:t,seconds:i}}function hh(e){if(e.reader.offset=e.reader.view.byteLength-26+8,Ue(e,void 0,17)!=="TRUEVISION-XFILE."||e.reader.readUint8()!==0)return{extensionAreaOffset:0,developerDirectoryOffset:0};e.reader.offset=e.reader.view.byteLength-26;let t=e.reader.readUint32();t>=e.reader.view.byteLength&&(J(e,new j(`Extension area offset "${t}" is invalid`,e.reader.offset-4)),t=0);let i=e.reader.readUint32();return i>=e.reader.view.byteLength&&(J(e,new j(`Developer directory offset "${i}" is invalid`,e.reader.offset-4)),i=0),{extensionAreaOffset:t,developerDirectoryOffset:i}}var ge,ga=m(()=>{It();sa();la();ca();ge=0});function Je(e,n){if(e.options.strictMode)throw n;e.warnings.push(n)}var he,Ze,Kn=m(()=>{he=class extends Error{constructor(n,t){super(n);this.offset=t}},Ze=class extends Error{constructor(n,t){super(n);this.offset=t}}});function ba(e,n={}){let t=[],i=[],r={options:n,warnings:t};if(e.width>65535)throw new he(`Image width is out of range (${e.width} > 65535)`,-1);if(e.height>65535)throw new he(`Image height is out of range (${e.height} > 65535)`,-1);if(e.data.length!==e.width*e.height*4)throw new he(`Provided image data length (${e.data.length}) is not expected length (${e.width*e.height*4})`,Math.min(e.data.length,e.width*e.height*4)-1);if(n.imageId&&n.imageId.length>255)throw new he(`Image ID length is out of range (${n.imageId.length} > 255)`,-1);if(n.origin&&(n.origin.x||0)>65535)throw new he(`X origin is out of range (${n.origin.x} > 65535)`,-1);if(n.origin&&(n.origin.y||0)>65535)throw new he(`Y origin is out of range (${n.origin.y} > 65535)`,-1);if(n.screenOrigin===1&&Je(r,new Ze("This image is encoded using a bottom right screen origin, many image editors won't read this correctly",17)),n.screenOrigin===3&&Je(r,new Ze("This image is encoded using a top right screen origin, many image editors won't read this correctly",17)),n.bitDepth!==void 0&&n.imageType===void 0||n.bitDepth===void 0&&n.imageType!==void 0)throw new he("Bit depth and image type options must be used together",-1);let o=n.imageType,a=n.bitDepth,s;if(a===24&&ch(e)&&Je({options:n,warnings:t},new Ze("Cannot encode 24 bit image without data loss as it contains transparent colors",0)),o===9||o===1){let f=va(e);if(!f.colorMap)throw new he("Image has too many colors to encode using a color map",-1);s=f.colorMap}if(!a){let f=va(e);a=f.bitDepth,o=f.imageType,s=f.colorMap}if(!o)throw new Error("No ImageType set");return{bitDepth:a,imageType:o,colorMap:s,imageId:n.imageId||"",options:n,warnings:t,info:i,image:e}}function ch(e){let t=e.width*e.height*4,i=!1;for(let r=0;r<t;r+=4)i||(i=e.data[r+3]<255);return i}function va(e){let t=e.width*e.height*4,i=!1,r=!1,o=!1,a=!1,s=new Set;for(let f=0;f<t;f+=4)i||(i=e.data[f+3]>0&&e.data[f+3]<255),r||(r=e.data[f+3]<255),o||o||(o=!fn(e.data[f])||!fn(e.data[f+1])||!fn(e.data[f+2])||!fn(e.data[f+3])),a||(a=e.data[f]!==e.data[f+1]||e.data[f]!==e.data[f+2]),s.size<256&&s.add((e.data[f]<<24)+(e.data[f+1]<<16)+(e.data[f+2]<<8)+e.data[f+3]);if(s.size<255){let f=new Map,l=0;for(let h of s)f.set(h,l++);let d;return o?r?d={colorToIndexMap:f,bitDepth:32}:d={colorToIndexMap:f,bitDepth:24}:r?d={colorToIndexMap:f,bitDepth:32}:d={colorToIndexMap:f,bitDepth:15},{imageType:9,bitDepth:8,colorMap:d}}return a?o?r?{imageType:10,bitDepth:32}:{imageType:10,bitDepth:24}:r?i?{imageType:10,bitDepth:32}:{imageType:10,bitDepth:16}:{imageType:10,bitDepth:15}:r?{imageType:11,bitDepth:16}:{imageType:11,bitDepth:8}}function fn(e){return(e>>5&7)===(e&7)}var ya=m(()=>{Kn()});var Qe,ma=m(()=>{Qe=class{constructor(n,t){this._le=t,this.offset=0,this.array=new Uint8Array(n),this.view=new DataView(this.array.buffer,this.array.byteOffset,this.array.byteLength)}writeUint8(n){this.view.setUint8(this.offset,n),this.offset+=1}writeUint16(n){this.view.setUint16(this.offset,n,this._le),this.offset+=2}assertAtEnd(){if(this.offset!==this.array.length)throw new Error("Writing finished before expected length of stream")}}});function Ea(e,n){let t=Math.ceil(e.bitDepth/8),i=t+1,r=new Uint8Array(e.image.width*e.image.height*i),o=0,a=0,s=1,f=0,l=!1,d=0,h=0,u=!1;for(let c=t;c<n.length;c+=t){let p=!1;for(f=0;f<t;f++)p||(p=n[a+f]!==n[c+f]);if(p){for(;s>0;){for(l=s===1,u&&l?(d=r[h]&127,d<127?r[h]=d+1:(r[o]=Math.min(s,128)-1,h=o,o++)):(r[o]=Math.min(s,128)-1|(l?0:128),h=o,o++),f=0;f<t;f++)r[o+f]=n[a+f];o+=t,u=l,s-=128}a=c,s=1}else s++}for(;s>0;){for(l=s===1,u&&l?(d=r[h]&127,d<127?r[h]=d+1:(r[o]=Math.min(s,128)-1,h=o,o++)):(r[o]=Math.min(s,128)-1|(l?0:128),h=o,o++),f=0;f<t;f++)r[o+f]=n[a+f];o+=t,s-=128}return o-1>n.length&&Je(e,new Ze("RLE encoded was used but it is larger than unencoded would be",-1)),r.slice(0,o)}var ka=m(()=>{Kn()});var Da={};M(Da,{encodeTga:()=>uh});async function uh(e,n={}){let t=ba(e,n),i=[];i.push(ph(t)),t.imageId.length>0&&i.push(wh(t)),t.colorMap&&i.push(_h(t)),i.push(gh(t));let r=i.reduce((s,f)=>s+f.length,0),o=new Uint8Array(r),a=0;for(let s of i)o.set(s,a),a+=s.length;return{data:o,warnings:t.warnings,info:t.info}}function ph(e){var n,t,i,r,o,a,s;let f=new Qe(18,!0);f.writeUint8(e.imageId.length),f.writeUint8(e.colorMap?1:0),f.writeUint8(e.imageType),f.writeUint16(0),f.writeUint16((t=(n=e.colorMap)===null||n===void 0?void 0:n.colorToIndexMap.size)!==null&&t!==void 0?t:0),f.writeUint8((r=(i=e.colorMap)===null||i===void 0?void 0:i.bitDepth)!==null&&r!==void 0?r:0),f.writeUint16(((o=e.options.origin)===null||o===void 0?void 0:o.x)||0),f.writeUint16(((a=e.options.origin)===null||a===void 0?void 0:a.y)||0),f.writeUint16(e.image.width),f.writeUint16(e.image.height),f.writeUint8(e.bitDepth);let l=0;e.bitDepth===32&&(l=8);let d=l&15|((s=e.options.screenOrigin)!==null&&s!==void 0?s:0)<<4&48;return f.writeUint8(d),f.assertAtEnd(),f.array}function wh(e){let n=new Qe(e.imageId.length,!0);for(let t=0;t<e.imageId.length;t++)n.writeUint8(e.imageId.charCodeAt(t));return n.assertAtEnd(),n.array}function _h(e){let n=e.colorMap;if(!n)throw new Error("Cannot write color map undefined");let t=Math.ceil(n.bitDepth/8),i=new Qe(n.colorToIndexMap.size*t,!0),r;switch(n.bitDepth){case 15:r=Ca;break;case 16:r=Ta;break;case 24:r=Sa;break;case 32:r=xa;break;default:throw new Error(`Unsupported bit depth for color map "${n.bitDepth}"`)}let o=Array.from(n.colorToIndexMap.entries()).sort((a,s)=>a[1]-s[1]).map(a=>a[0]);for(let a of o)r(i,new Uint8Array([a>>24&255,a>>16&255,a>>8&255,a&255]),0);return i.assertAtEnd(),i.array}function gh(e){var n;let t=Math.ceil(e.bitDepth/8),i=new Qe(e.image.width*e.image.height*t,!0),r=0,o;if(e.colorMap){let a=e.colorMap;o=(s,f,l)=>{let d=a.colorToIndexMap.get((f[l]<<24)+(f[l+1]<<16)+(f[l+2]<<8)+f[l+3]);s.writeUint8(d)}}else switch(e.bitDepth){case 8:if(e.imageType===3||e.imageType===11)o=bh;else throw new Error(`Unsupported image type (${e.imageType}) with bit depth (${e.bitDepth})`);break;case 15:o=Ca;break;case 16:e.imageType===3||e.imageType===11?o=vh:o=Ta;break;case 24:o=Sa;break;case 32:o=xa;break;default:throw new Error("NYI")}switch((n=e.options.screenOrigin)!==null&&n!==void 0?n:0){case 0:for(let a=e.image.height-1;a>=0;a--){r=e.image.width*a*4;for(let s=0;s<e.image.width;s++)o(i,e.image.data,r),r+=4}break;case 1:for(let a=e.image.height-1;a>=0;a--){r=(e.image.width*a+(e.image.width-1))*4;for(let s=0;s<e.image.width;s++)o(i,e.image.data,r),r-=4}break;case 2:for(let a=0;a<e.image.height;a++){r=e.image.width*a*4;for(let s=0;s<e.image.width;s++)o(i,e.image.data,r),r+=4}break;case 3:for(let a=0;a<e.image.height;a++){r=(e.image.width*a+(e.image.width-1))*4;for(let s=0;s<e.image.width;s++)o(i,e.image.data,r),r-=4}break}return i.assertAtEnd(),e.imageType&8?Ea(e,i.array):i.array}function bh(e,n,t){e.writeUint8(n[t])}function Ca(e,n,t){e.writeUint16((n[t+0]>>3&31)<<10|(n[t+1]>>3&31)<<5|(n[t+2]>>3&31)<<0)}function Ta(e,n,t){e.writeUint16((n[t+0]>>3&31)<<10|(n[t+1]>>3&31)<<5|(n[t+2]>>3&31)<<0|(n[t+3]===255?1<<15:0))}function vh(e,n,t){e.writeUint8(n[t]),e.writeUint8(n[t+3])}function Sa(e,n,t){e.writeUint8(n[t+2]),e.writeUint8(n[t+1]),e.writeUint8(n[t+0])}function xa(e,n,t){e.writeUint8(n[t+2]),e.writeUint8(n[t+1]),e.writeUint8(n[t+0]),e.writeUint8(n[t+3])}var Ia=m(()=>{ya();ma();ka()});var Ua={};M(Ua,{DecodeError:()=>Ie,DecodeWarning:()=>j,decodeTga:()=>yh,encodeTga:()=>mh});async function yh(e,n){return(await Promise.resolve().then(()=>(ga(),_a))).decodeTga(e,n)}async function mh(e,n){return(await Promise.resolve().then(()=>(Ia(),Da))).encodeTga(e,n)}var Aa=m(()=>{It()});var Ba=oe(et=>{"use strict";var Eh=et&&et.__awaiter||function(e,n,t,i){function r(o){return o instanceof t?o:new t(function(a){a(o)})}return new(t||(t=Promise))(function(o,a){function s(d){try{l(i.next(d))}catch(h){a(h)}}function f(d){try{l(i.throw(d))}catch(h){a(h)}}function l(d){d.done?o(d.value):r(d.value).then(s,f)}l((i=i.apply(e,n||[])).next())})};Object.defineProperty(et,"__esModule",{value:!0});et.activateInspectImageFileContribution=void 0;var Ut=require("path"),be=require("vscode"),kh=(oa(),Nt(ra)),Ch=(z(),Nt(fi)),Th=(Aa(),Nt(Ua)),Sh=(It(),Nt(aa));function xh(e){e.subscriptions.push(be.commands.registerCommand("luna.file.inspectImageFile",n=>Eh(this,void 0,void 0,function*(){var t,i;if(!n){let o=(t=be.window.tabGroups.activeTabGroup.activeTab)===null||t===void 0?void 0:t.input;if(o&&"uri"in o?n=o.uri:n=(i=be.window.activeTextEditor)===null||i===void 0?void 0:i.document.uri,!n||(0,Ut.extname)(n.fsPath)!==".png"&&(0,Ut.extname)(n.fsPath)!==".tga")return}let r=(0,Ut.extname)(n.fsPath);switch(r){case".png":{let o=yield be.workspace.fs.readFile(n),a,s;try{a=yield(0,kh.decodePng)(o,{parseChunkTypes:"*"})}catch(l){s=l}let f=yield be.workspace.openTextDocument({content:Dh(n,a,s),language:"markdown"});yield be.window.showTextDocument(f);break}case".tga":case".tpic":{let o=yield be.workspace.fs.readFile(n),a,s;try{a=yield(0,Th.decodeTga)(o,{detectAmbiguousAlphaChannel:!0})}catch(l){s=l}let f=yield be.workspace.openTextDocument({content:Ih(n,a,s),language:"markdown"});yield be.window.showTextDocument(f);break}default:throw new Error(`Cannot inspect file type ${r}`)}})))}et.activateInspectImageFileContribution=xh;function Dh(e,n,t){let i=`# ${(0,Ut.basename)(e.path)}`;i+=`

`;let r,o;if(n)r=n;else{if(!t)return i+="Could not decode png or get decode error",i;if(!(t instanceof Ch.DecodeError))return t instanceof Error?i+=`Could not be decoded due to an unexpected exception:

`:i+=`Unexpected error type:

`,i;o=t,r=t.partiallyDecodedImage}return r.details&&(i+=`## Details

`,i+=`- Width: ${r.details.width}
`,i+=`- Height: ${r.details.height}
`,i+=`- Bit depth: ${r.details.bitDepth}
`,i+=`- Color type: ${Uh(r.details.colorType)} (${r.details.colorType})
`,i+=`- Interlace method: ${r.details.interlaceMethod===1?"Adam7":"None"}
`,i+=`
`),i+=Ma(r.info||[],r.warnings||[],o),i+=`## Metadata

`,r.metadata&&r.metadata.length>0?(i+="```json\n",i+=Ra(r.metadata),i+=`
`,i+="```"):i+="No recognized metadata",i+=`

`,r.rawChunks&&r.rawChunks.length>0&&(i+=`## Raw chunks

`,i+="```json\n",i+=Ra(r.rawChunks),i+=`
`,i+="```",i+=`

`),r.image&&(i+=La(r.image)),i}function Ih(e,n,t){let i=`# ${(0,Ut.basename)(e.path)}`;i+=`

`;let r,o;if(n)r=n;else{if(!t)return i+="Could not decode tga or get decode error",i;if(!(t instanceof Sh.DecodeError))return t instanceof Error?i+=`Could not be decoded due to an unexpected exception:

`:i+=`Unexpected error type:

`,i;o=t,r=t.partiallyDecodedImage}return r.details&&(i+=`## Details

`,r.details.header&&(i+=`- Width: ${r.details.header.width}
`,i+=`- Height: ${r.details.header.height}
`),i+=`- Image identifier: ${r.details.imageId}
`,r.details.footer&&(i+=`- Extension area offset: ${r.details.footer.extensionAreaOffset}
`,i+=`- Developer directory offset: ${r.details.footer.developerDirectoryOffset}
`),i+=`
`),i+=Ma([],r.warnings||[],o),r.image&&(i+=La(r.image)),i}function Ra(e){return JSON.stringify(e,(n,t)=>[Uint8Array,Uint16Array].some(i=>t instanceof i)?Array.from(t):t,2)}function Uh(e){switch(e){case 0:return"Grayscale";case 2:return"Truecolor";case 3:return"Indexed";case 4:return"Grayacale and alpha";case 6:return"Truecolor and alpha"}return""}function Ma(e,n,t){let i="";if(e.length||n.length>0||t){i+=`## Problems encountered

`;for(let r of e)i+=`- \`INFO\` ${r}
`;for(let r of n)i+=`- \`WARN\` ${r.message} (offset: 0x${r.offset.toString(16)})
`;t&&(i+=`- \`ERROR\` ${t.message} (offset: 0x${t.offset.toString(16)})
`),i+=`
`}return i}function La(e){let n="";n+=`## Raw rgba data as json

`,n+=`[
`;let t=e.width*4,i=e.data.BYTES_PER_ELEMENT===2?5:3,r=0;for(let o=0;o<e.data.length;o++)n+=`${o!==0?",":""}`,o%t!==0&&o%4===0&&(n+=" "),r===t&&(n+=`
`,r=0),r++,n+=e.data[o].toString().padStart(i," ");return n+=`
]`,n+=`
`,n}});var At=oe(V=>{"use strict";var Xn;Object.defineProperty(V,"__esModule",{value:!0});V.isLinux=V.isWindows=V.isMac=V.isWeb=V.globals=void 0;V.globals=typeof self=="object"?self:typeof global=="object"?global:{};var ce;typeof V.globals.vscode!="undefined"&&typeof V.globals.vscode.process!="undefined"?ce=V.globals.vscode.process:typeof process!="undefined"&&(ce=process);var Ah=typeof((Xn=ce==null?void 0:ce.versions)===null||Xn===void 0?void 0:Xn.electron)=="string"&&ce.type==="renderer",Jn=!1,Qn=!1,ei=!1,ti=!1;typeof navigator=="object"&&!Ah?(Jn=!0,ei=navigator.userAgent.indexOf("Windows")>=0,Qn=navigator.userAgent.indexOf("Macintosh")>=0,ti=navigator.userAgent.indexOf("Linux")>=0):typeof ce=="object"&&(Jn=!1,ei=ce.platform==="win32",Qn=ce.platform==="darwin",ti=ce.platform==="linux");V.isWeb=Jn;V.isMac=Qn;V.isWindows=ei;V.isLinux=ti});var hn=oe(Ae=>{"use strict";Object.defineProperty(Ae,"__esModule",{value:!0});Ae.mixinGlobalState=Ae.getWorkbenchState=Ae.getGlobalState=void 0;function Fa(e,n){let t=e.workspaceState.get("workbenchState"),i=t==null?void 0:t[n];return!i||i.version!==3?{version:3,entries:[]}:i}function za(e){return Fa(e,"global")}Ae.getGlobalState=za;function Rh(e,n){let t=Fa(e,n.toString());return $a(e,t),t}Ae.getWorkbenchState=Rh;function $a(e,n){let t=za(e);for(let i of t.entries){let r=n.entries.findIndex(o=>o.id===i.id);n.entries.splice(r,1)}n.entries.push(...t.entries)}Ae.mixinGlobalState=$a});var ni=oe(Re=>{"use strict";var Pa=Re&&Re.__awaiter||function(e,n,t,i){function r(o){return o instanceof t?o:new t(function(a){a(o)})}return new(t||(t=Promise))(function(o,a){function s(d){try{l(i.next(d))}catch(h){a(h)}}function f(d){try{l(i.throw(d))}catch(h){a(h)}}function l(d){d.done?o(d.value):r(d.value).then(s,f)}l((i=i.apply(e,n||[])).next())})};Object.defineProperty(Re,"__esModule",{value:!0});Re.saveBackupData=Re.getBackupData=void 0;var Na=require("vscode"),Wa=At(),Mh=hn();function Lh(e,n){return Pa(this,void 0,void 0,function*(){let t=yield Na.workspace.fs.readFile(n);if(Wa.isWeb){if(!self.TextDecoder)return console.warn("This browser doesn't support TextEncoder"),{};let f=new self.TextDecoder().decode(t),l=Oa(f==null?void 0:f.state),d=f==null?void 0:f.workbenchState;return{state:l,workbenchState:d}}let r=new(yield Promise.resolve().then(()=>require("v8"))).Deserializer(t).readValue(),o=Oa(r==null?void 0:r.state),a=r==null?void 0:r.workbenchState;return(0,Mh.mixinGlobalState)(e,a),{state:o,workbenchState:a}})}Re.getBackupData=Lh;function Bh(e,n){return Pa(this,void 0,void 0,function*(){let t;if(Wa.isWeb)if(self.TextEncoder)t=new self.TextEncoder().encode(JSON.stringify(n));else throw new Error("This browser doesn't support TextEncoder");else{let i=new(yield Promise.resolve().then(()=>require("v8"))).Serializer;i.writeValue(n),t=i.releaseBuffer()}yield Na.workspace.fs.writeFile(e,t)})}Re.saveBackupData=Bh;function Oa(e){if(typeof e!="object"||e===null)return;let n=e;if(!(!("version"in n)||n.version!==8)&&("body"in n||typeof n.body!="object"))return{version:n.version,body:n.body}}});var Ha=oe(tt=>{"use strict";Object.defineProperty(tt,"__esModule",{value:!0});tt.deserializeFromJson=tt.serializeToJson=void 0;function qa(e){if(!e||typeof e!="object")return e;let n={};for(let t of Object.keys(e)){let i=e[t];typeof i=="object"?"readyPromise"in i?n[t]=Fh(i):i instanceof Float32Array?n[t]=cn(i,"Float32Array"):i instanceof Uint8Array?n[t]=cn(i,"Uint8Array"):i instanceof Uint16Array?n[t]=cn(i,"Uint16Array"):i instanceof Uint32Array?n[t]=cn(i,"Uint32Array"):n[t]=i:n[t]=i}return n}tt.serializeToJson=qa;function ii(e){if(!e||typeof e!="object")return e;let n={};for(let t of Object.keys(e)){let i=e[t];typeof i=="object"?"dataType"in i?i.dataType==="pending"?n[t]=zh(i):n[t]=$h(i):n[t]=ii(i):n[t]=i}return n}tt.deserializeFromJson=ii;function Fh(e){return{dataType:"pending",data:qa(e.resource)}}function zh(e){let n=ii(e.data);return{resource:n,readyPromise:Promise.resolve(n),isReady:!0}}function cn(e,n){return{dataType:n,data:Array.from(e)}}function $h(e){return new global[e.dataType](e.data)}});var Ya=oe(nt=>{"use strict";var Za=nt&&nt.__awaiter||function(e,n,t,i){function r(o){return o instanceof t?o:new t(function(a){a(o)})}return new(t||(t=Promise))(function(o,a){function s(d){try{l(i.next(d))}catch(h){a(h)}}function f(d){try{l(i.throw(d))}catch(h){a(h)}}function l(d){d.done?o(d.value):r(d.value).then(s,f)}l((i=i.apply(e,n||[])).next())})};Object.defineProperty(nt,"__esModule",{value:!0});nt.WebviewIpcClient=void 0;var Ga=Ha(),ja=At(),Va=class{constructor(n){this._webview=n,this._webviewRequestHandlers=new Map,this._activeRequests=new Map,this._webview.onDidReceiveMessage(t=>Za(this,void 0,void 0,function*(){if("extHostRequestId"in t){let i=t.extHostRequestId,r=this._activeRequests.get(i);if(!r)throw new Error(`Response received without request "${i}"`);this._activeRequests.delete(i),r(ja.isWeb?(0,Ga.deserializeFromJson)(t.body):t.body);return}if("webviewRequestId"in t){let i=this._webviewRequestHandlers.get(t.type);if(!i)throw new Error(`No handler for webview request "${t.type}"`);let r=yield i(t.body),o={type:t.type,body:ja.isWeb?(0,Ga.serializeToJson)(r):r,webviewRequestId:t.webviewRequestId};this._webview.postMessage(o);return}}))}registerRequestHandler(n,t){if(this._webviewRequestHandlers.has(n))throw new Error(`Duplicate webview request handler "${n}"`);this._webviewRequestHandlers.set(n,t)}request(n,t){return Za(this,void 0,void 0,function*(){let i=Math.round(Math.random()*1e6);return yield new Promise(o=>{this._activeRequests.set(i,o);let a={type:n,body:t,extHostRequestId:i};this._webview.postMessage(a)})})}};nt.WebviewIpcClient=Va});var Xa=oe(it=>{"use strict";Object.defineProperty(it,"__esModule",{value:!0});it.disposeArray=it.Disposable=void 0;var Ka=class{constructor(){this._disposables=[],this._isDisposed=!1}dispose(){if(this._isDisposed)throw new Error("Attempt to dispose a disposed entity");this._isDisposed=!0;for(let n of this._disposables)n.dispose();this._disposables.length=0}register(n){return this._disposables.push(n),n}unregister(n){let t=this._disposables.indexOf(n);t!==-1&&this._disposables.splice(t,1)}};it.Disposable=Ka;function Ph(e){for(let n of e)n.dispose();e.length=0}it.disposeArray=Ph});var ri=oe(un=>{"use strict";Object.defineProperty(un,"__esModule",{value:!0});un.perf=void 0;var Nh=At();un.perf=Nh.isWeb?self.performance:require("perf_hooks").performance});var ss=oe(ie=>{"use strict";var O=ie&&ie.__awaiter||function(e,n,t,i){function r(o){return o instanceof t?o:new t(function(a){a(o)})}return new(t||(t=Promise))(function(o,a){function s(d){try{l(i.next(d))}catch(h){a(h)}}function f(d){try{l(i.throw(d))}catch(h){a(h)}}function l(d){d.done?o(d.value):r(d.value).then(s,f)}l((i=i.apply(e,n||[])).next())})};Object.defineProperty(ie,"__esModule",{value:!0});ie.setVscodeContext=ie.BuiltInCommands=ie.ImageDocument=void 0;var Ja=require("path"),L=require("vscode"),Qa=ni(),Wh=Ya(),es=Xa(),te=ri(),ts=hn(),ns=class extends es.Disposable{constructor(n,t,i,r){var o;super();if(this._context=n,this.uri=t,this._initData=i,this._isInitialized=!1,this._editIndex=0,this._savedEditIndex=0,this._hasContentChanged=!1,this._fileWatcherDisposables=[],this._isActive=!1,this._globalState=new Map,this._workbenchState=new Map,this._perfMetrics={startEvent:0,webviewReadyEvent:0,dataReadyEvent:0,finishEvent:0,totalDuration:0,parseDuration:0,dataTransportDuration:0},this._onDisposed=new L.EventEmitter,this.onDisposed=this._onDisposed.event,this._onDidChange=new L.EventEmitter,this.onDidChange=this._onDidChange.event,this._onDidUpdateGlobalState=new L.EventEmitter,this.onDidUpdateGlobalState=this._onDidUpdateGlobalState.event,this._onRequestReload=new L.EventEmitter,this.onRequestReload=this._onRequestReload.event,this._onMimeTypeChange=new L.EventEmitter,this.onMimeTypeChange=this._onMimeTypeChange.event,this._onDidEncounterDecodeProblem=new L.EventEmitter,this.onDidEncounterDecodeProblem=this._onDidEncounterDecodeProblem.event,((o=this._initData.workbenchState)===null||o===void 0?void 0:o.version)===3)for(let a of this._initData.workbenchState.entries)this._workbenchState.set(a.id,a.state);this._perfMetrics.startEvent=r!==void 0?r:te.perf.now(),this._setupFileWatcher(t)}get ipcClient(){return this._ipcClient}get isActive(){return this._isActive}set isActive(n){this._isActive=n,this._isActive&&this._hasContentChanged&&this._showContentChangedWarning()}get _isDirty(){return this._editIndex!==this._savedEditIndex}dispose(){let n=this._context.workspaceState.get("workbenchState");n&&this.uri.toString()in n&&(delete n[this.uri.toString()],this._context.workspaceState.update("workbenchState",n)),this._onDisposed.fire(),super.dispose()}_setupFileWatcher(n){var t;if(((t=this._fileWatcherUri)===null||t===void 0?void 0:t.toString())===n.toString())return;this._fileWatcherUri=n,(0,es.disposeArray)(this._fileWatcherDisposables);let i=L.workspace.createFileSystemWatcher(new L.RelativePattern(n,"*"));this._fileWatcherDisposables.push(i),this._fileWatcherDisposables.push(i.onDidChange(()=>O(this,void 0,void 0,function*(){return this._handleFileChangeEvent(n)}))),this._fileWatcherDisposables.push(i.onDidCreate(()=>O(this,void 0,void 0,function*(){return this._handleFileChangeEvent(n)})))}_handleFileChangeEvent(n){return O(this,void 0,void 0,function*(){let t=yield L.workspace.fs.stat(n);if(!(this._lastSaveStat&&qh(t,yield this._lastSaveStat))){if(!this._isActive){this._hasContentChanged=!0;return}if(this._isDirty){yield this._showContentChangedWarning();return}this._onRequestReload.fire()}})}_showContentChangedWarning(){return O(this,void 0,void 0,function*(){(yield L.window.showWarningMessage("The image changed on disk, do you want to reload the file?","Reload"))==="Reload"&&(yield L.commands.executeCommand("workbench.action.files.revert"),this._onRequestReload.fire())})}getIpcClientOrThrow(){if(!this._ipcClient)throw new Error(`No IPC client for document ${this.uri.toString()}`);return this._ipcClient}save(n){return O(this,void 0,void 0,function*(){if(!this._isDirty){console.warn("Attempt to save when not dirty");return}yield this.saveAs(this.uri,n)})}saveAs(n,t){return O(this,void 0,void 0,function*(){let i=this.getIpcClientOrThrow(),r={startEvent:te.perf.now(),writeStartEvent:0,writeFinishEvent:0,finishEvent:0,encodeDuration:0,dataTransportDuration:0,totalDuration:0},o=L.workspace.getConfiguration("files").get("autoSave")!=="off",a=yield i.request("save",{isAutoSaveEnabled:o,extName:(0,Ja.extname)(n.fsPath)});if(t.isCancellationRequested)return;r.encodeDuration=a.encodeDuration,r.writeStartEvent=te.perf.now(),r.dataTransportDuration=r.writeStartEvent-r.startEvent-r.encodeDuration;let s=new Uint8Array(a.blobBuffer);yield L.workspace.fs.writeFile(n,s),r.writeFinishEvent=te.perf.now(),this._lastSaveStat=L.workspace.fs.stat(n),yield this._lastSaveStat,this._setupFileWatcher(n),this._savedEditIndex=this._editIndex,this._latestBackupUri&&(yield L.workspace.fs.delete(this._latestBackupUri),this._latestBackupUri=void 0,this._latestBackupContent=void 0),r.finishEvent=te.perf.now(),r.totalDuration=r.finishEvent-r.startEvent,as(`Save perf: ${this.uri.fsPath}`,r)})}revert(){this._latestBackupUri=void 0,this._lastSaveStat=void 0,this._editIndex=0,this._savedEditIndex=0,this._hasContentChanged=!1,this._isInitialized=!0}backup(n,t){return O(this,void 0,void 0,function*(){let i=this.getIpcClientOrThrow(),r=L.workspace.getConfiguration().get("luna.hotExitMaxPixels",0),o=yield i.request("backup",{hotExitMaxPixels:r});if(t.isCancellationRequested)throw new Error("Backup canceled");if(!o.success)throw new Error("Could not backup file as it's too large");return yield(0,Qa.saveBackupData)(n.destination,{state:o.state,workbenchState:o.workbenchState}),this._latestBackupUri=n.destination,this._latestBackupContent=void 0,{id:n.destination.toString(),delete:()=>O(this,void 0,void 0,function*(){this._latestBackupUri&&this._latestBackupUri.toString()===n.destination.toString()&&(this._latestBackupContent=o.state);try{yield L.workspace.fs.delete(n.destination)}catch{}})}})}setupIpc(n){let t=new Wh.WebviewIpcClient(n);return t.registerRequestHandler("backupClipboardData",i=>{this._initData.type==="newFromClipboard"&&(this._initData.data=i)}),t.registerRequestHandler("historyNewEdit",i=>{this._editIndex++,this._onDidChange.fire({document:this,label:i.label,redo:()=>O(this,void 0,void 0,function*(){if(this._editIndex++,!(yield t.request("luna.executeCommand","edit.redo")).success)throw new Error(`Could not redo entry "${i.label}"`)}),undo:()=>O(this,void 0,void 0,function*(){if(this._editIndex--,!(yield t.request("luna.executeCommand","edit.undo")).success)throw new Error(`Could not undo entry "${i.label}"`)})})}),t.registerRequestHandler("inputBoxNumber",i=>O(this,void 0,void 0,function*(){let r=yield L.window.showInputBox({title:i.title,prompt:i.prompt,value:i.defaultValue.toString(),validateInput:o=>os(o,i.defaultValue,i.minValue,i.maxValue)});return r===void 0?void 0:Rt(r,i.defaultValue)})),t.registerRequestHandler("inputBoxNumberOrDimensionsShorthand",i=>O(this,void 0,void 0,function*(){let r=yield L.window.showInputBox({prompt:i.prompt,title:i.title,value:i.widthDefaultValue.toString(),validateInput:o=>{if(!Oh(o))return os(o,i.widthDefaultValue,i.minValue,i.maxValue)}});if(r==null?void 0:r.includes("x")){let o=r.split("x");return{width:Rt(o[0],i.widthDefaultValue),height:Rt(o[1],i.heightDefaultValue)}}return r===void 0?void 0:Rt(r,i.widthDefaultValue)})),t.registerRequestHandler("inputBoxString",i=>O(this,void 0,void 0,function*(){return yield L.window.showInputBox({prompt:i.prompt,value:i.defaultValue})})),t.registerRequestHandler("quickPick",i=>O(this,void 0,void 0,function*(){var r;return(r=yield L.window.showQuickPick(i.items,i.options))===null||r===void 0?void 0:r.id})),t.registerRequestHandler("vscode.executeCommand",i=>O(this,void 0,void 0,function*(){return L.commands.executeCommand(i.command,i.args)})),t.registerRequestHandler("vscode.setContext",i=>O(this,void 0,void 0,function*(){yield rs(i.key,i.value)})),t.registerRequestHandler("ready",()=>O(this,void 0,void 0,function*(){this._perfMetrics.webviewReadyEvent=te.perf.now();let i;if(!i&&this._workbenchState.size>0){i={version:3,entries:[]};for(let[r,o]of this._workbenchState.entries())i.entries.push({id:r,state:o});(0,ts.mixinGlobalState)(this._context,i)}if(i||(i=(0,ts.getWorkbenchState)(this._context,this.uri)),this._latestBackupUri){let r;if(this._latestBackupContent)r=this._latestBackupContent;else{let o=yield(0,Qa.getBackupData)(this._context,this._latestBackupUri);r=o.state,i=o.workbenchState}if(!r||r.version<8)L.window.showWarningMessage("Extension was updated, could not restore image from backup");else return this._perfMetrics.dataReadyEvent=te.perf.now(),{type:"restore",config:this._getLunaConfig(),state:r,workbenchState:i,editIndex:this._editIndex,restoreHistory:!0}}if(!this._isInitialized)return this._isInitialized=!0,this._initData.workbenchState=i,this._perfMetrics.dataReadyEvent=te.perf.now(),this._initData;try{let r=yield L.workspace.fs.readFile(this.uri);if(this._lastSaveStat=L.workspace.fs.stat(this.uri),yield this._lastSaveStat,r.length===0){let o=L.workspace.getConfiguration("luna.defaultImageSize",this.uri);return this._perfMetrics.dataReadyEvent=te.perf.now(),{type:"new",config:this._getLunaConfig(),workbenchState:i,dimensions:{width:o.get("width",800),height:o.get("height",600)}}}return this._perfMetrics.dataReadyEvent=te.perf.now(),{type:"open",config:this._getLunaConfig(),workbenchState:i,data:r,extName:(0,Ja.extname)(this.uri.path),isReadonly:this._initData.isReadonly}}catch{return L.window.showInformationMessage("This image could not be restored from hot exit, try saving the file and/or turning the luna.retainContextWhenHidden setting on"),this._initData.workbenchState=i,this._perfMetrics.dataReadyEvent=te.perf.now(),this._initData}})),t.registerRequestHandler("parseFinished",i=>O(this,void 0,void 0,function*(){this._perfMetrics.parseDuration=i.duration,this._perfMetrics.finishEvent=te.perf.now(),this._perfMetrics.dataTransportDuration=this._perfMetrics.finishEvent-this._perfMetrics.dataReadyEvent-this._perfMetrics.parseDuration,this._perfMetrics.totalDuration=this._perfMetrics.finishEvent-this._perfMetrics.startEvent,as(`Open perf: ${this.uri.fsPath}`,this._perfMetrics)})),t.registerRequestHandler("reportIssue",()=>O(this,void 0,void 0,function*(){L.commands.executeCommand("workbench.action.openIssueReporter",{extensionId:"tyriar.luna-paint"})})),t.registerRequestHandler("setMimeType",i=>{this._onMimeTypeChange.fire(i)}),t.registerRequestHandler("showDecodeProblemStatusBarEntry",i=>{this._onDidEncounterDecodeProblem.fire(i.level)}),t.registerRequestHandler("updateWorkbenchState",i=>{i.global?this._globalState.set(i.id,i.state):this._workbenchState.set(i.id,i.state);let r=this._context.workspaceState.get("workbenchState")||{},o={version:3,entries:[]};if(i.global){for(let[a,s]of this._globalState.entries())o.entries.push({id:a,state:s});r.global=o}else{for(let[a,s]of this._workbenchState.entries())o.entries.push({id:a,state:s});r[this.uri.toString()]=o}this._context.workspaceState.update("workbenchState",r),i.global&&this._onDidUpdateGlobalState.fire(o)}),this._ipcClient=t,t}syncGlobalState(n){var t;return O(this,void 0,void 0,function*(){yield(t=this._ipcClient)===null||t===void 0?void 0:t.request("syncGlobalState",n)})}_getLunaConfig(){var n,t,i,r;let o=L.workspace.getConfiguration();return{mouseWheelBehavior:(n=o.get("luna.mouseWheelBehavior"))!==null&&n!==void 0?n:"scroll",snapToPixelGrid:(t=o.get("luna.snapToPixelGrid"))!==null&&t!==void 0?t:!0,statusBarPointerColor:(i=o.get("luna.statusBar.pointerColor"))!==null&&i!==void 0?i:"currentLayer",defaultTool:(r=o.get("luna.defaultTool"))!==null&&r!==void 0?r:"selection"}}};ie.ImageDocument=ns;var is;(function(e){e.SetContext="setContext"})(is=ie.BuiltInCommands||(ie.BuiltInCommands={}));function rs(e,n){return L.commands.executeCommand(is.SetContext,e,n)}ie.setVscodeContext=rs;function Oh(e,n,t){return!!e.match(/^\d+%?x\d+%?/)}function os(e,n,t,i){if(!e.match(/^[0-9]+%?$/))return"Enter a valid number";let r=Rt(e,n);if(t!==void 0&&r<t)return`Enter a number greater than or equal to ${t}`;if(i!==void 0&&r>i)return`Enter a number less than or equal to ${i}`}function Rt(e,n){return e.endsWith("%")?Math.round(parseInt(e)/100*n):parseInt(e)}function qh(e,n){return n?e.ctime===n.ctime&&e.mtime===n.mtime&&e.size===n.size:!1}function as(e,n){if(L.workspace.getConfiguration().get("luna.developer.logPerfMetrics")){let i={},r={};for(let o of Object.keys(n)){let a=n[o];o.endsWith("Event")?i[o]={"Time (ms)":parseFloat((a-n.startEvent).toFixed(2)),"Percent (%)":Math.round((n[o]-n.startEvent)/n.totalDuration*100)}:r[o]={"Duration (ms)":parseFloat(a.toFixed(2))}}console.info(`
${e}`),console.table(r),console.table(i)}}});var cs=oe(re=>{"use strict";var Y=re&&re.__awaiter||function(e,n,t,i){function r(o){return o instanceof t?o:new t(function(a){a(o)})}return new(t||(t=Promise))(function(o,a){function s(d){try{l(i.next(d))}catch(h){a(h)}}function f(d){try{l(i.throw(d))}catch(h){a(h)}}function l(d){d.done?o(d.value):r(d.value).then(s,f)}l((i=i.apply(e,n||[])).next())})};Object.defineProperty(re,"__esModule",{value:!0});re.setVscodeContext=re.BuiltInCommands=re.PaintEditorProvider=void 0;var ls=require("os"),rt=require("path"),T=require("vscode"),Hh=ni(),Mt=ss(),Zh=ri(),pn=At(),wn=hn(),Gh=["adjustments.invert","color.swapColors","edit.copy","edit.cut","edit.paste","edit.redo","edit.undo","help.reportIssue","image.cropToSelection","image.expandCanvasToSelection","image.resize","image.resizeCanvas","image.flipHorizontal","image.flipVertical","image.rotate180","image.rotate90Clockwise","image.rotate90CounterClockwise","image.flattenLayers","image.finishActiveAction","image.customizePointerColorStatusBarItem","image.addNewImage","image.deleteImage","image.goToTopImage","image.goToImageAbove","image.goToImageBelow","image.goToBottomImage","image.moveImageToTop","image.moveImageUp","image.moveImageDown","image.moveImageToBottom","layer.addNewLayer","layer.deleteLayer","layer.duplicateLayer","layer.mergeLayerDown","layer.renameLayer","layer.flipHorizontal","layer.flipVertical","layer.rotate180","layer.goToTopLayer","layer.goToLayerAbove","layer.goToLayerBelow","layer.goToBottomLayer","layer.moveLayerToTop","layer.moveLayerUp","layer.moveLayerDown","layer.moveLayerToBottom","selection.deselect","selection.selectAll","selection.erase","selection.eraseKeepSelection","tool.colorPicker","tool.crop","tool.eraser","tool.fill","tool.hand","tool.handUntilRelease","tool.pencil","tool.selection","tool.zoom","tool.line","tool.rectangle","tool.shape","tool.text","tool.toggleShapeTool","tool.movePixels","tool.moveSelection","tool.toggleMoveTool","view.focusCanvas","view.zoomIn","view.zoomOut","view.actualSize","view.fitToWindow","view.fitLayerToWindow","color.toggleColorsWindow","history.toggleHistoryWindow","image.toggleImagesWindow","layer.toggleLayersWindow","minimap.toggleMinimapWindow","palette.togglePaletteWindow","tool.toggleToolsWindow"],Me=class{constructor(n){this._context=n,this._onDidChangeCustomDocument=new T.EventEmitter,this.onDidChangeCustomDocument=this._onDidChangeCustomDocument.event,this._documents=new Map,this._webviewPanels=new Map,this._newImageRequest=new Map;for(let t of Gh)this._context.subscriptions.push(T.commands.registerCommand(`luna.${t}`,()=>{var i;if(!this._lastActiveResource)return;let r=(i=this._documents.get(this._lastActiveResource.toString()))===null||i===void 0?void 0:i.ipcClient;if(!!r)return r.request("luna.executeCommand",t)}));this._context.subscriptions.push(T.commands.registerCommand("luna.file.new",t=>Y(this,void 0,void 0,function*(){let i=T.workspace.getConfiguration("luna.defaultImageSize",this._lastActiveResource),r={width:i.get("width",800),height:i.get("height",600)},o=yield this._requestNewImageDimensions(r,t);if(!o)return;let a=yield this._getNewImageUri();this._newImageRequest.set(a.path,{width:o.width,height:o.height}),T.commands.executeCommand("vscode.openWith",a,Me.viewType)}))),T.workspace.onDidChangeConfiguration(t=>{var i;if(t.affectsConfiguration("luna")){let r=this._getLunaConfig();for(let o of this._documents.values())(i=o.ipcClient)===null||i===void 0||i.request("updateConfig",r)}}),this._context.subscriptions.push(T.commands.registerCommand("luna.file.newIcon",t=>Y(this,void 0,void 0,function*(){let i={width:256,height:256},r=yield this._requestNewImageDimensions(i,t);if(!r)return;let o=yield this._getNewImageUri("image/x-ico");this._newImageRequest.set(o.path,{width:r.width,height:r.height,extName:".ico"}),T.commands.executeCommand("vscode.openWith",o,Me.viewType)}))),this._context.subscriptions.push(T.commands.registerCommand("luna.file.importFromClipboard",()=>Y(this,void 0,void 0,function*(){let t=yield this._getNewImageUri();this._newImageRequest.set(t.path,"clipboard"),T.commands.executeCommand("vscode.openWith",t,Me.viewType)}))),this._context.subscriptions.push(T.commands.registerCommand("luna.file.newDefaultSize",()=>Y(this,void 0,void 0,function*(){let t=yield this._getNewImageUri();this._newImageRequest.set(t.path,this._getDefaultImageSize(t)),T.commands.executeCommand("vscode.openWith",t,Me.viewType)}))),this._context.subscriptions.push(T.commands.registerCommand("luna.help.openDocumentation",()=>Y(this,void 0,void 0,function*(){T.commands.executeCommand("workbench.action.openWalkthrough","Tyriar.luna-paint#welcome",!0)}))),this._context.subscriptions.push(T.commands.registerCommand("luna.help.hideAutoSaveWarning",()=>Y(this,void 0,void 0,function*(){var t;(t=this._autoSaveWarningStatusBarItem)===null||t===void 0||t.dispose(),this._autoSaveWarningStatusBarItem=void 0}))),this._context.subscriptions.push(T.window.onDidChangeWindowState(t=>{var i;if(!t.focused)for(let r of this._documents.values())(i=r.ipcClient)===null||i===void 0||i.request("pauseanimations",void 0)})),this._context.subscriptions.push(T.window.onDidChangeActiveTextEditor(()=>{var t,i;this._mimeTypeStatusBarItem.hide(),(t=this._autoSaveWarningStatusBarItem)===null||t===void 0||t.hide(),(i=this._decodeWarningStatusBarItem)===null||i===void 0||i.hide()})),this._mimeTypeStatusBarItem=T.window.createStatusBarItem("luna-paint.mimeType",T.StatusBarAlignment.Right),this._mimeTypeStatusBarItem.name="Luna Paint - Mime Type",this._autoSaveWarningStatusBarItem=T.window.createStatusBarItem("luna-paint.autoSaveWarning",T.StatusBarAlignment.Right,1),this._autoSaveWarningStatusBarItem.name="Luna Paint - Auto Save Warning",this._autoSaveWarningStatusBarItem.text="$(warning) Auto Save is On",this._autoSaveWarningStatusBarItem.backgroundColor=new T.ThemeColor("statusBarItem.warningBackground"),this._autoSaveWarningStatusBarItem.color=new T.ThemeColor("statusBarItem.warningForeground"),this._autoSaveWarningStatusBarItem.tooltip="Auto save after delay is enabled which may cause performance issues while editing the image. Left click to dismiss this warning for this session, right click to hide it permanently.",this._autoSaveWarningStatusBarItem.command="luna.help.hideAutoSaveWarning",this._decodeWarningStatusBarItem=T.window.createStatusBarItem("luna-paint.decodeWarning",T.StatusBarAlignment.Right,2),this._decodeWarningStatusBarItem.name="Luna Paint - Decode Warning",this._decodeWarningStatusBarItem.text="$(warning) Decode Warning",this._decodeWarningStatusBarItem.backgroundColor=new T.ThemeColor("statusBarItem.warningBackground"),this._decodeWarningStatusBarItem.color=new T.ThemeColor("statusBarItem.warningForeground"),this._decodeWarningStatusBarItem.tooltip="Warning(s) were encountered while decoding this image which could indicate corruption. Left click to inspect the image file, right click to hide this warning permanently.",this._decodeErrorStatusBarItem=T.window.createStatusBarItem("luna-paint.decodeError",T.StatusBarAlignment.Right,3),this._decodeErrorStatusBarItem.name="Luna Paint - Decode Error",this._decodeErrorStatusBarItem.text="$(error) Decode Error",this._decodeErrorStatusBarItem.backgroundColor=new T.ThemeColor("statusBarItem.errorBackground"),this._decodeErrorStatusBarItem.color=new T.ThemeColor("statusBarItem.errorForeground"),this._decodeErrorStatusBarItem.tooltip="A critical error was encountered while decoding this image. Left click to inspect the image file, right click to hide this warning permanently."}saveCustomDocument(n,t){return Y(this,void 0,void 0,function*(){return n.save(t)})}saveCustomDocumentAs(n,t,i){return Y(this,void 0,void 0,function*(){yield n.saveAs(t,i)})}revertCustomDocument(n,t){return Y(this,void 0,void 0,function*(){let i=n.getIpcClientOrThrow(),r=yield T.workspace.fs.readFile(n.uri);n.revert(),yield i.request("open",{data:r,extName:(0,rt.extname)(n.uri.path)})})}backupCustomDocument(n,t,i){return Y(this,void 0,void 0,function*(){try{return yield n.backup(t,i)}catch(r){throw console.error("Backup failed",r),r}})}openCustomDocument(n,t,i){return Y(this,void 0,void 0,function*(){let r;if(r=this._documents.get(n.toString()),r)return r;if(t.backupId){let a=T.Uri.parse(t.backupId);try{let{state:s,workbenchState:f}=yield(0,Hh.getBackupData)(this._context,a);s?r=new Mt.ImageDocument(this._context,n,{type:"restore",config:this._getLunaConfig(),state:s,workbenchState:f,restoreHistory:!1}):(T.window.showWarningMessage("The extension was updated, could not restore the image from backup"),r=yield this._createOpenImageDocument(n))}catch{r=yield this._createOpenImageDocument(n)}}else{let a=this._newImageRequest.get(n.path);a?(a==="clipboard"?r=new Mt.ImageDocument(this._context,n,{type:"newFromClipboard",config:this._getLunaConfig(),workbenchState:(0,wn.getGlobalState)(this._context),fallbackDimensions:this._getDefaultImageSize(n)}):r=new Mt.ImageDocument(this._context,n,{type:"new",config:this._getLunaConfig(),workbenchState:(0,wn.getGlobalState)(this._context),dimensions:{width:a.width,height:a.height},extName:a.extName}),this._newImageRequest.delete(n.path)):r=yield this._createOpenImageDocument(n)}r.onDidChange(a=>this._onDidChangeCustomDocument.fire(a));let o=r;return r.onDidUpdateGlobalState(a=>this._syncGlobalState(a,o)),r.onMimeTypeChange(a=>{this._mimeTypeStatusBarItem.text=jh(a),this._mimeTypeStatusBarItem.tooltip=a,this._mimeTypeStatusBarItem.show()}),r.onDidEncounterDecodeProblem(a=>{let s=a==="warning"?this._decodeWarningStatusBarItem:this._decodeErrorStatusBarItem;s&&(s.command={command:"luna.file.inspectImageFile",title:"Inspect Image File",arguments:[r==null?void 0:r.uri]},s.show())}),this._documents.set(n.toString(),r),r.onDisposed(()=>this._documents.delete(n.toString())),r})}_syncGlobalState(n,t){if(this._documents.size!==1)for(let i of this._documents.values())i!==t&&i.syncGlobalState(n)}_getNewImageUri(n="image/png"){return Y(this,void 0,void 0,function*(){let t=T.workspace.workspaceFolders,i;if(t&&t.length>0)i=t[0].uri;else{let o;if(pn.isWindows&&!pn.isWeb&&process.env.USERPROFILE?o=(0,rt.join)(process.env.USERPROFILE,"Pictures"):(pn.isMac||pn.isLinux)&&(o=(0,rt.join)((0,ls.homedir)(),"Pictures")),o){let a=T.Uri.from({scheme:this._context.extensionUri.scheme,path:o});try{yield T.workspace.fs.stat(a)}catch{o=void 0}}i=T.Uri.from({scheme:this._context.extensionUri.scheme,path:o||(0,ls.homedir)()})}let r=n==="image/x-ico"?"ico":"png";return T.Uri.joinPath(i,`NewImage-${this._getUnusedNewImageId()}.${r}`).with({scheme:"untitled"})})}_getUnusedNewImageId(){let t=Array.from(this._documents.values()).map(r=>r.uri).map(r=>(0,rt.parse)(r.path).name).filter(r=>r.match(/^NewImage-\d+$/)).map(r=>parseInt(r.substring(9))),i=1;for(;t.includes(i);)i++;return i}_requestNewImageDimensions(n,t){return Y(this,void 0,void 0,function*(){let i=(t==null?void 0:t.width)||(yield T.window.showInputBox({prompt:"Enter the width of the image",value:n.width.toString(),validateInput:hs}));if(!i)return;let r=(t==null?void 0:t.height)||(yield T.window.showInputBox({prompt:"Enter the height of the image",value:n.height.toString(),validateInput:hs}));if(!!r)return{width:typeof i=="number"?i:parseInt(i),height:typeof r=="number"?r:parseInt(r)}})}_createOpenImageDocument(n){return Y(this,void 0,void 0,function*(){try{let t=Zh.perf.now(),i=new Uint8Array(yield T.workspace.fs.readFile(n));return new Mt.ImageDocument(this._context,n,{type:"open",config:this._getLunaConfig(),workbenchState:(0,wn.getGlobalState)(this._context),data:i,extName:(0,rt.extname)(n.path),isReadonly:!T.workspace.fs.isWritableFileSystem(n.scheme)},t)}catch{}return new Mt.ImageDocument(this._context,n,{type:"new",config:this._getLunaConfig(),workbenchState:(0,wn.getGlobalState)(this._context),dimensions:this._getDefaultImageSize(n)})})}_getDefaultImageSize(n){let t=T.workspace.getConfiguration("luna.defaultImageSize",n);return{width:t.get("width",800),height:t.get("height",600)}}resolveCustomEditor(n,t,i){let r=this._webviewPanels.get(n.uri.toString());r==null||r.dispose(),this._webviewPanels.set(n.uri.toString(),t);let o=t.webview;o.options={enableScripts:!0},o.html=this._getHtml(o);let a=n.setupIpc(o);n.onRequestReload(()=>Y(this,void 0,void 0,function*(){let s=yield T.workspace.fs.readFile(n.uri);yield a.request("open",{data:s,extName:(0,rt.extname)(n.uri.path)})})),t.onDidChangeViewState(()=>this._refreshActiveState(n,t)),t.onDidDispose(()=>this._handleWebviewBlur(n)),this._refreshActiveState(n,t)}_refreshActiveState(n,t){var i;t.active?(this._lastActiveResource=n.uri,this._mimeTypeStatusBarItem.show(),T.workspace.getConfiguration("files",this._lastActiveResource).get("autoSave")==="afterDelay"&&((i=this._autoSaveWarningStatusBarItem)===null||i===void 0||i.show())):this._handleWebviewBlur(n),n.isActive=t.active}_getLunaConfig(){var n,t,i,r;let o=T.workspace.getConfiguration(void 0,this._lastActiveResource);return{mouseWheelBehavior:(n=o.get("luna.mouseWheelBehavior"))!==null&&n!==void 0?n:"scroll",snapToPixelGrid:(t=o.get("luna.snapToPixelGrid"))!==null&&t!==void 0?t:!0,statusBarPointerColor:(i=o.get("luna.statusBar.pointerColor"))!==null&&i!==void 0?i:"currentLayer",defaultTool:(r=o.get("luna.defaultTool"))!==null&&r!==void 0?r:"selection"}}_handleWebviewBlur(n){var t,i,r;this._lastActiveResource===n.uri&&(this._mimeTypeStatusBarItem.hide(),(t=this._autoSaveWarningStatusBarItem)===null||t===void 0||t.hide(),(i=this._decodeWarningStatusBarItem)===null||i===void 0||i.hide(),(r=this._decodeErrorStatusBarItem)===null||r===void 0||r.hide(),fs("luna:focused",!1))}_getHtml(n){let t=n.asWebviewUri(T.Uri.joinPath(this._context.extensionUri,"luna/dist/vscode.main.js")),i=n.asWebviewUri(T.Uri.joinPath(this._context.extensionUri,"luna/dist/vscode.main.css")),r=n.cspSource;return`
<!doctype html>
<html lang="en-US">
  <head>
    <title>Luna Paint</title>
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' ${r}; style-src-elem 'self' ${r}; worker-src ${r};">
    <link rel="stylesheet" href="${i}">
  </head>
  <body>
    <div id="top"></div>
    <div id="middle">
      <div id="canvas"></div>
      <div id="gui"></div>
    </div>
    <div id="bottom"></div>
    <script type="module" src="${t}" defer><\/script>
  </body>
</html>`}};re.PaintEditorProvider=Me;Me.viewType="luna.editor";var ds;(function(e){e.SetContext="setContext"})(ds=re.BuiltInCommands||(re.BuiltInCommands={}));function fs(e,n){return T.commands.executeCommand(ds.SetContext,e,n)}re.setVscodeContext=fs;function hs(e,n,t){if(!e.match(/^[0-9]+$/))return"Enter a valid number";if(n!==void 0&&parseInt(e)<n)return`Enter a number greater than or equal to ${n}`;if(t!==void 0&&parseInt(e)>t)return`Enter a number less than or equal to ${t}`}function jh(e){switch(e){case"image/bmp":return"BMP";case"image/x-ico":return"ICO";case"image/jpeg":return"JPEG";case"image/png":return"PNG";case"image/x-tga":return"TGA";case"image/webp":case"image/webplossless":return"WEBP"}}});Object.defineProperty(exports,"__esModule",{value:!0});exports.deactivate=exports.activate=void 0;var us=require("vscode"),Vh=Ba(),ps=cs();function Yh(e){let n=us.workspace.getConfiguration("luna").get("retainContextWhenHidden");e.subscriptions.push(us.window.registerCustomEditorProvider(ps.PaintEditorProvider.viewType,new ps.PaintEditorProvider(e),{webviewOptions:{retainContextWhenHidden:n}})),(0,Vh.activateInspectImageFileContribution)(e)}exports.activate=Yh;function Kh(){}exports.deactivate=Kh;
/*! pako 2.0.4 https://github.com/nodeca/pako @license (MIT AND Zlib) */
