"use strict";const a53_0x145b=["max",'Images "',"43ZnJWse","dimensions","6883DwwyVj","indexOf","86AhLPrq","imageData","selection",'Invalid dimensions for image "','" and "','Unrecognized shape "',"visibleRange","shapeSize","data","default","blendMode","includes","763040yyXWiE","update","strokeStyle","triangle","541114aFfoWz","smoothing","floor","The line can not be drawn outside of the selection and viewport","shapeDefinition","top","518324nqlNDx","fillStyle","min","bind","length","clearRect",'" dimensions are equal',"secondaryColor","type","getContext","subarray","then","targetImage","height"," x ","getImageData","strokeWidth","replace","diamond",'" dimensions differ',"width","drawShape","1523AJIGjc","bottom",'": ',"ceil","Could not attain 2d context","primaryColor","imageSize","webpackChunkluna","right","lineWidth","1142316fNmmTW","372821PFsVxv","left","style"],a53_0x22d4=function(e,t){return a53_0x145b[e-=300]},a53_0x5b9f49=a53_0x22d4;!function(e,t){const a=a53_0x22d4;for(;;)try{if(395556===parseInt(a(347))*-parseInt(a(349))+parseInt(a(361))+parseInt(a(340))+parseInt(a(329))*-parseInt(a(345))+parseInt(a(301))+parseInt(a(307))+-parseInt(a(339)))break;e.push(e.shift())}catch(t){e.push(e.shift())}}(a53_0x145b),(self[a53_0x5b9f49(336)]=self.webpackChunkluna||[]).push([[5324],{5324:(e,t,a)=>{a.r(t),a.d(t,{run:()=>s});var i=a(4371),r=a(7517),n=a(1003),o=a(7742);const s=async(e,t,s)=>{const l=a53_0x22d4;let x;switch((0,o.ap)(s,l(319)),s[l(315)]){case l(325):x=new((await a.e(727).then(a[l(310)](a,727)))[l(358)]);break;case"ellipse":x=new((await a.e(8459)[l(318)](a.bind(a,8459)))[l(358)]);break;case l(300):x=new((await a.e(4012)[l(318)](a[l(310)](a,4012)))[l(358)]);break;case"rightTriangle":x=new((await a.e(6243)[l(318)](a.bind(a,6243)))[l(358)]);break;default:throw new Error(l(354)+s[l(315)]+'"')}const h=(0,n.kq)((0,n.BN)(s[l(346)]));if(s[l(351)]&&(s[l(351)][l(341)]>h[l(341)]&&(h[l(341)]=Math[l(309)](s[l(351)].left,h[l(337)])),s[l(351)][l(337)]<h.right&&(h[l(337)]=Math[l(343)](s[l(351)][l(337)],h.left)),s[l(351)][l(306)]>h[l(306)]&&(h[l(306)]=Math.min(s.selection[l(306)],h[l(330)])),s[l(351)][l(330)]<h[l(330)]&&(h.bottom=Math[l(343)](s[l(351)].bottom,h[l(306)]))),h[l(341)]===h[l(337)]||h[l(306)]===h[l(330)])throw new Error(l(304));const g={...s,job:e,progressReporter:t,imageSize:{x:s.targetImage.width,y:s[l(319)][l(320)]},shapeDefinition:x,shapeSize:{x:(0,n.Oq)(s[l(346)]),y:(0,n.rY)(s[l(346)])},shapeOffset:{x:s.dimensions[l(341)]%1,y:s.dimensions.top%1},visibleRange:f(s[l(346)],h)};g[l(323)]=Math.min(g.strokeWidth,Math[l(332)](Math.max(g.shapeSize.x,g[l(356)].y)/2));const m=new OffscreenCanvas(g.imageSize.x,g[l(335)].y)[l(316)]("2d");if(!m)throw new Error(l(333));m[l(363)]="rgba("+g[l(334)][0]+","+g[l(334)][1]+","+g[l(334)][2]+","+g[l(334)][3]/255+")";const u=2===g.style?g[l(334)]:g.secondaryColor;let y,b,p,w;m[l(308)]="rgba("+u[0]+","+u[1]+","+u[2]+","+u[3]/255+")",m[l(338)]=2!==g[l(342)]?g[l(323)]:1,g[l(302)]||3!==g.style?g[l(302)]||1!==g[l(323)]&&2!==g[l(342)]?({indexList:b,coordList:p,imageData:w,indexListCount:y}=d(g,m)):({indexList:b,coordList:p,imageData:w,indexListCount:y}=c(g,m)):({indexList:b,coordList:p,imageData:w,indexListCount:y}=function(e,t){const a=a53_0x22d4,r={...e,style:2,primaryColor:e.secondaryColor},n={...e,style:1},o=d(r,t);t[a(312)](0,0,e.imageSize.x,e[a(335)].y);const s=c(n,t),f=(0,i.X$)(e[a(335)].x*e[a(335)].y,e[a(335)].x*e[a(335)].y*4,!0),l=(0,i.X$)(e.imageSize.x*e[a(335)].y*2,Math[a(343)](e[a(335)].x,e[a(335)].y),!0);let x=0,h=0,g=0,m=0,u=!1;for(g=e[a(355)][a(306)];g<e.visibleRange[a(330)];g++)for(h=e[a(355)][a(341)];h<e.visibleRange[a(337)];h++)m=4*(g*e[a(335)].x+h),u=!1,o[a(350)][m+3]>e[a(314)][3]/2&&(o[a(350)][m+3]=e[a(314)][3],u=!0),s[a(350)][m+3]>e.primaryColor[3]/2&&((0,i.Yr)(o.imageData,m,s[a(350)],m),u=!0),u&&(l[2*x]=h,l[2*x+1]=g,f[x++]=m);return{imageData:o[a(350)],indexListCount:x,indexList:f,coordList:l}}(g,m));const k=b[l(317)](0,y);t[l(362)](.25);const S=new Uint8Array(new SharedArrayBuffer(4*b[l(311)]));let L=0;for(L=0;L<b[l(311)];L++)(0,i.Yr)(S,4*L,g[l(319)][l(357)],b[L]);if(t.update(.5),g[l(359)]===l(324))for(L=0;L<k.length;L++)(0,i.Yr)(g[l(319)][l(357)],k[L],w,4*(p[2*L+1]*g[l(335)].x+p[2*L]));else for(L=0;L<k[l(311)];L++)(0,r.B)(g[l(359)],g[l(319)].data,k[L],w,4*(p[2*L+1]*g[l(335)].x+p[2*L]));t[l(362)](.75);const z=new Uint8Array(new SharedArrayBuffer(4*b[l(311)]));for(L=0;L<b[l(311)];L++)(0,i.Yr)(z,4*L,g.targetImage[l(357)],b[L]);return t[l(362)](1),{undoData:{indexList:k,colorData:S},redoData:{indexList:k,colorData:z},range:h}};function c(e,t){const a=a53_0x22d4;if(!e[a(305)].allowOnePixelSmoothing||e[a(323)]>1)return d(e,t);if(1===e[a(342)])return function(e,t){const a=a53_0x22d4;return e[a(305)][a(328)](e,t),function(e,t){const a=a53_0x22d4,r=(0,i.X$)(t[a(335)].x*t[a(335)].y,t[a(335)].x*t[a(335)].y*4,!0),n=(0,i.X$)(t[a(335)].x*t[a(335)].y*2,Math[a(343)](t.imageSize.x,t[a(335)].y),!0);let o=0;const s=t[a(335)].x,c=t.imageSize.y,d=t[a(334)];let f=0,l=0,x=0;const h=new Array(c);for(x=0;x<c;x++)for(h[x]=[],l=0;l<s;l++)f=4*(x*s+l),e[f+3]>d[3]/3?h[x][l]=e[f+3]:(e[f+3]=0,h[x][l]=0);const g=[0,0,0,0,0,0,0,0],m=[0,0];for(x=0;x<c;x++)for(l=0;l<s;l++)if(h[x][l]>0){g[0]=0===l||0===x?0:e[4*((x-1)*s+(l-1))+3],g[1]=0===x?0:e[4*((x-1)*s+l)+3],g[2]=0===x||l===s-1?0:e[4*((x-1)*s+(l+1))+3],g[3]=0===l?0:e[4*(x*s+(l-1))+3],g[4]=l===s-1?0:e[4*(x*s+(l+1))+3],g[5]=0===l||x===c-1?0:e[4*((x+1)*s+(l-1))+3],g[6]=x===c-1?0:e[4*((x+1)*s+l)+3],g[7]=x===c-1||l===s-1?0:e[4*((x+1)*s+(l+1))+3],g[0]>g[1]?(m[0]=0,m[1]=1):(m[0]=1,m[1]=0);for(let e=2;e<8;e++)g[e]>g[m[0]]?(m[1]=m[0],m[0]=e):g[e]>g[m[1]]&&(m[1]=e);switch(m[0]){case 0:h[x-1][l-1]=e[4*((x-1)*s+(l-1))+3];break;case 1:h[x-1][l]=e[4*((x-1)*s+l)+3];break;case 2:h[x-1][l+1]=e[4*((x-1)*s+(l+1))+3];break;case 3:h[x][l-1]=e[4*(x*s+(l-1))+3];break;case 4:h[x][l+1]=e[4*(x*s+(l+1))+3];break;case 5:h[x+1][l-1]=e[4*((x+1)*s+(l-1))+3];break;case 6:h[x+1][l]=e[4*((x+1)*s+l)+3];break;case 7:h[x+1][l+1]=e[4*((x+1)*s+(l+1))+3]}switch(m[1]){case 0:h[x-1][l-1]=e[4*((x-1)*s+(l-1))+3];break;case 1:h[x-1][l]=e[4*((x-1)*s+l)+3];break;case 2:h[x-1][l+1]=e[4*((x-1)*s+(l+1))+3];break;case 3:h[x][l-1]=e[4*(x*s+(l-1))+3];break;case 4:h[x][l+1]=e[4*(x*s+(l+1))+3];break;case 5:h[x+1][l-1]=e[4*((x+1)*s+(l-1))+3];break;case 6:h[x+1][l]=e[4*((x+1)*s+l)+3];break;case 7:h[x+1][l+1]=e[4*((x+1)*s+(l+1))+3]}}const u=[];let y=0;for(x=0;x<c;x++)for(l=0;l<s;l++)if(h[x][l]>0){if(y=0,l>0&&x>0&&h[x-1][l-1]>0&&(u[y++]=0),x>0&&h[x-1][l]>0&&(u[y++]=1),l<s-1&&x>0&&h[x-1][l+1]>0&&(u[y++]=2),l>0&&h[x][l-1]>0&&(u[y++]=3),l<s-1&&h[x][l+1]>0&&(u[y++]=4),l>0&&x<c-1&&h[x+1][l-1]>0&&(u[y++]=5),x<c-1&&h[x+1][l]>0&&(u[y++]=6),l<s-1&&x<c-1&&h[x+1][l+1]>0&&(u[y++]=7),y>2){for(f=y;f<u[a(311)];f++)u[f]=-1;f=u.indexOf(1),-1!==f&&h[x][l]>=h[x-1][l]&&(u[a(360)](0)&&h[x-1][l]<h[x-1][l-1]||u.includes(2)&&h[x-1][l]<h[x-1][l+1])&&(h[x-1][l]=0,e[4*((x-1)*s+l)+3]=0,u[f]=-1),f=u[a(348)](6),-1!==f&&h[x][l]>=h[x+1][l]&&(u[a(360)](5)&&h[x+1][l]<h[x+1][l-1]||u[a(360)](7)&&h[x+1][l]<h[x+1][l+1])&&(h[x+1][l]=0,e[4*((x+1)*s+l)+3]=0,u[f]=-1),f=u[a(348)](3),-1!==f&&h[x][l]>=h[x][l-1]&&(u[a(360)](0)&&h[x][l-1]<h[x-1][l-1]||u[a(360)](5)&&h[x][l-1]<h[x+1][l-1])&&(h[x][l-1]=0,e[4*(x*s+(l-1))+3]=0,u[f]=-1),f=u[a(348)](4),-1!==f&&h[x][l]>=h[x][l+1]&&(u[a(360)](2)&&h[x][l+1]<h[x-1][l+1]||u.includes(7)&&h[x][l+1]<h[x+1][l+1])&&(h[x][l+1]=0,e[4*(x*s+(l+1))+3]=0,u[f]=-1),u[a(360)](1)&&u.includes(3)&&u[a(360)](4)&&(h[x-1][l]=0,e[4*((x-1)*s+l)+3]=0),u[a(360)](3)&&u[a(360)](1)&&u.includes(6)&&(h[x][l-1]=0,e[4*(x*s+(l-1))+3]=0),u[a(360)](4)&&u[a(360)](1)&&u[a(360)](6)&&(h[x][l+1]=0,e[4*(x*s+(l+1))+3]=0),u[a(360)](6)&&u.includes(3)&&u[a(360)](4)&&(h[x+1][l]=0,e[4*((x+1)*s+l)+3]=0)}}else e[4*(x*s+l)+3]=0;for(y=0,x=0;x<c;x++)for(l=0;l<s;l++)if(h[x][l]>0&&(y=0,l>0&&x>0&&h[x-1][l-1]>0&&(u[y++]=0),x>0&&h[x-1][l]>0&&(u[y++]=1),l<s-1&&x>0&&h[x-1][l+1]>0&&(u[y++]=2),l>0&&h[x][l-1]>0&&(u[y++]=3),l<s-1&&h[x][l+1]>0&&(u[y++]=4),l>0&&x<c-1&&h[x+1][l-1]>0&&(u[y++]=5),x<c-1&&h[x+1][l]>0&&(u[y++]=6),l<s-1&&x<c-1&&h[x+1][l+1]>0&&(u[y++]=7),y>=2)){for(f=y;f<u[a(311)];f++)u[f]=-1;u[a(360)](4)&&h[x][l]<h[x][l+1]&&(u[a(360)](2)&&h[x][l]<h[x-1][l+1]||u[a(360)](7)&&h[x][l]<h[x+1][l+1])&&(h[x][l]=0,e[f+3]=0),u.includes(3)&&h[x][l]<h[x][l-1]&&(u[a(360)](0)&&h[x][l]<h[x-1][l-1]||u[a(360)](5)&&h[x][l]<h[x+1][l-1])&&(h[x][l]=0,e[f+3]=0)}for(x=t[a(355)][a(306)];x<t[a(355)][a(330)];x++)for(l=t.visibleRange[a(341)];l<t.visibleRange.right;l++)h[x][l]>0&&(f=4*(x*s+l),e[f+3]=d[3],n[2*o]=l,n[2*o+1]=x,r[o++]=f);return{imageData:e,indexListCount:o,indexList:r,coordList:n}}(t[a(322)](0,0,e.imageSize.x,e[a(335)].y)[a(357)],e)}(e,t);2===e[a(342)]&&(e[a(314)]=e.primaryColor,e[a(342)]=3,e[a(323)]=1);const r={...e,style:2,primaryColor:e[a(314)]},n={...e,style:1},o=d(r,t);t[a(312)](0,0,e[a(335)].x,e.imageSize.y);const s=c(n,t),f=(0,i.X$)(e[a(335)].x*e[a(335)].y,e[a(335)].x*e.imageSize.y*4,!0),l=(0,i.X$)(e.imageSize.x*e.imageSize.y*2,Math[a(343)](e[a(335)].x,e[a(335)].y),!0);let x=0,h=0,g=0,m=0,u=!1;for(g=e.visibleRange[a(306)];g<e[a(355)][a(330)];g++)for(h=e[a(355)][a(341)];h<e[a(355)][a(337)];h++)m=4*(g*e[a(335)].x+h),u=!1,o[a(350)][m+3]>e[a(314)][3]/2&&((0,i.Yr)(o[a(350)],m,e[a(314)],0),u=!0),s[a(350)][m+3]>e.primaryColor[3]/2&&((0,i.Yr)(o.imageData,m,s[a(350)],m),u=!0),u&&(l[2*x]=h,l[2*x+1]=g,f[x++]=m);return{imageData:o[a(350)],indexListCount:x,indexList:f,coordList:l}}function d(e,t){const a=a53_0x22d4;e[a(305)].drawShape(e,t);const r=t[a(322)](0,0,e[a(335)].x,e.imageSize.y)[a(357)],n=(0,i.X$)(e[a(335)].x*e[a(335)].y,e.imageSize.x*e[a(335)].y*4,!0),o=(0,i.X$)(e[a(335)].x*e[a(335)].y*2,Math[a(343)](e[a(335)].x,e[a(335)].y),!0);let s=0,c=0,d=0,f=0;if(e[a(302)])for(d=e[a(355)][a(306)];d<e[a(355)][a(330)];d++)for(c=e[a(355)].left;c<e[a(355)][a(337)];c++)f=4*(d*e[a(335)].x+c),r[f+3]>0&&(o[2*s]=c,o[2*s+1]=d,n[s++]=4*(d*e[a(335)].x+c));else for(d=e[a(355)][a(306)];d<e[a(355)][a(330)];d++)for(c=e[a(355)].left;c<e.visibleRange.right;c++)f=4*(d*e.imageSize.x+c),r[f+3]>e[a(334)][3]/2&&(r[f+3]=e[a(334)][3],o[2*s]=c,o[2*s+1]=d,n[s++]=4*(d*e[a(335)].x+c));return{imageData:r,indexListCount:s,indexList:n,coordList:o}}function f(e,t){const a=a53_0x22d4,i=t.left-Math[a(303)](e[a(341)]),r=i+(0,n.Oq)(t),o=t[a(306)]-Math[a(303)](e.top);return{left:i,right:r,top:o,bottom:o+(0,n.rY)(t)}}},7742:(e,t,a)=>{a.d(t,{ap:()=>r,TO:()=>n,zg:()=>o});var i=a(1003);function r(e,t){const a=a53_0x22d4,i=e[t];if(i[a(327)]<1||i.height<1)throw new Error(a(352)+t+a(331)+i[a(327)]+a(321)+i.height)}function n(e,t,a){const i=a53_0x22d4,r=e[t],n=e[a];if(r.width===n[i(327)]&&r[i(320)]===n[i(320)])throw new Error(i(344)+t+i(353)+a+i(313))}function o(e,t,a){const r=e[t];if(!(0,i.ur)(a,r))throw new Error('Range "'+t+'" '+(0,i.PW)(r)+" must be contained within "+(0,i.PW)(a))}}}]);